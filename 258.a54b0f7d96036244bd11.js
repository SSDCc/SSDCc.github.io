"use strict";(self.webpackChunktailchat_web=self.webpackChunktailchat_web||[]).push([[258],{75209:(Fe,V,t)=>{t.d(V,{Y:()=>Me,d:()=>_e});var r=t(52983),n=t(98281),l=t(7975),s=t(93540),e=t(20685);function a(h){const S=(0,r.useMemo)(()=>l.messageInterpreter.map(({name:L,explainMessage:ue})=>({name:L,render:ue(h)})).filter(({render:L})=>L!==null),[h]);return S.length===0?null:r.createElement("span",{className:"align-middle hidden group-hover:inline-block"},r.createElement(e.Z,{placement:"topLeft",title:(0,n.t)("\u6D88\u606F\u89E3\u91CA"),content:r.createElement("div",{className:"max-w-lg"},S.map((L,ue)=>{var H;return r.createElement("p",{key:ue+((H=L.name)!=null?H:"")},L.name&&r.createElement("span",null,(0,n.t)("\u6765\u81EA")," ",r.createElement("span",{className:"font-bold"},L.name)," :"," "),L.render)})),trigger:"click"},r.createElement(s.JO,{className:"cursor-pointer text-base",icon:"mdi:file-question-outline"})))}var N=t(96136),O=t(75217),b=t(66559),f=t(14517),P=t(84208),A=t(86724),R=t.n(A),M=t(6494),I=t.n(M),B=(h,S,L)=>new Promise((ue,H)=>{var Ce=fe=>{try{Ee(L.next(fe))}catch(Le){H(Le)}},Ae=fe=>{try{Ee(L.throw(fe))}catch(Le){H(Le)}},Ee=fe=>fe.done?ue(fe.value):Promise.resolve(fe.value).then(Ce,Ae);Ee((L=L.apply(h,S)).next())});function w(h,S){var L;const ue=(0,n.xMc)(),H=(0,n.rE2)(),Ce=(0,n.Pc$)(),[Ae]=(0,n.WHr)((L=H==null?void 0:H._id)!=null?L:"",[n.g3S.core.deleteMessage]),Ee=(0,r.useCallback)(()=>{R()((0,l.getMessageTextDecorators)().serialize(h.content)),(0,n.jiy)((0,n.t)("\u590D\u5236\u7EAF\u6587\u672C\u6210\u529F"))},[h.content]),[,fe]=(0,n.CoE)(()=>B(this,null,function*(){(yield(0,P.aW)())&&(yield(0,n.peM)(h._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u64A4\u56DE\u6210\u529F")))}),[h._id]),[,Le]=(0,n.CoE)(()=>B(this,null,function*(){(yield(0,P.aW)())&&(yield(0,n.$Zg)(h._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u5220\u9664\u6210\u529F")))}),[h._id]),et=H&&H.owner===(Ce==null?void 0:Ce._id),d=h.author===(Ce==null?void 0:Ce._id);return{onClick:S.onClick,items:I()([{key:"copy",label:(0,n.t)("\u590D\u5236"),icon:r.createElement(s.JO,{icon:"mdi:content-copy"}),onClick:Ee},ue.hasContext&&{key:"reply",label:(0,n.t)("\u56DE\u590D"),icon:r.createElement(s.JO,{icon:"mdi:reply"}),onClick:()=>n.Agn.emit("replyMessage",h)},(et||d)&&{key:"recall",label:(0,n.t)("\u64A4\u56DE"),icon:r.createElement(s.JO,{icon:"mdi:restore"}),onClick:fe},Ae&&{key:"delete",label:(0,n.t)("\u5220\u9664"),danger:!0,icon:r.createElement(s.JO,{icon:"mdi:delete-outline"}),onClick:Le}])}}var _=t(53652),X=t(71607),ce=t.n(X),ee=Object.defineProperty,K=Object.defineProperties,D=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,Z=(h,S,L)=>S in h?ee(h,S,{enumerable:!0,configurable:!0,writable:!0,value:L}):h[S]=L,J=(h,S)=>{for(var L in S||(S={}))m.call(S,L)&&Z(h,L,S[L]);if(W)for(var L of W(S))y.call(S,L)&&Z(h,L,S[L]);return h},se=(h,S)=>K(h,D(S));const de=r.createContext({closePopover:ce()}),pe=r.memo(h=>{const[S,L]=(0,r.useState)(!1),ue=(0,r.useCallback)(Ae=>{L(Ae),typeof h.onOpenChange=="function"&&h.onOpenChange(Ae)},[h.onOpenChange]),H=(0,r.useCallback)(()=>{L(!1),typeof h.onOpenChange=="function"&&h.onOpenChange(!1)},[]),Ce=(0,r.useMemo)(()=>({closePopover:H}),[H]);return r.createElement(de.Provider,{value:Ce},r.createElement(e.Z,se(J({},h),{open:S,onOpenChange:ue})))});pe.displayName="TcPopover";function De(){var h;const S=(0,r.useContext)(de);return{closePopover:(h=S==null?void 0:S.closePopover)!=null?h:ce()}}var ge=(h,S,L)=>new Promise((ue,H)=>{var Ce=fe=>{try{Ee(L.next(fe))}catch(Le){H(Le)}},Ae=fe=>{try{Ee(L.throw(fe))}catch(Le){H(Le)}},Ee=fe=>fe.done?ue(fe.value):Promise.resolve(fe.value).then(Ce,Ae);Ee((L=L.apply(h,S)).next())});function xe(h){const S=(0,n.ysv)(h);return(0,r.useMemo)(()=>()=>{const{closePopover:ue}=De(),[,H]=(0,n.CoE)(Ce=>ge(this,null,function*(){yield(0,n.rUo)(S.current._id,Ce),ue()}),[]);return r.createElement(_._,{onSelect:H})},[])}var Be=t(39907),Ze=t.n(Be),Ke=t(3010),ke=t.n(Ke),je=t(89022),Xe=t.n(je),He=t(95268);const $e=r.memo(h=>{const{reaction:S,onClick:L}=h,ue=(0,n.R8f)(S.users);return r.createElement("div",{className:"py-0.5 px-1 bg-black bg-opacity-20 hover:bg-opacity-40 rounded cursor-pointer"},r.createElement(He.Z,{title:ue.join(", ")},r.createElement("div",{className:"flex",onClick:L},r.createElement(_.d,{emoji:S.name}),r.createElement("div",{className:"ml-1 text-xs"},ue.length<3?r.createElement("span",null,Xe()(ue,2).join(",")):r.createElement("span",null,Xe()(ue,2).join(", "),", ...+",ue.length-2)))))});$e.displayName="ReactionItem";function qe(h){var S;const L=h._id,ue=(S=h.reactions)!=null?S:[],H=(0,n.IIz)(),Ce=(0,r.useMemo)(()=>{const Ee=Ze()(ue,"name");return Object.keys(Ee).map(fe=>{const Le=ke()(Ee[fe],"author");return{name:fe,length:Le.length,users:Le.map(et=>et.author)}})},[ue]),Ae=(0,r.useCallback)(Ee=>{!(0,n.YQu)(H)||(Ee.users.includes(H)?(0,n.WOV)(L,Ee.name):(0,n.rUo)(L,Ee.name))},[L,H]);return r.createElement("div",{className:"flex chat-message-reactions space-x-1 py-0.5"},Ce.map(Ee=>r.createElement($e,{key:Ee.name,reaction:Ee,onClick:()=>Ae(Ee)})))}var Qe=t(22398),Ye=t(16365),ie=t(51052),Y=t(29787),me=t.n(Y),Pe=Object.defineProperty,be=Object.defineProperties,Ue=Object.getOwnPropertyDescriptors,Se=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,k=(h,S,L)=>S in h?Pe(h,S,{enumerable:!0,configurable:!0,writable:!0,value:L}):h[S]=L,Q=(h,S)=>{for(var L in S||(S={}))j.call(S,L)&&k(h,L,S[L]);if(Se)for(var L of Se(S))U.call(S,L)&&k(h,L,S[L]);return h},$=(h,S)=>be(h,Ue(S));const he=r.memo(({payload:h})=>{const S=(0,r.useMemo)(()=>new n.NtG(h).hasReply(),[h]);return S===!1?null:r.createElement("div",{className:"chat-message-item_quote border-l-4 border-black border-opacity-20 pl-2 opacity-80"},(0,n.t)("\u56DE\u590D")," ",r.createElement(b.v,{userId:String(S.author)}),":"," ",r.createElement("span",null,(0,l.getMessageRender)(S.content)))});he.displayName="MessageQuote";const ye=h=>r.createElement("div",{className:"px-0.5 w-6 h-6 flex justify-center items-center opacity-60 hover:opacity-100"},r.createElement(s.JO,{icon:h.icon})),Me=r.memo(h=>{var S,L;const{showAvatar:ue,payload:H,hideAction:Ce=!1}=h,Ae=(0,n.xzJ)((S=H.author)!=null?S:""),[Ee,fe]=(0,r.useState)(!1),Le=qe(H),et=xe(H),d=w(H,{onClick:()=>{fe(!1)}}),F=Ce===!0||H.isLocal===!0||H.sendFailed===!0;return r.createElement("div",{className:(0,f.Z)("chat-message-item flex px-2 mobile:px-0 group relative select-text text-sm",{"bg-black bg-opacity-10":Ee,"hover:bg-black hover:bg-opacity-5":!Ee}),"data-message-id":H._id},r.createElement("div",{className:"w-18 mobile:w-14 flex items-start justify-center pt-0.5"},ue?r.createElement(e.Z,{content:!me()(Ae)&&r.createElement(ie.Z,{userInfo:Ae}),placement:"top",trigger:"click"},r.createElement(s.qE,{className:"cursor-pointer",size:40,src:Ae.avatar,name:Ae.nickname})):r.createElement("div",{className:"hidden group-hover:block opacity-40"},(0,n.vMv)(H.createdAt))),r.createElement("div",{className:"flex flex-col flex-1 overflow-auto group",onContextMenu:Qe.UW},ue&&r.createElement("div",{className:"flex items-center"},r.createElement("div",{className:"font-bold"},(L=Ae.nickname)!=null?L:r.createElement("span",null,"\xA0")),r.createElement("div",{className:"hidden group-hover:block opacity-40 ml-1 text-sm"},(0,n.vMv)(H.createdAt))),r.createElement(s.wb,{maxHeight:340,backgroundColor:"var(--tc-content-background-color)",showFullText:r.createElement("div",{className:"inline-block rounded-full bg-white dark:bg-black opacity-80 py-2 px-3 hover:opacity-100"},(0,n.t)("\u70B9\u51FB\u5C55\u5F00\u66F4\u591A"))},r.createElement("div",{className:"chat-message-item_body leading-6 break-words"},r.createElement(he,{payload:H}),r.createElement("span",null,(0,l.getMessageRender)(H.content)),H.sendFailed===!0&&r.createElement(s.JO,{className:"inline-block ml-1",icon:"emojione:cross-mark-button"}),a(H.content))),r.createElement("div",null,l.pluginMessageExtraParsers.map(p=>r.createElement(r.Fragment,{key:p.name},p.render(H)))),Le),!F&&r.createElement("div",{className:(0,f.Z)("bg-white dark:bg-black rounded absolute right-2 cursor-pointer -top-3 shadow-sm flex",{"opacity-0 group-hover:opacity-100 bg-opacity-80 hover:bg-opacity-100":!Ee,"opacity-100 bg-opacity-100":Ee})},r.createElement(pe,{overlayClassName:"chat-message-item_action-popover",content:et,placement:"bottomLeft",trigger:["click"],onOpenChange:fe},r.createElement("div",null,r.createElement(ye,{icon:"mdi:emoticon-happy-outline"}))),r.createElement(N.Z,{menu:d,placement:"bottomLeft",trigger:["click"],onOpenChange:fe},r.createElement("div",null,r.createElement(ye,{icon:"mdi:dots-horizontal"})))))});Me.displayName="NormalMessage";const Oe=r.memo(({payload:h})=>r.createElement("div",{className:"text-center"},r.createElement("div",{className:"bg-black bg-opacity-20 rounded inline-block py-0.5 px-2 my-1 text-sm"},h.content)));Oe.displayName="SystemMessage";const Re=r.memo(h=>{const L=(0,n.FDf)(h.userIds).map(ue=>ue.nickname);return r.createElement(Oe,$(Q({},h),{payload:h.overwritePayload(L)}))});Re.displayName="SystemMessageWithNickname";const Ge=r.memo(h=>{var S;const L=h.payload;return L.author===n.q6$?r.createElement(Oe,Q({},h)):L.hasRecall===!0?r.createElement(Re,$(Q({},h),{userIds:[(S=L.author)!=null?S:n.q6$],overwritePayload:ue=>$(Q({},L),{content:(0,n.t)("{{nickname}} \u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F",{nickname:ue[0]||""})})})):r.createElement(Me,Q({},h))});Ge.displayName="ChatMessageItem";function _e(h,S){var L,ue;const H=h[S];if(!H)return r.createElement("div",null);let Ce=!0,Ae=!0;const Ee=new Date((L=H.createdAt)!=null?L:"");if(S>0){const fe=h[S-1];(0,n.Nvc)(new Date((ue=fe.createdAt)!=null?ue:""),Ee)||(Ce=!1),Ce===!1&&(Ae=fe.author!==H.author||fe.hasRecall===!0)}return r.createElement("div",{key:H._id},Ce&&r.createElement(O.Z,{className:"text-sm opacity-40 px-6 font-normal select-text"},(0,n.omK)(Ee)),H.isLocal===!0?r.createElement("div",{className:"opacity-50"},r.createElement(Ge,{showAvatar:Ae,payload:H})):r.createElement(Ye.H,{converseId:H.converseId,messageId:H._id},r.createElement(Ge,{showAvatar:Ae,payload:H})))}},81244:(Fe,V,t)=>{t.d(V,{X:()=>b});var r=t(52983),n=t(98281),l=t(93540);const s=r.memo(f=>r.createElement("div",{className:"px-5 pb-4 pt-8"},r.createElement("div",{className:"font-extrabold mb-2 text-2xl flex items-center space-x-1"},r.createElement(l.JO,{icon:"mdi:pound"}),r.createElement("div",null,f.title)),r.createElement("div",{className:"text-base opacity-80"},(0,n.t)("\u8FD9\u91CC\u662F\u6240\u6709\u6D88\u606F\u7684\u5F00\u59CB\uFF0C\u8BF7\u7545\u6240\u6B32\u8A00\u3002"))));s.displayName="ChatMessageHeader";var e=t(75209),a=t(79861);const N=100,O=40,b=r.memo(f=>{const P=(0,r.useRef)(null),A=(0,r.useRef)(!1),[R,M]=(0,r.useState)(!1),I=(0,n.nWw)(()=>{var w;(w=P.current)==null||w.scrollTo({top:0,behavior:"smooth"})});(0,r.useEffect)(()=>{f.messages.length!==0&&A.current===!1&&I()},[f.messages.length]),(0,n.JtK)("sendMessage",I);const B=(0,r.useCallback)(()=>{f.messages.length!==0&&(!P.current||(-P.current.scrollTop<=O?(A.current=!1,M(!1)):-P.current.scrollTop+P.current.clientHeight>=P.current.scrollHeight-N?f.onLoadMore():(A.current=!0,M(!0))))},[f.messages]);return r.createElement("div",{className:"flex-1 overflow-y-scroll overflow-x-hidden flex flex-col-reverse",ref:P,onScroll:B},r.createElement("div",null,f.messages.map((w,_,X)=>(0,e.d)(X,_))),R&&r.createElement(a.a,{onClick:I}),f.title&&!f.hasMoreMessage&&r.createElement(s,{title:f.title}))});b.displayName="NormalMessageList"},79861:(Fe,V,t)=>{t.d(V,{a:()=>l});var r=t(52983),n=t(93540);const l=r.memo(s=>r.createElement("div",{className:"absolute right-10 bottom-18 px-3 py-2 rounded-full bg-white dark:bg-black bg-opacity-50 shadow cursor-pointer z-10 w-11 h-11 flex justify-center items-center text-2xl hover:bg-opacity-80",onClick:s.onClick},r.createElement(n.JO,{icon:"mdi:chevron-double-down"})));l.displayName="ScrollToBottom"},94229:(Fe,V,t)=>{t.d(V,{r:()=>et});var r=t(7975),n=t(52983),l=t(98281),s=t(21597),e=t(55696);const a=n.memo(()=>{const d={rows:1};return n.createElement("div",{className:"px-2 w-2/3"},n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(e.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}))});a.displayName="ChatBoxPlaceholder";var N=t(64750),O=t(93540),b=t(96136),f=t(29254),P=t(84208),A=t(63933),R=t(44411),M=t(75526),I=(d,F,p)=>new Promise((te,q)=>{var re=z=>{try{ae(p.next(z))}catch(le){q(le)}},ne=z=>{try{ae(p.throw(z))}catch(le){q(le)}},ae=z=>z.done?te(z.value):Promise.resolve(z.value).then(re,ne);ae((p=p.apply(d,F)).next())});const B=n.memo(d=>{const{imageUrl:F,forceUploadOriginImage:p}=d,te=(0,n.useRef)({width:0,height:0}),[q,re]=(0,n.useState)(p??!1),[{loading:ne},ae]=(0,l.ilX)(()=>I(void 0,null,function*(){if(te.current.width===0||te.current.height===0){(0,l.lHp)((0,l.t)("\u64CD\u4F5C\u8FC7\u4E8E\u9891\u7E41"),"warning");return}typeof d.onConfirm=="function"&&(yield Promise.resolve(d.onConfirm({size:te.current,uploadOriginImage:q})))}),[d.onConfirm,q]);(0,A.q)(le=>{(0,N.rR)(le)?(le.stopPropagation(),le.preventDefault(),ae()):(0,N.$)(le)&&(le.stopPropagation(),d.onCancel())},{capture:!0});const z=(0,n.useCallback)(le=>{const We=le.currentTarget;te.current={width:We.naturalWidth,height:We.naturalHeight}},[]);return n.createElement(P.AB,{style:{maxHeight:"60vh",maxWidth:"60vw"}},n.createElement("div",{className:"flex"},n.createElement("div",{className:"w-2/3 p-2.5 bg-black bg-opacity-20 rounded"},n.createElement("img",{className:"max-h-72 m-auto",src:F,onLoad:z})),n.createElement("div",{className:"w-1/3 p-2 flex flex-col items-end justify-between"},n.createElement("div",{className:"text-right"},n.createElement("div",{className:"text-lg"},(0,l.t)("\u4E0A\u4F20\u56FE\u7247\u5230\u4F1A\u8BDD")),n.createElement("div",{className:"text-sm text-gray-400"},(0,l.t)("\u8BF7\u52FF\u4E0A\u4F20\u8FDD\u53CD\u5F53\u5730\u6CD5\u5F8B\u6CD5\u89C4\u7684\u56FE\u7247"))),n.createElement("div",{className:"w-full"},n.createElement("div",{className:"text-left"},n.createElement(R.Z,{disabled:typeof p!="undefined",checked:q,onChange:le=>re(le)}),n.createElement("span",null,(0,l.t)("\u4E0A\u4F20\u539F\u56FE"))),n.createElement("div",{className:"text-right"},n.createElement(M.Z,{className:"mt-4",type:"primary",loading:ne,onClick:ae},(0,l.t)("\u786E\u8BA4")))))))});B.displayName="ImageUploadPreviewer";var w=t(74774),_=t(83996),X=(d,F,p)=>new Promise((te,q)=>{var re=z=>{try{ae(p.next(z))}catch(le){q(le)}},ne=z=>{try{ae(p.throw(z))}catch(le){q(le)}},ae=z=>z.done?te(z.value):Promise.resolve(z.value).then(re,ne);ae((p=p.apply(d,F)).next())});function ce(d){return new Promise(F=>{(0,w.Fy)(d).then(p=>{const te=(0,P.h7)(n.createElement(B,{imageUrl:p,forceUploadOriginImage:(0,_.w)(d.type)?void 0:!0,onCancel:()=>{(0,P.Mr)(te)},onConfirm:q=>X(this,null,function*(){let re=d;if(q.uploadOriginImage===!1){const le=d.size;re=yield(0,w.hv)(d);const We=re.size;console.log(`\u538B\u7F29\u7ED3\u679C: ${We/le*100}%(${le} -> ${We})`)}const z=(yield(0,l.cTq)(re)).url;F({url:z,width:q.size.width,height:q.size.height}),(0,P.Mr)(te)})}))})})}function ee(d){return X(this,null,function*(){const F=yield(0,l.cTq)(d);return{name:d.name||F.etag,url:F.url}})}var K=t(14517),D=(d,F,p)=>new Promise((te,q)=>{var re=z=>{try{ae(p.next(z))}catch(le){q(le)}},ne=z=>{try{ae(p.throw(z))}catch(le){q(le)}},ae=z=>z.done?te(z.value):Promise.resolve(z.value).then(re,ne);ae((p=p.apply(d,F)).next())});const W=n.memo(()=>{const[d,F]=(0,n.useState)(!1),p=(0,f.at)();if(p===null)return null;const te=ne=>{const ae=ne;ae&&ce(ae).then(({url:z,width:le,height:We})=>{p.sendMsg((0,r.getMessageTextDecorators)().image(z,{width:le,height:We}))})},q=ne=>{ne&&ee(ne).then(({name:ae,url:z})=>{p.sendMsg((0,r.getMessageTextDecorators)().card(ae,{type:"file",url:z}))})},re={items:[{key:"send-image",label:(0,l.t)("\u53D1\u9001\u56FE\u7247"),onClick:()=>D(void 0,null,function*(){F(!1);const ne=yield(0,w.ZB)({accept:"image/*"});ne&&te(ne)})},{key:"send-file",label:(0,l.t)("\u53D1\u9001\u6587\u4EF6"),onClick:()=>D(void 0,null,function*(){F(!1);const ne=yield(0,w.ZB)();ne&&q(ne)})},...r.pluginChatInputActions.map((ne,ae)=>({key:ne.label+ae,label:ne.label,onClick:()=>{ne.onClick(p),F(!1)}}))]};return n.createElement(b.Z,{menu:re,open:d,onOpenChange:F,placement:"topRight",trigger:["click"]},n.createElement("div",null,n.createElement(O.JO,{className:(0,K.Z)("text-2xl cursor-pointer transition transform",{"rotate-45":d}),icon:"mdi:plus-circle-outline"})))});W.displayName="ChatInputAddon";class m{constructor(F){this.event=F}get data(){return this.event.clipboardData}get builtinHandlers(){const F={name:"pasteUrl",label:(0,l.t)("\u8F6C\u4E3AUrl\u5BCC\u6587\u672C"),match:p=>p.clipboardData.getData("text/plain").startsWith("http"),handler:(p,{applyMessage:te})=>{te((0,r.getMessageTextDecorators)().url(p.text))}};return[]}get pasteHandlers(){return[...this.builtinHandlers,...r.pluginChatInputPasteHandler]}hasImage(){const F=this.isPasteImage(this.data.items);if(F===!1)return!1;const p=F.getAsFile();return p===null?!1:p}matchPasteHandler(){return this.pasteHandlers.filter(p=>p.match(this.event))}isPasteImage(F){let p=0,te;for(;p<F.length;){if(te=F[p],te.type.indexOf("image")!==-1)return te;p++}return!1}}var y=t(9021),Z=t(22398),J=t(49723);const se=n.memo(d=>n.createElement("div",{className:"flex items-center py-2 px-3"},n.createElement(O.JO,{className:"mr-1 text-lg",icon:d.icon}),n.createElement("div",null,d.label)));se.displayName="MentionCommandItem";const de={input:{overflow:"auto",maxHeight:70},highlighter:{boxSizing:"border-box",overflow:"hidden",maxHeight:70}},pe=n.memo(d=>{const{users:F,panels:p,placeholder:te,disabled:q}=(0,f.TD)();return n.createElement(J.r,{inputRef:d.inputRef,className:"chatbox-mention-input",placeholder:te??(0,l.t)("\u8F93\u5165\u4E00\u4E9B\u4EC0\u4E48"),disabled:q,style:de,maxLength:1e3,value:d.value,onChange:(re,ne,ae,z)=>d.onChange(ne,z.filter(le=>le.display.startsWith("@")).map(le=>le.id)),onKeyDown:d.onKeyDown,onPaste:d.onPaste,onContextMenu:Z.UW,allowSuggestionsAboveCursor:!0,forceSuggestionsAboveCursor:!0},n.createElement(J.p,{trigger:"@",data:F,displayTransform:(re,ne)=>`@${ne}`,appendSpaceOnAdd:!0,renderSuggestion:re=>n.createElement(y.Q,{userId:String(re.id)}),markup:(0,r.getMessageTextDecorators)().mention("__id__","__display__")}),n.createElement(J.p,{trigger:"#",data:p,displayTransform:(re,ne)=>`#${ne}`,appendSpaceOnAdd:!0,renderSuggestion:re=>{var ne;return n.createElement(se,{icon:"mdi:pound",label:(ne=re.display)!=null?ne:String(re.id)})},markup:(0,r.getMessageTextDecorators)().url("__id__","#__display__")}))});pe.displayName="ChatInputBoxInput";var De=t(53652),ge=t(28723);const xe=n.memo(()=>{const d=(0,f.at)(),{appendMsg:F}=d;return n.createElement(ge.L,{overlayClassName:"emotion-popover",icon:"mdi:emoticon-happy-outline",popoverContent:({hidePopover:p})=>n.createElement(De._,{onSelect:te=>{F(te),p()}})})});xe.displayName="ChatInputEmotion";var Be=t(90292),Ze=t.n(Be),Ke=t(37980),ke=t(22659);const je=n.memo(()=>{const d=(0,f.at)(),F=(0,l.zX9)(q=>{const re=q[0];!re||(re.type.startsWith("image/")?ce(re).then(({url:ne,width:ae,height:z})=>{d==null||d.sendMsg((0,r.getMessageTextDecorators)().image(ne,{width:ae,height:z}))}):ee(re).then(({url:ne,name:ae})=>{d==null||d.sendMsg((0,r.getMessageTextDecorators)().card(ae,{type:"file",url:ne}))}))}),[p,te]=(0,Ke.L)({accept:[ke.FILE],drop(q){F(q.files)},canDrop(q){return!0},collect:q=>({isOver:q.isOver(),canDrop:q.canDrop()})});return p.canDrop?n.createElement("div",{ref:te,className:"absolute inset-0 bg-white bg-opacity-50 dark:bg-black dark:bg-opacity-50 p-4"},n.createElement("div",{className:"h-full w-full border-dashed border-8 flex flex-col justify-center items-center"},n.createElement("div",null,n.createElement(O.JO,{icon:"mdi:cloud-upload",fontSize:128})),n.createElement("div",{className:"text-xl font-bold"},(0,l.t)("\u62D6\u653E\u6587\u4EF6\u4EE5\u53D1\u9001\u5230\u5F53\u524D\u4F1A\u8BDD")))):null});je.displayName="ChatDropArea";function Xe(){const[d,F]=(0,n.useState)(null);return(0,A.q)(q=>{d!==null&&((0,N.ks)(q)||(0,N.FF)(q))&&F(null)}),{runPasteHandlers:(0,l.zX9)((q,re,ne)=>{const ae=re.clipboardData,z={files:ae.files,text:ae.getData("text/plain")};q.length===1?(console.log(`Running paste handler: ${q[0].name}`),re.stopPropagation(),re.preventDefault(),q[0].handler(z,ne)):q.length>=2&&F(n.createElement("div",{className:"absolute bottom-2 bg-content-light bg-opacity-90 dark:bg-content-dark dark:bg-opacity-90 border dark:border-gray-900 shadow rounded px-2 py-1 space-y-1 w-72"},n.createElement("div",null,(0,l.t)("\u770B\u8D77\u6765\u6709\u591A\u4E2A\u526A\u5207\u677F\u5904\u7406\u5DE5\u5177\u88AB\u540C\u65F6\u5339\u914D\uFF0C\u8BF7\u9009\u62E9\u5176\u4E2D\u4E00\u9879\u6216\u8005\u5FFD\u7565")),q.map(le=>n.createElement("div",{key:le.name,className:"bg-black bg-opacity-40 hover:bg-opacity-80 rounded px-2 py-1 cursor-pointer",onClick:()=>{console.log(`Running paste handler: ${le.name}`),le.handler(z,ne),F(null)}},le.label))))}),pasteHandlerContainer:n.createElement("div",{className:"absolute top-0"},d)}}var He=(d,F,p)=>new Promise((te,q)=>{var re=z=>{try{ae(p.next(z))}catch(le){q(le)}},ne=z=>{try{ae(p.throw(z))}catch(le){q(le)}},ae=z=>z.done?te(z.value):Promise.resolve(z.value).then(re,ne);ae((p=p.apply(d,F)).next())});const $e=n.memo(d=>{const F=(0,n.useRef)(null),[p,te]=(0,n.useState)(""),[q,re]=(0,n.useState)([]),{disabled:ne}=(0,f.TD)(),{runPasteHandlers:ae,pasteHandlerContainer:z}=Xe(),le=(0,l.zX9)((Ne,we)=>He(void 0,null,function*(){var at;yield d.onSendMsg(Ne,we),te(""),(at=F.current)==null||at.focus()})),We=(0,l.zX9)(()=>{le(p,{mentions:Ze()(q)})}),nt=(0,l.zX9)(Ne=>{var we;te(p+Ne),(we=F.current)==null||we.focus()}),Te=(0,l.zX9)(Ne=>{(0,N.rR)(Ne.nativeEvent)&&(Ne.preventDefault(),We())}),ze=(0,l.zX9)(Ne=>{const we=Ne.currentTarget,at=new m(Ne);if(!we.value){const ot=at.matchPasteHandler();if(ot.length>0){ae(ot,Ne,{sendMessage:le,applyMessage:te});return}}const st=at.hasImage();st&&(Ne.preventDefault(),ce(st).then(({url:ot,width:ut,height:lt})=>{d.onSendMsg((0,r.getMessageTextDecorators)().image(ot,{width:ut,height:lt}))}))});return(0,l.JtK)("replyMessage",Ne=>He(void 0,null,function*(){if(F.current&&(F.current.focus(),Ne&&(0,l.YQu)(Ne==null?void 0:Ne.author))){const we=yield(0,l.pGV)(Ne.author);te(`${(0,r.getMessageTextDecorators)().mention(Ne.author,we.nickname)} ${p}`)}})),n.createElement(f.zB.Provider,{value:{message:p,setMessage:te,sendMsg:d.onSendMsg,appendMsg:nt}},n.createElement("div",{className:"px-4 py-2"},n.createElement("div",{className:"bg-white dark:bg-gray-600 flex rounded-md items-center relative"},n.createElement("div",{className:"flex-1 w-0"},n.createElement(pe,{inputRef:F,value:p,onChange:(Ne,we)=>{te(Ne),re(we)},onKeyDown:Te,onPaste:ze})),z,!ne&&n.createElement(n.Fragment,null,n.createElement("div",{className:"px-2 flex space-x-1"},r.pluginChatInputButtons.map((Ne,we)=>n.cloneElement(Ne.render(),{key:`plugin-chatinput-btn#${we}`})),n.createElement(xe,null),p?n.createElement(O.JO,{icon:"mdi:send-circle-outline",className:"text-2xl cursor-pointer",onClick:We}):n.createElement(W,null)),n.createElement(je,null)))))});$e.displayName="ChatInputBox";var qe=t(38887),Qe=t(81244),Ye=t(75209),ie=t(6342),Y=t(79861),me=Math.pow;const Pe=me(10,7),be={height:"100%"},Ue={main:1e3,reverse:1e3},Se=n.memo(d=>{const F=(0,n.useRef)(null),p=(0,n.useRef)(),te=j(d.messages),q=(0,l.nWw)(()=>{var Te,ze;(ze=F.current)==null||ze.scrollTo({top:(Te=p.current)==null?void 0:Te.scrollHeight,behavior:"smooth"})});(0,l.JtK)("sendMessage",q);const re=(0,l.nWw)(()=>{d.isLoadingMore||d.hasMoreMessage&&d.onLoadMore()}),ne=(0,l.nWw)(Te=>(Te&&setTimeout(()=>{var ze;(ze=F.current)==null||ze.autoscrollToBottom()},20),Te?"smooth":!1)),ae=(0,l.nWw)((Te,ze)=>ze?ze._id:Te),z=(0,l.nWw)(Te=>{const ze=Te+te-Pe;return(0,Ye.d)(d.messages,ze)}),[le,We]=(0,n.useState)(!1),nt=(0,l.nWw)(Te=>{We(!Te)});return n.createElement("div",{className:"flex-1"},n.createElement(ie.OO,{style:be,ref:F,scrollerRef:Te=>p.current=Te,firstItemIndex:Pe-te,initialTopMostItemIndex:Math.max(d.messages.length-1,0),computeItemKey:ae,totalCount:d.messages.length,overscan:Ue,itemContent:z,alignToBottom:!0,startReached:re,atBottomStateChange:nt,followOutput:ne,defaultItemHeight:25,atTopThreshold:100,atBottomThreshold:40,useWindowScroll:!1}),le&&n.createElement(Y.a,{onClick:q}))});Se.displayName="VirtualizedMessageList";function j(d){var F;const p=(F=d==null?void 0:d[0])==null?void 0:F._id,te=(0,n.useRef)(p),q=(0,n.useRef)(p),re=(0,n.useRef)(0);return(0,n.useMemo)(()=>{if(!d||!d.length)return 0;if(p===q.current)return re.current;te.current||(te.current=p),q.current=p;for(let ae=re.current;ae<d.length;ae+=1)if(d[ae]._id===te.current)return re.current=ae,ae;return 0},[d,d==null?void 0:d.length])}var U=Object.defineProperty,k=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,he=(d,F,p)=>F in d?U(d,F,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[F]=p,ye=(d,F)=>{for(var p in F||(F={}))Q.call(F,p)&&he(d,p,F[p]);if(k)for(var p of k(F))$.call(F,p)&&he(d,p,F[p]);return d};const Me=n.memo(d=>{const{value:F,loading:p}=(0,l.cvI)("messageListVirtualization",!1);return p?n.createElement("div",{className:"flex-1"},n.createElement(qe.T,null)):F?n.createElement(Se,ye({},d)):n.createElement(Qe.X,ye({},d))});Me.displayName="ChatMessageList";var Oe=t(14698),Re=t.n(Oe),Ge=t(66559);const _e=n.memo(()=>{const{replyMsg:d,setReplyMsg:F,clearReplyMsg:p}=(0,l.xMc)();return(0,l.JtK)("replyMessage",te=>{F(te)}),Re()(d)?null:n.createElement("div",{className:"relative"},n.createElement("div",{className:"absolute bottom-0 left-0 right-0 py-1 px-4"},n.createElement("div",{className:"rounded bg-white dark:bg-gray-800 p-2 max-h-44 overflow-auto shadow-sm relative"},n.createElement("span",{className:"align-top"},(0,l.t)("\u56DE\u590D")," ",d.author&&n.createElement(Ge.v,{userId:d.author}),":"," "),n.createElement("span",null,(0,r.getMessageRender)(d.content)),n.createElement(O.JO,{className:"absolute right-1 top-0.5 text-lg cursor-pointer opacity-60 hover:opacity-80",icon:"mdi:close-circle-outline",onClick:p}))))});_e.displayName="ChatReply";const h=/:([a-zA-Z0-9_\-\+]+):/g;function S(d){return d=String(d).trim(),d=d.replace(h,F=>(0,r.getMessageTextDecorators)().emoji(F)),d}var L=Object.defineProperty,ue=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable,Ae=(d,F,p)=>F in d?L(d,F,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[F]=p,Ee=(d,F)=>{for(var p in F||(F={}))H.call(F,p)&&Ae(d,p,F[p]);if(ue)for(var p of ue(F))Ce.call(F,p)&&Ae(d,p,F[p]);return d},fe=(d,F,p)=>new Promise((te,q)=>{var re=z=>{try{ae(p.next(z))}catch(le){q(le)}},ne=z=>{try{ae(p.throw(z))}catch(le){q(le)}},ae=z=>z.done?te(z.value):Promise.resolve(z.value).then(re,ne);ae((p=p.apply(d,F)).next())});const Le=n.memo(d=>{const{converseId:F,converseTitle:p}=d,{messages:te,loading:q,error:re,isLoadingMore:ne,hasMoreMessage:ae,fetchMoreMessage:z,sendMessage:le}=(0,l.FNv)();return q?n.createElement(a,null):re?n.createElement(s.o,{error:re}):n.createElement("div",{className:"w-full h-full flex flex-col select-text relative text-sm"},n.createElement(Me,{key:F,title:p,messages:te,isLoadingMore:ne,hasMoreMessage:ae,onLoadMore:z}),n.createElement(_e,null),n.createElement($e,{onSendMsg:(We,nt)=>fe(void 0,null,function*(){const Te=S(We);yield le({converseId:d.converseId,groupId:d.groupId,content:Te,plain:(0,r.getMessageTextDecorators)().serialize(Te),meta:nt})})}))});Le.displayName="ChatBoxInner";const et=n.memo(d=>n.createElement(l.gvw,null,n.createElement(l.$Ib,{converseId:d.converseId,isGroup:d.isGroup},n.createElement(Le,Ee({},d)))));et.displayName="ChatBox"},10114:(Fe,V,t)=>{t.d(V,{L:()=>n});var r=t(52983);const n=r.memo(l=>r.createElement("div",{className:"h-full flex flex-col","data-tc-role":l["data-tc-role"]},l.children));n.displayName="CommonSidebarWrapper"},73513:(Fe,V,t)=>{t.d(V,{o:()=>a});var r=t(52983),n=t(45563),l=t.n(n),s=t(93540),e=t(14517);const a=r.memo(N=>{const{visible:O=!0,onChangeVisible:b}=N,f=(0,r.useRef)(null),P=(0,r.useCallback)(()=>{l()(b)&&b(!1)},[b]);return(0,r.useEffect)(()=>{const A=R=>{R.code==="Escape"&&P()};return window.addEventListener("keyup",A),()=>{window.removeEventListener("keyup",A)}},[P]),r.createElement("div",{className:(0,e.Z)("fixed left-0 right-0 top-0 bottom-0 z-10 bg-content-light dark:bg-content-dark flex justify-center items-center",{"opacity-0":!O}),ref:f},N.children,l()(b)&&r.createElement("div",{className:"absolute right-8 top-8 cursor-pointer flex flex-col",onClick:P,"data-testid":"full-modal-close"},r.createElement(s.JO,{className:"text-2xl border-2 rounded-1/2 border-gray-900 dark:border-gray-100",icon:"mdi:close"}),r.createElement("span",{className:"text-center mt-0.5 font-bold"},"ESC")))});a.displayName="FullModal"},19856:(Fe,V,t)=>{t.d(V,{D:()=>e});var r=t(95268),n=t(75217),l=t(52983),s=t(98281);const e=l.memo(a=>{const{invite:N}=a;return N.expiredAt&&new Date(N.expiredAt).valueOf()<Date.now()?l.createElement("span",null,(0,s.t)("\u8BE5\u9080\u8BF7\u7801\u5DF2\u8FC7\u671F")):l.createElement(l.Fragment,null,N.expiredAt?l.createElement(s.cCv,null,"\u8BE5\u9080\u8BF7\u5C06\u4E8E"," ",l.createElement(r.Z,{title:(0,s.KJm)(N.expiredAt)},l.createElement("span",{className:"font-bold"},{date:(0,s.u39)(N.expiredAt)}))," ","\u8FC7\u671F"):l.createElement("span",null,(0,s.t)("\u8BE5\u9080\u8BF7\u7801\u6C38\u4E0D\u8FC7\u671F")),N.usageLimit&&l.createElement(l.Fragment,null,l.createElement(n.Z,{type:"vertical"}),l.createElement(s.cCv,null,"\u53EF\u4F7F\u7528"," ",l.createElement("span",{className:"font-bold"},{num:N.usageLimit})," ","\u6B21")))});e.displayName="InviteCodeExpiredAt"},63839:(Fe,V,t)=>{t.d(V,{z:()=>N});var r=t(75209),n=t(79546),l=t(65097),s=t(52983),e=t(98281),a=(O,b,f)=>new Promise((P,A)=>{var R=B=>{try{I(f.next(B))}catch(w){A(w)}},M=B=>{try{I(f.throw(B))}catch(w){A(w)}},I=B=>B.done?P(B.value):Promise.resolve(B.value).then(R,M);I((f=f.apply(O,b)).next())});const N=s.memo(O=>{const{groupId:b,converseId:f}=O,[{loading:P,value:A=[]},R]=(0,e.CoE)(I=>a(void 0,null,function*(){if(I.length<3){(0,e.lHp)((0,e.t)("\u641C\u7D22\u5185\u5BB9\u592A\u77ED\u65E0\u6CD5\u641C\u7D22"));return}const B=yield e.o4J.yw.searchMessage(I,f,b);return B??[]})),M=A;return s.createElement("div",{className:"p-2"},s.createElement(n.Z.Search,{className:"mb-2",placeholder:(0,e.t)("\u8BF7\u8F93\u5165\u5173\u952E\u5B57"),loading:P,onSearch:R}),s.createElement("div",null,M.length===0&&s.createElement(l.Z,{description:(0,e.t)("\u6CA1\u6709\u4EFB\u4F55\u641C\u7D22\u7ED3\u679C")}),M.map(I=>s.createElement(r.Y,{key:I._id,showAvatar:!0,payload:I,hideAction:!0}))))});N.displayName="MessageSearchPanel"},9021:(Fe,V,t)=>{t.d(V,{Q:()=>f});var r=t(52983),n=t(93540),l=t(29787),s=t.n(l),e=t(55696),a=t(20685),N=t(58761),O=t(98281),b=t(66559);const f=r.memo(P=>{const{actions:A=[],hideDiscriminator:R=!1}=P,M=(0,O.xzJ)(P.userId),[I]=(0,O.aoI)([P.userId]),B=M.nickname;return r.createElement("div",{className:"flex items-center h-14 px-2.5 rounded group bg-black bg-opacity-0 hover:bg-opacity-20 dark:bg-white dark:bg-opacity-0 dark:hover:bg-opacity-20"},r.createElement(e.Z,{loading:s()(M),avatar:!0,title:!1,active:!0},r.createElement("div",{className:"mr-2"},P.popover?r.createElement(a.Z,{content:P.popover,placement:"left",trigger:"click"},r.createElement(n.qE,{className:"cursor-pointer",src:M.avatar,name:B,isOnline:I})):r.createElement(n.qE,{src:M.avatar,name:B,isOnline:I})),r.createElement("div",{className:"flex-1 text-gray-900 dark:text-white"},r.createElement(b.v,{userId:P.userId,showDiscriminator:!R})),r.createElement(N.Z,null,A)))});f.displayName="UserListItem"},2945:(Fe,V,t)=>{t.d(V,{B:()=>s});var r=t(52983),n=t(98281),l=t(38643);const s=r.memo(e=>{const{withoutUserIds:a=[],selectedIds:N,onChange:O}=e,b=(0,n.CGy)(f=>f.user.friends.map(P=>P.id).filter(P=>!a.includes(P)));return r.createElement(l.f,{selectedIds:N,onChange:O,allUserIds:b})});s.displayName="FriendPicker"},38643:(Fe,V,t)=>{t.d(V,{f:()=>P});var r=t(79546),n=t(66990),l=t(52983),s=t(98281),e=t(89022),a=t.n(e),N=t(92238),O=t.n(N),b=t(93540),f=t(64939);const P=l.memo(A=>{const{withSearch:R=!0,selectedIds:M,onChange:I,allUserIds:B}=A,[w,_]=(0,l.useState)(""),X=(0,s.FDf)(B),ce=(0,l.useCallback)((K,D)=>{if(D===!0){if(M.includes(K))return;typeof I=="function"&&I([...M,K])}else typeof I=="function"&&I(O()(M,K))},[M,I]),ee=a()(X.filter(K=>K.nickname.includes(w)),10);return l.createElement("div",null,R&&l.createElement(r.Z,{placeholder:(0,s.t)("\u641C\u7D22\u7528\u6237"),className:"mb-2",value:w,onChange:K=>_(K.target.value)}),l.createElement("div",null,(0,s.t)("\u5DF2\u9009\u62E9 {{num}} \u9879",{num:M.length})),ee.length>0?ee.map(K=>l.createElement("div",{key:K._id,className:"my-1"},l.createElement(n.Z,{className:"mr-2 items-center",checked:M.includes(K._id),onChange:D=>ce(K._id,D.target.checked)},l.createElement("div",{className:"flex items-center w-full"},l.createElement(b.qE,{size:"small",name:K.nickname,src:K.avatar}),l.createElement("div",{className:"ml-1 text-typography-light dark:text-typography-dark"},K.nickname))))):l.createElement(f.T,null))});P.displayName="UserPicker"},50093:(Fe,V,t)=>{t.d(V,{m:()=>O});var r=t(75526),n=t(52983),l=t(54782),s=t(98281),e=t(2945),a=t(84208),N=(b,f,P)=>new Promise((A,R)=>{var M=w=>{try{B(P.next(w))}catch(_){R(_)}},I=w=>{try{B(P.throw(w))}catch(_){R(_)}},B=w=>w.done?A(w.value):Promise.resolve(w.value).then(M,I);B((P=P.apply(b,f)).next())});const O=n.memo(b=>{const{hiddenUserIds:f=[]}=b,[P,A]=(0,n.useState)([]),R=(0,l.useNavigate)(),[{loading:M},I]=(0,s.CoE)(()=>N(void 0,null,function*(){const B=yield(0,s.L1i)([...f,...P]);(0,a.Mr)(),R(`/main/personal/converse/${B._id}`)}),[P]);return n.createElement(a.AB,{title:(0,s.t)("\u521B\u5EFA\u591A\u4EBA\u4F1A\u8BDD")},n.createElement(e.B,{withoutUserIds:f,selectedIds:P,onChange:A}),n.createElement("div",{className:"text-right"},n.createElement(r.Z,{type:"primary",loading:M,onClick:I},(0,s.t)("\u521B\u5EFA"))))});O.displayName="CreateDMConverse"},40318:(Fe,V,t)=>{t.d(V,{P:()=>W});var r=t(93540),n=t(52983),l=t(98281),s=t(84208),e=t(19856),a=t(72297),N=t(75283),O=t(75526),b=t(96136),f=t(25355);const P={createInviteBtn:"src-components-modals-CreateGroupInvite-CreateInviteCode-module__createInviteBtn--9soUP"};var A=Object.defineProperty,R=Object.defineProperties,M=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,_=(m,y,Z)=>y in m?A(m,y,{enumerable:!0,configurable:!0,writable:!0,value:Z}):m[y]=Z,X=(m,y)=>{for(var Z in y||(y={}))B.call(y,Z)&&_(m,Z,y[Z]);if(I)for(var Z of I(y))w.call(y,Z)&&_(m,Z,y[Z]);return m},ce=(m,y)=>R(m,M(y)),ee=(m,y,Z)=>new Promise((J,se)=>{var de=ge=>{try{De(Z.next(ge))}catch(xe){se(xe)}},pe=ge=>{try{De(Z.throw(ge))}catch(xe){se(xe)}},De=ge=>ge.done?J(ge.value):Promise.resolve(ge.value).then(de,pe);De((Z=Z.apply(m,y)).next())}),K=(m=>(m.Normal="normal",m.Permanent="permanent",m))(K||{});const D=n.memo(({groupId:m,onInviteCreated:y,onInviteUpdated:Z})=>{const[J,se]=(0,n.useState)(null),[{loading:de},pe]=(0,l.CoE)(Ze=>ee(void 0,null,function*(){const Ke=yield(0,l.fiB)(m,Ze);se(Ke),y==null||y()}),[m,y]),[De,ge]=(0,l.WHr)(m,[l.g3S.core.invite,l.g3S.core.unlimitedInvite]),xe=(0,l.zX9)(()=>{if(!J)return;const Ze=(0,s.h7)(n.createElement(f.s,{groupId:m,code:J.code,onEditSuccess:({expiredAt:Ke,usageLimit:ke})=>{(0,l.lHp)((0,l.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),se(je=>ce(X({},je),{expiredAt:Ke?new Date(Ke).toISOString():void 0,usageLimit:ke})),(0,s.Mr)(Ze),Z==null||Z()}}))}),Be={items:[{key:"persist",label:(0,l.t)("\u521B\u5EFA\u6C38\u4E45\u9080\u8BF7\u7801"),disabled:!ge,onClick:()=>pe("permanent")}]};return n.createElement("div",null,J?n.createElement("div",null,n.createElement(N.Z.Title,{className:"bg-white bg-opacity-30 dark:bg-black dark:bg-opacity-30 px-2 py-1 select-text text-lg rounded border border-black border-opacity-20",level:4,copyable:!0},(0,a.po)(J.code)),n.createElement("p",{className:"text-gray-500 text-sm"},n.createElement(e.D,{invite:J}),n.createElement(O.Z,{type:"link",size:"small",onClick:xe},(0,l.t)("\u7F16\u8F91")))):n.createElement(b.Z.Button,{className:P.createInviteBtn,size:"large",type:"primary",disabled:!De,loading:de,onClick:()=>pe("normal"),menu:Be,trigger:["click"]},(0,l.t)("\u521B\u5EFA\u94FE\u63A5")))});D.displayName="CreateInviteCode";const W=n.memo(m=>{const y=m.groupId;return(0,l.iFL)(y)?n.createElement(s.AB,null,n.createElement(r.JO,{className:"text-6xl block m-auto opacity-30 mb-4 mt-2",icon:"mdi:email-edit-outline"}),n.createElement("div",{className:"text-gray-400 font-bold text-lg mb-2"},(0,l.t)("\u521B\u5EFA\u94FE\u63A5\u5E76\u53D1\u9001\u7ED9\u5916\u90E8\u597D\u53CB")),n.createElement(D,{groupId:y,onInviteCreated:m.onInviteCreated,onInviteUpdated:m.onInviteUpdated})):n.createElement("div",null,(0,l.t)("\u5F02\u5E38"))});W.displayName="GroupInvite"},25355:(Fe,V,t)=>{t.d(V,{s:()=>N});var r=t(93540),n=t(52983),l=t(98281),s=t(84208),e=(O,b,f)=>new Promise((P,A)=>{var R=B=>{try{I(f.next(B))}catch(w){A(w)}},M=B=>{try{I(f.throw(B))}catch(w){A(w)}},I=B=>B.done?P(B.value):Promise.resolve(B.value).then(R,M);I((f=f.apply(O,b)).next())});const a=[{type:"select",name:"expiredAt",label:(0,l.t)("\u8FC7\u671F\u65F6\u95F4"),defaultValue:-1,options:[{label:(0,l.t)("30\u5206\u949F"),value:30*60},{label:(0,l.t)("1\u5C0F\u65F6"),value:60*60},{label:(0,l.t)("6\u5C0F\u65F6"),value:6*60*60},{label:(0,l.t)("12\u5C0F\u65F6"),value:12*60*60},{label:(0,l.t)("1\u5929"),value:24*60*60},{label:(0,l.t)("7\u5929"),value:7*24*60*60},{label:(0,l.t)("\u6C38\u4E0D"),value:-1}]},{type:"select",name:"usageLimit",label:(0,l.t)("\u6700\u5927\u4F7F\u7528\u6B21\u6570"),defaultValue:-1,options:[{label:(0,l.t)("\u65E0\u9650\u5236"),value:-1},{label:(0,l.t)("1\u6B21\u4F7F\u7528"),value:1},{label:(0,l.t)("5\u6B21\u4F7F\u7528"),value:5},{label:(0,l.t)("10\u6B21\u4F7F\u7528"),value:10},{label:(0,l.t)("25\u6B21\u4F7F\u7528"),value:25},{label:(0,l.t)("50\u6B21\u4F7F\u7528"),value:50},{label:(0,l.t)("100\u6B21\u4F7F\u7528"),value:100}]}],N=n.memo(O=>{const b=(0,l.zX9)(f=>e(void 0,null,function*(){const P=f.expiredAt===-1?void 0:Date.now()+f.expiredAt*1e3,A=f.usageLimit===-1?void 0:f.usageLimit;yield l.o4J.ru.editGroupInvite(O.groupId,O.code,P,A),O.onEditSuccess({expiredAt:P,usageLimit:A})}));return n.createElement(s.AB,{title:(0,l.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5")},n.createElement(r.Po,{fields:a,onSubmit:b}))});N.displayName="EditGroupInvite"},17679:(Fe,V,t)=>{t.d(V,{a:()=>At});var r=t(73513),n=t(3856),l=t(50842),s=t(7975),e=t(52983),a=t(98281),N=t(95268),O=t(58761),b=t(75526),f=t(69104),P=t(66559),A=t(84208),R=t(40318),M=t(36932),I=t(84143),B=t(86724),w=t.n(B),_=t(72297),X=t(93540),ce=t(25355),ee=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const K=e.memo(o=>{const i=o.groupId,{loading:u,value:x,refresh:g}=(0,a.IxN)(()=>ee(void 0,null,function*(){return(yield(0,a.TcU)(i)).reverse()}),[i]),C=(0,a.zX9)(()=>{(0,A.h7)(e.createElement(R.P,{groupId:i,onInviteCreated:()=>{g()},onInviteUpdated:()=>{g()}}))}),T=(0,a.zX9)(G=>{const oe=(0,A.h7)(e.createElement(ce.s,{groupId:i,code:G,onEditSuccess:()=>{(0,a.lHp)((0,a.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),(0,A.Mr)(oe),g()}}))}),v=(0,a.zX9)(G=>{w()((0,_.po)(G)),(0,a.lHp)((0,a.t)("\u9080\u8BF7\u94FE\u63A5\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"),"success")}),c=(0,a.zX9)(G=>ee(void 0,null,function*(){(yield(0,A.aW)())&&(yield(0,a.L4o)(i,G),yield g())})),E=(0,e.useMemo)(()=>[{title:(0,a.t)("\u9080\u8BF7\u7801"),dataIndex:"code",width:200,render:G=>e.createElement(X.PJ,{text:G})},{title:(0,a.t)("\u521B\u5EFA\u65F6\u95F4"),dataIndex:"createdAt",render:G=>e.createElement(N.Z,{title:(0,a.KJm)(G)},(0,a.u39)(G))},{title:(0,a.t)("\u8FC7\u671F\u65F6\u95F4"),dataIndex:"expiredAt",render:G=>G?new Date(G).valueOf()<Date.now()?(0,a.t)("\u5DF2\u8FC7\u671F"):e.createElement(N.Z,{title:(0,a.KJm)(G)},(0,a.u39)(G)):(0,a.t)("\u6C38\u4E0D\u8FC7\u671F")},{title:(0,a.t)("\u4F7F\u7528\u6B21\u6570"),dataIndex:"usage",render:(G,oe)=>e.createElement("div",null,G,oe.usageLimit&&` / ${oe.usageLimit}`)},{title:(0,a.t)("\u521B\u5EFA\u8005"),dataIndex:"creator",render:G=>e.createElement(P.v,{userId:G})},{title:(0,a.t)("\u64CD\u4F5C"),dataIndex:"_id",render:(G,oe)=>e.createElement(O.Z,null,e.createElement(I.a,{title:(0,a.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:edit",onClick:()=>T(oe.code)}),e.createElement(I.a,{title:(0,a.t)("\u590D\u5236\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:content-copy",onClick:()=>v(oe.code)}),e.createElement(I.a,{title:(0,a.t)("\u5220\u9664"),shape:"square",icon:"mdi:delete-outline",danger:!0,onClick:()=>c(G)}))}],[v,c]);return e.createElement(M.t,{spinning:u},e.createElement("div",{className:"text-right mb-2"},e.createElement(b.Z,{type:"primary",onClick:C},(0,a.t)("\u521B\u5EFA\u9080\u8BF7\u7801"))),e.createElement(f.Z,{columns:E,dataSource:x,pagination:{hideOnSinglePage:!0}}))});K.displayName="GroupInvite";var D=t(85466),W=t.n(D),m=t(45513),y=t(14698),Z=t.n(y),J=t(77179),se=t.n(J);function de(o){return o.filter(i=>Z()(i.parentId)).map(i=>({key:i.id,title:i.name,isLeaf:i.type!==a.Xpe.GROUP,children:i.type===a.Xpe.GROUP?o.filter(u=>u.parentId===i.id).map(u=>({key:u.id,title:u.name,isLeaf:!0})):void 0}))}function pe(o){const i=se()(o),u=i.filter(g=>Z()(g.parentId)),x=u.length;for(let g=x-1;g>=0;g--){const C=u[g].id;u.splice(g+1,0,...i.filter(T=>T.parentId===C))}return u}function De(o,i){const u=(0,e.useRef)(null),x=(0,e.useCallback)(v=>{u.current=v.node},[]),g=(0,e.useCallback)(()=>{u.current=null},[]),C=(0,e.useCallback)(({dropNode:v,dropPosition:c})=>{var E;return((E=u.current)==null?void 0:E.isLeaf)===!0?c===0?!v.isLeaf:!0:c===0?!1:!v.isLeaf},[]),T=(0,e.useCallback)(v=>{var c;const E=se()(o),G=E.findIndex(ve=>ve.id===v.node.key),oe=E[G];G===-1&&(0,a.lHp)("\u5F02\u5E38, \u76EE\u6807\u8282\u70B9\u672A\u627E\u5230","error");const Ve=E.findIndex(ve=>ve.id===v.dragNode.key);((c=u.current)==null?void 0:c.isLeaf)===!0&&(v.node.isLeaf===!0?v.dragNodesKeys.map(ve=>E.findIndex(rt=>rt.id===ve)).filter(ve=>ve!==-1).forEach(ve=>{E[ve].parentId=oe.parentId}):v.dropToGap===!1&&v.node.isLeaf===!1?v.dragNodesKeys.map(ve=>E.findIndex(rt=>rt.id===ve)).filter(ve=>ve!==-1).forEach(ve=>{E[ve].parentId=oe.id}):v.dropToGap===!0&&v.node.isLeaf===!1&&v.dragNodesKeys.map(ve=>E.findIndex(rt=>rt.id===ve)).filter(ve=>ve!==-1).forEach(ve=>{E[ve].parentId=void 0}));const Je=Ve;let Ie;if(v.node.dragOverGapTop===!0?Ie=G:Ie=G+1,Je<Ie)E.splice(Ie,0,E[Je]),E.splice(Je,1);else if(Je>Ie){const[ve]=E.splice(Je,1);E.splice(Ie,0,ve)}if(typeof i=="function"){const ve=pe(E);i(ve)}},[o,i]);return{handleDragStart:x,handleDragEnd:g,handleAllowDrop:C,handleDrop:T}}var ge=t(38887),xe=t(89889),Be=Object.defineProperty,Ze=Object.defineProperties,Ke=Object.getOwnPropertyDescriptors,ke=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,He=(o,i,u)=>i in o?Be(o,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[i]=u,$e=(o,i)=>{for(var u in i||(i={}))je.call(i,u)&&He(o,u,i[u]);if(ke)for(var u of ke(i))Xe.call(i,u)&&He(o,u,i[u]);return o},qe=(o,i)=>Ze(o,Ke(i)),Qe=(o,i)=>{var u={};for(var x in o)je.call(o,x)&&i.indexOf(x)<0&&(u[x]=o[x]);if(o!=null&&ke)for(var x of ke(o))i.indexOf(x)<0&&Xe.call(o,x)&&(u[x]=o[x]);return u};function Ye(o){const i=o,{name:u,type:x,permissionMap:g,fallbackPermissions:C}=i,T=Qe(i,["name","type","permissionMap","fallbackPermissions"]);let v,c,E;if(typeof x=="string"){const G=x;v=a.Xpe.PLUGIN;const oe=(0,xe.S)(G);oe&&(c=oe.provider,E=oe.name)}else v=x;return{name:u,type:v,provider:c,pluginPanelName:E,meta:T,permissionMap:g,fallbackPermissions:C}}function ie(o){return o===null?{name:"",type:a.Xpe.TEXT}:qe($e({},o.meta),{name:o.name,type:o.type===a.Xpe.PLUGIN?String(o.pluginPanelName):o.type,permissionMap:o.permissionMap,fallbackPermissions:o.fallbackPermissions})}var Y=t(39907),me=t.n(Y),Pe=t(61230),be=t.n(Pe),Ue=Object.defineProperty,Se=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,k=(o,i,u)=>i in o?Ue(o,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[i]=u,Q=(o,i)=>{for(var u in i||(i={}))j.call(i,u)&&k(o,u,i[u]);if(Se)for(var u of Se(i))U.call(i,u)&&k(o,u,i[u]);return o};const $=[{type:"text",name:"name",label:(0,a.t)("\u9762\u677F\u540D")},{type:"select",name:"type",label:(0,a.t)("\u7C7B\u578B"),options:[{label:(0,a.t)("\u804A\u5929\u9891\u9053"),value:a.Xpe.TEXT},{label:(0,a.t)("\u9762\u677F\u5206\u7EC4"),value:a.Xpe.GROUP},...s.pluginGroupPanel.map(o=>({label:o.label,value:o.name}))]}],he={name:X._6.string().required((0,a.t)("\u9762\u677F\u540D\u4E0D\u80FD\u4E3A\u7A7A")).max(20,(0,a.t)("\u9762\u677F\u540D\u8FC7\u957F")),type:X._6.string().required((0,a.t)("\u9762\u677F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A"))};function ye(o,i){return(0,e.useMemo)(()=>{let x=$,g=he;if(typeof i.type=="string"){const C=(0,xe.S)(i.type);if(C){const T=Array.isArray(C.extraFormMeta)?C.extraFormMeta:[];x=[...$,...T];const v=be()(me()(T,c=>c.name),()=>X._6.mixed());g=Q(Q({},v),he)}}return{fields:x,schema:(0,X._D)(g)}},[i])}var Me=t(75217),Oe=t(63509),Re=t(36572),Ge=t(44411),_e=t(90292),h=t.n(_e),S=t(92238),L=t.n(S);const ue=e.memo(o=>{const i=(0,a.zX9)((C,T)=>{T?o.onChange(h()([...o.value,C])):o.onChange(L()(o.value,C))}),u=(0,a.zX9)(C=>{if(typeof o.panelType=="undefined")return!0;if(!C.panel)return!1;if(C.panel===!0)return!0;if(Array.isArray(C.panel))return C.panel.includes(o.panelType)}),x=(0,a.pZA)().filter(u),g=s.pluginPermission.filter(u);return x.length===0&&g.length===0?e.createElement("div",{className:"text-center"},(0,a.t)("\u6682\u65E0\u53EF\u7528\u7684\u6743\u9650\u9879")):e.createElement("div",null,x.map(C=>e.createElement(H,{key:C.key,title:C.title,desc:C.desc,disabled:C.required?!C.required.every(T=>o.value.includes(T)):void 0,checked:o.value.includes(C.key),onChange:T=>i(C.key,T)})),g.length>0&&e.createElement(e.Fragment,null,e.createElement(Me.Z,null,(0,a.t)("\u4EE5\u4E0B\u4E3A\u63D2\u4EF6\u6743\u9650")),s.pluginPermission.map(C=>e.createElement(H,{key:C.key,title:C.title,desc:C.desc,disabled:C.required?!C.required.every(T=>o.value.includes(T)):void 0,checked:o.value.includes(C.key),onChange:T=>i(C.key,T)}))))});ue.displayName="PermissionList";const H=e.memo(o=>e.createElement("div",{className:"mx-2 py-3 border-b border-white border-opacity-20"},e.createElement(Oe.Z,null,e.createElement(Re.Z,{flex:1,className:"font-bold"},o.title),e.createElement(Re.Z,null,e.createElement(Ge.Z,{disabled:o.disabled,checked:o.checked,onChange:o.onChange}))),e.createElement("div",{className:"text-gray-400"},o.desc)));H.displayName="PermissionItem";var Ce=t(14517),Ae=Object.defineProperty,Ee=Object.defineProperties,fe=Object.getOwnPropertyDescriptors,Le=Object.getOwnPropertySymbols,et=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,F=(o,i,u)=>i in o?Ae(o,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[i]=u,p=(o,i)=>{for(var u in i||(i={}))et.call(i,u)&&F(o,u,i[u]);if(Le)for(var u of Le(i))d.call(i,u)&&F(o,u,i[u]);return o},te=(o,i)=>Ee(o,fe(i));const q=e.memo(o=>{var i;const[u,x]=(0,e.useState)(a.eFs),g=(0,a.CGy)(oe=>oe.group.groups[o.groupId].roles),C=(0,a.CGy)(oe=>oe.group.groups[o.groupId].panels.find(Ie=>Ie.id===o.panelId)),T=(0,e.useMemo)(()=>{var oe;return C?p({[a.eFs]:(oe=C.fallbackPermissions)!=null?oe:(0,a.Q$5)()},C.permissionMap):{[a.eFs]:(0,a.Q$5)()}},[C]),[v,c]=(0,a.kz6)(T,o.onChange),E=(0,a.zX9)(oe=>{const Ve=te(p({},v),{[u]:oe});c(Ve)}),G=(0,a.zX9)(()=>{c({[a.eFs]:(0,a.Q$5)()}),o.onChange(void 0)});return C?e.createElement("div",{className:"flex",style:{width:540}},e.createElement("div",null,e.createElement(re,{active:u===a.eFs,onClick:()=>x(a.eFs)},(0,a.t)("\u6240\u6709\u4EBA")),g.map(oe=>e.createElement(re,{key:oe._id,active:u===oe._id,onClick:()=>x(oe._id)},oe.name))),e.createElement("div",{className:"flex-1 overflow-auto",style:{height:o.height}},e.createElement("div",{className:"text-right"},e.createElement(b.Z,{onClick:G},(0,a.t)("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u6743\u9650"))),e.createElement(ue,{panelType:C.type===a.Xpe.PLUGIN?C.pluginPanelName:C.type,value:(i=v[u])!=null?i:[],onChange:E}))):e.createElement(ge.T,null)});q.displayName="AdvanceGroupPanelPermission";const re=e.memo(o=>e.createElement("div",{className:(0,Ce.Z)("px-2 py-1 rounded cursor-pointer mb-1 hover:bg-black hover:bg-opacity-20",{"bg-black bg-opacity-20":o.active}),onClick:o.onClick},o.children));re.displayName="RoleItem";var ne=t(6769);const ae=e.memo(o=>e.createElement(ne.Z,{className:o.className,style:o.style},e.createElement(ne.Z.Panel,{header:o.title,key:"main"},o.children)));ae.displayName="CollapseView";var z=t(73352),le=t.n(z),We=Object.defineProperty,nt=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,Ne=(o,i,u)=>i in o?We(o,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[i]=u,we=(o,i)=>{for(var u in i||(i={}))Te.call(i,u)&&Ne(o,u,i[u]);if(nt)for(var u of nt(i))ze.call(i,u)&&Ne(o,u,i[u]);return o},at=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const st=e.memo(o=>{const i=(0,a.wY6)(o.groupId,o.groupPanelId),[u,x]=(0,e.useState)(ie(i)),[,g]=(0,a.CoE)(()=>at(void 0,null,function*(){yield(0,a.d89)(o.groupId,o.groupPanelId,Ye(u)),(0,a.lHp)((0,a.t)("\u4FEE\u6539\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.groupPanelId,o.onSuccess,u]),{fields:C,schema:T}=ye(o.groupId,u),v=(0,a.zX9)(c=>{x(E=>we(we({},E),c))});return i?e.createElement(A.AB,{title:(0,a.t)("\u7F16\u8F91\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:600}},e.createElement(X.Po,{schema:T,fields:C.filter(c=>c.type!=="type"),initialValues:ie(i),onChange:v,onSubmit:g,extraProps:{suffixElement:e.createElement(ae,{title:(0,a.t)("\u9AD8\u7EA7\u6743\u9650\u63A7\u5236"),className:"mb-2"},e.createElement(q,{height:320,groupId:o.groupId,panelId:o.groupPanelId,onChange:c=>{if(c){const E=c[a.eFs],G=we({},c);v({fallbackPermissions:E,permissionMap:le()(G,[a.eFs])})}else v({fallbackPermissions:void 0,permissionMap:void 0})}}))}})):e.createElement(ge.T,null)});st.displayName="ModalModifyGroupPanel";var ot=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const ut=e.memo(o=>{const i=(0,e.useMemo)(()=>de(o.groupPanels),[o.groupPanels]),u=(0,e.useCallback)(E=>{const G=(0,A.h7)(e.createElement(st,{groupId:o.groupId,groupPanelId:E,onSuccess:()=>(0,A.Mr)(G)}))},[o.groupId]),x=(0,e.useCallback)((E,G,oe)=>{(0,a.wp$)({message:oe?(0,a.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F\u7EC4 \u3010{{name}}\u3011 \u4EE5\u53CA\u4E0B\u7EA7\u7684\u6240\u6709\u9762\u677F\u4E48",{name:G}):(0,a.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F \u3010{{name}}\u3011 \u4E48",{name:G}),onConfirm:()=>ot(void 0,null,function*(){yield(0,a.J9q)(o.groupId,E)})})},[o.groupId]),g=(0,e.useCallback)(E=>e.createElement("div",{className:"flex group"},e.createElement("span",null,E.title),e.createElement("div",{className:"opacity-0 group-hover:opacity-100 ml-2"},e.createElement(O.Z,{size:"small"},e.createElement(I.a,{title:(0,a.t)("\u7F16\u8F91"),type:"text",size:"small",icon:"mdi:pencil-outline",onClick:G=>{G.stopPropagation(),G.preventDefault(),u(String(E.key))}}),e.createElement(I.a,{title:(0,a.t)("\u5220\u9664"),type:"text",size:"small",icon:"mdi:trash-can-outline",onClick:G=>{G.stopPropagation(),G.preventDefault(),x(String(E.key),String(E.title),!E.isLeaf)}})))),[x]),{handleDragStart:C,handleDragEnd:T,handleAllowDrop:v,handleDrop:c}=De(o.groupPanels,o.onChange);return e.createElement(m.Z,{treeData:i,defaultExpandAll:!0,blockNode:!0,draggable:{icon:!1},selectable:!1,titleRender:g,onDrop:c,onDragStart:C,onDragEnd:T,allowDrop:v})});ut.displayName="GroupPanelTree";const lt=e.memo(o=>e.createElement("div",{className:"text-xl font-bold mb-4 flex justify-between"},e.createElement("div",null,o.children),e.createElement("div",null,o.extra)));lt.displayName="FullModalCommonTitle";var Nt=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const vt=e.memo(o=>{const[i,u]=(0,e.useState)({}),[,x]=(0,a.CoE)(T=>Nt(void 0,null,function*(){yield(0,a.XAi)(o.groupId,Ye(T)),(0,a.lHp)((0,a.t)("\u521B\u5EFA\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.onSuccess]),{fields:g,schema:C}=ye(o.groupId,i);return e.createElement(A.AB,{title:(0,a.t)("\u521B\u5EFA\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:440}},e.createElement(X.Po,{schema:C,fields:g,onChange:u,onSubmit:x}))});vt.displayName="ModalCreateGroupPanel";var Bt=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const Et=e.memo(o=>{var i;const u=o.groupId,x=(0,a.iFL)(u),g=(i=x==null?void 0:x.panels)!=null?i:[],[C,T]=(0,e.useState)(g),v=(0,e.useRef)(!1);(0,e.useEffect)(()=>{v.current!==!0&&T(g)},[g]);const c=(0,e.useCallback)(Je=>{v.current=!0,T(Je)},[]),[{loading:E},G]=(0,a.CoE)(()=>Bt(void 0,null,function*(){yield(0,a.uRW)(u,"panels",C),v.current=!1,(0,a.lHp)((0,a.t)("\u4FDD\u5B58\u6210\u529F"),"success")}),[C]),oe=(0,e.useCallback)(()=>{T(g),v.current=!1},[g]),Ve=(0,e.useCallback)(()=>{const Je=(0,A.h7)(e.createElement(vt,{groupId:u,onSuccess:()=>{(0,A.Mr)(Je),v.current=!1}}))},[]);return e.createElement("div",null,e.createElement(lt,{extra:e.createElement(b.Z,{type:"primary",onClick:Ve},(0,a.t)("\u521B\u5EFA\u9762\u677F"))},(0,a.t)("\u9762\u677F\u7BA1\u7406")),e.createElement("div",{className:"max-h-160 overflow-auto border rounded border-black border-opacity-20 p-1"},e.createElement(ut,{groupId:u,groupPanels:C,onChange:c})),!W()(g,C)&&e.createElement("div",{className:"space-x-1 mt-2"},e.createElement(b.Z,{type:"primary",loading:E,onClick:G},(0,a.t)("\u4FDD\u5B58")),e.createElement(b.Z,{onClick:oe},(0,a.t)("\u91CD\u7F6E"))))});Et.displayName="GroupPanel";var ft=t(18300),bt=t(83667);const it=e.memo(o=>e.createElement("div",{className:(0,Ce.Z)("px-2 py-1 rounded cursor-pointer mb-1 hover:bg-black hover:bg-opacity-20",{"bg-black bg-opacity-20":o.active}),onClick:o.onClick},o.children));it.displayName="RoleItem";var ct=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});function St(o,i){const[{loading:u},x]=(0,a.CoE)(()=>ct(this,null,function*(){yield a.o4J.ru.createGroupRole(o,(0,a.t)("\u65B0\u8EAB\u4EFD\u7EC4"),(0,a.Q$5)()),(0,a.jiy)()}),[o]),[{loading:g},C]=(0,a.CoE)(G=>ct(this,null,function*(){i===a.eFs?yield a.o4J.ru.modifyGroupField(o,"fallbackPermissions",G):yield a.o4J.ru.updateGroupRolePermission(o,i,G),(0,a.jiy)()}),[o,i]),[{loading:T},v]=(0,a.CoE)(G=>ct(this,null,function*(){if(i===a.eFs)throw new Error((0,a.t)("\u65E0\u6CD5\u4FEE\u6539\u6240\u6709\u4EBA\u6743\u9650\u7EC4\u7684\u663E\u793A\u540D\u79F0"));yield a.o4J.ru.updateGroupRoleName(o,i,G),(0,a.jiy)()}),[o,i]),[{loading:c},E]=(0,a.CoE)(()=>ct(this,null,function*(){if(i===a.eFs)throw new Error((0,a.t)("\u65E0\u6CD5\u5220\u9664\u6240\u6709\u4EBA\u6743\u9650"));yield a.o4J.ru.deleteGroupRole(o,i),(0,a.jiy)()}),[o,i]);return{loading:u||g||T||c,handleCreateRole:x,handleSavePermission:C,handleChangeRoleName:v,handleDeleteRole:E}}var tt=t(7606);const pt=e.memo(o=>{const{currentRoleInfo:i}=o,u=(0,a.nWw)(()=>{(0,A.VW)({title:(0,a.t)("\u786E\u8BA4\u8981\u5220\u9664\u89D2\u8272 {{name}} \u4E48?",{name:i.name}),onConfirm:()=>o.onDeleteRole()})});return e.createElement("div",{className:"px-2"},e.createElement(tt.LP,{title:(0,a.t)("\u8EAB\u4EFD\u7EC4\u540D\u79F0"),value:o.currentRoleInfo.name,editable:!0,renderEditor:tt.jo,onSave:o.onChangeRoleName}),e.createElement(b.Z,{type:"primary",danger:!0,onClick:u},(0,a.t)("\u5220\u9664\u8EAB\u4EFD\u7EC4")))});pt.displayName="RoleSummary";function Rt(o){const[i,u]=(0,e.useState)([]),x=(0,e.useMemo)(()=>!W()(new Set(o),new Set(i)),[o,i]);return(0,e.useEffect)(()=>{u([...o])},[o]),{isEditing:x,editingPermission:i,setEditingPermission:u}}const ht=e.memo(o=>{const i=(0,e.useMemo)(()=>{var T,v;return o.roleId===a.eFs?o.fallbackPermissions:(v=(T=o.currentRoleInfo)==null?void 0:T.permissions)!=null?v:[]},[o.roleId,o.fallbackPermissions,o.currentRoleInfo]),{isEditing:u,editingPermission:x,setEditingPermission:g}=Rt(i),C=(0,e.useCallback)(()=>{g((0,a.Q$5)())},[]);return e.createElement("div",null,e.createElement("div",{className:"mb-2 space-x-2 text-right"},e.createElement(b.Z,{onClick:C},(0,a.t)("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C")),e.createElement(b.Z,{type:"primary",disabled:!u,onClick:()=>o.onSavePermission(x)},(0,a.t)("\u4FDD\u5B58"))),e.createElement(ue,{value:x,onChange:g}))});ht.displayName="RolePermission";var Lt=t(38643),Tt=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const gt=e.memo(o=>{const{groupId:i,withoutMemberIds:u=[],onConfirm:x}=o,[g,C]=(0,e.useState)([]),T=(0,a.aaJ)(i),v=(0,e.useMemo)(()=>L()(T,...u),[T,u]),[{loading:c},E]=(0,a.ilX)(()=>Tt(void 0,null,function*(){yield x(g)}),[x,g]);return e.createElement(A.AB,{title:(0,a.t)("\u9009\u62E9\u7FA4\u7EC4\u6210\u5458")},e.createElement(Lt.f,{allUserIds:v,selectedIds:g,onChange:C}),e.createElement("div",{className:"text-right"},e.createElement(b.Z,{type:"primary",loading:c,onClick:E},(0,a.t)("\u786E\u8BA4"))))});gt.displayName="SelectGroupMember";var yt=t(9021),mt=t(79546),Ut=t(6494),Pt=t.n(Ut),Ct=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const It=e.memo(o=>{var i,u;const x=o.currentRoleInfo._id,g=(0,a.iFL)(o.groupId),T=((i=g==null?void 0:g.members)!=null?i:[]).filter(Ie=>{var ve;return((ve=Ie.roles)!=null?ve:[]).includes(x)}).map(Ie=>Ie.userId),v=(0,a.FDf)(T),{searchText:c,setSearchText:E,isSearching:G,searchResult:oe}=(0,a.RxY)({dataSource:v,filterFn:(Ie,ve)=>String(Ie.nickname).includes(ve)}),Ve=(0,a.nWw)(()=>{const Ie=(0,A.h7)(e.createElement(gt,{groupId:o.groupId,withoutMemberIds:Pt()([...T]),onConfirm:ve=>Ct(void 0,null,function*(){try{yield a.o4J.ru.appendGroupMemberRoles(o.groupId,ve,[o.currentRoleInfo._id]),(0,a.jiy)(),(0,A.Mr)(Ie)}catch(rt){(0,a.hJM)(rt)}})}))}),[,Je]=(0,a.CoE)(Ie=>Ct(void 0,null,function*(){var ve;if(!((ve=o.currentRoleInfo)==null?void 0:ve._id)){(0,a.hJM)((0,a.t)("\u5F53\u524D\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u89D2\u8272\u7EC4"));return}yield a.o4J.ru.removeGroupMemberRoles(o.groupId,[Ie],[o.currentRoleInfo._id]),(0,a.jiy)()}),[o.groupId,(u=o.currentRoleInfo)==null?void 0:u._id]);return e.createElement("div",null,e.createElement("div",{className:"text-right mb-2 flex space-x-1"},e.createElement(b.Z,{type:"primary",onClick:Ve},(0,a.t)("\u6DFB\u52A0\u6210\u5458")),v.length>0&&e.createElement(mt.Z,{placeholder:(0,a.t)("\u641C\u7D22\u6210\u5458"),size:"middle",suffix:e.createElement(X.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:c,onChange:Ie=>E(Ie.target.value)})),(G?oe:v).map(Ie=>e.createElement(yt.Q,{key:Ie._id,userId:Ie._id,actions:[e.createElement(I.a,{key:"remove",icon:"mdi:close",onClick:()=>Je(Ie._id)})]})))});It.displayName="RoleMember";var Gt=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const Dt=e.memo(o=>{var i,u;const{groupId:x}=o,[g,C]=(0,e.useState)(a.eFs),T=(0,a.iFL)(x),v=(i=T==null?void 0:T.roles)!=null?i:[],c=(0,e.useMemo)(()=>v.find(Ie=>Ie._id===g),[v,g]),{loading:E,handleCreateRole:G,handleSavePermission:oe,handleChangeRoleName:Ve,handleDeleteRole:Je}=St(x,g);return e.createElement(ft.g,{spinning:E,className:"h-full"},e.createElement("div",{className:"flex h-full"},e.createElement("div",{className:"pr-2 mr-2 w-40 mobile:w-28 border-r border-white border-opacity-20"},e.createElement(it,{active:g===a.eFs,onClick:()=>C(a.eFs)},(0,a.t)("\u6240\u6709\u4EBA")),v.map(Ie=>e.createElement(it,{key:Ie._id,active:g===Ie._id,onClick:()=>C(Ie._id)},Ie.name)),e.createElement(Me.Z,{className:"my-3"}),e.createElement(it,{active:!1,onClick:G},(0,a.t)("\u6DFB\u52A0\u89D2\u8272"))),e.createElement("div",{className:"flex-1 overflow-y-auto"},e.createElement(bt.N,{defaultActiveKey:"permission",items:[{key:"summary",label:(0,a.t)("\u6982\u8FF0"),disabled:g===a.eFs,children:e.createElement(e.Fragment,null,c&&e.createElement(pt,{currentRoleInfo:c,onChangeRoleName:Ve,onDeleteRole:()=>Gt(void 0,null,function*(){yield Je(),C(a.eFs)})}))},{key:"permission",label:(0,a.t)("\u6743\u9650"),children:e.createElement(ht,{roleId:g,fallbackPermissions:(u=T==null?void 0:T.fallbackPermissions)!=null?u:[],currentRoleInfo:c,onSavePermission:oe})},{key:"member",label:(0,a.t)("\u7BA1\u7406\u6210\u5458"),disabled:g===a.eFs,children:e.createElement(e.Fragment,null,c&&e.createElement(It,{groupId:x,currentRoleInfo:c}))}]}))))});Dt.displayName="GroupRole";var Mt=t(92951),Wt=t(15333),dt=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const Ft=e.memo(({groupId:o})=>{var i,u;const x=(0,a.iFL)(o),[,g]=(0,a.CoE)(v=>dt(void 0,null,function*(){yield(0,a.uRW)(o,"name",v),(0,a.jiy)((0,a.t)("\u4FEE\u6539\u7FA4\u7EC4\u540D\u6210\u529F"))}),[o]),[,C]=(0,a.CoE)(v=>dt(void 0,null,function*(){yield(0,a.uRW)(o,"description",v),(0,a.jiy)((0,a.t)("\u4FEE\u6539\u7FA4\u7EC4\u63CF\u8FF0\u6210\u529F"))}),[o]),[,T]=(0,a.CoE)(v=>dt(void 0,null,function*(){yield(0,a.uRW)(o,"avatar",v.url),(0,a.lHp)((0,a.t)("\u4FEE\u6539\u7FA4\u7EC4\u5934\u50CF\u6210\u529F"),"success")}),[o]);return x?e.createElement("div",null,e.createElement(lt,null,(0,a.t)("\u7FA4\u7EC4\u6982\u8FF0")),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"w-1/3 mobile:w-full mobile:text-center"},e.createElement(Mt.C,{circle:!0,onUploadSuccess:T},e.createElement(X.qE,{size:128,name:x.name,src:x.avatar}))),e.createElement("div",{className:"w-2/3 mobile:w-full"},e.createElement(tt.LP,{title:(0,a.t)("\u7FA4\u7EC4\u540D\u79F0"),value:x.name,editable:!0,renderEditor:tt.jo,onSave:g}),e.createElement(tt.LP,{title:(0,a.t)("\u6210\u5458\u6570"),value:String(x.members.length)}),e.createElement(tt.LP,{title:(0,a.t)("\u7FA4\u7EC4\u63CF\u8FF0"),value:(i=x.description)!=null?i:"",content:e.createElement("pre",null,(u=x.description)!=null?u:""),editable:!0,renderEditor:wt,onSave:C})))):e.createElement(Wt.J,{message:(0,a.t)("\u65E0\u6CD5\u83B7\u53D6\u5230\u7FA4\u7EC4\u4FE1\u606F")})});Ft.displayName="GroupSummary";const wt=({value:o,onChange:i})=>e.createElement(mt.Z.TextArea,{autoSize:{minRows:4,maxRows:6},maxLength:120,value:o,onChange:u=>i(u.target.value),showCount:!0});var Kt=(o,i,u)=>new Promise((x,g)=>{var C=c=>{try{v(u.next(c))}catch(E){g(E)}},T=c=>{try{v(u.throw(c))}catch(E){g(E)}},v=c=>c.done?x(c.value):Promise.resolve(c.value).then(C,T);v((u=u.apply(o,i)).next())});const xt=e.memo(o=>{var i,u,x;const g=o.groupId,C=(0,a.iFL)(g),T=(0,a.TL5)(),[{loading:v},c]=(0,a.CoE)((G,oe)=>Kt(void 0,null,function*(){yield a.o4J.ru.modifyGroupConfig(g,G,oe),T(a.hyC.updateGroupConfig({groupId:g,configName:G,configValue:oe})),(0,a.jiy)()}),[g]);if(!C)return e.createElement(ft.g,{spinning:!0});const E=(i=C.config)!=null?i:{};return e.createElement("div",null,e.createElement(lt,null,(0,a.t)("\u7FA4\u7EC4\u914D\u7F6E")),e.createElement(tt.LP,{title:(0,a.t)("\u9690\u85CF\u6210\u5458\u5B8C\u6574\u540D\u79F0"),tip:(0,a.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u83B7\u53D6\u6210\u5458\u4FE1\u606F"),content:e.createElement(Ge.Z,{disabled:v,checked:(u=E.hideGroupMemberDiscriminator)!=null?u:!1,onChange:G=>c("hideGroupMemberDiscriminator",G)})}),e.createElement(tt.LP,{title:(0,a.t)("\u7981\u6B62\u5728\u7FA4\u7EC4\u53D1\u8D77\u79C1\u4FE1"),tip:(0,a.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u9A9A\u6270\u7528\u6237\u3002"),content:e.createElement(Ge.Z,{disabled:v||E.hideGroupMemberDiscriminator===!0,checked:(x=E.hideGroupMemberDiscriminator===!0||E.disableCreateConverseFromGroup)!=null?x:!1,onChange:G=>c("disableCreateConverseFromGroup",G)})}),e.createElement(tt.LP,{title:(0,a.t)("\u7FA4\u7EC4\u80CC\u666F"),tip:(0,a.t)("\u4E2A\u6027\u5316\u914D\u7F6E\u7FA4\u7EC4\u80CC\u666F"),content:e.createElement(e.Fragment,null,e.createElement(Mt.w,{aspect:16/9,onUploadSuccess:G=>{c("groupBackgroundImage",G.url)}},e.createElement(X.Ee,{wrapperClassName:"block",style:{width:640,height:360},src:E.groupBackgroundImage})),e.createElement("div",{className:"text-xs opacity-80"},(0,a.t)("\u5EFA\u8BAE\u6BD4\u4F8B: 16:9 | \u5EFA\u8BAE\u5927\u5C0F: 1280x720")),E.groupBackgroundImage&&e.createElement(b.Z,{className:"mt-1",type:"primary",onClick:()=>{c("groupBackgroundImage","")}},(0,a.t)("\u6E05\u9664")))}),s.pluginGroupConfigItems.map(G=>{const oe=(0,xe.g)(G.name);return e.createElement(tt.LP,{key:oe,title:G.title,tip:G.tip,content:e.createElement(G.component,{value:E[oe],onChange:Ve=>c(oe,Ve),loading:v})})}))});xt.displayName="GroupConfig";var Zt=t(64917),kt=t(96136),jt=t(6342);const Ot=e.memo(o=>{const i=o.groupId,{userInfos:u,searchText:x,setSearchText:g,isSearching:C,searchResult:T,generateActionMenu:v}=(0,Zt.Q)(i),c=E=>{const G=v(E);return e.createElement(yt.Q,{key:E._id,userId:E._id,actions:[e.createElement("div",{key:"more"},e.createElement(kt.Z,{menu:G,trigger:["click"],placement:"bottomRight"},e.createElement("div",null,e.createElement(I.a,{icon:"mdi:dots-vertical"}))))]})};return e.createElement("div",{className:"flex flex-col h-full"},e.createElement(lt,null,(0,a.t)("\u6210\u5458\u7BA1\u7406")),e.createElement("div",{className:"py-2"},e.createElement(mt.Z,{placeholder:(0,a.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:e.createElement(X.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:x,onChange:E=>g(E.target.value)})),e.createElement("div",{className:"flex-1 overflow-auto"},e.createElement(jt.OO,{style:{height:"100%"},data:C?T:u,itemContent:(E,G)=>c(G)})))});Ot.displayName="GroupMember";const At=e.memo(o=>{const i=o.groupId,u=(0,e.useCallback)(E=>{E===!1&&typeof o.onClose=="function"&&o.onClose()},[o.onClose]),[x,g,C,T,v]=(0,a.WHr)(i,[a.g3S.core.groupConfig,a.g3S.core.manageUser,a.g3S.core.managePanel,a.g3S.core.manageInvite,a.g3S.core.manageRoles]),c=(0,e.useMemo)(()=>{const E=[{type:"group",title:(0,a.t)("\u901A\u7528"),children:Pt()([{type:"item",title:(0,a.t)("\u6982\u8FF0"),content:e.createElement(Ft,{groupId:i})},x&&{type:"item",title:(0,a.t)("\u914D\u7F6E"),content:e.createElement(xt,{groupId:i})},g&&{type:"item",title:(0,a.t)("\u6210\u5458"),content:e.createElement(Ot,{groupId:i})},C&&{type:"item",title:(0,a.t)("\u9762\u677F"),content:e.createElement(Et,{groupId:i})},T&&{type:"item",title:(0,a.t)("\u9080\u8BF7\u7801"),content:e.createElement(K,{groupId:i})},v&&{type:"item",title:(0,a.t)("\u8EAB\u4EFD\u7EC4"),content:e.createElement(Dt,{groupId:i})}])}],G=s.pluginCustomPanel.filter(oe=>oe.position==="groupdetail").map(oe=>({type:"item",title:oe.label,content:e.createElement(oe.render)}));return G.length>0&&E.push({type:"group",title:(0,a.t)("\u63D2\u4EF6"),children:G}),E},[]);return e.createElement(l.A,{value:i},e.createElement(r.o,{onChangeVisible:u},e.createElement(n.u,{menu:c,defaultContentPath:"0.children.0.content"})))});At.displayName="GroupDetail"},51052:(Fe,V,t)=>{t.d(V,{Z:()=>ce});var r=t(50842),n=t(52983),l=t(98281),s=t(84143),e=t(66559),a=t(83996),N=t(58761),O=t(56489),b=t(95268),f=t(54782),P=t(93540),A=(ee,K,D)=>new Promise((W,m)=>{var y=se=>{try{J(D.next(se))}catch(de){m(de)}},Z=se=>{try{J(D.throw(se))}catch(de){m(de)}},J=se=>se.done?W(se.value):Promise.resolve(se.value).then(y,Z);J((D=D.apply(ee,K)).next())});const R=n.memo(ee=>{const{userInfo:K}=ee,D=K._id,[W]=(0,l.aoI)([D]),{value:m}=(0,l.r53)(()=>A(void 0,null,function*(){if(!K.avatar)return(0,P.Yy)(K.nickname);const y=yield(0,a.f)(K.avatar);return`rgba(${y.r}, ${y.g}, ${y.b}, ${y.a})`}),[K.avatar]);return n.createElement("div",{className:"relative bg-inherit"},n.createElement("div",{style:{width:"100%",height:60,backgroundColor:m}}),n.createElement("div",{className:"absolute p-1 rounded-1/2 -mt-11 ml-3 bg-inherit"},n.createElement(P.OI,{size:80,src:K.avatar,name:K.nickname,isOnline:W})),n.createElement("div",{className:"p-2 mt-10"},ee.children))});R.displayName="UserProfileContainer";var M=t(7975);function I(ee={}){return n.createElement(n.Fragment,null,M.pluginUserExtraInfo.map((K,D)=>{var W;const m=(W=K.component)==null?void 0:W.render;return m?n.createElement(m,{key:K.name+D,value:ee[K.name]}):n.createElement("div",{key:K.name+D,className:"flex"},n.createElement("div",{className:"w-1/4 text-gray-500"},K.label,":"),n.createElement("div",{className:"w-3/4"},ee[K.name]?String(ee[K.name]):""))}))}var B=(ee,K,D)=>new Promise((W,m)=>{var y=se=>{try{J(D.next(se))}catch(de){m(de)}},Z=se=>{try{J(D.throw(se))}catch(de){m(de)}},J=se=>se.done?W(se.value):Promise.resolve(se.value).then(y,Z);J((D=D.apply(ee,K)).next())});const w=n.memo(ee=>{var K;const{userInfo:D,groupInfo:W}=ee,m=D._id,y=(K=D.extra)!=null?K:{},Z=_(m,W),{hideGroupMemberDiscriminator:J,disableCreateConverseFromGroup:se}=(0,l.r3q)(W),de=I(y),pe=(0,f.useNavigate)(),De=(0,l.IIz)(),ge=!J&&!se&&De!==m,[,xe]=(0,l.CoE)(()=>B(void 0,null,function*(){const Be=yield(0,l.L1i)([m]);pe(`/main/personal/converse/${Be._id}`)}),[pe]);return(0,n.useEffect)(()=>{D.avatar&&(0,a.f)(D.avatar).then(Be=>{console.log("fetchImagePrimaryColor",Be)})},[D.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(R,{userInfo:D},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(e.v,{userId:m})),!J&&n.createElement("span",{className:"opacity-60 ml-1"},"#",D.discriminator)),n.createElement(N.Z,{size:4,wrap:!0,className:"py-1"},W.owner===m&&n.createElement(O.Z,{color:"gold"},(0,l.t)("\u521B\u5EFA\u8005")),D.temporary&&n.createElement(O.Z,{color:"processing"},(0,l.t)("\u6E38\u5BA2")),Z.map(Be=>n.createElement(O.Z,{key:Be,color:(0,P.Yy)(Be)},Be))),n.createElement("div",{className:"pt-2"},de),n.createElement("div",{className:"text-right"},ge&&n.createElement(b.Z,{title:(0,l.t)("\u53D1\u9001\u6D88\u606F")},n.createElement(s.a,{icon:"mdi:message-processing-outline",onClick:xe})))))});w.displayName="GroupUserPopover";function _(ee,K){var D,W;const m=(W=(D=K.members.find(Z=>Z.userId===ee))==null?void 0:D.roles)!=null?W:[];return K.roles.filter(Z=>m.includes(Z._id)).map(Z=>Z.name)}const X=n.memo(ee=>{var K;const{userInfo:D}=ee,W=(K=D.extra)!=null?K:{},m=I(W);return(0,n.useEffect)(()=>{D.avatar&&(0,a.f)(D.avatar).then(y=>{console.log("fetchImagePrimaryColor",y)})},[D.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(R,{userInfo:D},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(e.v,{userId:D._id})),n.createElement("span",{className:"opacity-60 ml-1"},"#",D.discriminator)),n.createElement(N.Z,{size:4,wrap:!0,className:"py-1"},D.temporary&&n.createElement(O.Z,{color:"processing"},(0,l.t)("\u6E38\u5BA2"))),n.createElement("div",{className:"pt-2"},m)))});X.displayName="PersonalUserPopover";const ce=n.memo(ee=>{const K=(0,r.b)(),D=(0,l.iFL)(K);return(0,l.xzJ)(ee.userInfo._id,!0),D?n.createElement(w,{userInfo:ee.userInfo,groupInfo:D}):n.createElement(X,{userInfo:ee.userInfo})});ce.displayName="UserPopover"},63933:(Fe,V,t)=>{t.d(V,{q:()=>l});var r=t(52983),n=t(98281);function l(s,e){const a=(0,n.ysv)(s);(0,r.useLayoutEffect)(()=>{const N=O=>{typeof a.current=="function"&&a.current(O)};return window.addEventListener("keydown",N,e),()=>{window.removeEventListener("keydown",N,e)}},[])}},64917:(Fe,V,t)=>{t.d(V,{Q:()=>O});var r=t(84208),n=t(52983),l=t(98281),s=t(6494),e=t.n(s),a=t(95850),N=(f,P,A)=>new Promise((R,M)=>{var I=_=>{try{w(A.next(_))}catch(X){M(X)}},B=_=>{try{w(A.throw(_))}catch(X){M(X)}},w=_=>_.done?R(_.value):Promise.resolve(_.value).then(I,B);w((A=A.apply(f,P)).next())});function O(f){var P;const A=(0,l.iFL)(f),R=(P=A==null?void 0:A.members)!=null?P:[],M=(0,l.Tgq)(f),I=(0,a.x)(),{handleMuteMember:B,handleUnmuteMember:w}=b(f,M),{searchText:_,setSearchText:X,isSearching:ce,searchResult:ee}=(0,l.RxY)({dataSource:M,filterFn:(m,y)=>!!(I[m._id]&&I[m._id].includes(y)||m.nickname.includes(y))}),[,K]=(0,l.CoE)(m=>N(this,null,function*(){(yield(0,r.aW)({title:(0,l.t)("\u786E\u8BA4\u8981\u5C06\u8BE5\u7528\u6237\u79FB\u51FA\u7FA4\u7EC4\u4E48")}))&&(yield l.o4J.ru.deleteGroupMember(f,m),(0,l.jiy)())}),[f]),D=(0,n.useCallback)(m=>{const y=R.find(J=>J.userId===m);if(!y||!y.muteUntil)return!1;const Z=y.muteUntil;return new Date(Z).valueOf()>new Date().valueOf()},[R]),W=(0,l.nWw)(m=>{const Z=D(m._id)?[{key:"unmute",label:(0,l.t)("\u89E3\u9664\u7981\u8A00"),onClick:()=>w(m._id)}]:[{key:"mute",label:(0,l.t)("\u7981\u8A00"),children:[{key:"1m",label:(0,l.t)("1\u5206\u949F"),onClick:()=>B(m._id,1*60*1e3)},{key:"5m",label:(0,l.t)("5\u5206\u949F"),onClick:()=>B(m._id,5*60*1e3)},{key:"10m",label:(0,l.t)("10\u5206\u949F"),onClick:()=>B(m._id,10*60*1e3)},{key:"30m",label:(0,l.t)("30\u5206\u949F"),onClick:()=>B(m._id,30*60*1e3)},{key:"1d",label:(0,l.t)("1\u5929"),onClick:()=>B(m._id,1*24*60*60*1e3)},{key:"7d",label:(0,l.t)("7\u5929"),onClick:()=>B(m._id,7*24*60*60*1e3)},{key:"30d",label:(0,l.t)("30\u5929"),onClick:()=>B(m._id,30*24*60*60*1e3)}]}];return{items:e()([...Z,{key:"delete",label:(0,l.t)("\u79FB\u51FA\u7FA4\u7EC4"),danger:!0,onClick:()=>K(m._id)}])}});return{userInfos:M,searchText:_,setSearchText:X,isSearching:ce,searchResult:ee,getMemberHasMute:D,handleMuteMember:B,handleUnmuteMember:w,handleRemoveGroupMember:K,generateActionMenu:W}}function b(f,P){const[,A]=(0,l.CoE)((M,I)=>N(this,null,function*(){const B=P.find(w=>w._id===M);if(!B)throw new Error((0,l.t)("\u6CA1\u6709\u627E\u5230\u7528\u6237"));(yield(0,r.aW)({title:(0,l.t)("\u786E\u5B9A\u8981\u7981\u8A00 {{name}} \u4E48",{name:B.nickname}),content:(0,l.t)("\u7981\u8A00 {{length}}, \u9884\u8BA1\u5230 {{until}} \u4E3A\u6B62",{length:(0,l.TGs)(I),until:(0,l.KJm)(new Date().valueOf()+I)})}))&&(yield l.o4J.ru.muteGroupMember(f,M,I),(0,l.jiy)())}),[f,P]),[,R]=(0,l.CoE)(M=>N(this,null,function*(){yield l.o4J.ru.muteGroupMember(f,M,-1),(0,l.jiy)()}),[f]);return{handleMuteMember:A,handleUnmuteMember:R}}},95483:(Fe,V,t)=>{t.d(V,{r:()=>A});var r=t(98281);const n=(0,r.fA3)(()=>sessionStorage);var l=Object.defineProperty,s=Object.defineProperties,e=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,b=(R,M,I)=>M in R?l(R,M,{enumerable:!0,configurable:!0,writable:!0,value:I}):R[M]=I,f=(R,M)=>{for(var I in M||(M={}))N.call(M,I)&&b(R,I,M[I]);if(a)for(var I of a(M))O.call(M,I)&&b(R,I,M[I]);return R},P=(R,M)=>s(R,e(M));function A(R){const[M={},I]=n("sessionPreference"),B=M[R],w=(0,r.nWw)(_=>{I(P(f({},M),{[R]:_}))});return[B,w]}},16131:(Fe,V,t)=>{t.d(V,{E:()=>Qe,x:()=>Ye});var r=t(6739),n=t(89889),l=t(48303),s=t(52983),e=t(98281);const a=s.memo(ie=>{const Y=(0,e.wY6)(ie.groupId,ie.panelId);if(!Y)return s.createElement(l.Z,{className:"w-full text-center",message:(0,e.t)("\u65E0\u6CD5\u83B7\u53D6\u9762\u677F\u4FE1\u606F")});if(typeof Y.provider!="string")return s.createElement(l.Z,{className:"w-full text-center",message:(0,e.t)("\u672A\u627E\u5230\u63D2\u4EF6\u7684\u63D0\u4F9B\u8005")});const me=(0,s.useMemo)(()=>(0,e.YQu)(Y.pluginPanelName)?(0,n.S)(Y.pluginPanelName):null,[Y.name]);if(!me)return s.createElement(l.Z,{className:"w-full text-center",message:s.createElement("div",null,s.createElement("p",null,(0,e.t)("\u8BE5\u9762\u677F\u7531\u63D2\u4EF6\u63D0\u4F9B")),s.createElement("p",null,(0,e.t)("\u63D2\u4EF6\u540D"),": ",Y.provider),s.createElement("p",null,(0,e.t)("\u9762\u677F\u540D"),": ",Y.pluginPanelName))});const Pe=me.render;return Pe?s.createElement(Pe,{panelInfo:Y}):s.createElement(r.t,{text:(0,e.t)("\u63D2\u4EF6\u6E32\u67D3\u51FD\u6570\u4E0D\u5B58\u5728")})});a.displayName="GroupPluginPanel";var N=t(94229),O=t(29254),b=t(84143),f=t(7975),P=t(95850),A=t(93540),R=t(9021),M=t(55696),I=t(96136),B=t(79546),w=t(64917),_=t(51052),X=t(6342),ce=t(89022),ee=t.n(ce),K=t(28102),D=t.n(K),W=t(13546),m=t.n(W);const y=s.memo(ie=>{var Y;const me=ie.groupId,Pe=(0,e.iFL)(me),be=(Y=Pe==null?void 0:Pe.members)!=null?Y:[],Ue=(0,e.aoI)(be.map(h=>h.userId)),[Se]=(0,e.WHr)(me,[e.g3S.core.manageUser]),{hideGroupMemberDiscriminator:j}=(0,e.r3q)(Pe),{userInfos:U,searchText:k,setSearchText:Q,isSearching:$,searchResult:he,generateActionMenu:ye}=(0,w.Q)(me),Me=(0,s.useMemo)(()=>{const h=[],S=[];return U.forEach((L,ue)=>{Ue[ue]===!0?h.push(L):S.push(L)}),{[(0,e.t)("\u5728\u7EBF")]:h,[(0,e.t)("\u79BB\u7EBF")]:S}},[U,Ue]),{groupCounts:Oe,groupNames:Re,getGroupedMemberInfo:Ge}=(0,s.useMemo)(()=>{const h=$?{"":he}:Me,S=Object.values(h).map(H=>H.length),L=Object.keys(h);return{groupCounts:S,groupNames:L,getGroupedMemberInfo:(H,Ce)=>{const Ae=L[Ce],Ee=D()(ee()(S,Ce)),fe=H-Ee;return m()(h,[Ae,fe],null)}}},[$,he,Me]);if(!Pe)return s.createElement(r.t,null);if(U.length===0)return s.createElement(M.Z,null);const _e=h=>{if(!h)return s.createElement("div",null);if(Se){const S=ye(h);return s.createElement(I.Z,{key:h._id,trigger:["contextMenu"],menu:S},s.createElement("div",null,s.createElement(R.Q,{userId:h._id,popover:s.createElement(_.Z,{userInfo:h}),hideDiscriminator:j})))}else return s.createElement(R.Q,{key:h._id,userId:h._id,popover:s.createElement(_.Z,{userInfo:h}),hideDiscriminator:j})};return s.createElement("div",{className:"h-full flex flex-col"},s.createElement("div",{className:"p-2"},s.createElement(B.Z,{placeholder:(0,e.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:s.createElement(A.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:k,onChange:h=>Q(h.target.value)})),s.createElement("div",{className:"flex-1"},s.createElement(X.Px,{className:"h-full",groupCounts:Oe,groupContent:h=>s.createElement("div",{className:"pt-4 px-2.5 font-bold text-sm text-opacity-80 bg-content-light dark:bg-content-dark"},Re[h]," - ",Oe[h]),itemContent:(h,S)=>_e(Ge(h,S))})))});y.displayName="MembersPanel";var Z=t(29188),J=t(63839);function se(ie,Y){const me=(0,e.IIz)(),Pe=(0,e.mWi)(ie,me??""),[be]=(0,e.a_M)(ie,Y,[e.g3S.core.message]),[Ue,Se]=(0,s.useState)(void 0),j=(0,s.useCallback)(()=>{Se(Pe&&Pe?(0,e.t)("\u7981\u8A00\u4E2D, \u8FD8\u5269 {{remain}}",{remain:(0,e.TGs)(new Date().valueOf()-new Date(Pe).valueOf())}):void 0)},[Pe]);return(0,e.Yzt)(j,1e4),(0,s.useLayoutEffect)(()=>{j()},[Pe]),be?{disabled:Boolean(Pe),placeholder:Ue}:{disabled:!0,placeholder:(0,e.t)("\u6CA1\u6709\u53D1\u9001\u6D88\u606F\u7684\u6743\u9650, \u8BF7\u8054\u7CFB\u7FA4\u7EC4\u6240\u6709\u8005")}}const de=s.memo(({groupId:ie,panelId:Y})=>{const me=(0,e.iFL)(ie),Pe=(0,e.Tgq)(ie),be=(0,e.wY6)(ie,Y),{disabled:Ue,placeholder:Se}=se(ie,Y),j=(0,P.x)();return!me||!be?null:s.createElement(Z.q,{groupId:ie,panelId:Y,prefixActions:()=>[...f.pluginPanelActions.filter(U=>U.position==="group").map(U=>s.createElement(b.a,{key:U.name,title:U.label,shape:"square",icon:U.icon,iconClassName:"text-2xl",onClick:()=>U.onClick({groupId:ie,panelId:Y})}))],suffixActions:({setRightPanel:U})=>[s.createElement(b.a,{key:"search",title:(0,e.t)("\u804A\u5929\u8BB0\u5F55\u641C\u7D22"),shape:"square",icon:"mdi:text-search",iconClassName:"text-2xl",onClick:()=>U({name:(0,e.t)("\u804A\u5929\u8BB0\u5F55"),panel:s.createElement(J.z,{groupId:ie,converseId:Y})})}),s.createElement(b.a,{key:"members",title:(0,e.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>U({name:(0,e.t)("\u6210\u5458")+` (${Pe.length})`,panel:s.createElement(y,{groupId:ie})})})]},s.createElement(O.x2,{users:Pe.map(U=>({id:U._id,display:j[U._id]?j[U._id]:U.nickname})),panels:me.panels.filter(U=>U.type!==e.Xpe.GROUP).map(U=>({id:`/main/group/${ie}/${U.id}`,display:U.name})),disabled:Ue,placeholder:Se},s.createElement(N.r,{converseId:Y,converseTitle:be.name,isGroup:!0,groupId:ie})))});de.displayName="TextPanel";var pe=t(85478),De=t(95483),ge=t(22215),xe=Object.defineProperty,Be=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable,Xe=(ie,Y,me)=>Y in ie?xe(ie,Y,{enumerable:!0,configurable:!0,writable:!0,value:me}):ie[Y]=me,He=(ie,Y)=>{for(var me in Y||(Y={}))ke.call(Y,me)&&Xe(ie,me,Y[me]);if(Ke)for(var me of Ke(Y))je.call(Y,me)&&Xe(ie,me,Y[me]);return ie},$e=(ie,Y)=>Be(ie,Ze(Y));function qe(ie,Y){const[me,Pe]=(0,De.r)("groupLastVisitPanel");(0,s.useEffect)(()=>{Pe($e(He({},me),{[ie]:Y}))},[ie,Y])}const Qe=s.memo(ie=>{const{groupId:Y,panelId:me}=ie,Pe=(0,e.iFL)(Y),be=(0,e.wY6)(Y,me),Ue=(0,s.useMemo)(()=>({groupId:Y,panelId:me}),[Y,me]);qe(Y,me);const[Se]=(0,e.a_M)(Y,me,[e.g3S.core.viewPanel]);return Pe===null?s.createElement(l.Z,{className:"w-full text-center",type:"error",message:(0,e.t)("\u7FA4\u7EC4\u4E0D\u5B58\u5728")}):be===null?s.createElement(r.t,{text:(0,e.t)("\u9762\u677F\u4E0D\u5B58\u5728")}):Se?be.type===e.Xpe.TEXT?s.createElement(e.f4G,{groupInfo:Pe},s.createElement(pe.x.Provider,{value:Ue},s.createElement(de,{groupId:Y,panelId:be.id}))):be.type===e.Xpe.PLUGIN?s.createElement(pe.x.Provider,{value:Ue},s.createElement(a,{groupId:Y,panelId:be.id})):s.createElement(l.Z,{className:"w-full text-center",type:"error",message:(0,e.t)("\u672A\u77E5\u7684\u9762\u677F\u7C7B\u578B")}):s.createElement(r.t,{text:(0,e.t)("\u6CA1\u6709\u9762\u677F\u8BBF\u95EE\u6743\u9650")})});Qe.displayName="GroupPanelRender";const Ye=s.memo(()=>{const{groupId:ie,panelId:Y}=(0,ge.PO)();return s.createElement(Qe,{groupId:ie,panelId:Y})});Ye.displayName="GroupPanelRoute"},53937:(Fe,V,t)=>{t.d(V,{Z:()=>Se});var r=t(6739),n=t(14517),l=t(52983),s=t(72425),e=t(98281);const a=l.memo(j=>{const[U,{save:k}]=(0,e.y$C)("pin-sizes",[90,10]),Q=$=>{k($)};return l.createElement(s.Z,{className:(0,n.Z)("split",j.className),sizes:U,minSize:250,expandToMin:!0,onDragEnd:Q},j.children)});a.displayName="SplitPanel";var N=t(50842),O=t(54782),b=t(12492),f=t(16131),P=t(14698),A=t.n(P),R=t(95483);const M=l.memo(()=>{const{groupId:j=""}=(0,O.useParams)(),U=(0,O.useNavigate)(),[k]=(0,R.r)("groupLastVisitPanel"),Q=(0,e.ysv)(k),$=(0,e.iFL)(j);return(0,l.useEffect)(()=>{var he;if(!$||!Array.isArray($==null?void 0:$.panels)||($==null?void 0:$.panels.length)===0)return;const ye=(he=Q.current)==null?void 0:he[$._id],Me=$.panels;if(Me.some(Ge=>Ge.id===ye)){U(`/main/group/${j}/${ye}`,{replace:!0});return}const Re=Me.find(Ge=>Ge.type!==e.Xpe.GROUP);A()(Re)||U(`/main/group/${j}/${Re.id}`,{replace:!0})},[$]),null});M.displayName="GroupPanelRedirect";var I=t(6494),B=t.n(I),w=t(1348),_=t(84208),X=t(17679),ce=t(40318),ee=t(72297),K=t(59417),D=t.n(K);function W(j,U){const k=(0,O.useLocation)(),Q=(0,l.useRef)(""),$=(0,e.ysv)(U);(0,l.useEffect)(()=>{const{nav:he}=(0,ee.qp)(k.search,{ignoreQueryPrefix:!0}),ye=String(he);ye&&(ye!==Q.current&&D()(ye,j)&&$.current(ye),Q.current=ye)},[k.search])}var m=(j,U,k)=>new Promise((Q,$)=>{var he=Oe=>{try{Me(k.next(Oe))}catch(Re){$(Re)}},ye=Oe=>{try{Me(k.throw(Oe))}catch(Re){$(Re)}},Me=Oe=>Oe.done?Q(Oe.value):Promise.resolve(Oe.value).then(he,ye);Me((k=k.apply(j,U)).next())});function y(j){const U=(0,e.GLd)(j),k=(0,O.useNavigate)(),Q=(0,l.useCallback)(()=>{const ye=(0,_.h7)(l.createElement(X.a,{groupId:j,onClose:()=>{(0,_.Mr)(ye)}}))},[j]),$=(0,l.useCallback)(()=>{(0,_.h7)(l.createElement(ce.P,{groupId:j}))},[j]),he=(0,l.useCallback)(()=>{(0,e.wp$)({message:U?(0,e.t)("\u60A8\u662F\u7FA4\u7EC4\u7BA1\u7406\u8005\uFF0C\u9000\u51FA\u7FA4\u7EC4\u4F1A\u5BFC\u81F4\u89E3\u6563\u7FA4\u7EC4"):(0,e.t)("\u786E\u5B9A\u8981\u9000\u51FA\u7FA4\u7EC4\u4E48?"),onConfirm(){return m(this,null,function*(){yield(0,e.XV6)(j),k("/main",{replace:!0})})}})},[j,U]);return W("group.*",ye=>{ye.startsWith("group.detail")&&Q()}),{handleShowGroupDetail:Q,handleInviteUser:$,handleQuitGroup:he}}const Z=l.memo(j=>{const{groupId:U}=j,k=(0,e.iFL)(U),{t:Q}=(0,e.$G7)(),[$,he]=(0,e.WHr)(U,[e.g3S.core.groupDetail,e.g3S.core.invite]),{handleShowGroupDetail:ye,handleInviteUser:Me,handleQuitGroup:Oe}=y(U);if(A()(k))return null;const Re={items:B()([$&&{key:"0",label:Q("\u67E5\u770B\u8BE6\u60C5"),onClick:ye},he&&{key:"1",label:Q("\u9080\u8BF7\u7528\u6237"),onClick:Me},{key:"2",label:Q("\u9000\u51FA\u7FA4\u7EC4"),danger:!0,onClick:Oe}])};return l.createElement(w.M,{menu:Re,"data-testid":"group-header"},k==null?void 0:k.name)});Z.displayName="GroupHeader";var J=t(93540);const se=l.memo(j=>{const[U,k]=(0,l.useReducer)(Q=>!Q,!0);return l.createElement("div",null,l.createElement("div",{className:"flex items-center cursor-pointer py-1 text-xs",onClick:k},l.createElement(J.JO,{className:"mr-1",icon:"mdi:chevron-right",rotate:U?45:0}),l.createElement("div",null,j.header)),l.createElement("div",{className:"transition-all overflow-hidden space-y-0.5 pl-2 ml-1 border-l-4 border-opacity-40",style:{maxHeight:U?"var(--max-height)":0},ref:Q=>Q==null?void 0:Q.style.setProperty("--max-height",`${Q.scrollHeight}px`)},j.children))});se.displayName="GroupSection";var de=t(10114),pe=t(75283),De=t(58761),ge=t(68e3),xe=t(10330),Be=Object.defineProperty,Ze=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,je=(j,U,k)=>U in j?Be(j,U,{enumerable:!0,configurable:!0,writable:!0,value:k}):j[U]=k,Xe=(j,U)=>{for(var k in U||(U={}))Ke.call(U,k)&&je(j,k,U[k]);if(Ze)for(var k of Ze(U))ke.call(U,k)&&je(j,k,U[k]);return j};const He=l.memo(j=>{const{icon:U,name:k,to:Q,dimmed:$=!1,badge:he}=j,Me=(0,O.useLocation)().pathname.startsWith(Q);return l.createElement(xe.rU,{className:"block",to:Q},l.createElement("div",{className:(0,n.Z)("w-full hover:bg-black hover:bg-opacity-20 dark:hover:bg-white dark:hover:bg-opacity-20 cursor-pointer text-gray-900 dark:text-white rounded px-1 h-8 flex items-center text-base group",{"bg-black bg-opacity-20 dark:bg-white dark:bg-opacity-20":Me},$&&"text-opacity-40 dark:text-opacity-40")},l.createElement("div",{className:(0,n.Z)("flex items-center justify-center px-1 mr-1")},U),l.createElement(pe.Z.Text,{className:(0,n.Z)("flex-1 text-gray-900 dark:text-white",$&&"text-opacity-40 dark:text-opacity-40"),ellipsis:!0},k),l.createElement(De.Z,null,he===!0&&l.createElement(ge.Z,Xe({status:"error"},j.badgeProps)),j.extraBadge)))});He.displayName="GroupPanelItem";var $e=t(22215);const qe=l.memo(j=>{var U;const{groupId:k,panel:Q}=j,$=Q.id,he=(0,e.EP)($),ye=(0,$e.rF)(k,$,(U=Q.pluginPanelName)!=null?U:""),{checkIsMuted:Me}=(0,e.OqL)(),Oe=Me($,k);return l.createElement(He,{name:Q.name,icon:j.icon,to:`/main/group/${k}/${Q.id}`,dimmed:Oe,badge:he,badgeProps:{status:Oe?"default":"error"},extraBadge:ye})});qe.displayName="GroupAckPanelItem";var Qe=t(96136),Ye=t(86724),ie=t.n(Ye),Y=t(103),me=t(38887),Pe=t(35633);const be=l.memo(j=>{var U;const{groupId:k,panel:Q}=j,$=Q.id,{hasOpenedPanel:he,openPanelWindow:ye}=(0,Y.l)(`/panel/group/${k}/${$}`),Me=(0,e.iFL)(k),Oe=(0,e.TL5)(),{markConverseAllAck:Re}=(0,e.hoD)($),Ge=(0,$e.Sp)(Q),_e=(0,$e.rF)(k,$,(U=Q.pluginPanelName)!=null?U:""),{checkIsMuted:h,toggleMute:S}=(0,e.OqL)(),[L]=(0,e.a_M)(k,$,[e.g3S.core.viewPanel]);if(!Me)return l.createElement(me.T,null);if(!L)return null;const ue=(0,e.YQu)(Me.pinnedPanelId)&&Me.pinnedPanelId===$,H={items:B()([{key:"copy",label:(0,e.t)("\u590D\u5236\u94FE\u63A5"),icon:l.createElement(J.JO,{icon:"mdi:content-copy"}),onClick:()=>{ie()(`${location.origin}/main/group/${k}/${$}`),(0,e.lHp)((0,e.t)("\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"))}},{key:"new",label:(0,e.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),icon:l.createElement(J.JO,{icon:"mdi:dock-window"}),disabled:he,onClick:ye},ue?{key:"unpin",label:(0,e.t)("Unpin"),icon:l.createElement(J.JO,{icon:"mdi:pin-off"}),onClick:()=>{Oe(e.hyC.unpinGroupPanel({groupId:k}))}}:{key:"pin",label:(0,e.t)("Pin"),icon:l.createElement(J.JO,{icon:"mdi:pin"}),onClick:()=>{Oe(e.hyC.pinGroupPanel({groupId:k,panelId:$}))}},Q.type===e.Xpe.TEXT&&{key:"markAsRead",label:(0,e.t)("\u6807\u8BB0\u4E3A\u5DF2\u8BFB"),icon:l.createElement(J.JO,{icon:"mdi:message-badge-outline"}),onClick:Re},Q.type===e.Xpe.TEXT&&{key:"mute",label:h($,k)?(0,e.t)("\u53D6\u6D88\u514D\u6253\u6270"):(0,e.t)("\u514D\u6253\u6270"),icon:l.createElement(J.JO,{icon:"mdi:bell-off-outline"}),onClick:()=>S($)},...Ge])},Ce=ue?l.createElement(J.JO,{icon:"mdi:pin"}):l.createElement(J.JO,{icon:"mdi:pound"});return l.createElement(Qe.Z,{menu:H,trigger:["contextMenu"]},l.createElement("div",null,(0,Pe.Q)(Q)?l.createElement(qe,{icon:Ce,groupId:k,panel:Q}):l.createElement(He,{name:Q.name,icon:Ce,to:`/main/group/${k}/${$}`,extraBadge:_e})))});be.displayName="SidebarItem";const Ue=l.memo(()=>{var j;const{groupId:U=""}=(0,O.useParams)(),k=(0,e.iFL)(U),Q=(j=k==null?void 0:k.panels)!=null?j:[];return l.createElement(de.L,{"data-tc-role":"sidebar-group"},l.createElement(Z,{groupId:U}),l.createElement("div",{className:"p-2 space-y-1 overflow-auto"},Q.filter($=>!(0,e.YQu)($.parentId)).map($=>$.type===e.Xpe.GROUP?l.createElement(se,{key:$.id,header:$.name},Q.filter(he=>he.parentId===$.id).map(he=>l.createElement(be,{key:he.id,groupId:U,panel:he}))):l.createElement(be,{key:$.id,groupId:U,panel:$}))))});Ue.displayName="Sidebar";const Se=l.memo(()=>{const{groupId:j=""}=(0,O.useParams)(),U=(0,e.iFL)(j);if(!U)return l.createElement(r.t,{text:(0,e.t)("\u7FA4\u7EC4\u672A\u627E\u5230")});const k=U.pinnedPanelId,Q=l.createElement(O.Routes,null,l.createElement(O.Route,{path:"/:panelId",element:l.createElement(f.x,null)}),l.createElement(O.Route,{path:"/",element:l.createElement(M,null)}));return l.createElement(N.A,{value:j},l.createElement(b.J,{"data-tc-role":"content-group",sidebar:l.createElement(Ue,null)},(0,e.YQu)(k)?l.createElement(a,{className:"flex-auto w-full"},l.createElement("div",null,Q),l.createElement("div",null,l.createElement(f.E,{groupId:j,panelId:k}))):Q))});Se.displayName="Group"},12492:(Fe,V,t)=>{t.d(V,{J:()=>K});var r=t(52983),n=t(58935),l=t(14698),s=t.n(l),e=t(59270),a=t(89935),N=t(14517),O=t(67706),b=t(98281),f=Object.defineProperty,P=Object.defineProperties,A=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,B=(D,W,m)=>W in D?f(D,W,{enumerable:!0,configurable:!0,writable:!0,value:m}):D[W]=m,w=(D,W)=>{for(var m in W||(W={}))M.call(W,m)&&B(D,m,W[m]);if(R)for(var m of R(W))I.call(W,m)&&B(D,m,W[m]);return D},_=(D,W)=>P(D,A(W)),X=(D,W)=>{var m={};for(var y in D)M.call(D,y)&&W.indexOf(y)<0&&(m[y]=D[y]);if(D!=null&&R)for(var y of R(D))W.indexOf(y)<0&&I.call(D,y)&&(m[y]=D[y]);return m};const ce=D=>{var W=D,{className:m,style:y,children:Z}=W,J=X(W,["className","style","children"]);return r.createElement("div",_(w({},J),{style:y,className:(0,N.Z)("flex flex-row flex-1 overflow-hidden relative",m)}),Z)},ee=r.memo(D=>{const{setShowSidebar:W}=(0,n.S)(),m=(0,e.useDrag)(y=>{const{swipe:Z}=y,J=Z[0];J>0?W(!0):J<0&&W(!1)},{axis:"x",swipe:{distance:5}});return r.createElement(ce,w({style:{touchAction:"pan-x"}},m()),D.children)});ee.displayName="PageGestureWrapper";const K=r.memo(D=>{const{sidebar:W,children:m}=D,{showSidebar:y,setShowSidebar:Z}=(0,n.S)(),J=(0,a.d)(),se=(0,r.useCallback)(Be=>{Be.stopPropagation(),Be.preventDefault(),Z(!1)},[]);(0,b.qoQ)([J],()=>{J===!1&&Z(!0)});const de=s()(W)?null:r.createElement("div",{className:(0,N.Z)("bg-sidebar-light dark:bg-sidebar-dark flex-shrink-0 transition-width w-60")},D.sidebar),pe=J===!0&&y===!0&&!s()(de),De=pe?r.createElement("div",{className:"absolute right-0 top-0 bottom-0 z-10",style:{width:"calc(100% - 15rem)"},onClick:se}):null,ge=m,xe=r.createElement(O.S,null,de,De,r.createElement("div",{className:(0,N.Z)("flex flex-auto bg-content-light dark:bg-content-dark overflow-hidden",J&&"transform left-0 w-full h-full absolute transition-transform",J&&{"translate-x-60":y,"translate-x-0":!y}),"data-tc-role":D["data-tc-role"]},r.createElement("div",{className:"tc-content-background"}),r.createElement("div",{className:(0,N.Z)("flex relative w-full",{"overflow-auto":!pe,"overflow-hidden":pe})},r.createElement(O.S,null,ge))));return J?r.createElement(ee,null,xe):r.createElement(ce,null,xe)});K.displayName="PageContent"},14231:(Fe,V,t)=>{t.d(V,{d:()=>W});var r=t(64939),n=t(94229),l=t(9021),s=t(52983),e=t(98281),a=t(712),N=t(6494),O=t.n(N),b=t(84208),f=t(75526),P=t(2945),A=(m,y,Z)=>new Promise((J,se)=>{var de=ge=>{try{De(Z.next(ge))}catch(xe){se(xe)}},pe=ge=>{try{De(Z.throw(ge))}catch(xe){se(xe)}},De=ge=>ge.done?J(ge.value):Promise.resolve(ge.value).then(de,pe);De((Z=Z.apply(m,y)).next())});const R=s.memo(m=>{const{converseId:y,withoutUserIds:Z=[]}=m,[J,se]=(0,s.useState)([]),[{loading:de},pe]=(0,e.ilX)(()=>A(void 0,null,function*(){yield(0,e.m8p)(y,[...J]),(0,b.Mr)()}),[y,J]);return s.createElement(b.AB,{title:(0,e.t)("\u9080\u8BF7\u597D\u53CB\u52A0\u5165\u4F1A\u8BDD")},s.createElement(P.B,{withoutUserIds:Z,selectedIds:J,onChange:se}),s.createElement("div",{className:"text-right"},s.createElement(f.Z,{type:"primary",loading:de,onClick:pe},(0,e.t)("\u786E\u8BA4"))))});R.displayName="AppendDMConverseMembers";var M=t(103),I=t(87179),B=t(84143),w=t(7975),_=t(50093),X=t(63839);const ce=s.memo(({converse:m})=>{const y=(0,e.Y84)(m);return(0,e.t)("\u4E0E {{name}} \u7684\u4F1A\u8BDD",{name:y})});ce.displayName="ConversePanelTitle";const ee=s.memo(({members:m})=>s.createElement("div",null,m.map(y=>s.createElement(l.Q,{key:y,userId:y}))));ee.displayName="ConversePanelMembers";const K=s.memo(({converseId:m})=>{const y=(0,e.CGy)(pe=>pe.chat.converses[m]),{hasOpenedPanel:Z,openPanelWindow:J,closePanelWindow:se}=(0,M.l)(`/panel/personal/converse/${m}`);if(Z)return s.createElement(I.x,{onClosePanelWindow:se});const de=y&&s.createElement(ce,{converse:y});return s.createElement(a.S,{header:de,actions:({setRightPanel:pe})=>y?O()([...w.pluginPanelActions.filter(De=>De.position==="dm").map(De=>s.createElement(B.a,{key:De.name,title:De.label,shape:"square",icon:De.icon,iconClassName:"text-2xl",onClick:()=>De.onClick({converseId:m})})),s.createElement(B.a,{key:"open",title:(0,e.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),shape:"square",icon:"mdi:dock-window",iconClassName:"text-2xl",onClick:J}),y.members.length===2?s.createElement(B.a,{key:"create",title:(0,e.t)("\u521B\u5EFA\u4F1A\u8BDD"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,b.h7)(s.createElement(_.m,{hiddenUserIds:y.members}))}):s.createElement(B.a,{key:"add",title:(0,e.t)("\u9080\u8BF7\u6210\u5458"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,b.h7)(s.createElement(R,{converseId:y._id,withoutUserIds:y.members}))}),s.createElement(B.a,{key:"search",title:(0,e.t)("\u804A\u5929\u8BB0\u5F55\u641C\u7D22"),shape:"square",icon:"mdi:text-search",iconClassName:"text-2xl",onClick:()=>pe({name:(0,e.t)("\u804A\u5929\u8BB0\u5F55"),panel:s.createElement(X.z,{converseId:m})})}),y.members.length>2&&s.createElement(B.a,{key:"members",title:(0,e.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>pe({name:(0,e.t)("\u6210\u5458")+` (${y.members.length})`,panel:s.createElement(ee,{members:y.members})})})]):[]},s.createElement(n.r,{converseId:m,converseTitle:de,isGroup:!1}))});K.displayName="ConversePanel";var D=t(54782);const W=s.memo(()=>{const m=(0,D.useParams)();return m.converseId?s.createElement(K,{converseId:m.converseId}):s.createElement(r.T,null)});W.displayName="PersonalConverse"},7364:(Fe,V,t)=>{t.d(V,{l:()=>B});var r=t(98281),n=t(52983),l=t(38887),s=t(21848),e=t(14698),a=t.n(e),N=t(54782),O=t(58935),b=t(442),f=t(5198),P=t(96857),A=t(6739),R=t(13893),M=(w,_,X)=>new Promise((ce,ee)=>{var K=m=>{try{W(X.next(m))}catch(y){ee(y)}},D=m=>{try{W(X.throw(m))}catch(y){ee(y)}},W=m=>m.done?ce(m.value):Promise.resolve(m.value).then(K,D);W((X=X.apply(w,_)).next())});function I(){const w=(0,N.useNavigate)(),{value:_,loading:X,error:ce}=(0,r.r53)(()=>M(this,null,function*(){let D;try{D=yield(0,s.gP)()}catch(y){w(`/entry/login?redirect=${encodeURIComponent(location.pathname)}`,{replace:!0});return}const W=(0,r.vIP)();W.dispatch(r.hIH.setUserInfo(D)),(0,f._3)(W);const m=yield(0,r.Tzh)(D.token);return(0,f.Kj)(m),(0,r.cUn)(m,W),{store:W,socket:m}}),[]),ee=_==null?void 0:_.store,K=_==null?void 0:_.socket;return{loading:X,store:ee,socket:K,error:ce}}const B=n.memo(w=>{const{loading:_,store:X,error:ce,socket:ee}=I();return _?n.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-content-light dark:bg-content-dark text-gray-700 dark:text-white text-xl"},n.createElement(l.T,{tip:(0,r.t)("\u6B63\u5728\u8FDE\u63A5\u5230\u804A\u5929\u670D\u52A1\u5668...")})):ce?(console.error("[MainProvider]",ce),n.createElement("div",null,ce.message)):a()(X)?n.createElement(A.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Store \u521B\u5EFA\u5931\u8D25")}):a()(ee)?n.createElement(A.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Socket \u521B\u5EFA\u5931\u8D25")}):n.createElement(r.m$Z,{store:X},n.createElement(P.Z,{socket:ee},n.createElement(O.f,null,n.createElement(R.L,null,n.createElement(b.$2,null,w.children)))))});B.displayName="MainProvider"},58935:(Fe,V,t)=>{t.d(V,{S:()=>a,f:()=>e});var r=t(52983),n=t(71607),l=t.n(n);const s=r.createContext({showSidebar:!0,switchSidebar:l(),setShowSidebar:l()});s.displayName="SidebarContext";const e=r.memo(N=>{const[O,b]=(0,r.useState)(!0),f=(0,r.useCallback)(()=>{b(!O)},[O]);return r.createElement(s.Provider,{value:{showSidebar:O,switchSidebar:f,setShowSidebar:b}},N.children)});e.displayName="SidebarContextProvider";function a(){return(0,r.useContext)(s)}},35633:(Fe,V,t)=>{t.d(V,{Q:()=>l});var r=t(98281),n=t(89889);function l(s){var e,a;if(s.type===r.Xpe.TEXT)return!0;if(s.type===r.Xpe.PLUGIN){const N=(0,n.S)(s.name);return(a=(e=N==null?void 0:N.feature)==null?void 0:e.includes("ack"))!=null?a:!1}return!1}},64750:(Fe,V,t)=>{t.d(V,{$:()=>s,FF:()=>l,Hi:()=>e,dq:()=>N,er:()=>a,ks:()=>O,rR:()=>n});var r=t(79172);const n=(0,r.P6)("enter"),l=(0,r.P6)("space"),s=(0,r.P6)("esc"),e=(0,r.P6)("mod+k"),a=(0,r.P6)("up"),N=(0,r.P6)("down");function O(b){const f=b.key;return/[a-zA-Z]/.test(f)}},83996:(Fe,V,t)=>{t.d(V,{f:()=>s,w:()=>e});var r=t(98281),n=(a,N,O)=>new Promise((b,f)=>{var P=M=>{try{R(O.next(M))}catch(I){f(I)}},A=M=>{try{R(O.throw(M))}catch(I){f(I)}},R=M=>M.done?b(M.value):Promise.resolve(M.value).then(P,A);R((O=O.apply(a,N)).next())});function l(a){return n(this,null,function*(){const N=document.createElement("img");return new Promise((O,b)=>{N.onload=()=>O(N),N.onerror=b,N.src=(0,r.Awg)(a),N.crossOrigin="Anonymous"})})}function s(a){return n(this,null,function*(){const N=yield l(a),O=document.createElement("canvas");O.width=N.width,O.height=N.height;const b=O.getContext("2d");if(!b)return{r:0,g:0,b:0,a:0};b.drawImage(N,0,0,O.width,O.height);const f=b.getImageData(0,0,O.width,O.height);let P=0,A=0,R=0,M=0;for(let B=0;B<f.height;B++)for(let w=0;w<f.width;w++)P+=f.data[(f.width*B+w)*4],A+=f.data[(f.width*B+w)*4+1],R+=f.data[(f.width*B+w)*4+2],M+=f.data[(f.width*B+w)*4+3];const I=f.width*f.height;return P=Math.round(P/I),A=Math.round(A/I),R=Math.round(R/I),M=Math.round(M/I),{r:P,g:A,b:R,a:M}})}function e(a){return!["image/gif"].includes(a)}},21848:(Fe,V,t)=>{t.d(V,{JM:()=>f,gP:()=>b,rU:()=>N});var r=t(98281),n=t(14698),l=t.n(n),s=t(87450),e=(P,A,R)=>new Promise((M,I)=>{var B=X=>{try{_(R.next(X))}catch(ce){I(ce)}},w=X=>{try{_(R.throw(X))}catch(ce){I(ce)}},_=X=>X.done?M(X.value):Promise.resolve(X.value).then(B,w);_((R=R.apply(P,A)).next())});let a=null;function N(P){a=P}function O(){return a}function b(){return e(this,null,function*(){let P=O();if(l()(P)){const A=yield(0,s.pT)();if(typeof A!="string")throw new Error("Token \u683C\u5F0F\u4E0D\u5408\u6CD5");if(console.debug("\u6B63\u5728\u5C1D\u8BD5\u4F7F\u7528Token\u767B\u5F55"),P=yield r.o4J.EA.loginWithToken(A),P===null)throw new Error("Token \u5185\u5BB9\u4E0D\u5408\u6CD5");N(P)}return P})}function f(P){if(typeof P!="string")return!0;const A=P.split("@")[1];return!!(!A||A.endsWith(".msgbyte.com"))}}}]);
