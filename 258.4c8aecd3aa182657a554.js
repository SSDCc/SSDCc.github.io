"use strict";(self.webpackChunktailchat_web=self.webpackChunktailchat_web||[]).push([[258],{75209:(Me,Q,e)=>{e.d(Q,{d:()=>ve});var r=e(52983),n=e(30831),a=e(7975),s=e(93540),t=e(20685);function l(P){const b=(0,r.useMemo)(()=>a.messageInterpreter.map(({name:S,explainMessage:ce})=>({name:S,render:ce(P)})).filter(({render:S})=>S!==null),[P]);return b.length===0?null:r.createElement("span",{className:"align-middle hidden group-hover:inline-block"},r.createElement(t.Z,{placement:"topLeft",title:(0,n.t)("\u6D88\u606F\u89E3\u91CA"),content:r.createElement("div",{className:"max-w-lg"},b.map((S,ce)=>{var X;return r.createElement("p",{key:ce+((X=S.name)!=null?X:"")},S.name&&r.createElement("span",null,(0,n.t)("\u6765\u81EA")," ",r.createElement("span",{className:"font-bold"},S.name)," :"," "),S.render)})),trigger:"click"},r.createElement(s.JO,{className:"cursor-pointer text-base",icon:"mdi:file-question-outline"})))}var A=e(96136),F=e(75217),G=e(66559),p=e(14517),g=e(84208),N=e(86724),L=e.n(N),M=e(6494),x=e.n(M),U=(P,b,S)=>new Promise((ce,X)=>{var he=ge=>{try{Ee(S.next(ge))}catch(Te){X(Te)}},Ie=ge=>{try{Ee(S.throw(ge))}catch(Te){X(Te)}},Ee=ge=>ge.done?ce(ge.value):Promise.resolve(ge.value).then(he,Ie);Ee((S=S.apply(P,b)).next())});function K(P,b){var S;const ce=(0,n.xMc)(),X=(0,n.rE2)(),he=(0,n.Pc$)(),[Ie]=(0,n.WHr)((S=X==null?void 0:X._id)!=null?S:"",[n.g3S.core.deleteMessage]),Ee=(0,r.useCallback)(()=>{L()((0,a.getMessageTextDecorators)().serialize(P.content)),(0,n.jiy)((0,n.t)("\u590D\u5236\u7EAF\u6587\u672C\u6210\u529F"))},[P.content]),[,ge]=(0,n.CoE)(()=>U(this,null,function*(){(yield(0,g.aW)())&&(yield(0,n.peM)(P._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u64A4\u56DE\u6210\u529F")))}),[P._id]),[,Te]=(0,n.CoE)(()=>U(this,null,function*(){(yield(0,g.aW)())&&(yield(0,n.$Zg)(P._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u5220\u9664\u6210\u529F")))}),[P._id]),v=X&&X.owner===(he==null?void 0:he._id),D=P.author===(he==null?void 0:he._id);return{onClick:b.onClick,items:x()([{key:"copy",label:(0,n.t)("\u590D\u5236"),icon:r.createElement(s.JO,{icon:"mdi:content-copy"}),onClick:Ee},ce.hasContext&&{key:"reply",label:(0,n.t)("\u56DE\u590D"),icon:r.createElement(s.JO,{icon:"mdi:reply"}),onClick:()=>n.Agn.emit("replyMessage",P)},(v||D)&&{key:"recall",label:(0,n.t)("\u64A4\u56DE"),icon:r.createElement(s.JO,{icon:"mdi:restore"}),onClick:ge},Ie&&{key:"delete",label:(0,n.t)("\u5220\u9664"),danger:!0,icon:r.createElement(s.JO,{icon:"mdi:delete-outline"}),onClick:Te}])}}var Y=e(53652),j=e(71607),ie=e.n(j),ee=Object.defineProperty,w=Object.defineProperties,y=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,Z=(P,b,S)=>b in P?ee(P,b,{enumerable:!0,configurable:!0,writable:!0,value:S}):P[b]=S,z=(P,b)=>{for(var S in b||(b={}))d.call(b,S)&&Z(P,S,b[S]);if(I)for(var S of I(b))O.call(b,S)&&Z(P,S,b[S]);return P},le=(P,b)=>w(P,y(b));const me=r.createContext({closePopover:ie()}),de=r.memo(P=>{const[b,S]=(0,r.useState)(!1),ce=(0,r.useCallback)(Ie=>{S(Ie),typeof P.onOpenChange=="function"&&P.onOpenChange(Ie)},[P.onOpenChange]),X=(0,r.useCallback)(()=>{S(!1),typeof P.onOpenChange=="function"&&P.onOpenChange(!1)},[]),he=(0,r.useMemo)(()=>({closePopover:X}),[X]);return r.createElement(me.Provider,{value:he},r.createElement(t.Z,le(z({},P),{open:b,onOpenChange:ce})))});de.displayName="TcPopover";function Fe(){var P;const b=(0,r.useContext)(me);return{closePopover:(P=b==null?void 0:b.closePopover)!=null?P:ie()}}var xe=(P,b,S)=>new Promise((ce,X)=>{var he=ge=>{try{Ee(S.next(ge))}catch(Te){X(Te)}},Ie=ge=>{try{Ee(S.throw(ge))}catch(Te){X(Te)}},Ee=ge=>ge.done?ce(ge.value):Promise.resolve(ge.value).then(he,Ie);Ee((S=S.apply(P,b)).next())});function be(P){const b=(0,n.ysv)(P);return(0,r.useMemo)(()=>()=>{const{closePopover:ce}=Fe(),[,X]=(0,n.CoE)(he=>xe(this,null,function*(){yield(0,n.rUo)(b.current._id,he),ce()}),[]);return r.createElement(Y._,{onSelect:X})},[])}var Se=e(39907),Ze=e.n(Se),ze=e(3010),Je=e.n(ze),je=e(89022),He=e.n(je),$e=e(95268);const Xe=r.memo(P=>{const{reaction:b,onClick:S}=P,ce=(0,n.R8f)(b.users);return r.createElement("div",{className:"py-0.5 px-1 bg-black bg-opacity-20 hover:bg-opacity-40 rounded cursor-pointer"},r.createElement($e.Z,{title:ce.join(", ")},r.createElement("div",{className:"flex",onClick:S},r.createElement(Y.d,{emoji:b.name}),r.createElement("div",{className:"ml-1 text-xs"},ce.length<3?r.createElement("span",null,He()(ce,2).join(",")):r.createElement("span",null,He()(ce,2).join(", "),", ...+",ce.length-2)))))});Xe.displayName="ReactionItem";function Qe(P){var b;const S=P._id,ce=(b=P.reactions)!=null?b:[],X=(0,n.IIz)(),he=(0,r.useMemo)(()=>{const Ee=Ze()(ce,"name");return Object.keys(Ee).map(ge=>{const Te=Je()(Ee[ge],"author");return{name:ge,length:Te.length,users:Te.map(v=>v.author)}})},[ce]),Ie=(0,r.useCallback)(Ee=>{!(0,n.YQu)(X)||(Ee.users.includes(X)?(0,n.WOV)(S,Ee.name):(0,n.rUo)(S,Ee.name))},[S,X]);return r.createElement("div",{className:"flex chat-message-reactions space-x-1 py-0.5"},he.map(Ee=>r.createElement(Xe,{key:Ee.name,reaction:Ee,onClick:()=>Ie(Ee)})))}var Ye=e(22398),se=e(16365),_=e(51052),ue=e(29787),Oe=e.n(ue),Ue=Object.defineProperty,Re=Object.defineProperties,we=Object.getOwnPropertyDescriptors,ke=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,k=(P,b,S)=>b in P?Ue(P,b,{enumerable:!0,configurable:!0,writable:!0,value:S}):P[b]=S,V=(P,b)=>{for(var S in b||(b={}))R.call(b,S)&&k(P,S,b[S]);if(ke)for(var S of ke(b))q.call(b,S)&&k(P,S,b[S]);return P},H=(P,b)=>Re(P,we(b));const fe=r.memo(({payload:P})=>{const b=(0,r.useMemo)(()=>new n.NtG(P).hasReply(),[P]);return b===!1?null:r.createElement("div",{className:"chat-message-item_quote border-l-4 border-black border-opacity-20 pl-2 opacity-80"},(0,n.t)("\u56DE\u590D")," ",r.createElement(G.v,{userId:String(b.author)}),":"," ",r.createElement("span",null,(0,a.getMessageRender)(b.content)))});fe.displayName="MessageQuote";const pe=P=>r.createElement("div",{className:"px-0.5 w-6 h-6 flex justify-center items-center opacity-60 hover:opacity-100"},r.createElement(s.JO,{icon:P.icon})),Be=r.memo(P=>{var b,S;const{showAvatar:ce,payload:X}=P,he=(0,n.xzJ)((b=X.author)!=null?b:""),[Ie,Ee]=(0,r.useState)(!1),ge=Qe(X),Te=be(X),v=K(X,{onClick:()=>{Ee(!1)}}),D=X.isLocal===!0||X.sendFailed===!0;return r.createElement("div",{className:(0,p.Z)("chat-message-item flex px-2 mobile:px-0 group relative select-text",{"bg-black bg-opacity-10":Ie,"hover:bg-black hover:bg-opacity-5":!Ie}),"data-message-id":X._id},r.createElement("div",{className:"w-18 mobile:w-14 flex items-start justify-center pt-0.5"},ce?r.createElement(t.Z,{content:!Oe()(he)&&r.createElement(_.Z,{userInfo:he}),placement:"top",trigger:"click"},r.createElement(s.qE,{className:"cursor-pointer",size:40,src:he.avatar,name:he.nickname})):r.createElement("div",{className:"hidden group-hover:block opacity-40"},(0,n.vMv)(X.createdAt))),r.createElement("div",{className:"flex flex-col flex-1 overflow-auto group",onContextMenu:Ye.UW},ce&&r.createElement("div",{className:"flex items-center"},r.createElement("div",{className:"font-bold"},(S=he.nickname)!=null?S:r.createElement("span",null,"\xA0")),r.createElement("div",{className:"hidden group-hover:block opacity-40 ml-1 text-sm"},(0,n.vMv)(X.createdAt))),r.createElement(s.wb,{maxHeight:340,backgroundColor:"var(--tc-content-background-color)",showFullText:r.createElement("div",{className:"inline-block rounded-full bg-white dark:bg-black opacity-80 py-2 px-3 hover:opacity-100"},(0,n.t)("\u70B9\u51FB\u5C55\u5F00\u66F4\u591A"))},r.createElement("div",{className:"chat-message-item_body leading-6 break-words"},r.createElement(fe,{payload:X}),r.createElement("span",null,(0,a.getMessageRender)(X.content)),X.sendFailed===!0&&r.createElement(s.JO,{className:"inline-block ml-1",icon:"emojione:cross-mark-button"}),l(X.content))),r.createElement("div",null,a.pluginMessageExtraParsers.map(h=>r.createElement(r.Fragment,{key:h.name},h.render(X)))),ge),!D&&r.createElement("div",{className:(0,p.Z)("bg-white dark:bg-black rounded absolute right-2 cursor-pointer -top-3 shadow-sm flex",{"opacity-0 group-hover:opacity-100 bg-opacity-80 hover:bg-opacity-100":!Ie,"opacity-100 bg-opacity-100":Ie})},r.createElement(de,{overlayClassName:"chat-message-item_action-popover",content:Te,placement:"bottomLeft",trigger:["click"],onOpenChange:Ee},r.createElement("div",null,r.createElement(pe,{icon:"mdi:emoticon-happy-outline"}))),r.createElement(A.Z,{menu:v,placement:"bottomLeft",trigger:["click"],onOpenChange:Ee},r.createElement("div",null,r.createElement(pe,{icon:"mdi:dots-horizontal"})))))});Be.displayName="NormalMessage";const Ne=r.memo(({payload:P})=>r.createElement("div",{className:"text-center"},r.createElement("div",{className:"bg-black bg-opacity-20 rounded inline-block py-0.5 px-2 my-1 text-sm"},P.content)));Ne.displayName="SystemMessage";const Le=r.memo(P=>{const S=(0,n.FDf)(P.userIds).map(ce=>ce.nickname);return r.createElement(Ne,H(V({},P),{payload:P.overwritePayload(S)}))});Le.displayName="SystemMessageWithNickname";const Ge=r.memo(P=>{var b;const S=P.payload;return S.author===n.q6$?r.createElement(Ne,V({},P)):S.hasRecall===!0?r.createElement(Le,H(V({},P),{userIds:[(b=S.author)!=null?b:n.q6$],overwritePayload:ce=>H(V({},S),{content:(0,n.t)("{{nickname}} \u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F",{nickname:ce[0]||""})})})):r.createElement(Be,V({},P))});Ge.displayName="ChatMessageItem";function ve(P,b){var S,ce;const X=P[b];if(!X)return r.createElement("div",null);let he=!0,Ie=!0;const Ee=new Date((S=X.createdAt)!=null?S:"");if(b>0){const ge=P[b-1];(0,n.Nvc)(new Date((ce=ge.createdAt)!=null?ce:""),Ee)||(he=!1),he===!1&&(Ie=ge.author!==X.author||ge.hasRecall===!0)}return r.createElement("div",{key:X._id},he&&r.createElement(F.Z,{className:"text-sm opacity-40 px-6 font-normal select-text"},(0,n.omK)(Ee)),X.isLocal===!0?r.createElement("div",{className:"opacity-50"},r.createElement(Ge,{showAvatar:Ie,payload:X})):r.createElement(se.H,{converseId:X.converseId,messageId:X._id},r.createElement(Ge,{showAvatar:Ie,payload:X})))}},81244:(Me,Q,e)=>{e.d(Q,{X:()=>G});var r=e(52983),n=e(30831),a=e(93540);const s=r.memo(p=>r.createElement("div",{className:"px-5 pb-4 pt-8"},r.createElement("div",{className:"font-extrabold mb-2 text-2xl flex items-center space-x-1"},r.createElement(a.JO,{icon:"mdi:pound"}),r.createElement("div",null,p.title)),r.createElement("div",{className:"text-base opacity-80"},(0,n.t)("\u8FD9\u91CC\u662F\u6240\u6709\u6D88\u606F\u7684\u5F00\u59CB\uFF0C\u8BF7\u7545\u6240\u6B32\u8A00\u3002"))));s.displayName="ChatMessageHeader";var t=e(75209),l=e(79861);const A=100,F=40,G=r.memo(p=>{const g=(0,r.useRef)(null),N=(0,r.useRef)(!1),[L,M]=(0,r.useState)(!1),x=(0,n.nWw)(()=>{var K;(K=g.current)==null||K.scrollTo({top:0,behavior:"smooth"})});(0,r.useEffect)(()=>{p.messages.length!==0&&N.current===!1&&x()},[p.messages.length]),(0,n.JtK)("sendMessage",x);const U=(0,r.useCallback)(()=>{p.messages.length!==0&&(!g.current||(-g.current.scrollTop<=F?(N.current=!1,M(!1)):-g.current.scrollTop+g.current.clientHeight>=g.current.scrollHeight-A?p.onLoadMore():(N.current=!0,M(!0))))},[p.messages]);return r.createElement("div",{className:"flex-1 overflow-y-scroll overflow-x-hidden flex flex-col-reverse",ref:g,onScroll:U},r.createElement("div",null,p.messages.map((K,Y,j)=>(0,t.d)(j,Y))),L&&r.createElement(l.a,{onClick:x}),p.title&&!p.hasMoreMessage&&r.createElement(s,{title:p.title}))});G.displayName="NormalMessageList"},79861:(Me,Q,e)=>{e.d(Q,{a:()=>a});var r=e(52983),n=e(93540);const a=r.memo(s=>r.createElement("div",{className:"absolute right-10 bottom-18 px-3 py-2 rounded-full bg-white dark:bg-black bg-opacity-50 shadow cursor-pointer z-10 w-11 h-11 flex justify-center items-center text-2xl hover:bg-opacity-80",onClick:s.onClick},r.createElement(n.JO,{icon:"mdi:chevron-double-down"})));a.displayName="ScrollToBottom"},21506:(Me,Q,e)=>{e.d(Q,{r:()=>Te});var r=e(7975),n=e(52983),a=e(30831),s=e(21597),t=e(55696);const l=n.memo(()=>{const v={rows:1};return n.createElement("div",{className:"px-2 w-2/3"},n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}))});l.displayName="ChatBoxPlaceholder";var A=e(64750),F=e(93540),G=e(96136),p=e(29254),g=e(84208),N=e(63933),L=e(44411),M=e(75526),x=(v,D,h)=>new Promise((te,ne)=>{var re=J=>{try{$(h.next(J))}catch(oe){ne(oe)}},ae=J=>{try{$(h.throw(J))}catch(oe){ne(oe)}},$=J=>J.done?te(J.value):Promise.resolve(J.value).then(re,ae);$((h=h.apply(v,D)).next())});const U=n.memo(v=>{const{imageUrl:D,forceUploadOriginImage:h}=v,te=(0,n.useRef)({width:0,height:0}),[ne,re]=(0,n.useState)(h??!1),[{loading:ae},$]=(0,a.ilX)(()=>x(void 0,null,function*(){if(te.current.width===0||te.current.height===0){(0,a.lHp)((0,a.t)("\u64CD\u4F5C\u8FC7\u4E8E\u9891\u7E41"),"warning");return}typeof v.onConfirm=="function"&&(yield Promise.resolve(v.onConfirm({size:te.current,uploadOriginImage:ne})))}),[v.onConfirm,ne]);(0,N.q)(oe=>{(0,A.rR)(oe)?(oe.stopPropagation(),oe.preventDefault(),$()):(0,A.$)(oe)&&(oe.stopPropagation(),v.onCancel())},{capture:!0});const J=(0,n.useCallback)(oe=>{const Ke=oe.currentTarget;te.current={width:Ke.naturalWidth,height:Ke.naturalHeight}},[]);return n.createElement(g.AB,{style:{maxHeight:"60vh",maxWidth:"60vw"}},n.createElement("div",{className:"flex"},n.createElement("div",{className:"w-2/3 p-2.5 bg-black bg-opacity-20 rounded"},n.createElement("img",{className:"max-h-72 m-auto",src:D,onLoad:J})),n.createElement("div",{className:"w-1/3 p-2 flex flex-col items-end justify-between"},n.createElement("div",{className:"text-right"},n.createElement("div",{className:"text-lg"},(0,a.t)("\u4E0A\u4F20\u56FE\u7247\u5230\u4F1A\u8BDD")),n.createElement("div",{className:"text-sm text-gray-400"},(0,a.t)("\u8BF7\u52FF\u4E0A\u4F20\u8FDD\u53CD\u5F53\u5730\u6CD5\u5F8B\u6CD5\u89C4\u7684\u56FE\u7247"))),n.createElement("div",{className:"w-full"},n.createElement("div",{className:"text-left"},n.createElement(L.Z,{disabled:typeof h!="undefined",checked:ne,onChange:oe=>re(oe)}),n.createElement("span",null,(0,a.t)("\u4E0A\u4F20\u539F\u56FE"))),n.createElement("div",{className:"text-right"},n.createElement(M.Z,{className:"mt-4",type:"primary",loading:ae,onClick:$},(0,a.t)("\u786E\u8BA4")))))))});U.displayName="ImageUploadPreviewer";var K=e(74774),Y=e(83996),j=(v,D,h)=>new Promise((te,ne)=>{var re=J=>{try{$(h.next(J))}catch(oe){ne(oe)}},ae=J=>{try{$(h.throw(J))}catch(oe){ne(oe)}},$=J=>J.done?te(J.value):Promise.resolve(J.value).then(re,ae);$((h=h.apply(v,D)).next())});function ie(v){return new Promise(D=>{(0,K.Fy)(v).then(h=>{const te=(0,g.h7)(n.createElement(U,{imageUrl:h,forceUploadOriginImage:(0,Y.w)(v.type)?void 0:!0,onCancel:()=>{(0,g.Mr)(te)},onConfirm:ne=>j(this,null,function*(){let re=v;if(ne.uploadOriginImage===!1){const oe=v.size;re=yield(0,K.hv)(v);const Ke=re.size;console.log(`\u538B\u7F29\u7ED3\u679C: ${Ke/oe*100}%(${oe} -> ${Ke})`)}const J=(yield(0,a.cTq)(re)).url;D({url:J,width:ne.size.width,height:ne.size.height}),(0,g.Mr)(te)})}))})})}function ee(v){return j(this,null,function*(){const D=yield(0,a.cTq)(v);return{name:v.name||D.etag,url:D.url}})}var w=e(14517),y=(v,D,h)=>new Promise((te,ne)=>{var re=J=>{try{$(h.next(J))}catch(oe){ne(oe)}},ae=J=>{try{$(h.throw(J))}catch(oe){ne(oe)}},$=J=>J.done?te(J.value):Promise.resolve(J.value).then(re,ae);$((h=h.apply(v,D)).next())});const I=n.memo(()=>{const[v,D]=(0,n.useState)(!1),h=(0,p.at)();if(h===null)return null;const te=ae=>{const $=ae;$&&ie($).then(({url:J,width:oe,height:Ke})=>{h.sendMsg((0,r.getMessageTextDecorators)().image(J,{width:oe,height:Ke}))})},ne=ae=>{ae&&ee(ae).then(({name:$,url:J})=>{h.sendMsg((0,r.getMessageTextDecorators)().card($,{type:"file",url:J}))})},re={items:[{key:"send-image",label:(0,a.t)("\u53D1\u9001\u56FE\u7247"),onClick:()=>y(void 0,null,function*(){D(!1);const ae=yield(0,K.ZB)({accept:"image/*"});ae&&te(ae)})},{key:"send-file",label:(0,a.t)("\u53D1\u9001\u6587\u4EF6"),onClick:()=>y(void 0,null,function*(){D(!1);const ae=yield(0,K.ZB)();ae&&ne(ae)})},...r.pluginChatInputActions.map((ae,$)=>({key:ae.label+$,label:ae.label,onClick:()=>{ae.onClick(h),D(!1)}}))]};return n.createElement(G.Z,{menu:re,open:v,onOpenChange:D,placement:"topRight",trigger:["click"]},n.createElement("div",null,n.createElement(F.JO,{className:(0,w.Z)("text-2xl cursor-pointer transition transform",{"rotate-45":v}),icon:"mdi:plus-circle-outline"})))});I.displayName="ChatInputAddon";class d{constructor(D){this.data=D.clipboardData}hasImage(){const D=this.isPasteImage(this.data.items);if(D===!1)return!1;const h=D.getAsFile();return h===null?!1:h}isPasteImage(D){let h=0,te;for(;h<D.length;){if(te=D[h],te.type.indexOf("image")!==-1)return te;h++}return!1}}var O=e(9021),Z=e(22398),z=e(49723);const le=n.memo(v=>n.createElement("div",{className:"flex items-center py-2 px-3"},n.createElement(F.JO,{className:"mr-1 text-lg",icon:v.icon}),n.createElement("div",null,v.label)));le.displayName="MentionCommandItem";const me={input:{overflow:"auto",maxHeight:70},highlighter:{boxSizing:"border-box",overflow:"hidden",maxHeight:70}},de=n.memo(v=>{const{users:D,panels:h,placeholder:te,disabled:ne}=(0,p.TD)();return n.createElement(z.r,{inputRef:v.inputRef,className:"chatbox-mention-input",placeholder:te??(0,a.t)("\u8F93\u5165\u4E00\u4E9B\u4EC0\u4E48"),disabled:ne,style:me,maxLength:1e3,value:v.value,onChange:(re,ae,$,J)=>v.onChange(ae,J.filter(oe=>oe.display.startsWith("@")).map(oe=>oe.id)),onKeyDown:v.onKeyDown,onPaste:v.onPaste,onContextMenu:Z.UW,allowSuggestionsAboveCursor:!0,forceSuggestionsAboveCursor:!0},n.createElement(z.p,{trigger:"@",data:D,displayTransform:(re,ae)=>`@${ae}`,appendSpaceOnAdd:!0,renderSuggestion:re=>n.createElement(O.Q,{userId:String(re.id)}),markup:(0,r.getMessageTextDecorators)().mention("__id__","__display__")}),n.createElement(z.p,{trigger:"#",data:h,displayTransform:(re,ae)=>`#${ae}`,appendSpaceOnAdd:!0,renderSuggestion:re=>{var ae;return n.createElement(le,{icon:"mdi:pound",label:(ae=re.display)!=null?ae:String(re.id)})},markup:(0,r.getMessageTextDecorators)().url("__id__","#__display__")}))});de.displayName="ChatInputBoxInput";var Fe=e(53652),xe=e(28723);const be=n.memo(()=>{const v=(0,p.at)(),{appendMsg:D}=v;return n.createElement(xe.L,{icon:"mdi:emoticon-happy-outline",popoverContent:({hidePopover:h})=>n.createElement(Fe._,{onSelect:te=>{D(te),h()}})})});be.displayName="ChatInputEmotion";var Se=e(90292),Ze=e.n(Se),ze=e(37980),Je=e(22659);const je=n.memo(()=>{const v=(0,p.at)(),D=(0,a.zX9)(ne=>{const re=ne[0];!re||(re.type.startsWith("image/")?ie(re).then(({url:ae,width:$,height:J})=>{v==null||v.sendMsg((0,r.getMessageTextDecorators)().image(ae,{width:$,height:J}))}):ee(re).then(({url:ae,name:$})=>{v==null||v.sendMsg((0,r.getMessageTextDecorators)().card($,{type:"file",url:ae}))}))}),[h,te]=(0,ze.L)({accept:[Je.FILE],drop(ne){D(ne.files)},canDrop(ne){return!0},collect:ne=>({isOver:ne.isOver(),canDrop:ne.canDrop()})});return h.canDrop?n.createElement("div",{ref:te,className:"absolute inset-0 bg-white bg-opacity-50 dark:bg-black dark:bg-opacity-50 p-4"},n.createElement("div",{className:"h-full w-full border-dashed border-8 flex flex-col justify-center items-center"},n.createElement("div",null,n.createElement(F.JO,{icon:"mdi:cloud-upload",fontSize:128})),n.createElement("div",{className:"text-xl font-bold"},(0,a.t)("\u62D6\u653E\u6587\u4EF6\u4EE5\u53D1\u9001\u5230\u5F53\u524D\u4F1A\u8BDD")))):null});je.displayName="ChatDropArea";var He=(v,D,h)=>new Promise((te,ne)=>{var re=J=>{try{$(h.next(J))}catch(oe){ne(oe)}},ae=J=>{try{$(h.throw(J))}catch(oe){ne(oe)}},$=J=>J.done?te(J.value):Promise.resolve(J.value).then(re,ae);$((h=h.apply(v,D)).next())});const $e=n.memo(v=>{const D=(0,n.useRef)(null),[h,te]=(0,n.useState)(""),[ne,re]=(0,n.useState)([]),{disabled:ae}=(0,p.TD)(),$=(0,a.zX9)(()=>He(void 0,null,function*(){var Ae;yield v.onSendMsg(h,{mentions:Ze()(ne)}),te(""),(Ae=D.current)==null||Ae.focus()})),J=(0,a.zX9)(Ae=>{var Pe;te(h+Ae),(Pe=D.current)==null||Pe.focus()}),oe=(0,a.zX9)(Ae=>{(0,A.rR)(Ae.nativeEvent)&&(Ae.preventDefault(),$())}),Ke=(0,a.zX9)(Ae=>{const We=new d(Ae).hasImage();We&&(Ae.preventDefault(),ie(We).then(({url:et,width:tt,height:nt})=>{v.onSendMsg((0,r.getMessageTextDecorators)().image(et,{width:tt,height:nt}))}))});return(0,a.JtK)("replyMessage",Ae=>He(void 0,null,function*(){if(D.current&&(D.current.focus(),Ae&&(0,a.YQu)(Ae==null?void 0:Ae.author))){const Pe=yield(0,a.pGV)(Ae.author);te(`${(0,r.getMessageTextDecorators)().mention(Ae.author,Pe.nickname)} ${h}`)}})),n.createElement(p.zB.Provider,{value:{message:h,setMessage:te,sendMsg:v.onSendMsg,appendMsg:J}},n.createElement("div",{className:"px-4 py-2"},n.createElement("div",{className:"bg-white dark:bg-gray-600 flex rounded-md items-center"},n.createElement("div",{className:"flex-1 w-0"},n.createElement(de,{inputRef:D,value:h,onChange:(Ae,Pe)=>{te(Ae),re(Pe)},onKeyDown:oe,onPaste:Ke})),!ae&&n.createElement(n.Fragment,null,n.createElement("div",{className:"px-2 flex space-x-1"},r.pluginChatInputButtons.map((Ae,Pe)=>n.cloneElement(Ae.render(),{key:`plugin-chatinput-btn#${Pe}`})),n.createElement(be,null),h?n.createElement(F.JO,{icon:"mdi:send-circle-outline",className:"text-2xl cursor-pointer",onClick:()=>$()}):n.createElement(I,null)),n.createElement(je,null)))))});$e.displayName="ChatInputBox";var Xe=e(38887),Qe=e(81244),Ye=e(75209),se=e(6342),_=e(79861),ue=Math.pow;const Oe=ue(10,7),Ue={height:"100%"},Re={main:1e3,reverse:1e3},we=n.memo(v=>{const D=(0,n.useRef)(null),h=(0,n.useRef)(),te=ke(v.messages),ne=(0,a.nWw)(()=>{var Pe,We;(We=D.current)==null||We.scrollTo({top:(Pe=h.current)==null?void 0:Pe.scrollHeight,behavior:"smooth"})});(0,a.JtK)("sendMessage",ne);const re=(0,a.nWw)(()=>{v.isLoadingMore||v.hasMoreMessage&&v.onLoadMore()}),ae=(0,a.nWw)(Pe=>(Pe&&setTimeout(()=>{var We;(We=D.current)==null||We.autoscrollToBottom()},20),Pe?"smooth":!1)),$=(0,a.nWw)((Pe,We)=>We?We._id:Pe),J=(0,a.nWw)(Pe=>{const We=Pe+te-Oe;return(0,Ye.d)(v.messages,We)}),[oe,Ke]=(0,n.useState)(!1),Ae=(0,a.nWw)(Pe=>{Ke(!Pe)});return n.createElement("div",{className:"flex-1"},n.createElement(se.OO,{style:Ue,ref:D,scrollerRef:Pe=>h.current=Pe,firstItemIndex:Oe-te,initialTopMostItemIndex:Math.max(v.messages.length-1,0),computeItemKey:$,totalCount:v.messages.length,overscan:Re,itemContent:J,alignToBottom:!0,startReached:re,atBottomStateChange:Ae,followOutput:ae,defaultItemHeight:25,atTopThreshold:100,atBottomThreshold:40,useWindowScroll:!1}),oe&&n.createElement(_.a,{onClick:ne}))});we.displayName="VirtualizedMessageList";function ke(v){var D;const h=(D=v==null?void 0:v[0])==null?void 0:D._id,te=(0,n.useRef)(h),ne=(0,n.useRef)(h),re=(0,n.useRef)(0);return(0,n.useMemo)(()=>{if(!v||!v.length)return 0;if(h===ne.current)return re.current;te.current||(te.current=h),ne.current=h;for(let $=re.current;$<v.length;$+=1)if(v[$]._id===te.current)return re.current=$,$;return 0},[v,v==null?void 0:v.length])}var R=Object.defineProperty,q=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,H=(v,D,h)=>D in v?R(v,D,{enumerable:!0,configurable:!0,writable:!0,value:h}):v[D]=h,fe=(v,D)=>{for(var h in D||(D={}))k.call(D,h)&&H(v,h,D[h]);if(q)for(var h of q(D))V.call(D,h)&&H(v,h,D[h]);return v};const pe=n.memo(v=>{const{value:D,loading:h}=(0,a.cvI)("messageListVirtualization",!1);return h?n.createElement("div",{className:"flex-1"},n.createElement(Xe.T,null)):D?n.createElement(we,fe({},v)):n.createElement(Qe.X,fe({},v))});pe.displayName="ChatMessageList";var Be=e(14698),Ne=e.n(Be),Le=e(66559);const Ge=n.memo(()=>{const{replyMsg:v,setReplyMsg:D,clearReplyMsg:h}=(0,a.xMc)();return(0,a.JtK)("replyMessage",te=>{D(te)}),Ne()(v)?null:n.createElement("div",{className:"relative"},n.createElement("div",{className:"absolute bottom-0 left-0 right-0 py-1 px-4"},n.createElement("div",{className:"rounded bg-white dark:bg-gray-800 p-2 max-h-44 overflow-auto shadow-sm relative"},n.createElement("span",{className:"align-top"},(0,a.t)("\u56DE\u590D")," ",v.author&&n.createElement(Le.v,{userId:v.author}),":"," "),n.createElement("span",null,(0,r.getMessageRender)(v.content)),n.createElement(F.JO,{className:"absolute right-1 top-0.5 text-lg cursor-pointer opacity-60 hover:opacity-80",icon:"mdi:close-circle-outline",onClick:h}))))});Ge.displayName="ChatReply";const ve=/:([a-zA-Z0-9_\-\+]+):/g;function P(v){return v=String(v).trim(),v=v.replace(ve,D=>(0,r.getMessageTextDecorators)().emoji(D)),v}var b=Object.defineProperty,S=Object.getOwnPropertySymbols,ce=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,he=(v,D,h)=>D in v?b(v,D,{enumerable:!0,configurable:!0,writable:!0,value:h}):v[D]=h,Ie=(v,D)=>{for(var h in D||(D={}))ce.call(D,h)&&he(v,h,D[h]);if(S)for(var h of S(D))X.call(D,h)&&he(v,h,D[h]);return v},Ee=(v,D,h)=>new Promise((te,ne)=>{var re=J=>{try{$(h.next(J))}catch(oe){ne(oe)}},ae=J=>{try{$(h.throw(J))}catch(oe){ne(oe)}},$=J=>J.done?te(J.value):Promise.resolve(J.value).then(re,ae);$((h=h.apply(v,D)).next())});const ge=n.memo(v=>{const{converseId:D,converseTitle:h}=v,{messages:te,loading:ne,error:re,isLoadingMore:ae,hasMoreMessage:$,fetchMoreMessage:J,sendMessage:oe}=(0,a.FNv)();return ne?n.createElement(l,null):re?n.createElement(s.o,{error:re}):n.createElement("div",{className:"w-full h-full flex flex-col select-text relative text-sm"},n.createElement(pe,{key:D,title:h,messages:te,isLoadingMore:ae,hasMoreMessage:$,onLoadMore:J}),n.createElement(Ge,null),n.createElement($e,{onSendMsg:(Ke,Ae)=>Ee(void 0,null,function*(){const Pe=P(Ke);yield oe({converseId:v.converseId,groupId:v.groupId,content:Pe,plain:(0,r.getMessageTextDecorators)().serialize(Pe),meta:Ae})})}))});ge.displayName="ChatBoxInner";const Te=n.memo(v=>n.createElement(a.gvw,null,n.createElement(a.$Ib,{converseId:v.converseId,isGroup:v.isGroup},n.createElement(ge,Ie({},v)))));Te.displayName="ChatBox"},10114:(Me,Q,e)=>{e.d(Q,{L:()=>n});var r=e(52983);const n=r.memo(a=>r.createElement("div",{className:"h-full flex flex-col","data-tc-role":a["data-tc-role"]},a.children));n.displayName="CommonSidebarWrapper"},73513:(Me,Q,e)=>{e.d(Q,{o:()=>l});var r=e(52983),n=e(45563),a=e.n(n),s=e(93540),t=e(14517);const l=r.memo(A=>{const{visible:F=!0,onChangeVisible:G}=A,p=(0,r.useRef)(null),g=(0,r.useCallback)(()=>{a()(G)&&G(!1)},[G]);return(0,r.useEffect)(()=>{const N=L=>{L.code==="Escape"&&g()};return window.addEventListener("keyup",N),()=>{window.removeEventListener("keyup",N)}},[g]),r.createElement("div",{className:(0,t.Z)("fixed left-0 right-0 top-0 bottom-0 z-10 bg-content-light dark:bg-content-dark flex justify-center items-center",{"opacity-0":!F}),ref:p},A.children,a()(G)&&r.createElement("div",{className:"absolute right-8 top-8 cursor-pointer flex flex-col",onClick:g,"data-testid":"full-modal-close"},r.createElement(s.JO,{className:"text-2xl border-2 rounded-1/2 border-gray-900 dark:border-gray-100",icon:"mdi:close"}),r.createElement("span",{className:"text-center mt-0.5 font-bold"},"ESC")))});l.displayName="FullModal"},19856:(Me,Q,e)=>{e.d(Q,{D:()=>t});var r=e(95268),n=e(75217),a=e(52983),s=e(30831);const t=a.memo(l=>{const{invite:A}=l;return A.expiredAt&&new Date(A.expiredAt).valueOf()<Date.now()?a.createElement("span",null,(0,s.t)("\u8BE5\u9080\u8BF7\u7801\u5DF2\u8FC7\u671F")):a.createElement(a.Fragment,null,A.expiredAt?a.createElement(s.cCv,null,"\u8BE5\u9080\u8BF7\u5C06\u4E8E"," ",a.createElement(r.Z,{title:(0,s.KJm)(A.expiredAt)},a.createElement("span",{className:"font-bold"},{date:(0,s.u39)(A.expiredAt)}))," ","\u8FC7\u671F"):a.createElement("span",null,(0,s.t)("\u8BE5\u9080\u8BF7\u7801\u6C38\u4E0D\u8FC7\u671F")),A.usageLimit&&a.createElement(a.Fragment,null,a.createElement(n.Z,{type:"vertical"}),a.createElement(s.cCv,null,"\u53EF\u4F7F\u7528"," ",a.createElement("span",{className:"font-bold"},{num:A.usageLimit})," ","\u6B21")))});t.displayName="InviteCodeExpiredAt"},9021:(Me,Q,e)=>{e.d(Q,{Q:()=>p});var r=e(52983),n=e(93540),a=e(29787),s=e.n(a),t=e(55696),l=e(20685),A=e(58761),F=e(30831),G=e(66559);const p=r.memo(g=>{const{actions:N=[],hideDiscriminator:L=!1}=g,M=(0,F.xzJ)(g.userId),[x]=(0,F.aoI)([g.userId]),U=M.nickname;return r.createElement("div",{className:"flex items-center h-14 px-2.5 rounded group bg-black bg-opacity-0 hover:bg-opacity-20 dark:bg-white dark:bg-opacity-0 dark:hover:bg-opacity-20"},r.createElement(t.Z,{loading:s()(M),avatar:!0,title:!1,active:!0},r.createElement("div",{className:"mr-2"},g.popover?r.createElement(l.Z,{content:g.popover,placement:"left",trigger:"click"},r.createElement(n.qE,{className:"cursor-pointer",src:M.avatar,name:U,isOnline:x})):r.createElement(n.qE,{src:M.avatar,name:U,isOnline:x})),r.createElement("div",{className:"flex-1 text-gray-900 dark:text-white"},r.createElement(G.v,{userId:g.userId,showDiscriminator:!L})),r.createElement(A.Z,null,N)))});p.displayName="UserListItem"},2945:(Me,Q,e)=>{e.d(Q,{B:()=>s});var r=e(52983),n=e(30831),a=e(38643);const s=r.memo(t=>{const{withoutUserIds:l=[],selectedIds:A,onChange:F}=t,G=(0,n.CGy)(p=>p.user.friends.map(g=>g.id).filter(g=>!l.includes(g)));return r.createElement(a.f,{selectedIds:A,onChange:F,allUserIds:G})});s.displayName="FriendPicker"},38643:(Me,Q,e)=>{e.d(Q,{f:()=>g});var r=e(79546),n=e(66990),a=e(52983),s=e(30831),t=e(89022),l=e.n(t),A=e(92238),F=e.n(A),G=e(93540),p=e(64939);const g=a.memo(N=>{const{withSearch:L=!0,selectedIds:M,onChange:x,allUserIds:U}=N,[K,Y]=(0,a.useState)(""),j=(0,s.FDf)(U),ie=(0,a.useCallback)((w,y)=>{if(y===!0){if(M.includes(w))return;typeof x=="function"&&x([...M,w])}else typeof x=="function"&&x(F()(M,w))},[M,x]),ee=l()(j.filter(w=>w.nickname.includes(K)),10);return a.createElement("div",null,L&&a.createElement(r.Z,{placeholder:(0,s.t)("\u641C\u7D22\u7528\u6237"),className:"mb-2",value:K,onChange:w=>Y(w.target.value)}),a.createElement("div",null,(0,s.t)("\u5DF2\u9009\u62E9 {{num}} \u9879",{num:M.length})),ee.length>0?ee.map(w=>a.createElement("div",{key:w._id,className:"my-1"},a.createElement(n.Z,{className:"mr-2 items-center",checked:M.includes(w._id),onChange:y=>ie(w._id,y.target.checked)},a.createElement("div",{className:"flex items-center w-full"},a.createElement(G.qE,{size:"small",name:w.nickname,src:w.avatar}),a.createElement("div",{className:"ml-1 text-typography-light dark:text-typography-dark"},w.nickname))))):a.createElement(p.T,null))});g.displayName="UserPicker"},50093:(Me,Q,e)=>{e.d(Q,{m:()=>F});var r=e(75526),n=e(52983),a=e(54782),s=e(30831),t=e(2945),l=e(84208),A=(G,p,g)=>new Promise((N,L)=>{var M=K=>{try{U(g.next(K))}catch(Y){L(Y)}},x=K=>{try{U(g.throw(K))}catch(Y){L(Y)}},U=K=>K.done?N(K.value):Promise.resolve(K.value).then(M,x);U((g=g.apply(G,p)).next())});const F=n.memo(G=>{const{hiddenUserIds:p=[]}=G,[g,N]=(0,n.useState)([]),L=(0,a.useNavigate)(),[{loading:M},x]=(0,s.CoE)(()=>A(void 0,null,function*(){const U=yield(0,s.L1i)([...p,...g]);(0,l.Mr)(),L(`/main/personal/converse/${U._id}`)}),[g]);return n.createElement(l.AB,{title:(0,s.t)("\u521B\u5EFA\u591A\u4EBA\u4F1A\u8BDD")},n.createElement(t.B,{withoutUserIds:p,selectedIds:g,onChange:N}),n.createElement("div",{className:"text-right"},n.createElement(r.Z,{type:"primary",loading:M,onClick:x},(0,s.t)("\u521B\u5EFA"))))});F.displayName="CreateDMConverse"},40318:(Me,Q,e)=>{e.d(Q,{P:()=>I});var r=e(93540),n=e(52983),a=e(30831),s=e(84208),t=e(19856),l=e(72297),A=e(75283),F=e(75526),G=e(96136),p=e(25355);const g={createInviteBtn:"src-components-modals-CreateGroupInvite-CreateInviteCode-module__createInviteBtn--9soUP"};var N=Object.defineProperty,L=Object.defineProperties,M=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,Y=(d,O,Z)=>O in d?N(d,O,{enumerable:!0,configurable:!0,writable:!0,value:Z}):d[O]=Z,j=(d,O)=>{for(var Z in O||(O={}))U.call(O,Z)&&Y(d,Z,O[Z]);if(x)for(var Z of x(O))K.call(O,Z)&&Y(d,Z,O[Z]);return d},ie=(d,O)=>L(d,M(O)),ee=(d,O,Z)=>new Promise((z,le)=>{var me=xe=>{try{Fe(Z.next(xe))}catch(be){le(be)}},de=xe=>{try{Fe(Z.throw(xe))}catch(be){le(be)}},Fe=xe=>xe.done?z(xe.value):Promise.resolve(xe.value).then(me,de);Fe((Z=Z.apply(d,O)).next())}),w=(d=>(d.Normal="normal",d.Permanent="permanent",d))(w||{});const y=n.memo(({groupId:d,onInviteCreated:O,onInviteUpdated:Z})=>{const[z,le]=(0,n.useState)(null),[{loading:me},de]=(0,a.CoE)(Ze=>ee(void 0,null,function*(){const ze=yield(0,a.fiB)(d,Ze);le(ze),O==null||O()}),[d,O]),[Fe,xe]=(0,a.WHr)(d,[a.g3S.core.invite,a.g3S.core.unlimitedInvite]),be=(0,a.zX9)(()=>{if(!z)return;const Ze=(0,s.h7)(n.createElement(p.s,{groupId:d,code:z.code,onEditSuccess:({expiredAt:ze,usageLimit:Je})=>{(0,a.lHp)((0,a.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),le(je=>ie(j({},je),{expiredAt:ze?new Date(ze).toISOString():void 0,usageLimit:Je})),(0,s.Mr)(Ze),Z==null||Z()}}))}),Se={items:[{key:"persist",label:(0,a.t)("\u521B\u5EFA\u6C38\u4E45\u9080\u8BF7\u7801"),disabled:!xe,onClick:()=>de("permanent")}]};return n.createElement("div",null,z?n.createElement("div",null,n.createElement(A.Z.Title,{className:"bg-white bg-opacity-30 dark:bg-black dark:bg-opacity-30 px-2 py-1 select-text text-lg rounded border border-black border-opacity-20",level:4,copyable:!0},(0,l.po)(z.code)),n.createElement("p",{className:"text-gray-500 text-sm"},n.createElement(t.D,{invite:z}),n.createElement(F.Z,{type:"link",size:"small",onClick:be},(0,a.t)("\u7F16\u8F91")))):n.createElement(G.Z.Button,{className:g.createInviteBtn,size:"large",type:"primary",disabled:!Fe,loading:me,onClick:()=>de("normal"),menu:Se,trigger:["click"]},(0,a.t)("\u521B\u5EFA\u94FE\u63A5")))});y.displayName="CreateInviteCode";const I=n.memo(d=>{const O=d.groupId;return(0,a.iFL)(O)?n.createElement(s.AB,null,n.createElement(r.JO,{className:"text-6xl block m-auto opacity-30 mb-4 mt-2",icon:"mdi:email-edit-outline"}),n.createElement("div",{className:"text-gray-400 font-bold text-lg mb-2"},(0,a.t)("\u521B\u5EFA\u94FE\u63A5\u5E76\u53D1\u9001\u7ED9\u5916\u90E8\u597D\u53CB")),n.createElement(y,{groupId:O,onInviteCreated:d.onInviteCreated,onInviteUpdated:d.onInviteUpdated})):n.createElement("div",null,(0,a.t)("\u5F02\u5E38"))});I.displayName="GroupInvite"},25355:(Me,Q,e)=>{e.d(Q,{s:()=>A});var r=e(93540),n=e(52983),a=e(30831),s=e(84208),t=(F,G,p)=>new Promise((g,N)=>{var L=U=>{try{x(p.next(U))}catch(K){N(K)}},M=U=>{try{x(p.throw(U))}catch(K){N(K)}},x=U=>U.done?g(U.value):Promise.resolve(U.value).then(L,M);x((p=p.apply(F,G)).next())});const l=[{type:"select",name:"expiredAt",label:(0,a.t)("\u8FC7\u671F\u65F6\u95F4"),defaultValue:-1,options:[{label:(0,a.t)("30\u5206\u949F"),value:30*60},{label:(0,a.t)("1\u5C0F\u65F6"),value:60*60},{label:(0,a.t)("6\u5C0F\u65F6"),value:6*60*60},{label:(0,a.t)("12\u5C0F\u65F6"),value:12*60*60},{label:(0,a.t)("1\u5929"),value:24*60*60},{label:(0,a.t)("7\u5929"),value:7*24*60*60},{label:(0,a.t)("\u6C38\u4E0D"),value:-1}]},{type:"select",name:"usageLimit",label:(0,a.t)("\u6700\u5927\u4F7F\u7528\u6B21\u6570"),defaultValue:-1,options:[{label:(0,a.t)("\u65E0\u9650\u5236"),value:-1},{label:(0,a.t)("1\u6B21\u4F7F\u7528"),value:1},{label:(0,a.t)("5\u6B21\u4F7F\u7528"),value:5},{label:(0,a.t)("10\u6B21\u4F7F\u7528"),value:10},{label:(0,a.t)("25\u6B21\u4F7F\u7528"),value:25},{label:(0,a.t)("50\u6B21\u4F7F\u7528"),value:50},{label:(0,a.t)("100\u6B21\u4F7F\u7528"),value:100}]}],A=n.memo(F=>{const G=(0,a.zX9)(p=>t(void 0,null,function*(){const g=p.expiredAt===-1?void 0:Date.now()+p.expiredAt*1e3,N=p.usageLimit===-1?void 0:p.usageLimit;yield a.o4J.ru.editGroupInvite(F.groupId,F.code,g,N),F.onEditSuccess({expiredAt:g,usageLimit:N})}));return n.createElement(s.AB,{title:(0,a.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5")},n.createElement(r.Po,{fields:l,onSubmit:G}))});A.displayName="EditGroupInvite"},39979:(Me,Q,e)=>{e.d(Q,{a:()=>pt});var r=e(73513),n=e(3856),a=e(50842),s=e(7975),t=e(52983),l=e(30831),A=e(95268),F=e(58761),G=e(75526),p=e(69104),g=e(66559),N=e(84208),L=e(40318),M=e(36932),x=e(84143),U=e(86724),K=e.n(U),Y=e(72297),j=e(93540),ie=e(25355),ee=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const w=t.memo(o=>{const c=o.groupId,{loading:u,value:C,refresh:f}=(0,l.IxN)(()=>ee(void 0,null,function*(){return(yield(0,l.TcU)(c)).reverse()}),[c]),T=(0,l.zX9)(()=>{(0,N.h7)(t.createElement(L.P,{groupId:c,onInviteCreated:()=>{f()},onInviteUpdated:()=>{f()}}))}),B=(0,l.zX9)(W=>{const Ce=(0,N.h7)(t.createElement(ie.s,{groupId:c,code:W,onEditSuccess:()=>{(0,l.lHp)((0,l.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),(0,N.Mr)(Ce),f()}}))}),m=(0,l.zX9)(W=>{K()((0,Y.po)(W)),(0,l.lHp)((0,l.t)("\u9080\u8BF7\u94FE\u63A5\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"),"success")}),i=(0,l.zX9)(W=>ee(void 0,null,function*(){(yield(0,N.aW)())&&(yield(0,l.L4o)(c,W),yield f())})),E=(0,t.useMemo)(()=>[{title:(0,l.t)("\u9080\u8BF7\u7801"),dataIndex:"code",width:200,render:W=>t.createElement(j.PJ,{text:W})},{title:(0,l.t)("\u521B\u5EFA\u65F6\u95F4"),dataIndex:"createdAt",render:W=>t.createElement(A.Z,{title:(0,l.KJm)(W)},(0,l.u39)(W))},{title:(0,l.t)("\u8FC7\u671F\u65F6\u95F4"),dataIndex:"expiredAt",render:W=>W?new Date(W).valueOf()<Date.now()?(0,l.t)("\u5DF2\u8FC7\u671F"):t.createElement(A.Z,{title:(0,l.KJm)(W)},(0,l.u39)(W)):(0,l.t)("\u6C38\u4E0D\u8FC7\u671F")},{title:(0,l.t)("\u4F7F\u7528\u6B21\u6570"),dataIndex:"usage",render:(W,Ce)=>t.createElement("div",null,W,Ce.usageLimit&&` / ${Ce.usageLimit}`)},{title:(0,l.t)("\u521B\u5EFA\u8005"),dataIndex:"creator",render:W=>t.createElement(g.v,{userId:W})},{title:(0,l.t)("\u64CD\u4F5C"),dataIndex:"_id",render:(W,Ce)=>t.createElement(F.Z,null,t.createElement(x.a,{title:(0,l.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:edit",onClick:()=>B(Ce.code)}),t.createElement(x.a,{title:(0,l.t)("\u590D\u5236\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:content-copy",onClick:()=>m(Ce.code)}),t.createElement(x.a,{title:(0,l.t)("\u5220\u9664"),shape:"square",icon:"mdi:delete-outline",danger:!0,onClick:()=>i(W)}))}],[m,i]);return t.createElement(M.t,{spinning:u},t.createElement("div",{className:"text-right mb-2"},t.createElement(G.Z,{type:"primary",onClick:T},(0,l.t)("\u521B\u5EFA\u9080\u8BF7\u7801"))),t.createElement(p.Z,{columns:E,dataSource:C,pagination:{hideOnSinglePage:!0}}))});w.displayName="GroupInvite";var y=e(85466),I=e.n(y),d=e(45513),O=e(14698),Z=e.n(O),z=e(77179),le=e.n(z);function me(o){return o.filter(c=>Z()(c.parentId)).map(c=>({key:c.id,title:c.name,isLeaf:c.type!==l.Xpe.GROUP,children:c.type===l.Xpe.GROUP?o.filter(u=>u.parentId===c.id).map(u=>({key:u.id,title:u.name,isLeaf:!0})):void 0}))}function de(o){const c=le()(o),u=c.filter(f=>Z()(f.parentId)),C=u.length;for(let f=C-1;f>=0;f--){const T=u[f].id;u.splice(f+1,0,...c.filter(B=>B.parentId===T))}return u}function Fe(o,c){const u=(0,t.useRef)(null),C=(0,t.useCallback)(m=>{u.current=m.node},[]),f=(0,t.useCallback)(()=>{u.current=null},[]),T=(0,t.useCallback)(({dropNode:m,dropPosition:i})=>{var E;return((E=u.current)==null?void 0:E.isLeaf)===!0?i===0?!m.isLeaf:!0:i===0?!1:!m.isLeaf},[]),B=(0,t.useCallback)(m=>{var i;const E=le()(o),W=E.findIndex(ye=>ye.id===m.node.key),Ce=E[W];W===-1&&(0,l.lHp)("\u5F02\u5E38, \u76EE\u6807\u8282\u70B9\u672A\u627E\u5230","error");const qe=E.findIndex(ye=>ye.id===m.dragNode.key);((i=u.current)==null?void 0:i.isLeaf)===!0&&(m.node.isLeaf===!0?m.dragNodesKeys.map(ye=>E.findIndex(_e=>_e.id===ye)).filter(ye=>ye!==-1).forEach(ye=>{E[ye].parentId=Ce.parentId}):m.dropToGap===!1&&m.node.isLeaf===!1?m.dragNodesKeys.map(ye=>E.findIndex(_e=>_e.id===ye)).filter(ye=>ye!==-1).forEach(ye=>{E[ye].parentId=Ce.id}):m.dropToGap===!0&&m.node.isLeaf===!1&&m.dragNodesKeys.map(ye=>E.findIndex(_e=>_e.id===ye)).filter(ye=>ye!==-1).forEach(ye=>{E[ye].parentId=void 0}));const Ve=qe;let De;if(m.node.dragOverGapTop===!0?De=W:De=W+1,Ve<De)E.splice(De,0,E[Ve]),E.splice(Ve,1);else if(Ve>De){const[ye]=E.splice(Ve,1);E.splice(De,0,ye)}if(typeof c=="function"){const ye=de(E);c(ye)}},[o,c]);return{handleDragStart:C,handleDragEnd:f,handleAllowDrop:T,handleDrop:B}}var xe=e(38887),be=e(89889),Se=Object.defineProperty,Ze=Object.defineProperties,ze=Object.getOwnPropertyDescriptors,Je=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,$e=(o,c,u)=>c in o?Se(o,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[c]=u,Xe=(o,c)=>{for(var u in c||(c={}))je.call(c,u)&&$e(o,u,c[u]);if(Je)for(var u of Je(c))He.call(c,u)&&$e(o,u,c[u]);return o},Qe=(o,c)=>Ze(o,ze(c)),Ye=(o,c)=>{var u={};for(var C in o)je.call(o,C)&&c.indexOf(C)<0&&(u[C]=o[C]);if(o!=null&&Je)for(var C of Je(o))c.indexOf(C)<0&&He.call(o,C)&&(u[C]=o[C]);return u};function se(o){const c=o,{name:u,type:C}=c,f=Ye(c,["name","type"]);let T,B,m;if(typeof C=="string"){const i=C;T=l.Xpe.PLUGIN;const E=(0,be.S)(i);E&&(B=E.provider,m=E.name)}else T=C;return{name:u,type:T,provider:B,pluginPanelName:m,meta:f}}function _(o){return Qe(Xe({},o.meta),{name:o.name,type:o.type===l.Xpe.PLUGIN?String(o.pluginPanelName):o.type})}var ue=e(73246);const Oe=t.memo(o=>{const{allUserIds:c,userIds:u,onChange:C}=o,f=(0,l.FDf)(c),T=(0,t.useCallback)(B=>{typeof C=="function"&&C(B)},[C]);return t.createElement(ue.Z,{mode:"multiple",allowClear:!0,placeholder:(0,l.t)("\u8BF7\u9009\u62E9\u7528\u6237"),value:u,onChange:T},f.map(B=>t.createElement(ue.Z.Option,{key:B._id,value:B._id},B.nickname)))});Oe.displayName="UserSelector";var Ue=e(6494),Re=e.n(Ue),we=e(39907),ke=e.n(we),R=e(61230),q=e.n(R),k=Object.defineProperty,V=Object.defineProperties,H=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,Ne=(o,c,u)=>c in o?k(o,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[c]=u,Le=(o,c)=>{for(var u in c||(c={}))pe.call(c,u)&&Ne(o,u,c[u]);if(fe)for(var u of fe(c))Be.call(c,u)&&Ne(o,u,c[u]);return o},Ge=(o,c)=>V(o,H(c));const ve=[{type:"text",name:"name",label:(0,l.t)("\u9762\u677F\u540D")},{type:"select",name:"type",label:(0,l.t)("\u7C7B\u578B"),options:[{label:(0,l.t)("\u804A\u5929\u9891\u9053"),value:l.Xpe.TEXT},{label:(0,l.t)("\u9762\u677F\u5206\u7EC4"),value:l.Xpe.GROUP},...s.pluginGroupPanel.map(o=>({label:o.label,value:o.name}))]}],P={name:j._6.string().required((0,l.t)("\u9762\u677F\u540D\u4E0D\u80FD\u4E3A\u7A7A")).max(20,(0,l.t)("\u9762\u677F\u540D\u8FC7\u957F")),type:j._6.string().required((0,l.t)("\u9762\u677F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A"))};function b(o,c){const u=(0,t.useMemo)(()=>{const f=()=>{const T=(0,l.aaJ)(o),B=(0,j.tF)();return t.createElement(Oe,{allUserIds:T,onChange:m=>{B==null||B.setValues(Ge(Le({},B.values),{disableSendMessageWithout:m}))}})};return f.displayName="DisableSendMessageWithoutComponent",f},[o]);return(0,t.useMemo)(()=>{if(l.yGS&&c.type===l.Xpe.TEXT)return{fields:Re()([...ve,{type:"checkbox",name:"disableSendMessage",label:(0,l.t)("\u7981\u6B62\u6240\u6709\u4EBA\u53D1\u8A00")},c.disableSendMessage===!0&&{type:"custom",name:"disableSendMessageWithout",label:(0,l.t)("\u4EC5\u5141\u8BB8\u6307\u5B9A\u7528\u6237\u53D1\u8A00"),render:u}]),schema:(0,j._D)(Ge(Le({},P),{disableSendMessage:j._6.mixed(),disableSendMessageWithout:j._6.mixed()}))};let f=ve,T=P;if(typeof c.type=="string"){const B=(0,be.S)(c.type);if(B){const m=Array.isArray(B.extraFormMeta)?B.extraFormMeta:[];f=[...ve,...m];const i=q()(ke()(m,E=>E.name),()=>j._6.mixed());T=Le(Le({},i),P)}}return{fields:f,schema:(0,j._D)(T)}},[c])}var S=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const ce=t.memo(o=>{const c=(0,l.wY6)(o.groupId,o.groupPanelId),[u,C]=(0,t.useState)({}),[,f]=(0,l.CoE)(m=>S(void 0,null,function*(){yield(0,l.d89)(o.groupId,o.groupPanelId,se(m)),(0,l.lHp)((0,l.t)("\u4FEE\u6539\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.groupPanelId,o.onSuccess]),{fields:T,schema:B}=b(o.groupId,u);return c?t.createElement(N.AB,{title:(0,l.t)("\u7F16\u8F91\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:440}},t.createElement(j.Po,{schema:B,fields:T.filter(m=>m.type!=="type"),initialValues:_(c),onChange:C,onSubmit:f})):t.createElement(xe.T,null)});ce.displayName="ModalModifyGroupPanel";var X=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const he=t.memo(o=>{const c=(0,t.useMemo)(()=>me(o.groupPanels),[o.groupPanels]),u=(0,t.useCallback)(E=>{const W=(0,N.h7)(t.createElement(ce,{groupId:o.groupId,groupPanelId:E,onSuccess:()=>(0,N.Mr)(W)}))},[o.groupId]),C=(0,t.useCallback)((E,W,Ce)=>{(0,l.wp$)({message:Ce?(0,l.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F\u7EC4 \u3010{{name}}\u3011 \u4EE5\u53CA\u4E0B\u7EA7\u7684\u6240\u6709\u9762\u677F\u4E48",{name:W}):(0,l.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F \u3010{{name}}\u3011 \u4E48",{name:W}),onConfirm:()=>X(void 0,null,function*(){yield(0,l.J9q)(o.groupId,E)})})},[o.groupId]),f=(0,t.useCallback)(E=>t.createElement("div",{className:"flex group"},t.createElement("span",null,E.title),t.createElement("div",{className:"opacity-0 group-hover:opacity-100 ml-2"},t.createElement(F.Z,{size:"small"},t.createElement(x.a,{title:(0,l.t)("\u7F16\u8F91"),type:"text",size:"small",icon:"mdi:pencil-outline",onClick:W=>{W.stopPropagation(),W.preventDefault(),u(String(E.key))}}),t.createElement(x.a,{title:(0,l.t)("\u5220\u9664"),type:"text",size:"small",icon:"mdi:trash-can-outline",onClick:W=>{W.stopPropagation(),W.preventDefault(),C(String(E.key),String(E.title),!E.isLeaf)}})))),[C]),{handleDragStart:T,handleDragEnd:B,handleAllowDrop:m,handleDrop:i}=Fe(o.groupPanels,o.onChange);return t.createElement(d.Z,{treeData:c,defaultExpandAll:!0,blockNode:!0,draggable:{icon:!1},selectable:!1,titleRender:f,onDrop:i,onDragStart:T,onDragEnd:B,allowDrop:m})});he.displayName="GroupPanelTree";const Ie=t.memo(o=>t.createElement("div",{className:"text-xl font-bold mb-4 flex justify-between"},t.createElement("div",null,o.children),t.createElement("div",null,o.extra)));Ie.displayName="FullModalCommonTitle";var Ee=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const ge=t.memo(o=>{const[c,u]=(0,t.useState)({}),[,C]=(0,l.CoE)(B=>Ee(void 0,null,function*(){yield(0,l.XAi)(o.groupId,se(B)),(0,l.lHp)((0,l.t)("\u521B\u5EFA\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.onSuccess]),{fields:f,schema:T}=b(o.groupId,c);return t.createElement(N.AB,{title:(0,l.t)("\u521B\u5EFA\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:440}},t.createElement(j.Po,{schema:T,fields:f,onChange:u,onSubmit:C}))});ge.displayName="ModalCreateGroupPanel";var Te=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const v=t.memo(o=>{var c;const u=o.groupId,C=(0,l.iFL)(u),f=(c=C==null?void 0:C.panels)!=null?c:[],[T,B]=(0,t.useState)(f),m=(0,t.useRef)(!1);(0,t.useEffect)(()=>{m.current!==!0&&B(f)},[f]);const i=(0,t.useCallback)(Ve=>{m.current=!0,B(Ve)},[]),[{loading:E},W]=(0,l.CoE)(()=>Te(void 0,null,function*(){yield(0,l.uRW)(u,"panels",T),m.current=!1,(0,l.lHp)((0,l.t)("\u4FDD\u5B58\u6210\u529F"),"success")}),[T]),Ce=(0,t.useCallback)(()=>{B(f),m.current=!1},[f]),qe=(0,t.useCallback)(()=>{const Ve=(0,N.h7)(t.createElement(ge,{groupId:u,onSuccess:()=>{(0,N.Mr)(Ve),m.current=!1}}))},[]);return t.createElement("div",null,t.createElement(Ie,{extra:t.createElement(G.Z,{type:"primary",onClick:qe},(0,l.t)("\u521B\u5EFA\u9762\u677F"))},(0,l.t)("\u9762\u677F\u7BA1\u7406")),t.createElement("div",{className:"max-h-80 overflow-auto border rounded border-black border-opacity-20 p-1"},t.createElement(he,{groupId:u,groupPanels:T,onChange:i})),!I()(f,T)&&t.createElement("div",{className:"space-x-1 mt-2"},t.createElement(G.Z,{type:"primary",loading:E,onClick:W},(0,l.t)("\u4FDD\u5B58")),t.createElement(G.Z,{onClick:Ce},(0,l.t)("\u91CD\u7F6E"))))});v.displayName="GroupPanel";var D=e(18300),h=e(83667),te=e(14517);const ne=t.memo(o=>t.createElement("div",{className:(0,te.Z)("px-2 py-1 rounded cursor-pointer mb-1 hover:bg-black hover:bg-opacity-20",{"bg-black bg-opacity-20":o.active}),onClick:o.onClick},o.children));ne.displayName="RoleItem";var re=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});function ae(o,c){const[{loading:u},C]=(0,l.CoE)(()=>re(this,null,function*(){yield l.o4J.ru.createGroupRole(o,(0,l.t)("\u65B0\u8EAB\u4EFD\u7EC4"),(0,l.Q$5)()),(0,l.jiy)()}),[o]),[{loading:f},T]=(0,l.CoE)(W=>re(this,null,function*(){c===l.lin?yield l.o4J.ru.modifyGroupField(o,"fallbackPermissions",W):yield l.o4J.ru.updateGroupRolePermission(o,c,W),(0,l.jiy)()}),[o,c]),[{loading:B},m]=(0,l.CoE)(W=>re(this,null,function*(){if(c===l.lin)throw new Error((0,l.t)("\u65E0\u6CD5\u4FEE\u6539\u6240\u6709\u4EBA\u6743\u9650\u7EC4\u7684\u663E\u793A\u540D\u79F0"));yield l.o4J.ru.updateGroupRoleName(o,c,W),(0,l.jiy)()}),[o,c]),[{loading:i},E]=(0,l.CoE)(()=>re(this,null,function*(){if(c===l.lin)throw new Error((0,l.t)("\u65E0\u6CD5\u5220\u9664\u6240\u6709\u4EBA\u6743\u9650"));yield l.o4J.ru.deleteGroupRole(o,c),(0,l.jiy)()}),[o,c]);return{loading:u||f||B||i,handleCreateRole:C,handleSavePermission:T,handleChangeRoleName:m,handleDeleteRole:E}}var $=e(7606);const J=t.memo(o=>{const{currentRoleInfo:c}=o,u=(0,l.nWw)(()=>{(0,N.VW)({title:(0,l.t)("\u786E\u8BA4\u8981\u5220\u9664\u89D2\u8272 {{name}} \u4E48?",{name:c.name}),onConfirm:()=>o.onDeleteRole()})});return t.createElement("div",{className:"px-2"},t.createElement($.LP,{title:(0,l.t)("\u8EAB\u4EFD\u7EC4\u540D\u79F0"),value:o.currentRoleInfo.name,editable:!0,renderEditor:$.jo,onSave:o.onChangeRoleName}),t.createElement(G.Z,{type:"primary",danger:!0,onClick:u},(0,l.t)("\u5220\u9664\u8EAB\u4EFD\u7EC4")))});J.displayName="RoleSummary";var oe=e(75217),Ke=e(63509),Ae=e(36572),Pe=e(44411);const We=t.memo(o=>t.createElement("div",{className:"mx-2 py-3 border-b border-white border-opacity-20"},t.createElement(Ke.Z,null,t.createElement(Ae.Z,{flex:1,className:"font-bold"},o.title),t.createElement(Ae.Z,null,t.createElement(Pe.Z,{disabled:o.disabled,checked:o.checked,onChange:o.onChange}))),t.createElement("div",{className:"text-gray-400"},o.desc)));We.displayName="PermissionItem";var et=e(90292),tt=e.n(et),nt=e(92238),rt=e.n(nt);function ht(o){const[c,u]=(0,t.useState)([]),C=(0,t.useMemo)(()=>!I()(new Set(o),new Set(c)),[o,c]);(0,t.useEffect)(()=>{u([...o])},[o]);const f=(0,t.useCallback)((T,B)=>{u(B?tt()([...c,T]):rt()(c,T))},[c]);return{isEditing:C,editingPermission:c,setEditingPermission:u,handleSwitchPermission:f}}const ot=t.memo(o=>{const c=(0,t.useMemo)(()=>{var m,i;return o.roleId===l.lin?o.fallbackPermissions:(i=(m=o.currentRoleInfo)==null?void 0:m.permissions)!=null?i:[]},[o.roleId,o.fallbackPermissions,o.currentRoleInfo]),{isEditing:u,editingPermission:C,setEditingPermission:f,handleSwitchPermission:T}=ht(c),B=(0,t.useCallback)(()=>{f((0,l.pZA)().filter(m=>m.default===!0).map(m=>m.key))},[]);return t.createElement("div",null,t.createElement("div",{className:"mb-2 space-x-2 text-right"},t.createElement(G.Z,{onClick:B},(0,l.t)("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C")),t.createElement(G.Z,{type:"primary",disabled:!u,onClick:()=>o.onSavePermission(C)},(0,l.t)("\u4FDD\u5B58"))),(0,l.pZA)().map(m=>t.createElement(We,{key:m.key,title:m.title,desc:m.desc,disabled:m.required?!m.required.every(i=>C.includes(i)):void 0,checked:C.includes(m.key),onChange:i=>T(m.key,i)})),s.pluginPermission.length>0&&t.createElement(t.Fragment,null,t.createElement(oe.Z,null,(0,l.t)("\u4EE5\u4E0B\u4E3A\u63D2\u4EF6\u6743\u9650")),s.pluginPermission.map(m=>t.createElement(We,{key:m.key,title:m.title,desc:m.desc,disabled:m.required?!m.required.every(i=>C.includes(i)):void 0,checked:C.includes(m.key),onChange:i=>T(m.key,i)}))))});ot.displayName="RolePermission";var gt=e(38643),yt=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const st=t.memo(o=>{const{groupId:c,withoutMemberIds:u=[],onConfirm:C}=o,[f,T]=(0,t.useState)([]),B=(0,l.aaJ)(c),m=(0,t.useMemo)(()=>rt()(B,...u),[B,u]),[{loading:i},E]=(0,l.ilX)(()=>yt(void 0,null,function*(){yield C(f)}),[C,f]);return t.createElement(N.AB,{title:(0,l.t)("\u9009\u62E9\u7FA4\u7EC4\u6210\u5458")},t.createElement(gt.f,{allUserIds:m,selectedIds:f,onChange:T}),t.createElement("div",{className:"text-right"},t.createElement(G.Z,{type:"primary",loading:i,onClick:E},(0,l.t)("\u786E\u8BA4"))))});st.displayName="SelectGroupMember";var ut=e(9021),at=e(79546),ct=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const it=t.memo(o=>{var c,u;const C=o.currentRoleInfo._id,f=(0,l.iFL)(o.groupId),B=((c=f==null?void 0:f.members)!=null?c:[]).filter(De=>De.roles.includes(C)).map(De=>De.userId),m=(0,l.FDf)(B),{searchText:i,setSearchText:E,isSearching:W,searchResult:Ce}=(0,l.RxY)({dataSource:m,filterFn:(De,ye)=>String(De.nickname).includes(ye)}),qe=(0,l.nWw)(()=>{const De=(0,N.h7)(t.createElement(st,{groupId:o.groupId,withoutMemberIds:Re()([...B]),onConfirm:ye=>ct(void 0,null,function*(){try{yield l.o4J.ru.appendGroupMemberRoles(o.groupId,ye,[o.currentRoleInfo._id]),(0,l.jiy)(),(0,N.Mr)(De)}catch(_e){(0,l.hJM)(_e)}})}))}),[,Ve]=(0,l.CoE)(De=>ct(void 0,null,function*(){var ye;if(!((ye=o.currentRoleInfo)==null?void 0:ye._id)){(0,l.hJM)((0,l.t)("\u5F53\u524D\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u89D2\u8272\u7EC4"));return}yield l.o4J.ru.removeGroupMemberRoles(o.groupId,[De],[o.currentRoleInfo._id]),(0,l.jiy)()}),[o.groupId,(u=o.currentRoleInfo)==null?void 0:u._id]);return t.createElement("div",null,t.createElement("div",{className:"text-right mb-2 flex space-x-1"},t.createElement(G.Z,{type:"primary",onClick:qe},(0,l.t)("\u6DFB\u52A0\u6210\u5458")),m.length>0&&t.createElement(at.Z,{placeholder:(0,l.t)("\u641C\u7D22\u6210\u5458"),size:"middle",suffix:t.createElement(j.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:i,onChange:De=>E(De.target.value)})),(W?Ce:m).map(De=>t.createElement(ut.Q,{key:De._id,userId:De._id,actions:[t.createElement(x.a,{key:"remove",icon:"mdi:close",onClick:()=>Ve(De._id)})]})))});it.displayName="RoleMember";var Pt=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const mt=t.memo(o=>{var c,u;const{groupId:C}=o,[f,T]=(0,t.useState)(l.lin),B=(0,l.iFL)(C),m=(c=B==null?void 0:B.roles)!=null?c:[],i=(0,t.useMemo)(()=>m.find(De=>De._id===f),[m,f]),{loading:E,handleCreateRole:W,handleSavePermission:Ce,handleChangeRoleName:qe,handleDeleteRole:Ve}=ae(C,f);return t.createElement(D.g,{spinning:E,className:"h-full"},t.createElement("div",{className:"flex h-full"},t.createElement("div",{className:"pr-2 mr-2 w-40 mobile:w-28 border-r border-white border-opacity-20"},t.createElement(ne,{active:f===l.lin,onClick:()=>T(l.lin)},(0,l.t)("\u6240\u6709\u4EBA")),m.map(De=>t.createElement(ne,{key:De._id,active:f===De._id,onClick:()=>T(De._id)},De.name)),t.createElement(ne,{active:!1,onClick:W},(0,l.t)("\u6DFB\u52A0\u89D2\u8272"))),t.createElement("div",{className:"flex-1 overflow-y-auto"},t.createElement(h.N,{defaultActiveKey:"permission",items:[{key:"summary",label:(0,l.t)("\u6982\u8FF0"),disabled:f===l.lin,children:t.createElement(t.Fragment,null,i&&t.createElement(J,{currentRoleInfo:i,onChangeRoleName:qe,onDeleteRole:()=>Pt(void 0,null,function*(){yield Ve(),T(l.lin)})}))},{key:"permission",label:(0,l.t)("\u6743\u9650"),children:t.createElement(ot,{roleId:f,fallbackPermissions:(u=B==null?void 0:B.fallbackPermissions)!=null?u:[],currentRoleInfo:i,onSavePermission:Ce})},{key:"member",label:(0,l.t)("\u7BA1\u7406\u6210\u5458"),disabled:f===l.lin,children:t.createElement(t.Fragment,null,i&&t.createElement(it,{groupId:C,currentRoleInfo:i}))}]}))))});mt.displayName="GroupRole";var dt=e(92951),Ct=e(15333),lt=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const vt=t.memo(({groupId:o})=>{var c,u;const C=(0,l.iFL)(o),[,f]=(0,l.CoE)(m=>lt(void 0,null,function*(){yield(0,l.uRW)(o,"name",m),(0,l.jiy)((0,l.t)("\u4FEE\u6539\u7FA4\u7EC4\u540D\u6210\u529F"))}),[o]),[,T]=(0,l.CoE)(m=>lt(void 0,null,function*(){yield(0,l.uRW)(o,"description",m),(0,l.jiy)((0,l.t)("\u4FEE\u6539\u7FA4\u7EC4\u63CF\u8FF0\u6210\u529F"))}),[o]),[,B]=(0,l.CoE)(m=>lt(void 0,null,function*(){yield(0,l.uRW)(o,"avatar",m.url),(0,l.lHp)((0,l.t)("\u4FEE\u6539\u7FA4\u7EC4\u5934\u50CF\u6210\u529F"),"success")}),[o]);return C?t.createElement("div",null,t.createElement(Ie,null,(0,l.t)("\u7FA4\u7EC4\u6982\u8FF0")),t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-1/3 mobile:w-full mobile:text-center"},t.createElement(dt.C,{circle:!0,onUploadSuccess:B},t.createElement(j.qE,{size:128,name:C.name,src:C.avatar}))),t.createElement("div",{className:"w-2/3 mobile:w-full"},t.createElement($.LP,{title:(0,l.t)("\u7FA4\u7EC4\u540D\u79F0"),value:C.name,editable:!0,renderEditor:$.jo,onSave:f}),t.createElement($.LP,{title:(0,l.t)("\u6210\u5458\u6570"),value:String(C.members.length)}),t.createElement($.LP,{title:(0,l.t)("\u7FA4\u7EC4\u63CF\u8FF0"),value:(c=C.description)!=null?c:"",content:t.createElement("pre",null,(u=C.description)!=null?u:""),editable:!0,renderEditor:It,onSave:T})))):t.createElement(Ct.J,{message:(0,l.t)("\u65E0\u6CD5\u83B7\u53D6\u5230\u7FA4\u7EC4\u4FE1\u606F")})});vt.displayName="GroupSummary";const It=({value:o,onChange:c})=>t.createElement(at.Z.TextArea,{autoSize:{minRows:4,maxRows:6},maxLength:120,value:o,onChange:u=>c(u.target.value),showCount:!0});var Dt=(o,c,u)=>new Promise((C,f)=>{var T=i=>{try{m(u.next(i))}catch(E){f(E)}},B=i=>{try{m(u.throw(i))}catch(E){f(E)}},m=i=>i.done?C(i.value):Promise.resolve(i.value).then(T,B);m((u=u.apply(o,c)).next())});const Et=t.memo(o=>{var c,u,C;const f=o.groupId,T=(0,l.iFL)(f),B=(0,l.TL5)(),[{loading:m},i]=(0,l.CoE)((W,Ce)=>Dt(void 0,null,function*(){yield l.o4J.ru.modifyGroupConfig(f,W,Ce),B(l.hyC.updateGroupConfig({groupId:f,configName:W,configValue:Ce})),(0,l.jiy)()}),[f]);if(!T)return t.createElement(D.g,{spinning:!0});const E=(c=T.config)!=null?c:{};return t.createElement("div",null,t.createElement(Ie,null,(0,l.t)("\u7FA4\u7EC4\u914D\u7F6E")),t.createElement($.LP,{title:(0,l.t)("\u9690\u85CF\u6210\u5458\u5B8C\u6574\u540D\u79F0"),tip:(0,l.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u83B7\u53D6\u6210\u5458\u4FE1\u606F"),content:t.createElement(Pe.Z,{disabled:m,checked:(u=E.hideGroupMemberDiscriminator)!=null?u:!1,onChange:W=>i("hideGroupMemberDiscriminator",W)})}),t.createElement($.LP,{title:(0,l.t)("\u7981\u6B62\u5728\u7FA4\u7EC4\u53D1\u8D77\u79C1\u4FE1"),tip:(0,l.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u9A9A\u6270\u7528\u6237\u3002"),content:t.createElement(Pe.Z,{disabled:m||E.hideGroupMemberDiscriminator===!0,checked:(C=E.hideGroupMemberDiscriminator===!0||E.disableCreateConverseFromGroup)!=null?C:!1,onChange:W=>i("disableCreateConverseFromGroup",W)})}),t.createElement($.LP,{title:(0,l.t)("\u7FA4\u7EC4\u80CC\u666F"),tip:(0,l.t)("\u4E2A\u6027\u5316\u914D\u7F6E\u7FA4\u7EC4\u80CC\u666F"),content:t.createElement(t.Fragment,null,t.createElement(dt.w,{aspect:16/9,onUploadSuccess:W=>{i("groupBackgroundImage",W.url)}},t.createElement(j.Ee,{wrapperClassName:"block",style:{width:640,height:360},src:E.groupBackgroundImage})),t.createElement("div",{className:"text-xs opacity-80"},(0,l.t)("\u5EFA\u8BAE\u6BD4\u4F8B: 16:9 | \u5EFA\u8BAE\u5927\u5C0F: 1280x720")),E.groupBackgroundImage&&t.createElement(G.Z,{className:"mt-1",type:"primary",onClick:()=>{i("groupBackgroundImage","")}},(0,l.t)("\u6E05\u9664")))}),s.pluginGroupConfigItems.map(W=>{const Ce=(0,be.g)(W.name);return t.createElement($.LP,{key:Ce,title:W.title,tip:W.tip,content:t.createElement(W.component,{value:E[Ce],onChange:qe=>i(Ce,qe),loading:m})})}))});Et.displayName="GroupConfig";var Mt=e(64917),Ft=e(96136),xt=e(6342);const ft=t.memo(o=>{const c=o.groupId,{userInfos:u,searchText:C,setSearchText:f,isSearching:T,searchResult:B,generateActionMenu:m}=(0,Mt.Q)(c),i=E=>{const W=m(E);return t.createElement(ut.Q,{key:E._id,userId:E._id,actions:[t.createElement("div",{key:"more"},t.createElement(Ft.Z,{menu:W,trigger:["click"],placement:"bottomRight"},t.createElement("div",null,t.createElement(x.a,{icon:"mdi:dots-vertical"}))))]})};return t.createElement("div",{className:"flex flex-col h-full"},t.createElement(Ie,null,(0,l.t)("\u6210\u5458\u7BA1\u7406")),t.createElement("div",{className:"py-2"},t.createElement(at.Z,{placeholder:(0,l.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:t.createElement(j.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:C,onChange:E=>f(E.target.value)})),t.createElement("div",{className:"flex-1 overflow-auto"},t.createElement(xt.OO,{style:{height:"100%"},data:T?B:u,itemContent:(E,W)=>i(W)})))});ft.displayName="GroupMember";const pt=t.memo(o=>{const c=o.groupId,u=(0,t.useCallback)(E=>{E===!1&&typeof o.onClose=="function"&&o.onClose()},[o.onClose]),[C,f,T,B,m]=(0,l.WHr)(c,[l.g3S.core.groupConfig,l.g3S.core.manageUser,l.g3S.core.managePanel,l.g3S.core.manageInvite,l.g3S.core.manageRoles]),i=(0,t.useMemo)(()=>{const E=[{type:"group",title:(0,l.t)("\u901A\u7528"),children:Re()([{type:"item",title:(0,l.t)("\u6982\u8FF0"),content:t.createElement(vt,{groupId:c})},C&&{type:"item",title:(0,l.t)("\u914D\u7F6E"),content:t.createElement(Et,{groupId:c})},f&&{type:"item",title:(0,l.t)("\u6210\u5458"),content:t.createElement(ft,{groupId:c})},T&&{type:"item",title:(0,l.t)("\u9762\u677F"),content:t.createElement(v,{groupId:c})},B&&{type:"item",title:(0,l.t)("\u9080\u8BF7\u7801"),content:t.createElement(w,{groupId:c})},m&&{type:"item",title:(0,l.t)("\u8EAB\u4EFD\u7EC4"),content:t.createElement(mt,{groupId:c})}])}],W=s.pluginCustomPanel.filter(Ce=>Ce.position==="groupdetail").map(Ce=>({type:"item",title:Ce.label,content:t.createElement(Ce.render)}));return W.length>0&&E.push({type:"group",title:(0,l.t)("\u63D2\u4EF6"),children:W}),E},[]);return t.createElement(a.A,{value:c},t.createElement(r.o,{onChangeVisible:u},t.createElement(n.u,{menu:i,defaultContentPath:"0.children.0.content"})))});pt.displayName="GroupDetail"},51052:(Me,Q,e)=>{e.d(Q,{Z:()=>ie});var r=e(50842),n=e(52983),a=e(30831),s=e(84143),t=e(66559),l=e(83996),A=e(58761),F=e(56489),G=e(95268),p=e(54782),g=e(93540),N=(ee,w,y)=>new Promise((I,d)=>{var O=le=>{try{z(y.next(le))}catch(me){d(me)}},Z=le=>{try{z(y.throw(le))}catch(me){d(me)}},z=le=>le.done?I(le.value):Promise.resolve(le.value).then(O,Z);z((y=y.apply(ee,w)).next())});const L=n.memo(ee=>{const{userInfo:w}=ee,{value:y}=(0,a.r53)(()=>N(void 0,null,function*(){if(!w.avatar)return(0,g.Yy)(w.nickname);const I=yield(0,l.f)(w.avatar);return`rgba(${I.r}, ${I.g}, ${I.b}, ${I.a})`}),[w.avatar]);return n.createElement("div",{className:"relative bg-inherit"},n.createElement("div",{style:{width:"100%",height:60,backgroundColor:y}}),n.createElement("div",{className:"absolute p-1 rounded-1/2 -mt-11 ml-3 bg-inherit"},n.createElement(g.OI,{size:80,src:w.avatar,name:w.nickname})),n.createElement("div",{className:"p-2 mt-10"},ee.children))});L.displayName="UserProfileContainer";var M=e(7975);function x(ee={}){return n.createElement(n.Fragment,null,M.pluginUserExtraInfo.map((w,y)=>{var I;const d=(I=w.component)==null?void 0:I.render;return d?n.createElement(d,{key:w.name+y,value:ee[w.name]}):n.createElement("div",{key:w.name+y,className:"flex"},n.createElement("div",{className:"w-1/4 text-gray-500"},w.label,":"),n.createElement("div",{className:"w-3/4"},ee[w.name]?String(ee[w.name]):""))}))}var U=(ee,w,y)=>new Promise((I,d)=>{var O=le=>{try{z(y.next(le))}catch(me){d(me)}},Z=le=>{try{z(y.throw(le))}catch(me){d(me)}},z=le=>le.done?I(le.value):Promise.resolve(le.value).then(O,Z);z((y=y.apply(ee,w)).next())});const K=n.memo(ee=>{var w;const{userInfo:y,groupInfo:I}=ee,d=y._id,O=(w=y.extra)!=null?w:{},Z=Y(d,I),{hideGroupMemberDiscriminator:z,disableCreateConverseFromGroup:le}=(0,a.r3q)(I),me=x(O),de=(0,p.useNavigate)(),Fe=(0,a.IIz)(),xe=!z&&!le&&Fe!==d,[,be]=(0,a.CoE)(()=>U(void 0,null,function*(){const Se=yield(0,a.L1i)([d]);de(`/main/personal/converse/${Se._id}`)}),[de]);return(0,n.useEffect)(()=>{y.avatar&&(0,l.f)(y.avatar).then(Se=>{console.log("fetchImagePrimaryColor",Se)})},[y.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(L,{userInfo:y},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(t.v,{userId:d})),!z&&n.createElement("span",{className:"opacity-60 ml-1"},"#",y.discriminator)),n.createElement(A.Z,{size:4,wrap:!0,className:"py-1"},I.owner===d&&n.createElement(F.Z,{color:"gold"},(0,a.t)("\u521B\u5EFA\u8005")),y.temporary&&n.createElement(F.Z,{color:"processing"},(0,a.t)("\u6E38\u5BA2")),Z.map(Se=>n.createElement(F.Z,{key:Se,color:(0,g.Yy)(Se)},Se))),n.createElement("div",{className:"pt-2"},me),n.createElement("div",{className:"text-right"},xe&&n.createElement(G.Z,{title:(0,a.t)("\u53D1\u9001\u6D88\u606F")},n.createElement(s.a,{icon:"mdi:message-processing-outline",onClick:be})))))});K.displayName="GroupUserPopover";function Y(ee,w){var y,I;const d=(I=(y=w.members.find(Z=>Z.userId===ee))==null?void 0:y.roles)!=null?I:[];return w.roles.filter(Z=>d.includes(Z._id)).map(Z=>Z.name)}const j=n.memo(ee=>{var w;const{userInfo:y}=ee,I=(w=y.extra)!=null?w:{},d=x(I);return(0,n.useEffect)(()=>{y.avatar&&(0,l.f)(y.avatar).then(O=>{console.log("fetchImagePrimaryColor",O)})},[y.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(L,{userInfo:y},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(t.v,{userId:y._id})),n.createElement("span",{className:"opacity-60 ml-1"},"#",y.discriminator)),n.createElement(A.Z,{size:4,wrap:!0,className:"py-1"},y.temporary&&n.createElement(F.Z,{color:"processing"},(0,a.t)("\u6E38\u5BA2"))),n.createElement("div",{className:"pt-2"},d)))});j.displayName="PersonalUserPopover";const ie=n.memo(ee=>{const w=(0,r.b)(),y=(0,a.iFL)(w);return(0,a.xzJ)(ee.userInfo._id,!0),y?n.createElement(K,{userInfo:ee.userInfo,groupInfo:y}):n.createElement(j,{userInfo:ee.userInfo})});ie.displayName="UserPopover"},63933:(Me,Q,e)=>{e.d(Q,{q:()=>a});var r=e(52983),n=e(30831);function a(s,t){const l=(0,n.ysv)(s);(0,r.useLayoutEffect)(()=>{const A=F=>{typeof l.current=="function"&&l.current(F)};return window.addEventListener("keydown",A,t),()=>{window.removeEventListener("keydown",A,t)}},[])}},64917:(Me,Q,e)=>{e.d(Q,{Q:()=>F});var r=e(84208),n=e(52983),a=e(30831),s=e(6494),t=e.n(s),l=e(95850),A=(p,g,N)=>new Promise((L,M)=>{var x=Y=>{try{K(N.next(Y))}catch(j){M(j)}},U=Y=>{try{K(N.throw(Y))}catch(j){M(j)}},K=Y=>Y.done?L(Y.value):Promise.resolve(Y.value).then(x,U);K((N=N.apply(p,g)).next())});function F(p){var g;const N=(0,a.iFL)(p),L=(g=N==null?void 0:N.members)!=null?g:[],M=(0,a.Tgq)(p),x=(0,l.x)(),{handleMuteMember:U,handleUnmuteMember:K}=G(p,M),{searchText:Y,setSearchText:j,isSearching:ie,searchResult:ee}=(0,a.RxY)({dataSource:M,filterFn:(d,O)=>!!(x[d._id]&&x[d._id].includes(O)||d.nickname.includes(O))}),[,w]=(0,a.CoE)(d=>A(this,null,function*(){(yield(0,r.aW)({title:(0,a.t)("\u786E\u8BA4\u8981\u5C06\u8BE5\u7528\u6237\u79FB\u51FA\u7FA4\u7EC4\u4E48")}))&&(yield a.o4J.ru.deleteGroupMember(p,d),(0,a.jiy)())}),[p]),y=(0,n.useCallback)(d=>{const O=L.find(z=>z.userId===d);if(!O||!O.muteUntil)return!1;const Z=O.muteUntil;return new Date(Z).valueOf()>new Date().valueOf()},[L]),I=(0,a.nWw)(d=>{const Z=y(d._id)?[{key:"unmute",label:(0,a.t)("\u89E3\u9664\u7981\u8A00"),onClick:()=>K(d._id)}]:[{key:"mute",label:(0,a.t)("\u7981\u8A00"),children:[{key:"1m",label:(0,a.t)("1\u5206\u949F"),onClick:()=>U(d._id,1*60*1e3)},{key:"5m",label:(0,a.t)("5\u5206\u949F"),onClick:()=>U(d._id,5*60*1e3)},{key:"10m",label:(0,a.t)("10\u5206\u949F"),onClick:()=>U(d._id,10*60*1e3)},{key:"30m",label:(0,a.t)("30\u5206\u949F"),onClick:()=>U(d._id,30*60*1e3)},{key:"1d",label:(0,a.t)("1\u5929"),onClick:()=>U(d._id,1*24*60*60*1e3)},{key:"7d",label:(0,a.t)("7\u5929"),onClick:()=>U(d._id,7*24*60*60*1e3)},{key:"30d",label:(0,a.t)("30\u5929"),onClick:()=>U(d._id,30*24*60*60*1e3)}]}];return{items:t()([...Z,{key:"delete",label:(0,a.t)("\u79FB\u51FA\u7FA4\u7EC4"),danger:!0,onClick:()=>w(d._id)}])}});return{userInfos:M,searchText:Y,setSearchText:j,isSearching:ie,searchResult:ee,getMemberHasMute:y,handleMuteMember:U,handleUnmuteMember:K,handleRemoveGroupMember:w,generateActionMenu:I}}function G(p,g){const[,N]=(0,a.CoE)((M,x)=>A(this,null,function*(){const U=g.find(K=>K._id===M);if(!U)throw new Error((0,a.t)("\u6CA1\u6709\u627E\u5230\u7528\u6237"));(yield(0,r.aW)({title:(0,a.t)("\u786E\u5B9A\u8981\u7981\u8A00 {{name}} \u4E48",{name:U.nickname}),content:(0,a.t)("\u7981\u8A00 {{length}}, \u9884\u8BA1\u5230 {{until}} \u4E3A\u6B62",{length:(0,a.TGs)(x),until:(0,a.KJm)(new Date().valueOf()+x)})}))&&(yield a.o4J.ru.muteGroupMember(p,M,x),(0,a.jiy)())}),[p,g]),[,L]=(0,a.CoE)(M=>A(this,null,function*(){yield a.o4J.ru.muteGroupMember(p,M,-1),(0,a.jiy)()}),[p]);return{handleMuteMember:N,handleUnmuteMember:L}}},95483:(Me,Q,e)=>{e.d(Q,{r:()=>N});var r=e(30831);const n=(0,r.fA3)(()=>sessionStorage);var a=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,G=(L,M,x)=>M in L?a(L,M,{enumerable:!0,configurable:!0,writable:!0,value:x}):L[M]=x,p=(L,M)=>{for(var x in M||(M={}))A.call(M,x)&&G(L,x,M[x]);if(l)for(var x of l(M))F.call(M,x)&&G(L,x,M[x]);return L},g=(L,M)=>s(L,t(M));function N(L){const[M={},x]=n("sessionPreference"),U=M[L],K=(0,r.nWw)(Y=>{x(g(p({},M),{[L]:Y}))});return[U,K]}},16131:(Me,Q,e)=>{e.d(Q,{E:()=>Qe,x:()=>Ye});var r=e(6739),n=e(89889),a=e(48303),s=e(52983),t=e(30831);const l=s.memo(se=>{const _=(0,t.wY6)(se.groupId,se.panelId);if(!_)return s.createElement(a.Z,{className:"w-full text-center",message:(0,t.t)("\u65E0\u6CD5\u83B7\u53D6\u9762\u677F\u4FE1\u606F")});if(typeof _.provider!="string")return s.createElement(a.Z,{className:"w-full text-center",message:(0,t.t)("\u672A\u627E\u5230\u63D2\u4EF6\u7684\u63D0\u4F9B\u8005")});const ue=(0,s.useMemo)(()=>(0,t.YQu)(_.pluginPanelName)?(0,n.S)(_.pluginPanelName):null,[_.name]);if(!ue)return s.createElement(a.Z,{className:"w-full text-center",message:s.createElement("div",null,s.createElement("p",null,(0,t.t)("\u8BE5\u9762\u677F\u7531\u63D2\u4EF6\u63D0\u4F9B")),s.createElement("p",null,(0,t.t)("\u63D2\u4EF6\u540D"),": ",_.provider),s.createElement("p",null,(0,t.t)("\u9762\u677F\u540D"),": ",_.pluginPanelName))});const Oe=ue.render;return Oe?s.createElement(Oe,{panelInfo:_}):s.createElement(r.t,{text:(0,t.t)("\u63D2\u4EF6\u6E32\u67D3\u51FD\u6570\u4E0D\u5B58\u5728")})});l.displayName="GroupPluginPanel";var A=e(21506),F=e(29254),G=e(84143),p=e(7975),g=e(95850),N=e(93540),L=e(9021),M=e(55696),x=e(96136),U=e(79546),K=e(64917),Y=e(51052),j=e(6342),ie=e(89022),ee=e.n(ie),w=e(28102),y=e.n(w),I=e(13546),d=e.n(I);const O=s.memo(se=>{var _;const ue=se.groupId,Oe=(0,t.iFL)(ue),Ue=(_=Oe==null?void 0:Oe.members)!=null?_:[],Re=(0,t.aoI)(Ue.map(ve=>ve.userId)),[we]=(0,t.WHr)(ue,[t.g3S.core.manageUser]),{hideGroupMemberDiscriminator:ke}=(0,t.r3q)(Oe),{userInfos:R,searchText:q,setSearchText:k,isSearching:V,searchResult:H,generateActionMenu:fe}=(0,K.Q)(ue),pe=(0,s.useMemo)(()=>{const ve=[],P=[];return R.forEach((b,S)=>{Re[S]===!0?ve.push(b):P.push(b)}),{[(0,t.t)("\u5728\u7EBF")]:ve,[(0,t.t)("\u79BB\u7EBF")]:P}},[R,Re]),{groupCounts:Be,groupNames:Ne,getGroupedMemberInfo:Le}=(0,s.useMemo)(()=>{const ve=V?{"":H}:pe,P=Object.values(ve).map(ce=>ce.length),b=Object.keys(ve);return{groupCounts:P,groupNames:b,getGroupedMemberInfo:(ce,X)=>{const he=b[X],Ie=y()(ee()(P,X)),Ee=ce-Ie;return d()(ve,[he,Ee],null)}}},[V,H,pe]);if(!Oe)return s.createElement(r.t,null);if(R.length===0)return s.createElement(M.Z,null);const Ge=ve=>{if(!ve)return s.createElement("div",null);if(we){const P=fe(ve);return s.createElement(x.Z,{key:ve._id,trigger:["contextMenu"],menu:P},s.createElement("div",null,s.createElement(L.Q,{userId:ve._id,popover:s.createElement(Y.Z,{userInfo:ve}),hideDiscriminator:ke})))}else return s.createElement(L.Q,{key:ve._id,userId:ve._id,popover:s.createElement(Y.Z,{userInfo:ve}),hideDiscriminator:ke})};return s.createElement("div",{className:"h-full flex flex-col"},s.createElement("div",{className:"p-2"},s.createElement(U.Z,{placeholder:(0,t.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:s.createElement(N.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:q,onChange:ve=>k(ve.target.value)})),s.createElement("div",{className:"flex-1"},s.createElement(j.Px,{className:"h-full",groupCounts:Be,groupContent:ve=>s.createElement("div",{className:"pt-4 px-2.5 font-bold text-sm text-opacity-80 bg-content-light dark:bg-content-dark"},Ne[ve]," - ",Be[ve]),itemContent:(ve,P)=>Ge(Le(ve,P))})))});O.displayName="MembersPanel";var Z=e(29188);function z(se){const _=(0,t.IIz)(),ue=(0,t.mWi)(se,_??""),[Oe]=(0,t.WHr)(se,[t.g3S.core.message]),[Ue,Re]=(0,s.useState)(void 0),we=(0,s.useCallback)(()=>{Re(ue&&ue?(0,t.t)("\u7981\u8A00\u4E2D, \u8FD8\u5269 {{remain}}",{remain:(0,t.TGs)(new Date().valueOf()-new Date(ue).valueOf())}):void 0)},[ue]);return(0,t.Yzt)(we,1e4),(0,s.useLayoutEffect)(()=>{we()},[ue]),Oe?{disabled:Boolean(ue),placeholder:Ue}:{disabled:!0,placeholder:(0,t.t)("\u6CA1\u6709\u53D1\u9001\u6D88\u606F\u7684\u6743\u9650, \u8BF7\u8054\u7CFB\u7FA4\u7EC4\u6240\u6709\u8005")}}const le=s.memo(({groupId:se,panelId:_})=>{const ue=(0,t.iFL)(se),Oe=(0,t.Tgq)(se),Ue=(0,t.wY6)(se,_),{disabled:Re,placeholder:we}=z(se),ke=(0,g.x)();return!ue||!Ue?null:s.createElement(Z.q,{groupId:se,panelId:_,prefixActions:()=>[...p.pluginPanelActions.filter(R=>R.position==="group").map(R=>s.createElement(G.a,{key:R.name,title:R.label,shape:"square",icon:R.icon,iconClassName:"text-2xl",onClick:()=>R.onClick({groupId:se,panelId:_})}))],suffixActions:({setRightPanel:R})=>[s.createElement(G.a,{key:"members",title:(0,t.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>R({name:(0,t.t)("\u6210\u5458")+` (${Oe.length})`,panel:s.createElement(O,{groupId:se})})})]},s.createElement(F.x2,{users:Oe.map(R=>({id:R._id,display:ke[R._id]?ke[R._id]:R.nickname})),panels:ue.panels.filter(R=>R.type!==t.Xpe.GROUP).map(R=>({id:`/main/group/${se}/${R.id}`,display:R.name})),disabled:Re,placeholder:we},s.createElement(A.r,{converseId:_,converseTitle:Ue.name,isGroup:!0,groupId:se})))});le.displayName="TextPanel";var me=e(85478),de=e(95483),Fe=e(22215),xe=Object.defineProperty,be=Object.defineProperties,Se=Object.getOwnPropertyDescriptors,Ze=Object.getOwnPropertySymbols,ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,je=(se,_,ue)=>_ in se?xe(se,_,{enumerable:!0,configurable:!0,writable:!0,value:ue}):se[_]=ue,He=(se,_)=>{for(var ue in _||(_={}))ze.call(_,ue)&&je(se,ue,_[ue]);if(Ze)for(var ue of Ze(_))Je.call(_,ue)&&je(se,ue,_[ue]);return se},$e=(se,_)=>be(se,Se(_));function Xe(se,_){const[ue,Oe]=(0,de.r)("groupLastVisitPanel");(0,s.useEffect)(()=>{Oe($e(He({},ue),{[se]:_}))},[se,_])}const Qe=s.memo(se=>{const{groupId:_,panelId:ue}=se,Oe=(0,t.iFL)(_),Ue=(0,t.wY6)(_,ue),Re=(0,s.useMemo)(()=>({groupId:_,panelId:ue}),[_,ue]);return Xe(_,ue),Oe===null?s.createElement(a.Z,{className:"w-full text-center",type:"error",message:(0,t.t)("\u7FA4\u7EC4\u4E0D\u5B58\u5728")}):Ue===null?s.createElement(r.t,{text:(0,t.t)("\u9762\u677F\u4E0D\u5B58\u5728")}):Ue.type===t.Xpe.TEXT?s.createElement(t.f4G,{groupInfo:Oe},s.createElement(me.x.Provider,{value:Re},s.createElement(le,{groupId:_,panelId:Ue.id}))):Ue.type===t.Xpe.PLUGIN?s.createElement(me.x.Provider,{value:Re},s.createElement(l,{groupId:_,panelId:Ue.id})):s.createElement(a.Z,{className:"w-full text-center",type:"error",message:(0,t.t)("\u672A\u77E5\u7684\u9762\u677F\u7C7B\u578B")})});Qe.displayName="GroupPanelRender";const Ye=s.memo(()=>{const{groupId:se,panelId:_}=(0,Fe.PO)();return s.createElement(Qe,{groupId:se,panelId:_})});Ye.displayName="GroupPanelRoute"},53937:(Me,Q,e)=>{e.d(Q,{Z:()=>ke});var r=e(6739),n=e(14517),a=e(52983),s=e(72425),t=e(30831);const l=a.memo(R=>{const[q,{save:k}]=(0,t.y$C)("pin-sizes",[90,10]),V=H=>{k(H)};return a.createElement(s.Z,{className:(0,n.Z)("split",R.className),sizes:q,minSize:250,expandToMin:!0,onDragEnd:V},R.children)});l.displayName="SplitPanel";var A=e(50842),F=e(54782),G=e(12492),p=e(16131),g=e(14698),N=e.n(g),L=e(95483);const M=a.memo(()=>{const{groupId:R=""}=(0,F.useParams)(),q=(0,F.useNavigate)(),[k]=(0,L.r)("groupLastVisitPanel"),V=(0,t.ysv)(k),H=(0,t.iFL)(R);return(0,a.useEffect)(()=>{var fe;if(!H||!Array.isArray(H==null?void 0:H.panels)||(H==null?void 0:H.panels.length)===0)return;const pe=(fe=V.current)==null?void 0:fe[H._id],Be=H.panels;if(Be.some(Ge=>Ge.id===pe)){q(`/main/group/${R}/${pe}`,{replace:!0});return}const Le=Be.find(Ge=>Ge.type!==t.Xpe.GROUP);N()(Le)||q(`/main/group/${R}/${Le.id}`,{replace:!0})},[H]),null});M.displayName="GroupPanelRedirect";var x=e(6494),U=e.n(x),K=e(1348),Y=e(84208),j=e(39979),ie=e(40318),ee=e(72297),w=e(59417),y=e.n(w);function I(R,q){const k=(0,F.useLocation)(),V=(0,a.useRef)(""),H=(0,t.ysv)(q);(0,a.useEffect)(()=>{const{nav:fe}=(0,ee.qp)(k.search,{ignoreQueryPrefix:!0}),pe=String(fe);pe&&(pe!==V.current&&y()(pe,R)&&H.current(pe),V.current=pe)},[k.search])}var d=(R,q,k)=>new Promise((V,H)=>{var fe=Ne=>{try{Be(k.next(Ne))}catch(Le){H(Le)}},pe=Ne=>{try{Be(k.throw(Ne))}catch(Le){H(Le)}},Be=Ne=>Ne.done?V(Ne.value):Promise.resolve(Ne.value).then(fe,pe);Be((k=k.apply(R,q)).next())});function O(R){const q=(0,t.GLd)(R),k=(0,F.useNavigate)(),V=(0,a.useCallback)(()=>{const pe=(0,Y.h7)(a.createElement(j.a,{groupId:R,onClose:()=>{(0,Y.Mr)(pe)}}))},[R]),H=(0,a.useCallback)(()=>{(0,Y.h7)(a.createElement(ie.P,{groupId:R}))},[R]),fe=(0,a.useCallback)(()=>{(0,t.wp$)({message:q?(0,t.t)("\u60A8\u662F\u7FA4\u7EC4\u7BA1\u7406\u8005\uFF0C\u9000\u51FA\u7FA4\u7EC4\u4F1A\u5BFC\u81F4\u89E3\u6563\u7FA4\u7EC4"):(0,t.t)("\u786E\u5B9A\u8981\u9000\u51FA\u7FA4\u7EC4\u4E48?"),onConfirm(){return d(this,null,function*(){yield(0,t.XV6)(R),k("/main",{replace:!0})})}})},[R,q]);return I("group.*",pe=>{pe.startsWith("group.detail")&&V()}),{handleShowGroupDetail:V,handleInviteUser:H,handleQuitGroup:fe}}const Z=a.memo(R=>{const{groupId:q}=R,k=(0,t.iFL)(q),{t:V}=(0,t.$G7)(),[H,fe]=(0,t.WHr)(q,[t.g3S.core.groupDetail,t.g3S.core.invite]),{handleShowGroupDetail:pe,handleInviteUser:Be,handleQuitGroup:Ne}=O(q);if(N()(k))return null;const Le={items:U()([H&&{key:"0",label:V("\u67E5\u770B\u8BE6\u60C5"),onClick:pe},fe&&{key:"1",label:V("\u9080\u8BF7\u7528\u6237"),onClick:Be},{key:"2",label:V("\u9000\u51FA\u7FA4\u7EC4"),danger:!0,onClick:Ne}])};return a.createElement(K.M,{menu:Le,"data-testid":"group-header"},k==null?void 0:k.name)});Z.displayName="GroupHeader";var z=e(93540);const le=a.memo(R=>{const[q,k]=(0,a.useReducer)(V=>!V,!0);return a.createElement("div",null,a.createElement("div",{className:"flex items-center cursor-pointer py-1 text-xs",onClick:k},a.createElement(z.JO,{className:"mr-1",icon:"mdi:chevron-right",rotate:q?45:0}),a.createElement("div",null,R.header)),a.createElement("div",{className:"transition-all overflow-hidden space-y-0.5 pl-2 ml-1 border-l-4 border-opacity-40",style:{maxHeight:q?"var(--max-height)":0},ref:V=>V==null?void 0:V.style.setProperty("--max-height",`${V.scrollHeight}px`)},R.children))});le.displayName="GroupSection";var me=e(10114),de=e(75283),Fe=e(58761),xe=e(68e3),be=e(10330),Se=Object.defineProperty,Ze=Object.getOwnPropertySymbols,ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,je=(R,q,k)=>q in R?Se(R,q,{enumerable:!0,configurable:!0,writable:!0,value:k}):R[q]=k,He=(R,q)=>{for(var k in q||(q={}))ze.call(q,k)&&je(R,k,q[k]);if(Ze)for(var k of Ze(q))Je.call(q,k)&&je(R,k,q[k]);return R};const $e=a.memo(R=>{const{icon:q,name:k,to:V,dimmed:H=!1,badge:fe}=R,Be=(0,F.useLocation)().pathname.startsWith(V);return a.createElement(be.rU,{className:"block",to:V},a.createElement("div",{className:(0,n.Z)("w-full hover:bg-black hover:bg-opacity-20 dark:hover:bg-white dark:hover:bg-opacity-20 cursor-pointer text-gray-900 dark:text-white rounded px-1 h-8 flex items-center text-base group",{"bg-black bg-opacity-20 dark:bg-white dark:bg-opacity-20":Be},H&&"text-opacity-40 dark:text-opacity-40")},a.createElement("div",{className:(0,n.Z)("flex items-center justify-center px-1 mr-1")},q),a.createElement(de.Z.Text,{className:(0,n.Z)("flex-1 text-gray-900 dark:text-white",H&&"text-opacity-40 dark:text-opacity-40"),ellipsis:!0},k),a.createElement(Fe.Z,null,fe===!0&&a.createElement(xe.Z,He({status:"error"},R.badgeProps)),R.extraBadge)))});$e.displayName="GroupPanelItem";var Xe=e(22215);const Qe=a.memo(R=>{var q;const{groupId:k,panel:V}=R,H=V.id,fe=(0,t.EP)(H),pe=(0,Xe.rF)(k,H,(q=V.pluginPanelName)!=null?q:""),{checkIsMuted:Be}=(0,t.OqL)(),Ne=Be(H,k);return a.createElement($e,{name:V.name,icon:R.icon,to:`/main/group/${k}/${V.id}`,dimmed:Ne,badge:fe,badgeProps:{status:Ne?"default":"error"},extraBadge:pe})});Qe.displayName="GroupAckPanelItem";var Ye=e(96136),se=e(86724),_=e.n(se),ue=e(103),Oe=e(38887),Ue=e(35633);const Re=a.memo(R=>{var q;const{groupId:k,panel:V}=R,H=V.id,{hasOpenedPanel:fe,openPanelWindow:pe}=(0,ue.l)(`/panel/group/${k}/${H}`),Be=(0,t.iFL)(k),Ne=(0,t.TL5)(),{markConverseAllAck:Le}=(0,t.hoD)(H),Ge=(0,Xe.Sp)(V),ve=(0,Xe.rF)(k,H,(q=V.pluginPanelName)!=null?q:""),{checkIsMuted:P,toggleMute:b}=(0,t.OqL)();if(!Be)return a.createElement(Oe.T,null);const S=(0,t.YQu)(Be.pinnedPanelId)&&Be.pinnedPanelId===H,ce={items:U()([{key:"copy",label:(0,t.t)("\u590D\u5236\u94FE\u63A5"),icon:a.createElement(z.JO,{icon:"mdi:content-copy"}),onClick:()=>{_()(`${location.origin}/main/group/${k}/${H}`),(0,t.lHp)((0,t.t)("\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"))}},{key:"new",label:(0,t.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),icon:a.createElement(z.JO,{icon:"mdi:dock-window"}),disabled:fe,onClick:pe},S?{key:"unpin",label:(0,t.t)("Unpin"),icon:a.createElement(z.JO,{icon:"mdi:pin-off"}),onClick:()=>{Ne(t.hyC.unpinGroupPanel({groupId:k}))}}:{key:"pin",label:(0,t.t)("Pin"),icon:a.createElement(z.JO,{icon:"mdi:pin"}),onClick:()=>{Ne(t.hyC.pinGroupPanel({groupId:k,panelId:H}))}},V.type===t.Xpe.TEXT&&{key:"markAsRead",label:(0,t.t)("\u6807\u8BB0\u4E3A\u5DF2\u8BFB"),icon:a.createElement(z.JO,{icon:"mdi:message-badge-outline"}),onClick:Le},V.type===t.Xpe.TEXT&&{key:"mute",label:P(H,k)?(0,t.t)("\u53D6\u6D88\u514D\u6253\u6270"):(0,t.t)("\u514D\u6253\u6270"),icon:a.createElement(z.JO,{icon:"mdi:bell-off-outline"}),onClick:()=>b(H)},...Ge])},X=S?a.createElement(z.JO,{icon:"mdi:pin"}):a.createElement(z.JO,{icon:"mdi:pound"});return a.createElement(Ye.Z,{menu:ce,trigger:["contextMenu"]},a.createElement("div",null,(0,Ue.Q)(V)?a.createElement(Qe,{icon:X,groupId:k,panel:V}):a.createElement($e,{name:V.name,icon:X,to:`/main/group/${k}/${H}`,extraBadge:ve})))});Re.displayName="SidebarItem";const we=a.memo(()=>{var R;const{groupId:q=""}=(0,F.useParams)(),k=(0,t.iFL)(q),V=(R=k==null?void 0:k.panels)!=null?R:[];return a.createElement(me.L,{"data-tc-role":"sidebar-group"},a.createElement(Z,{groupId:q}),a.createElement("div",{className:"p-2 space-y-1 overflow-auto"},V.filter(H=>!(0,t.YQu)(H.parentId)).map(H=>H.type===t.Xpe.GROUP?a.createElement(le,{key:H.id,header:H.name},V.filter(fe=>fe.parentId===H.id).map(fe=>a.createElement(Re,{key:fe.id,groupId:q,panel:fe}))):a.createElement(Re,{key:H.id,groupId:q,panel:H}))))});we.displayName="Sidebar";const ke=a.memo(()=>{const{groupId:R=""}=(0,F.useParams)(),q=(0,t.iFL)(R);if(!q)return a.createElement(r.t,{text:(0,t.t)("\u7FA4\u7EC4\u672A\u627E\u5230")});const k=q.pinnedPanelId,V=a.createElement(F.Routes,null,a.createElement(F.Route,{path:"/:panelId",element:a.createElement(p.x,null)}),a.createElement(F.Route,{path:"/",element:a.createElement(M,null)}));return a.createElement(A.A,{value:R},a.createElement(G.J,{"data-tc-role":"content-group",sidebar:a.createElement(we,null)},(0,t.YQu)(k)?a.createElement(l,{className:"flex-auto w-full"},a.createElement("div",null,V),a.createElement("div",null,a.createElement(p.E,{groupId:R,panelId:k}))):V))});ke.displayName="Group"},12492:(Me,Q,e)=>{e.d(Q,{J:()=>w});var r=e(52983),n=e(58935),a=e(14698),s=e.n(a),t=e(59270),l=e(89935),A=e(14517),F=e(67706),G=e(30831),p=Object.defineProperty,g=Object.defineProperties,N=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,U=(y,I,d)=>I in y?p(y,I,{enumerable:!0,configurable:!0,writable:!0,value:d}):y[I]=d,K=(y,I)=>{for(var d in I||(I={}))M.call(I,d)&&U(y,d,I[d]);if(L)for(var d of L(I))x.call(I,d)&&U(y,d,I[d]);return y},Y=(y,I)=>g(y,N(I)),j=(y,I)=>{var d={};for(var O in y)M.call(y,O)&&I.indexOf(O)<0&&(d[O]=y[O]);if(y!=null&&L)for(var O of L(y))I.indexOf(O)<0&&x.call(y,O)&&(d[O]=y[O]);return d};const ie=y=>{var I=y,{className:d,style:O,children:Z}=I,z=j(I,["className","style","children"]);return r.createElement("div",Y(K({},z),{style:O,className:(0,A.Z)("flex flex-row flex-1 overflow-hidden relative",d)}),Z)},ee=r.memo(y=>{const{setShowSidebar:I}=(0,n.S)(),d=(0,t.useDrag)(O=>{const{swipe:Z}=O,z=Z[0];z>0?I(!0):z<0&&I(!1)},{axis:"x",swipe:{distance:5}});return r.createElement(ie,K({style:{touchAction:"pan-x"}},d()),y.children)});ee.displayName="PageGestureWrapper";const w=r.memo(y=>{const{sidebar:I,children:d}=y,{showSidebar:O,setShowSidebar:Z}=(0,n.S)(),z=(0,l.d)(),le=(0,r.useCallback)(Se=>{Se.stopPropagation(),Se.preventDefault(),Z(!1)},[]);(0,G.qoQ)([z],()=>{z===!1&&Z(!0)});const me=s()(I)?null:r.createElement("div",{className:(0,A.Z)("bg-sidebar-light dark:bg-sidebar-dark flex-shrink-0 transition-width w-60")},y.sidebar),de=z===!0&&O===!0&&!s()(me),Fe=de?r.createElement("div",{className:"absolute right-0 top-0 bottom-0 z-10",style:{width:"calc(100% - 15rem)"},onClick:le}):null,xe=d,be=r.createElement(F.S,null,me,Fe,r.createElement("div",{className:(0,A.Z)("flex flex-auto bg-content-light dark:bg-content-dark overflow-hidden",z&&"transform left-0 w-full h-full absolute transition-transform",z&&{"translate-x-60":O,"translate-x-0":!O}),"data-tc-role":y["data-tc-role"]},r.createElement("div",{className:"tc-content-background"}),r.createElement("div",{className:(0,A.Z)("flex relative w-full",{"overflow-auto":!de,"overflow-hidden":de})},r.createElement(F.S,null,xe))));return z?r.createElement(ee,null,be):r.createElement(ie,null,be)});w.displayName="PageContent"},14231:(Me,Q,e)=>{e.d(Q,{d:()=>y});var r=e(64939),n=e(21506),a=e(9021),s=e(52983),t=e(30831),l=e(712),A=e(6494),F=e.n(A),G=e(84208),p=e(75526),g=e(2945),N=(I,d,O)=>new Promise((Z,z)=>{var le=Fe=>{try{de(O.next(Fe))}catch(xe){z(xe)}},me=Fe=>{try{de(O.throw(Fe))}catch(xe){z(xe)}},de=Fe=>Fe.done?Z(Fe.value):Promise.resolve(Fe.value).then(le,me);de((O=O.apply(I,d)).next())});const L=s.memo(I=>{const{converseId:d,withoutUserIds:O=[]}=I,[Z,z]=(0,s.useState)([]),[{loading:le},me]=(0,t.ilX)(()=>N(void 0,null,function*(){yield(0,t.m8p)(d,[...Z]),(0,G.Mr)()}),[d,Z]);return s.createElement(G.AB,{title:(0,t.t)("\u9080\u8BF7\u597D\u53CB\u52A0\u5165\u4F1A\u8BDD")},s.createElement(g.B,{withoutUserIds:O,selectedIds:Z,onChange:z}),s.createElement("div",{className:"text-right"},s.createElement(p.Z,{type:"primary",loading:le,onClick:me},(0,t.t)("\u786E\u8BA4"))))});L.displayName="AppendDMConverseMembers";var M=e(103),x=e(87179),U=e(84143),K=e(7975),Y=e(50093);const j=s.memo(({converse:I})=>{const d=(0,t.Y84)(I);return(0,t.t)("\u4E0E {{name}} \u7684\u4F1A\u8BDD",{name:d})});j.displayName="ConversePanelTitle";const ie=s.memo(({members:I})=>s.createElement("div",null,I.map(d=>s.createElement(a.Q,{key:d,userId:d}))));ie.displayName="ConversePanelMembers";const ee=s.memo(({converseId:I})=>{const d=(0,t.CGy)(me=>me.chat.converses[I]),{hasOpenedPanel:O,openPanelWindow:Z,closePanelWindow:z}=(0,M.l)(`/panel/personal/converse/${I}`);if(O)return s.createElement(x.x,{onClosePanelWindow:z});const le=d&&s.createElement(j,{converse:d});return s.createElement(l.S,{header:le,actions:({setRightPanel:me})=>d?F()([...K.pluginPanelActions.filter(de=>de.position==="dm").map(de=>s.createElement(U.a,{key:de.name,title:de.label,shape:"square",icon:de.icon,iconClassName:"text-2xl",onClick:()=>de.onClick({converseId:I})})),s.createElement(U.a,{key:"open",title:(0,t.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),shape:"square",icon:"mdi:dock-window",iconClassName:"text-2xl",onClick:Z}),d.members.length===2?s.createElement(U.a,{key:"create",title:(0,t.t)("\u521B\u5EFA\u4F1A\u8BDD"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,G.h7)(s.createElement(Y.m,{hiddenUserIds:d.members}))}):s.createElement(U.a,{key:"add",title:(0,t.t)("\u9080\u8BF7\u6210\u5458"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,G.h7)(s.createElement(L,{converseId:d._id,withoutUserIds:d.members}))}),d.members.length>2&&s.createElement(U.a,{key:"members",title:(0,t.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>me({name:(0,t.t)("\u6210\u5458")+` (${d.members.length})`,panel:s.createElement(ie,{members:d.members})})})]):[]},s.createElement(n.r,{converseId:I,converseTitle:le,isGroup:!1}))});ee.displayName="ConversePanel";var w=e(54782);const y=s.memo(()=>{const I=(0,w.useParams)();return I.converseId?s.createElement(ee,{converseId:I.converseId}):s.createElement(r.T,null)});y.displayName="PersonalConverse"},7364:(Me,Q,e)=>{e.d(Q,{l:()=>U});var r=e(30831),n=e(52983),a=e(38887),s=e(21848),t=e(14698),l=e.n(t),A=e(54782),F=e(58935),G=e(442),p=e(5198),g=e(96857),N=e(6739),L=e(13893),M=(K,Y,j)=>new Promise((ie,ee)=>{var w=d=>{try{I(j.next(d))}catch(O){ee(O)}},y=d=>{try{I(j.throw(d))}catch(O){ee(O)}},I=d=>d.done?ie(d.value):Promise.resolve(d.value).then(w,y);I((j=j.apply(K,Y)).next())});function x(){const K=(0,A.useNavigate)(),{value:Y,loading:j,error:ie}=(0,r.r53)(()=>M(this,null,function*(){let y;try{y=yield(0,s.gP)()}catch(O){K(`/entry/login?redirect=${encodeURIComponent(location.pathname)}`,{replace:!0});return}const I=(0,r.vIP)();I.dispatch(r.hIH.setUserInfo(y)),(0,p._3)(I);const d=yield(0,r.Tzh)(y.token);return(0,p.Kj)(d),(0,r.cUn)(d,I),{store:I,socket:d}}),[]),ee=Y==null?void 0:Y.store,w=Y==null?void 0:Y.socket;return{loading:j,store:ee,socket:w,error:ie}}const U=n.memo(K=>{const{loading:Y,store:j,error:ie,socket:ee}=x();return Y?n.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-content-light dark:bg-content-dark text-gray-700 dark:text-white text-xl"},n.createElement(a.T,{tip:(0,r.t)("\u6B63\u5728\u8FDE\u63A5\u5230\u804A\u5929\u670D\u52A1\u5668...")})):ie?(console.error("[MainProvider]",ie),n.createElement("div",null,ie.message)):l()(j)?n.createElement(N.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Store \u521B\u5EFA\u5931\u8D25")}):l()(ee)?n.createElement(N.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Socket \u521B\u5EFA\u5931\u8D25")}):n.createElement(r.m$Z,{store:j},n.createElement(g.Z,{socket:ee},n.createElement(F.f,null,n.createElement(L.L,null,n.createElement(G.$2,null,K.children)))))});U.displayName="MainProvider"},58935:(Me,Q,e)=>{e.d(Q,{S:()=>l,f:()=>t});var r=e(52983),n=e(71607),a=e.n(n);const s=r.createContext({showSidebar:!0,switchSidebar:a(),setShowSidebar:a()});s.displayName="SidebarContext";const t=r.memo(A=>{const[F,G]=(0,r.useState)(!0),p=(0,r.useCallback)(()=>{G(!F)},[F]);return r.createElement(s.Provider,{value:{showSidebar:F,switchSidebar:p,setShowSidebar:G}},A.children)});t.displayName="SidebarContextProvider";function l(){return(0,r.useContext)(s)}},35633:(Me,Q,e)=>{e.d(Q,{Q:()=>a});var r=e(30831),n=e(89889);function a(s){var t,l;if(s.type===r.Xpe.TEXT)return!0;if(s.type===r.Xpe.PLUGIN){const A=(0,n.S)(s.name);return(l=(t=A==null?void 0:A.feature)==null?void 0:t.includes("ack"))!=null?l:!1}return!1}},64750:(Me,Q,e)=>{e.d(Q,{$:()=>a,Hi:()=>s,dq:()=>l,er:()=>t,rR:()=>n});var r=e(79172);const n=(0,r.P6)("enter"),a=(0,r.P6)("esc"),s=(0,r.P6)("mod+k"),t=(0,r.P6)("up"),l=(0,r.P6)("down")},83996:(Me,Q,e)=>{e.d(Q,{f:()=>s,w:()=>t});var r=e(30831),n=(l,A,F)=>new Promise((G,p)=>{var g=M=>{try{L(F.next(M))}catch(x){p(x)}},N=M=>{try{L(F.throw(M))}catch(x){p(x)}},L=M=>M.done?G(M.value):Promise.resolve(M.value).then(g,N);L((F=F.apply(l,A)).next())});function a(l){return n(this,null,function*(){const A=document.createElement("img");return new Promise((F,G)=>{A.onload=()=>F(A),A.onerror=G,A.src=(0,r.Awg)(l),A.crossOrigin="Anonymous"})})}function s(l){return n(this,null,function*(){const A=yield a(l),F=document.createElement("canvas");F.width=A.width,F.height=A.height;const G=F.getContext("2d");if(!G)return{r:0,g:0,b:0,a:0};G.drawImage(A,0,0,F.width,F.height);const p=G.getImageData(0,0,F.width,F.height);let g=0,N=0,L=0,M=0;for(let U=0;U<p.height;U++)for(let K=0;K<p.width;K++)g+=p.data[(p.width*U+K)*4],N+=p.data[(p.width*U+K)*4+1],L+=p.data[(p.width*U+K)*4+2],M+=p.data[(p.width*U+K)*4+3];const x=p.width*p.height;return g=Math.round(g/x),N=Math.round(N/x),L=Math.round(L/x),M=Math.round(M/x),{r:g,g:N,b:L,a:M}})}function t(l){return!["image/gif"].includes(l)}},21848:(Me,Q,e)=>{e.d(Q,{JM:()=>p,gP:()=>G,rU:()=>A});var r=e(30831),n=e(14698),a=e.n(n),s=e(87450),t=(g,N,L)=>new Promise((M,x)=>{var U=j=>{try{Y(L.next(j))}catch(ie){x(ie)}},K=j=>{try{Y(L.throw(j))}catch(ie){x(ie)}},Y=j=>j.done?M(j.value):Promise.resolve(j.value).then(U,K);Y((L=L.apply(g,N)).next())});let l=null;function A(g){l=g}function F(){return l}function G(){return t(this,null,function*(){let g=F();if(a()(g)){const N=yield(0,s.pT)();if(typeof N!="string")throw new Error("Token \u683C\u5F0F\u4E0D\u5408\u6CD5");if(console.debug("\u6B63\u5728\u5C1D\u8BD5\u4F7F\u7528Token\u767B\u5F55"),g=yield r.o4J.EA.loginWithToken(N),g===null)throw new Error("Token \u5185\u5BB9\u4E0D\u5408\u6CD5");A(g)}return g})}function p(g){if(typeof g!="string")return!0;const N=g.split("@")[1];return!!(!N||N.endsWith(".msgbyte.com"))}}}]);
