"use strict";(self.webpackChunktailchat_web=self.webpackChunktailchat_web||[]).push([[179],{61500:(re,L,m)=>{m.d(L,{R$:()=>k,SH:()=>E,Ux:()=>e});var t=m(52983),C=m(54782),y=m(30831);const e=t.memo(p=>{const h=(0,C.useNavigate)();return t.createElement("div",{className:"absolute bottom-4 left-0 right-0 text-center"},t.createElement("div",{className:"shadow-lg px-6 py-2 rounded-full inline-block bg-indigo-600 hover:bg-indigo-700 text-white cursor-pointer",onClick:()=>{h(p.link)}},p.text))});e.displayName="JumpToButton";const E=t.memo(p=>{const h=`/main/group/${p.groupId}/${p.panelId}`;return t.createElement(e,{link:h,text:(0,y.t)("\u8DF3\u8F6C\u5230\u9762\u677F")})});E.displayName="JumpToGroupPanelButton";const k=t.memo(p=>{const h=p.groupId?`/main/group/${p.groupId}/${p.converseId}`:`/main/personal/converse/${p.converseId}`;return t.createElement(e,{link:h,text:(0,y.t)("\u8DF3\u8F6C\u5230\u4F1A\u8BDD")})});k.displayName="JumpToConverseButton"},37034:(re,L,m)=>{m.d(L,{S:()=>B});var t=m(73246),C=m(52983),y=m(30831),e=Object.defineProperty,E=Object.defineProperties,k=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,w=(N,F,A)=>F in N?e(N,F,{enumerable:!0,configurable:!0,writable:!0,value:A}):N[F]=A,D=(N,F)=>{for(var A in F||(F={}))h.call(F,A)&&w(N,A,F[A]);if(p)for(var A of p(F))U.call(F,A)&&w(N,A,F[A]);return N},$=(N,F)=>E(N,k(F));const B=C.memo(N=>{const{language:F,setLanguage:A}=(0,y.ZKp)(),Y=(0,C.useCallback)(q=>{(0,y.lHp)((0,y.t)("\u5237\u65B0\u9875\u9762\u540E\u751F\u6548"),"info"),A(q)},[A]);return C.createElement(t.Z,$(D({style:{width:280},size:"large"},N),{value:F,onChange:Y}),C.createElement(t.Z.Option,{value:"zh-CN"},"\u7B80\u4F53\u4E2D\u6587"),C.createElement(t.Z.Option,{value:"en-US"},"English"))});B.displayName="LanguageSelect"},59412:(re,L,m)=>{m.d(L,{U:()=>h});var t=m(72297),C=m(52983),y=m(30831),e=m(80474),E=m(93540),k=m(66175);const p=(0,e.P)(()=>Promise.all([m.e(594),m.e(20)]).then(m.bind(m,28020))),h=C.memo(({raw:U,baseUrl:w})=>{const D=(0,C.useCallback)(B=>(0,y.YQu)(w)?new URL(B,(0,t.W8)(w)).href:B,[w]),$=(0,C.useMemo)(()=>({img:B=>C.createElement(E.Ee,{src:B.src,preview:!0})}),[]);return C.createElement(p,{className:"tailchat-markdown",transformImageUri:B=>D(B),transformLinkUri:B=>D(B),remarkPlugins:[k.Z],linkTarget:"_blank",skipHtml:!0,components:$},U)});h.displayName="Markdown"},5995:(re,L,m)=>{m.r(L),m.d(L,{default:()=>Da});var t=m(30831);const C=(0,t.fA3)(()=>localStorage);var y=m(75526),e=m(52983),E=m(93540);const k=e.memo(()=>{const n=(0,t.tR0)(r=>r.announcement),[l,a]=C("ackGlobalAnnouncement");return!n||l===n.id?null:e.createElement("div",{className:"text-center bg-indigo-400 text-white relative px-6"},e.createElement("span",{className:"select-text"},n.text),n.link&&e.createElement(y.Z,{type:"link",className:"text-indigo-700 font-bold ml-2",size:"small",onClick:()=>window.open(n.link)},(0,t.t)("\u4E86\u89E3\u66F4\u591A")),e.createElement(E.JO,{className:"absolute top-0.5 right-1 opacity-80 hover:opacity-100 cursor-pointer text-xl",icon:"mdi:close-circle-outline",onClick:()=>a(n.id)}))});k.displayName="GlobalAnnouncementBar";var p=m(7975),h=m(84208),U=m(87450),w=m(21848),D=m(79546),$=m(6494),B=m.n($),N=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const F=()=>B()([{type:"text",name:"email",label:(0,t.t)("\u90AE\u7BB1")},(0,t.HiA)().emailVerification&&{type:"custom",name:"emailOTP",label:(0,t.t)("\u90AE\u7BB1\u6821\u9A8C\u7801"),render:n=>{var l;const a=(0,E.aG)(),r=(l=a==null?void 0:a.values)==null?void 0:l.email,[s,o]=(0,e.useState)(!1),[{loading:d},c]=(0,t.CoE)(()=>N(void 0,null,function*(){if(!r){(0,t.hJM)((0,t.t)("\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A"));return}yield t.o4J.EA.verifyEmail(r),o(!0)}),[r]);return e.createElement(D.Z.Group,{compact:!0,style:{display:"flex"}},e.createElement(D.Z,{size:"large",name:n.name,value:n.value,placeholder:(0,t.t)("6\u4F4D\u6821\u9A8C\u7801"),onChange:u=>n.onChange(u.target.value)}),!s&&e.createElement(y.Z,{size:"large",type:"primary",htmlType:"button",disabled:d,loading:d,onClick:u=>{u.preventDefault(),c()}},(0,t.t)("\u53D1\u9001\u6821\u9A8C\u7801")))}},{type:"password",name:"password",label:(0,t.t)("\u5BC6\u7801")}]),A=(0,E._D)({email:E._6.string().required((0,t.t)("\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A")).email((0,t.t)("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E")).max(40,(0,t.t)("\u90AE\u7BB1\u6700\u957F\u9650\u523640\u4E2A\u5B57\u7B26")),password:E._6.string().required((0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A")).min(6,(0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4F4E\u4E8E6\u4F4D")).max(40,(0,t.t)("\u5BC6\u7801\u6700\u957F\u9650\u523640\u4E2A\u5B57\u7B26")),emailOTP:E._6.string().length(6,(0,t.t)("\u6821\u9A8C\u7801\u4E3A6\u4F4D"))}),Y=e.memo(n=>{const l=n.userId,a=(0,t.TL5)(),r=(0,e.useMemo)(()=>F(),[]),[{},s]=(0,t.CoE)(o=>N(void 0,null,function*(){const d=yield(0,t.xuY)(l,o.email,o.password,o.emailOTP);(0,w.rU)(d),yield(0,U._H)(d.token),a(t.hIH.setUserInfo(d)),typeof n.onSuccess=="function"&&n.onSuccess()}),[l,n.onSuccess]);return e.createElement(h.AB,{title:(0,t.t)("\u8BA4\u9886\u8D26\u53F7")},e.createElement(E.Po,{schema:A,fields:r,onSubmit:s}))});Y.displayName="ClaimTemporaryUser";const q=e.memo(()=>{const n=(0,t.Pc$)(),l=(n==null?void 0:n.temporary)===!0,a=(0,e.useCallback)(()=>{if(!(n==null?void 0:n._id))return;const r=(0,p.openModal)(e.createElement(Y,{userId:n._id,onSuccess:()=>(0,h.Mr)(r)}))},[n==null?void 0:n._id]);return l?e.createElement("div",{className:"text-center bg-indigo-400 text-white"},e.createElement(t.cCv,null,"\u5F53\u524D\u4F7F\u7528\u7684\u662F\u4E00\u4E2A\u4E34\u65F6\u8D26\u53F7,"," ",e.createElement(y.Z,{type:"link",className:"text-indigo-700 font-bold",size:"small",onClick:a},"\u7ACB\u5373\u8BA4\u9886"))):null});q.displayName="GlobalTemporaryTip";var _=m(82335),ve=m(67706),jt=m(95483),g=m(54782),pe=m(12492),$t=m(14231),se=m(83667),I=m(75217),M=m(75283),zt=m(14698),Vt=m.n(zt),Ht=m(15333),ye=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const fe=e.memo(({result:n})=>{const[l,a]=(0,e.useState)(""),r=(0,e.useCallback)(o=>ye(void 0,null,function*(){try{yield(0,t.vAN)(o),a(o),(0,t.lHp)((0,t.t)("\u5DF2\u53D1\u9001\u7533\u8BF7"),"success")}catch(d){(0,t.hJM)(d)}}),[]);if(n===void 0)return null;if(n===null)return e.createElement(Ht.J,null);const s=l===n._id;return e.createElement("div",null,e.createElement(I.Z,null),e.createElement("div",{className:"rounded-md border border-black border-opacity-30 px-4 py-3 bg-black bg-opacity-10 flex justify-between items-center mobile:flex-col"},e.createElement("div",{className:"mobile:w-full mobile:mb-1"},e.createElement(E.qE,{className:"mb-3",size:60,name:n.nickname,src:n.avatar}),e.createElement("div",{className:"text-lg"},n.nickname,e.createElement("span",{className:"text-opacity-60 text-sm text-white"},"#",n.discriminator))),e.createElement(y.Z,{type:"primary",className:"bg-green-600 border-0 mobile:w-full",disabled:s,onClick:()=>r(n._id)},s?(0,t.t)("\u5DF2\u7533\u8BF7"):(0,t.t)("\u7533\u8BF7\u597D\u53CB"))))});fe.displayName="SearchFriendResult";const he=e.memo(()=>{const n=(0,t.CGy)(a=>a.user.info),l=`${n==null?void 0:n.nickname}#${n==null?void 0:n.discriminator}`;return e.createElement("div",null,e.createElement(I.Z,null),e.createElement("div",{className:"rounded-md border border-black border-opacity-30 px-4 py-3 bg-black bg-opacity-10 text-center"},e.createElement("div",null,(0,t.t)("\u60A8\u7684\u4E2A\u4EBA\u552F\u4E00\u6807\u8BC6")),e.createElement(M.Z.Title,{level:4,copyable:!0,className:"select-text"},l)))});he.displayName="SelfIdentify";const ge=e.memo(()=>{const[n,l]=(0,e.useState)(""),[{loading:a,value:r},s]=(0,t.ilX)(()=>ye(void 0,null,function*(){try{const o=yield(0,t.eGN)(n);return o===null&&(0,t.lHp)((0,t.t)("\u6CA1\u6709\u627E\u5230\u8BE5\u7528\u6237"),"warning"),o}catch(o){(0,t.hJM)(o)}}),[n]);return e.createElement("div",{className:"px-8 py-2"},e.createElement("div",{className:"text-lg my-2"},(0,t.t)("\u6DFB\u52A0\u597D\u53CB")),e.createElement("div",{className:"my-1"},e.createElement(t.cCv,null,"\u60A8\u53EF\u4EE5\u4F7F\u7528\u5B8C\u6574\u7684 ",e.createElement(E.y$,null,"\u7528\u6237\u6635\u79F0#\u6807\u8BC6")," \u6765\u6DFB\u52A0\u597D\u53CB")),e.createElement("div",{className:"px-4 py-2 my-3 flex border border-black border-opacity-30 rounded items-center bg-black bg-opacity-10 mobile:flex-col"},e.createElement("input",{className:"bg-transparent flex-1 text-base leading-9 outline-none mobile:w-full mobile:mb-1",placeholder:(0,t.t)("\u7528\u6237\u6635\u79F0#0000"),onChange:o=>l(o.target.value)}),e.createElement(y.Z,{type:"primary",className:"bg-indigo-600 disabled:opacity-80 border-none mobile:w-full",disabled:n==="",loading:a,onClick:s},(0,t.t)("\u67E5\u627E\u597D\u53CB"))),Vt()(r)?e.createElement(he,null):e.createElement(fe,{result:r}))});ge.displayName="AddFriend";var z=m(84143),oe=m(9021),V=m(95268),x=m(6739),Wt=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const Fe=e.memo(n=>{const[{loading:l},a]=(0,t.ilX)(r=>Wt(void 0,null,function*(){yield(0,t.J3N)(r)}),[]);return n.requests.length===0?e.createElement(x.t,{text:(0,t.t)("\u6682\u65E0\u5DF2\u53D1\u9001\u7684\u597D\u53CB\u8BF7\u6C42")}):e.createElement("div",{className:"py-2.5 px-5"},e.createElement("div",null,(0,t.t)("\u7B49\u5F85\u5BF9\u65B9\u5904\u7406\u7684\u597D\u53CB\u8BF7\u6C42"),":"),e.createElement("div",null,n.requests.map(({_id:r,to:s})=>e.createElement(oe.Q,{key:s,userId:s,actions:[e.createElement(V.Z,{key:"cancel",title:(0,t.t)("\u53D6\u6D88")},e.createElement("div",null,e.createElement(z.a,{icon:"mdi:close",disabled:l,onClick:()=>a(r)})))]}))))});Fe.displayName="RequestSend";var be=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const Ce=e.memo(n=>{const[{loading:l},a]=(0,t.CoE)(d=>be(void 0,null,function*(){yield(0,t.NDn)(d)}),[]),[{loading:r},s]=(0,t.CoE)(d=>be(void 0,null,function*(){yield(0,t.K_u)(d)}),[]);if(n.requests.length===0)return e.createElement(x.t,{text:(0,t.t)("\u6682\u65E0\u5F85\u5904\u7406\u7684\u597D\u53CB\u8BF7\u6C42")});const o=l||r;return e.createElement("div",{className:"py-2.5 px-5"},e.createElement("div",null,(0,t.t)("\u7B49\u5F85\u5904\u7406\u7684\u597D\u53CB\u8BF7\u6C42"),":"),e.createElement("div",null,n.requests.map(({_id:d,from:c})=>e.createElement(oe.Q,{key:c,userId:c,actions:[e.createElement(V.Z,{key:"accept",title:(0,t.t)("\u63A5\u53D7")},e.createElement("div",null,e.createElement(z.a,{icon:"mdi:check",disabled:o,onClick:()=>a(d)}))),e.createElement(V.Z,{key:"deny",title:(0,t.t)("\u62D2\u7EDD")},e.createElement("div",null,e.createElement(z.a,{icon:"mdi:close",disabled:o,onClick:()=>s(d)})))]}))))});Ce.displayName="RequestReceived";var Ae=m(96136),Be=m(58761),Qt=Object.defineProperty,Xt=Object.defineProperties,Kt=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Yt=Object.prototype.hasOwnProperty,qt=Object.prototype.propertyIsEnumerable,De=(n,l,a)=>l in n?Qt(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a,_t=(n,l)=>{for(var a in l||(l={}))Yt.call(l,a)&&De(n,a,l[a]);if(Ne)for(var a of Ne(l))qt.call(l,a)&&De(n,a,l[a]);return n},en=(n,l)=>Xt(n,Kt(l)),tn=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const xe=e.memo(n=>{const[l,a]=(0,e.useState)(!1);return e.createElement(y.Z,en(_t({loading:l},n),{onClick:r=>tn(void 0,null,function*(){n.onClick&&(a(!0),yield n.onClick(r),a(!1))})}))});xe.displayName="SubmitButton";var nn=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const Pe=e.memo(n=>{var l;const a=(0,t.xzJ)(n.userId),r=(0,t.CGy)(u=>u.user.friends.find(i=>i.id===n.userId)),s=(0,t.TL5)(),[o,d]=(0,e.useState)((l=r==null?void 0:r.nickname)!=null?l:""),[,c]=(0,t.CoE)(()=>nn(void 0,null,function*(){var u;yield t.o4J.r9.setFriendNickname(n.userId,o),s(t.hIH.setFriendNickname({friendId:n.userId,nickname:o})),(u=n.onSuccess)==null||u.call(n)}),[n.userId,n.onSuccess,o]);return r?e.createElement(h.AB,{title:(0,t.YQu)(r.nickname)?(0,t.t)("\u66F4\u6539\u597D\u53CB\u6635\u79F0"):(0,t.t)("\u6DFB\u52A0\u597D\u53CB\u6635\u79F0")},e.createElement(Be.Z,{direction:"vertical",style:{width:"100%"}},e.createElement("p",null,(0,t.t)("\u4F7F\u7528\u4E2A\u4EBA\u6635\u79F0\u66F4\u5FEB\u5730\u627E\u5230\u597D\u53CB\u3002\u4EC5\u60A8\u81EA\u5DF1\u53EF\u89C1\u3002")),e.createElement(D.Z,{placeholder:a.nickname,value:o,onChange:u=>d(u.target.value)}),e.createElement(y.Z,{type:"text",onClick:()=>d("")},(0,t.t)("\u91CD\u7F6E\u597D\u53CB\u6635\u79F0")),e.createElement(xe,{type:"primary",block:!0,size:"large",onClick:c},(0,t.t)("\u786E\u8BA4")))):e.createElement(x.t,{text:(0,t.t)("\u6CA1\u6709\u627E\u5230\u8BE5\u7528\u6237\u4FE1\u606F, \u53EF\u80FD\u51FA\u73B0\u4E86\u4E00\u4E9B\u5F02\u5E38")})});Pe.displayName="SetFriendNickname";var ee=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const Se=e.memo(n=>{const l=(0,t.CGy)(u=>u.user.friends),a=(0,g.useNavigate)(),r=(0,t.TL5)(),s=(0,t.tR0)(u=>u.disableAddFriend),[,o]=(0,t.CoE)(u=>ee(void 0,null,function*(){const i=yield(0,t.L1i)([u]);a(`/main/personal/converse/${i._id}`)}),[a]),d=(0,t.zX9)(u=>ee(void 0,null,function*(){const i=(0,h.h7)(e.createElement(Pe,{userId:u,onSuccess:()=>{(0,h.Mr)(i)}}))})),c=(0,t.zX9)(u=>ee(void 0,null,function*(){(0,t.wp$)({message:(0,t.t)("\u662F\u5426\u8981\u4ECE\u81EA\u5DF1\u7684\u597D\u53CB\u5217\u8868\u4E2D\u5220\u9664\u5BF9\u65B9? \u6CE8\u610F:\u4F60\u4E0D\u4F1A\u4ECE\u5BF9\u65B9\u7684\u597D\u53CB\u5217\u8868\u6D88\u5931"),onConfirm:()=>ee(void 0,null,function*(){try{yield(0,t.tJD)(u),(0,t.lHp)((0,t.t)("\u597D\u53CB\u5220\u9664\u6210\u529F"),"success"),r(t.hIH.removeFriend(u))}catch(i){(0,t.hJM)(i)}})})}));return l.length===0?e.createElement(x.t,{text:e.createElement("div",null,e.createElement("p",{className:"mb-2"},(0,t.t)("\u6682\u65E0\u597D\u53CB")),!s&&e.createElement(y.Z,{type:"primary",onClick:n.onSwitchToAddFriend},(0,t.t)("\u7ACB\u5373\u6DFB\u52A0")))}):e.createElement("div",{className:"py-2.5 px-5"},e.createElement("div",null,(0,t.t)("\u597D\u53CB\u5217\u8868")),e.createElement("div",null,l.map(u=>e.createElement(oe.Q,{key:u.id,userId:u.id,actions:[e.createElement(V.Z,{key:"message",title:(0,t.t)("\u53D1\u9001\u6D88\u606F")},e.createElement("div",null,e.createElement(z.a,{icon:"mdi:message-text-outline",onClick:()=>o(u.id)}))),e.createElement("div",{key:"more"},e.createElement(Ae.Z,{menu:{items:[{key:"setNickname",onClick:()=>d(u.id),label:(0,t.YQu)(u.nickname)?(0,t.t)("\u66F4\u6539\u597D\u53CB\u6635\u79F0"):(0,t.t)("\u6DFB\u52A0\u597D\u53CB\u6635\u79F0")},{key:"delete",danger:!0,onClick:()=>c(u.id),label:(0,t.t)("\u5220\u9664")}]},trigger:["click"],placement:"bottomRight"},e.createElement("div",null,e.createElement(z.a,{icon:"mdi:dots-vertical"}))))]}))))});Se.displayName="FriendList";var H=m(68e3);const we=e.memo(()=>{const n=(0,t.CGy)(u=>u.user.friendRequests),l=(0,t.CGy)(u=>{var i;return(i=u.user.info)==null?void 0:i._id}),[a,r]=(0,e.useState)("1"),s=(0,t.tR0)(u=>u.disableAddFriend),o=n.filter(u=>u.from===l),d=n.filter(u=>u.to===l),c=(0,e.useCallback)(()=>{r("4")},[]);return e.createElement("div",{className:"w-full"},e.createElement(se.N,{activeKey:a,onChange:r,items:B()([{key:"1",label:(0,t.t)("\u5168\u90E8"),children:e.createElement(Se,{onSwitchToAddFriend:c})},!s&&{key:"2",label:e.createElement(H.Z,{className:"text-black dark:text-white",size:"small",count:o.length},(0,t.t)("\u5DF2\u53D1\u9001")),children:e.createElement(Fe,{requests:o})},!s&&{key:"3",label:e.createElement(H.Z,{className:"text-black dark:text-white",size:"small",count:d.length},(0,t.t)("\u5F85\u5904\u7406")),children:e.createElement(Ce,{requests:d})},!s&&{key:"4",label:e.createElement("span",{className:"text-green-400"},(0,t.t)("\u6DFB\u52A0\u597D\u53CB")),children:e.createElement(ge,null)}])}))});we.displayName="FriendPanel";var ce=m(38887),ie=m(72824),W=m(99631),an=m(56899),Ie=m(59412),ln=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const ke=e.memo(({url:n})=>{const{loading:l,value:a,error:r}=(0,t.r53)(()=>ln(void 0,null,function*(){const s=yield fetch(n);if(s.status>=400)throw new Error("\u8BF7\u6C42\u5F02\u5E38");return s.text()}),[n]);return l?e.createElement(ce.T,null):r?e.createElement(x.t,{text:String(r)}):e.createElement(Ie.U,{raw:String(a),baseUrl:n})});ke.displayName="DocumentMarkdownRender";const un=an.default.iframe`
  .tc-modal & {
    width: 60vw;
    height: 70vh;
    min-width: 100%;
  }
`,Me=e.memo(n=>{const{documentUrl:l}=n;return(0,t.YQu)(l)?l.endsWith(".md")?e.createElement(ke,{url:l}):l.endsWith(".html")||l.startsWith("http")?e.createElement(un,{src:l}):e.createElement(x.t,{text:(0,t.t)("\u4E0D\u652F\u6301\u6E32\u67D3\u7684\u6587\u6863\u94FE\u63A5")}):e.createElement(x.t,{text:(0,t.t)("\u8BE5\u63D2\u4EF6\u6CA1\u6709\u66F4\u591A\u63CF\u8FF0")})});Me.displayName="DocumentView";var rn=m(31860);function sn(n){if(!(0,t.VxZ)(n))throw new Error((0,t.t)("\u4E0D\u662F\u4E00\u4E2A\u5408\u6CD5\u7684JSON\u5B57\u7B26\u4E32"));const l=JSON.parse(n),{valid:a,errors:r}=new rn.Validator().validate(l,{type:"object",properties:{label:{type:"string"},name:{type:"string"},url:{type:"string"},icon:{type:"string"},version:{type:"string"},author:{type:"string"},description:{type:"string"},requireRestart:{type:"boolean"}},required:["label","name","url","version","author","description"],additionalProperties:!0});if(!a)throw console.error("[PluginManifest validation]:",r.map(s=>s.message).join(", ")),new Error((0,t.t)("\u4E0D\u662F\u4E00\u4E2A\u5408\u6CD5\u7684\u63D2\u4EF6\u914D\u7F6E"));return l.url=(0,t.Awg)(l.url),l}function Oe(n,l){var a;const r=(0,t.G33)();return(a=n[`${l}.${r}`])!=null?a:n[l]}var Le=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const te=e.memo(n=>{const{manifest:l,builtin:a=!1}=n,[r,s]=(0,e.useState)(n.installed),[{loading:o},d]=(0,t.CoE)(()=>Le(void 0,null,function*(){yield W.E.installPlugin(l),l.requireRestart===!0?(0,t.lHp)((0,t.t)("\u63D2\u4EF6\u5B89\u88C5\u6210\u529F, \u5237\u65B0\u9875\u9762\u540E\u751F\u6548"),"success"):(0,t.lHp)((0,t.t)("\u63D2\u4EF6\u5B89\u88C5\u6210\u529F"),"success"),s(!0)}),[l]),c=(0,e.useCallback)(()=>{(0,t.wp$)({message:(0,t.t)("\u662F\u5426\u8981\u5378\u8F7D\u63D2\u4EF6"),onConfirm:()=>Le(void 0,null,function*(){yield W.E.uninstallPlugin(l.name),(0,t.lHp)((0,t.t)("\u63D2\u4EF6\u5378\u8F7D\u6210\u529F, \u5237\u65B0\u9875\u9762\u540E\u751F\u6548"),"success")})})},[l]),u=(0,e.useCallback)(()=>{!(0,t.YQu)(l.documentUrl)||(0,p.openModal)(e.createElement(p.ModalWrapper,{title:i},e.createElement(Me,{documentUrl:(0,t.Awg)(l.documentUrl)})))},[l]),i=Oe(l,"label"),v=Oe(l,"description");return e.createElement("div",{className:"mobile:w-full sm:w-full md:w-full lg:w-1/2 xl:w-1/3 2xl:w-1/4 p-1"},e.createElement("div",{className:"rounded-md flex w-full h-36 bg-white bg-opacity-40 dark:bg-black dark:bg-opacity-40 shadow py-2 px-3"},e.createElement("div",{className:"mr-2"},e.createElement(E.qE,{shape:"square",src:l.icon,name:i})),e.createElement("div",{className:"flex flex-col flex-1 min-w-0 overflow-hidden"},e.createElement("div",{className:"font-bold"},i),e.createElement("div",{className:"text-xs text-gray-700 dark:text-gray-300 text-opacity-50"},l.name),e.createElement("div",{className:"flex-1 overflow-auto"},v),e.createElement(Be.Z,{className:"mt-1 justify-end"},(0,t.YQu)(l.documentUrl)&&e.createElement(y.Z,{onClick:u},(0,t.t)("\u6587\u6863")),e.createElement("div",null,a?e.createElement(y.Z,{type:"primary",disabled:!0},(0,t.t)("\u5185\u7F6E\u63D2\u4EF6")):r?e.createElement(y.Z,{type:"default",onClick:c},(0,t.t)("\u5DF2\u5B89\u88C5")):e.createElement(y.Z,{type:"primary",loading:o,onClick:d},(0,t.t)("\u5B89\u88C5")))))))});te.displayName="PluginStoreItem";var on=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const Ze=e.memo(()=>{const[n,l]=(0,e.useState)(""),[{loading:a},r]=(0,t.CoE)(()=>on(void 0,null,function*(){W.E.installPlugin(sn(n)),(0,t.lHp)((0,t.t)("\u5B89\u88C5\u6210\u529F"),"success")}),[n]),s=(0,e.useMemo)(()=>!(0,t.VxZ)(n),[n]);return e.createElement("div",{className:"p-2"},e.createElement(M.Z.Paragraph,null,(0,t.t)("\u8BF7\u4E0D\u8981\u5B89\u88C5\u4E0D\u660E\u6765\u6E90\u7684\u63D2\u4EF6\uFF0C\u8FD9\u53EF\u80FD\u4F1A\u76D7\u53D6\u4F60\u5728 Tailchat \u7684\u4E2A\u4EBA\u4FE1\u606F")),e.createElement(D.Z.TextArea,{placeholder:(0,t.t)("\u8BF7\u624B\u52A8\u8F93\u5165JSON\u4FE1\u606F\uFF0C\u5982\u679C\u4F60\u4E0D\u660E\u786E\u4F60\u5728\u505A\u4EC0\u4E48\u8BF7\u4E0D\u8981\u4F7F\u7528\u8BE5\u529F\u80FD"),disabled:a,value:n,onChange:o=>l(o.target.value),rows:18}),e.createElement("div",{className:"text-red-500"},s&&n!==""&&(0,t.t)("\u4E0D\u662F\u4E00\u4E2A\u5408\u6CD5\u7684JSON\u5B57\u7B26\u4E32"),"\xA0"),e.createElement("div",{className:"text-right"},e.createElement(y.Z,{loading:a,disabled:s,type:"primary",onClick:r},(0,t.t)("\u786E\u8BA4"))))});Ze.displayName="ManualInstall";var cn=m(3010),mn=m.n(cn),Re=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});function dn(){const{loading:n,value:l=[]}=(0,t.r53)(()=>Re(this,null,function*(){return W.E.getInstalledPlugins()}),[]),{loading:a,value:r=[]}=(0,t.r53)(()=>Re(this,null,function*(){return W.E.getRegistryPlugins()}),[]);return{loading:n||a,installedPluginList:l,allPlugins:r}}const Te=e.memo(()=>{const{loading:n,installedPluginList:l,allPlugins:a}=dn();if(n)return e.createElement(ce.T,{tip:(0,t.t)("\u6B63\u5728\u52A0\u8F7D\u63D2\u4EF6\u5217\u8868")});const r=l.map(o=>o.name),s=ie.Y.map(o=>o.name);return e.createElement("div",{className:"p-2 w-full"},e.createElement(se.N,{items:[{key:"1",label:(0,t.t)("\u5DF2\u5B89\u88C5"),children:e.createElement(e.Fragment,null,e.createElement(I.Z,{orientation:"left"},(0,t.t)("\u5DF2\u5B89\u88C5")),e.createElement("div",{className:"flex flex-wrap"},mn()([...ie.Y,...l],"name").map(o=>e.createElement(te,{key:o.name,manifest:o,installed:!0,builtin:s.includes(o.name)}))))},{key:"2",label:(0,t.t)("\u5168\u90E8"),children:e.createElement(e.Fragment,null,e.createElement(I.Z,{orientation:"left"},(0,t.t)("\u5185\u7F6E\u63D2\u4EF6")),e.createElement("div",{className:"flex flex-wrap"},ie.Y.map(o=>e.createElement(te,{key:o.name,manifest:o,installed:r.includes(o.name),builtin:!0}))),e.createElement(I.Z,{orientation:"left"},(0,t.t)("\u63D2\u4EF6\u4E2D\u5FC3")),e.createElement("div",{className:"flex flex-wrap"},a.filter(o=>!s.includes(o.name)).map(o=>e.createElement(te,{key:o.name,manifest:o,installed:r.includes(o.name)}))))},{key:"3",label:e.createElement("span",{className:"text-green-400"},(0,t.t)("\u624B\u52A8\u5B89\u88C5")),children:e.createElement(Ze,null)}]}))});Te.displayName="PluginStore";const Ue=e.memo(()=>e.createElement(Te,null));Ue.displayName="PluginsPanel";var Ge=m(10330),R=m(14517);const Q=e.memo(n=>{const{icon:l,name:a,to:r,badge:s}=n,d=(0,g.useLocation)().pathname.startsWith(r);return e.createElement(Ge.rU,{to:r},e.createElement("div",{className:(0,R.Z)("w-full hover:bg-black hover:bg-opacity-20 dark:hover:bg-white dark:hover:bg-opacity-20 cursor-pointer text-gray-700 dark:text-white rounded px-2 h-11 flex items-center text-base group mb-0.5",{"bg-black bg-opacity-20 dark:bg-white dark:bg-opacity-20":d})},e.createElement("div",{className:"flex h-8 items-center justify-center text-2xl w-8 mr-3"},e.isValidElement(l)?l:e.createElement(E.qE,{src:l,name:a})),e.createElement(M.Z.Text,{className:"flex-1 text-gray-900 dark:text-white",ellipsis:!0},a),s===!0?e.createElement(H.Z,{status:"error"}):e.createElement(H.Z,{count:Number(s)||0}),n.action&&e.createElement("div",{className:"text-base p-1 cursor-pointer hidden opacity-70 group-hover:block hover:opacity-100"},n.action)))});Q.displayName="SidebarItem";var En=m(92238),vn=m.n(En),pn=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const Je=e.memo(n=>{const l=n.converse,a=(0,t.Y84)(l),r=(0,t.IIz)(),[s]=(0,t.wuX)([l._id]),{value:o}=(0,t.r53)(()=>pn(void 0,null,function*(){if(!r)return;const d=yield Promise.all(vn()(l.members,r).map(c=>(0,t.pGV)(c)));return e.createElement(E.EW,{items:d.map(c=>({name:c.nickname,src:c.avatar}))})}),[l.members,r]);return e.createElement(Q,{key:l._id,name:a,icon:o,to:`/main/personal/converse/${l._id}`,badge:s})});Je.displayName="SidebarDMItem";var yn=m(50093),je=m(1348),$e=m(10114);const ze=e.memo(n=>e.createElement("div",{className:"h-10 text-gray-900 dark:text-white flex pt-4 px-2"},e.createElement("span",{className:"flex-1 overflow-hidden overflow-ellipsis text-xs text-gray-700 dark:text-gray-300"},n.children),e.createElement("div",{className:"text-base opacity-70 hover:opacity-100 cursor-pointer"},n.action)));ze.displayName="SidebarSection";const Ve=e.memo(()=>{const n=(0,t.Wfz)(),l=(0,t.Pc$)(),{disablePluginStore:a}=(0,t.tR0)(s=>({disablePluginStore:s.disablePluginStore})),r=(0,t.CGy)(s=>s.user.friendRequests.findIndex(o=>{var d;return o.to===((d=s.user.info)==null?void 0:d._id)})>=0);return e.createElement($e.L,{"data-tc-role":"sidebar-personal"},e.createElement(je.M,null,l==null?void 0:l.nickname),e.createElement("div",{className:"p-2 overflow-auto"},e.createElement(Q,{name:(0,t.t)("\u597D\u53CB"),icon:e.createElement(E.JO,{icon:"mdi:account-multiple"}),to:"/main/personal/friends",badge:r}),!a&&e.createElement(Q,{name:(0,t.t)("\u63D2\u4EF6\u4E2D\u5FC3"),icon:e.createElement(E.JO,{icon:"mdi:puzzle"}),to:"/main/personal/plugins"}),p.pluginCustomPanel.filter(s=>s.position==="personal").map(s=>e.createElement(Q,{key:s.name,name:s.label,icon:e.createElement(E.JO,{icon:s.icon}),to:`/main/personal/custom/${s.name}`})),e.createElement(ze,{action:e.createElement(E.JO,{icon:"mdi:plus",onClick:()=>(0,h.h7)(e.createElement(yn.m,null))})},(0,t.t)("\u79C1\u4FE1")),n.map(s=>e.createElement(Je,{key:s._id,converse:s}))))});Ve.displayName="PersonalSidebar";const He=e.memo(()=>{const[n,l]=(0,jt.r)("personLastVisitPanelUrl"),a=(0,g.useLocation)();return(0,e.useEffect)(()=>{l(a.pathname)},[a.pathname]),e.createElement(pe.J,{"data-tc-role":"content-personal",sidebar:e.createElement(Ve,null)},e.createElement(g.Routes,null,e.createElement(g.Route,{path:"/friends",element:e.createElement(we,null)}),e.createElement(g.Route,{path:"/plugins",element:e.createElement(Ue,null)}),e.createElement(g.Route,{path:"/converse/:converseId",element:e.createElement($t.d,null)}),p.pluginCustomPanel.filter(r=>r.position==="personal").map(r=>e.createElement(g.Route,{key:r.name,path:`/custom/${r.name}`,element:e.createElement(ve.S,null,e.createElement(r.render))})),e.createElement(g.Route,{path:"/",element:e.createElement(g.Navigate,{to:n||"/main/personal/friends"})})))});He.displayName="Personal";var fn=m(53937),We=m(64939),Qe=m(712);const Xe=e.memo(n=>{var l,a;const s=n.info.payload;return s?e.createElement(Qe.S,{header:(l=s.title)!=null?l:(0,t.t)("\u65B0\u6D88\u606F")},e.createElement("div",{className:"h-full overflow-auto p-2"},e.createElement(Ie.U,{raw:(a=s.content)!=null?a:""}))):e.createElement(x.t,null)});Xe.displayName="InboxMarkdownContent";const Ke=e.memo(n=>{const l=(0,e.useMemo)(()=>`message-highlight-${String(Math.random()).substring(2)}`,[]);return(0,e.useEffect)(()=>{const a=document.createElement("style");return a.innerHTML=`
.${l} [data-message-id="${n.messageId}"] {
  background: #e0e7ff !important;
}

.dark .${l} [data-message-id="${n.messageId}"] {
  background: rgba(0, 0, 0, 0.15) !important;
}
      `,a.setAttribute("highlight-message-id",n.messageId),document.body.append(a),()=>{a.remove()}},[n.messageId,l]),e.createElement("div",{className:l},n.children)});Ke.displayName="MessageHighlightContainer";var hn=m(81244),gn=m(61500),Ye=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const qe=e.memo(n=>{var l;const a=n.info,r=(l=a.message)!=null?l:a.payload;if(!r)return e.createElement(x.t,null);const{groupId:s,converseId:o,messageId:d}=r;return e.createElement(Qe.S,{header:(0,t.t)("\u63D0\u53CA\u6211\u7684\u6D88\u606F")},e.createElement("div",{className:"h-full overflow-auto p-2 pb-18 relative"},e.createElement(_e,{groupId:s,converseId:o,messageId:d})),e.createElement(gn.R$,{groupId:s,converseId:o}))});qe.displayName="InboxMessageContent";const _e=e.memo(n=>{const{value:l=[],loading:a}=(0,t.r53)(()=>Ye(void 0,null,function*(){try{return yield t.o4J.yw.fetchNearbyMessage({groupId:n.groupId,converseId:n.converseId,messageId:n.messageId})}catch(r){(0,t.hJM)(r),console.error(r)}}),[n.converseId,n.messageId]);return a?e.createElement(ce.T,null):e.createElement(Ke,{messageId:n.messageId},e.createElement(hn.X,{messages:l,isLoadingMore:!1,hasMoreMessage:!1,onLoadMore:()=>Ye(void 0,null,function*(){})}))});_e.displayName="NearbyMessages";const et=e.memo(n=>{const{inboxItemId:l}=(0,g.useParams)(),a=(0,t.VM1)(l??"");if(Fn(l??""),!a)return e.createElement("div",{className:"w-full"},e.createElement(We.T,{message:(0,t.t)("\u6CA1\u6709\u627E\u5230\u8BE5\u8BB0\u5F55")}));if(a.type==="message")return e.createElement(qe,{info:a});if(a.type==="markdown")return e.createElement(Xe,{info:a});const r=a;if(p.pluginInboxItemMap[r.type]){const o=p.pluginInboxItemMap[r.type].render;return e.createElement(o,{inboxItem:r})}return e.createElement(We.T,{message:(0,t.t)("\u6CA1\u6709\u627E\u5230\u8BE5\u7C7B\u578B\u7684\u6E32\u67D3\u65B9\u5F0F")})});et.displayName="InboxContent";function Fn(n){const l=(0,t.TL5)(),a=(0,t.VM1)(n);(0,t.qoQ)([n],()=>{!a||a.readed===!1&&(l(t.ONy.setInboxItemAck(n)),t.o4J.Ty.setInboxAck([n]))})}var bn=m(40916),Cn=m.n(bn);const tt=e.memo(n=>{const{groupId:l,className:a,style:r}=n,s=(0,t.iFL)(l);return e.createElement("span",{className:a,style:r},s==null?void 0:s.name)});tt.displayName="GroupName";const nt=e.memo(n=>{const{converseId:l,className:a,style:r}=n,s=(0,t.CGy)(d=>d.chat.converses[l]),o=(0,t.Y84)(s);return e.createElement("span",{className:a,style:r},o)});nt.displayName="ConverseName";var at=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const me=n=>`/main/inbox/${n}`,lt=e.memo(()=>{const n=(0,t.eT7)(),l=(0,e.useMemo)(()=>Cn()(n,"createdAt","desc"),[n]),a=(0,t.TL5)(),r=u=>{var i,v,f,P,ue,Jt;if(u.type==="message"){const S=(v=(i=u.message)!=null?i:u.payload)!=null?v:{};let Z="";return(0,t.YQu)(S.groupId)?Z=e.createElement(tt,{groupId:S.groupId}):(0,t.YQu)(S.converseId)&&(Z=e.createElement(nt,{converseId:S.converseId})),e.createElement(ne,{key:u._id,title:Z,desc:(0,p.getMessageRender)((f=S.messageSnippet)!=null?f:""),source:"Tailchat",readed:u.readed,to:me(u._id)})}if(u.type==="markdown"){const S=(P=u.payload)!=null?P:{},Z=S.title||(0,t.t)("\u65B0\u6D88\u606F");return e.createElement(ne,{key:u._id,title:Z,desc:(0,t.t)("\u70B9\u51FB\u67E5\u770B\u8BE6\u60C5"),source:(ue=S.source)!=null?ue:"Tailchat",readed:u.readed,to:me(u._id)})}const j=u;if(p.pluginInboxItemMap[j.type]){const S=p.pluginInboxItemMap[j.type],Z=S.getPreview(j);return e.createElement(ne,{key:j._id,title:Z.title,desc:Z.desc,source:(Jt=S.source)!=null?Jt:"Unknown",readed:j.readed,to:me(j._id)})}return null},s=l,o=l.filter(u=>u.readed===!1),[,d]=(0,t.CoE)(()=>at(void 0,null,function*(){o.forEach(u=>{a(t.ONy.setInboxItemAck(u._id))}),yield t.o4J.Ty.setInboxAck(o.map(u=>u._id))}),[o]),[,c]=(0,t.CoE)(()=>at(void 0,null,function*(){(yield(0,h.aW)({title:(0,t.t)("\u786E\u8BA4\u6E05\u7A7A\u6536\u4EF6\u7BB1\u4E48?")}))&&(yield t.o4J.Ty.clearInbox())}),[o]);return e.createElement($e.L,{"data-tc-role":"sidebar-inbox"},e.createElement(je.M,{menu:{items:[{key:"readAll",label:(0,t.t)("\u6240\u6709\u5DF2\u8BFB"),onClick:d},{key:"clear",label:(0,t.t)("\u6E05\u7A7A\u6536\u4EF6\u7BB1"),danger:!0,onClick:c}]}},(0,t.t)("\u6536\u4EF6\u7BB1")),e.createElement("div",{className:"overflow-hidden"},e.createElement(se.N,{items:[{key:"1",label:`${(0,t.t)("\u5168\u90E8")}`,children:e.createElement(e.Fragment,null,s.map(u=>r(u)))},{key:"2",label:`${(0,t.t)("\u672A\u8BFB")} (${o.length})`,children:e.createElement(e.Fragment,null,o.map(u=>r(u)))}]})))});lt.displayName="InboxSidebar";const ne=e.memo(n=>{const a=(0,g.useLocation)().pathname.startsWith(n.to);return e.createElement(Ge.rU,{to:n.to},e.createElement("div",{className:(0,R.Z)("p-2 overflow-auto cursor-pointer hover:bg-black hover:bg-opacity-10 dark:hover:bg-white dark:hover:bg-opacity-10 border-r-4 rounded",{"bg-black bg-opacity-10 dark:bg-white dark:bg-opacity-10":a},n.readed?"border-transparent":"border-green-500")},e.createElement("div",{className:"text-lg overflow-ellipsis overflow-hidden text-gray-700 dark:text-white"},n.title||e.createElement("span",null,"\xA0")),e.createElement("div",{className:"break-all text-opacity-80 text-black dark:text-opacity-80 dark:text-white text-sm p-1 border-l-2 border-gray-500 border-opacity-50"},n.desc),e.createElement("div",{className:"text-xs text-opacity-50 text-black dark:text-opacity-50 dark:text-white"},(0,t.t)("\u6765\u81EA"),": ",n.source)))});ne.displayName="InboxSidebarItem";const ut=e.memo(()=>e.createElement(pe.J,{"data-tc-role":"content-inbox",sidebar:e.createElement(lt,null)},e.createElement(g.Routes,null,e.createElement(g.Route,{path:"/:inboxItemId",element:e.createElement(et,null)}),e.createElement(g.Route,{path:"/",element:e.createElement(rt,null)}))));ut.displayName="Inbox";const rt=e.memo(()=>e.createElement("div",{className:"mt-11 w-full"},e.createElement(x.t,{text:(0,t.t)("\u63D0\u53CA(@)\u60A8\u7684\u6D88\u606F\u4F1A\u5728\u8FD9\u91CC\u51FA\u73B0\u54E6")})));rt.displayName="InboxNoSelect";const st=e.memo(()=>e.createElement(g.Routes,null,e.createElement(g.Route,{path:"/personal/*",element:e.createElement(He,null)}),e.createElement(g.Route,{path:"/inbox/*",element:e.createElement(ut,null)}),e.createElement(g.Route,{path:"/group/:groupId/*",element:e.createElement(fn.Z,null)}),p.pluginCustomPanel.filter(n=>["navbar-more","navbar-group","navbar-personal"].includes(n.position)).map(n=>e.createElement(g.Route,{key:n.name,path:`/custom/${n.name}`,element:e.createElement(ve.S,null,e.createElement(n.render))})),e.createElement(g.Route,{path:"/",element:e.createElement(g.Navigate,{to:"/main/personal",replace:!0})})));st.displayName="MainContent";var An=m(94709),Bn=Object.defineProperty,Nn=Object.defineProperties,Dn=Object.getOwnPropertyDescriptors,ot=Object.getOwnPropertySymbols,xn=Object.prototype.hasOwnProperty,Pn=Object.prototype.propertyIsEnumerable,ct=(n,l,a)=>l in n?Bn(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a,Sn=(n,l)=>{for(var a in l||(l={}))xn.call(l,a)&&ct(n,a,l[a]);if(ot)for(var a of ot(l))Pn.call(l,a)&&ct(n,a,l[a]);return n},wn=(n,l)=>Nn(n,Dn(l));const it=e.forwardRef((n,l)=>{const a=(0,e.useRef)(null);return(0,e.useImperativeHandle)(l,()=>({next(){var r;(r=a.current)==null||r.next()},prev(){var r;(r=a.current)==null||r.prev()}}),[]),e.createElement(An.Z,wn(Sn({className:"slides",ref:a},n),{dots:!1,swipe:!1,adaptiveHeight:!0,infinite:!1,beforeChange:(r,s)=>{var o;console.log(r,s,(o=a.current)==null?void 0:o.innerSlider)}}),n.children)});it.displayName="Slides";var In=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const kn=[{key:"default",label:(0,t.t)("\u9ED8\u8BA4\u7FA4\u7EC4"),panels:[{id:"00",name:(0,t.t)("\u6587\u5B57\u9891\u9053"),type:t.Xpe.GROUP},{id:"01",name:(0,t.t)("\u5927\u5385"),parentId:"00",type:t.Xpe.TEXT}]},{key:"work",label:(0,t.t)("\u5DE5\u4F5C\u534F\u540C"),panels:[{id:"00",name:(0,t.t)("\u516C\u5171"),type:t.Xpe.GROUP},{id:"01",name:(0,t.t)("\u5168\u5458"),parentId:"00",type:t.Xpe.TEXT},{id:"10",name:(0,t.t)("\u4E34\u65F6\u4F1A\u8BAE"),type:t.Xpe.GROUP},{id:"11",name:(0,t.t)("\u4F1A\u8BAE\u5BA4")+"1",parentId:"10",type:t.Xpe.TEXT},{id:"11",name:(0,t.t)("\u4F1A\u8BAE\u5BA4")+"2",parentId:"10",type:t.Xpe.TEXT}]}],mt=e.memo(()=>{const n=(0,e.useRef)(null),[l,a]=(0,e.useState)([]),[r,s]=(0,e.useState)(""),o=(0,t.TL5)(),d=(0,g.useNavigate)(),c=(0,e.useCallback)(f=>{var P;a(f),(P=n.current)==null||P.next()},[]),u=(0,e.useCallback)(()=>{var f;(f=n.current)==null||f.prev()},[]),[{loading:i},v]=(0,t.CoE)(()=>In(void 0,null,function*(){const f=yield(0,t.sSU)(r,l);o(t.hyC.appendGroups([f])),d(`/main/group/${f._id}`),yield(0,t.FcZ)(String(f._id)),(0,h.Mr)()}),[r,l,location]);return e.createElement(h.AB,{style:{maxWidth:440}},e.createElement(it,{ref:n},e.createElement("div",null,e.createElement(M.Z.Title,{level:4,className:"text-center mb-4"},(0,t.t)("\u521B\u5EFA\u7FA4\u7EC4")),e.createElement(M.Z.Paragraph,{className:"mb-4 text-center"},(0,t.t)("\u9009\u62E9\u4EE5\u4E0B\u6A21\u677F, \u5F00\u59CB\u521B\u5EFA\u5C5E\u4E8E\u81EA\u5DF1\u7684\u7FA4\u7EC4\u5427!")),e.createElement("div",{className:"space-y-2.5"},kn.map((f,P)=>e.createElement(e.Fragment,{key:f.key},P===1&&e.createElement(I.Z,null),e.createElement("div",{key:f.key,className:"w-full border rounded text-base py-2 px-3 cursor-pointer font-bold hover:bg-white hover:bg-opacity-10",onClick:()=>c(f.panels)},f.label))))),e.createElement("div",null,e.createElement(M.Z.Title,{level:4,className:"text-center mb-4"},(0,t.t)("\u81EA\u5B9A\u4E49\u4F60\u7684\u7FA4\u7EC4")),e.createElement(M.Z.Paragraph,{className:"text-center mb-2"},(0,t.t)("\u4E0D\u8981\u62C5\u5FC3, \u5728\u6B64\u4E4B\u540E\u4F60\u53EF\u4EE5\u968F\u65F6\u8FDB\u884C\u53D8\u66F4")),e.createElement("div",{className:"text-center mb-2"},e.createElement(E.qE,{className:"mx-auto",size:80,name:r})),e.createElement("div",null,e.createElement("div",null,(0,t.t)("\u7FA4\u7EC4\u540D\u79F0"),":"),e.createElement(D.Z,{className:"shadow-none",size:"large",maxLength:100,value:r,onChange:f=>s(f.target.value)})),e.createElement(I.Z,null),e.createElement("div",{className:"flex justify-between"},e.createElement(y.Z,{type:"link",onClick:u,className:"text-gray-600 dark:text-white font-bold"},(0,t.t)("\u8FD4\u56DE")),e.createElement(y.Z,{type:"primary",loading:i,onClick:v},(0,t.t)("\u786E\u8BA4\u521B\u5EFA"))))))});mt.displayName="ModalCreateGroup";var Mn=Object.defineProperty,dt=Object.getOwnPropertySymbols,On=Object.prototype.hasOwnProperty,Ln=Object.prototype.propertyIsEnumerable,Et=(n,l,a)=>l in n?Mn(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a,Zn=(n,l)=>{for(var a in l||(l={}))On.call(l,a)&&Et(n,a,l[a]);if(dt)for(var a of dt(l))Ln.call(l,a)&&Et(n,a,l[a]);return n};const G=e.memo(n=>{const{name:l,className:a,to:r,showPill:s=!1,badge:o=!1}=n,d=(0,g.useLocation)(),c=typeof r=="string"&&d.pathname.startsWith(r),u=(0,g.useNavigate)(),i=(0,t.zX9)(()=>{var f;typeof r=="string"&&u(r),(f=n.onClick)==null||f.call(n)});let v=e.createElement(V.Z,{title:l?e.createElement("div",{className:"font-bold px-1.5 py-0.5"},l):null,placement:"right"},e.createElement("div",{className:(0,R.Z)("w-12 h-12 hover:rounded-lg transition-all duration-300 cursor-pointer flex items-center justify-center overflow-hidden",a,{"rounded-1/2":!c,"rounded-lg":c}),onClick:i,"data-testid":n["data-testid"]},n.children));return o===!0&&(v=e.createElement(H.Z,Zn({status:"error",dot:!0,offset:[0,44]},n.badgeProps),v)),e.createElement("div",{className:"px-3 relative group"},s&&e.createElement("div",{className:"absolute w-2 left-0 top-0 bottom-0 flex items-center",style:{marginLeft:-4}},e.createElement("span",{className:(0,R.Z)("bg-gray-400 dark:bg-white w-2 h-2 rounded transition-all duration-300",{"h-2 group-hover:h-5":!c,"h-10":c})})),v)});G.displayName="NavbarNavItem";var Rn=m(35633),Tn=m(84344),Un=m.n(Tn);function Gn(n){var l;const a=(0,t.iFL)(n),r=((l=a==null?void 0:a.panels)!=null?l:[]).filter(v=>(0,Rn.Q)(v)).map(v=>v.id),{mutedList:s}=(0,t.OqL)(),o=(0,t.wuX)(r),d=Un()(r,o);let c=!1,u=!1;const i=s.includes(n);for(const[v,f]of d)if(f===!0){if(c=!0,i)break;if(v&&!s.includes(v)){u=!0;break}}return c?u?"unread":"muted":"none"}const Jn=()=>!0,ae=e.memo(({panelInfo:n,withBg:l})=>(0,e.useMemo)(()=>{var s;return(s=n.useIsShow)!=null?s:Jn},[])()?e.createElement(G,{key:n.name,name:n.label,className:(0,R.Z)("text-3xl  cursor-pointer",{"bg-gray-700 text-white":l,"text-gray-600 dark:text-white":!l}),to:`/main/custom/${n.name}`,"data-testid":`navbar-custom-${n.name}`},e.createElement(E.JO,{icon:n.icon})):null);ae.displayName="NavbarCustomNavItem";var vt=m(45895),jn=m(76411),$n=m.n(jn);const pt=e.memo(({group:n})=>{const l=n._id,a=Gn(l),{markGroupAllAck:r}=(0,t.PlN)(l),s={items:[{key:"ack",label:(0,t.t)("\u6807\u8BB0\u4E3A\u5DF2\u8BFB"),icon:e.createElement(E.JO,{icon:"mdi:message-badge-outline"}),onClick:()=>{r(),(0,t.jiy)((0,t.t)("\u5DF2\u6807\u8BB0\u8BE5\u7FA4\u7EC4\u6240\u6709\u6D88\u606F\u5DF2\u8BFB"))}}]};return e.createElement(Ae.Z,{menu:s,trigger:["contextMenu"]},e.createElement("div",null,e.createElement(G,{name:n.name,to:`/main/group/${n._id}`,showPill:!0,badge:["muted","unread"].includes(a),badgeProps:{status:a==="unread"?"error":"default"}},e.createElement(E.qE,{shape:"square",size:48,name:n.name,src:n.avatar}))))});pt.displayName="GroupNavItem";function zn(){const n=(0,t.CGy)(o=>o.group.groups),{value:l=[],setValue:a}=(0,t.cvI)("groupOrderList",[]),r=(0,t.zX9)((o,d)=>{a($n()(s.map(c=>c._id),o,d))}),s=(0,e.useMemo)(()=>Object.values(n).sort((o,d)=>{const c=l.findIndex(i=>i===o._id),u=l.findIndex(i=>i===d._id);return c-u}),[n,l]);return{handleSortEnd:r,groupList:s}}const yt=e.memo(()=>{const n=(0,e.useRef)(null),{groupList:l,handleSortEnd:a}=zn(),r=(0,t.zX9)(()=>{(0,h.h7)(e.createElement(mt,null))}),{disableCreateGroup:s}=(0,t.tR0)(o=>({disableCreateGroup:o.disableCreateGroup}));return e.createElement("div",{className:"space-y-2","data-tc-role":"navbar-groups",ref:n},Array.isArray(l)&&e.createElement(vt.ZP,{className:"space-y-2",lockAxis:"y",onSortEnd:a,customHolderRef:n},l.map(o=>e.createElement(vt.TR,{key:o._id},e.createElement("div",{className:"overflow-hidden"},e.createElement(pt,{group:o}))))),!s&&e.createElement(G,{className:"bg-green-500",name:(0,t.t)("\u521B\u5EFA\u7FA4\u7EC4"),onClick:r,"data-testid":"create-group"},e.createElement(E.JO,{className:"text-3xl text-white",icon:"mdi:plus"})),p.pluginCustomPanel.filter(o=>o.position==="navbar-group").map(o=>e.createElement(ae,{key:o.name,panelInfo:o,withBg:!0})))});yt.displayName="GroupNav";var Vn=m(89935),Hn=m(58935);const ft=e.memo(()=>{const{showSidebar:n,setShowSidebar:l}=(0,Hn.S)(),a=(0,Vn.d)(),r=(0,e.useCallback)(()=>{l(!n)},[n]);return a?e.createElement(E.JO,{className:"text-5xl mb-4 cursor-pointer",icon:n?"mdi:menu-open":"mdi:menu",onClick:r}):null});ft.displayName="MobileMenuBtn";var Wn=m(73513),Qn=m(3856);const Xn=m.p+"assets/logo.9b1a63b.svg",{Paragraph:J,Text:ht,Link:Kn}=M.Z,O=e.memo(n=>{const{src:l,icon:a}=n;return e.createElement("a",{className:"p-2.5 hover:bg-black hover:bg-opacity-20 rounded",href:l,target:"_blank",rel:"noreferrer"},typeof a=="string"?e.createElement(E.JO,{icon:a}):a)});O.displayName="LogoLink";const gt=e.memo(()=>e.createElement("div",{className:"select-text"},e.createElement("img",{className:"float-right select-none bg-black rounded-2xl bg-opacity-40 p-2",width:128,height:128,src:Xn}),e.createElement(J,null,e.createElement(ht,{className:"font-bold"},"Tailchat"),e.createElement(ht,null,": ",(0,t.t)("\u5C5E\u4E8E\u6240\u6709\u4EBA\u7684\u5F00\u6E90\u804A\u5929\u5DE5\u5177")," ")),e.createElement(J,null,(0,t.t)("\u53EF\u4F9B\u9AD8\u5EA6\u81EA\u5B9A\u4E49\u7684\u804A\u5929\u5DE5\u5177")),e.createElement(J,null,(0,t.t)("\u5B8C\u5168\u72EC\u5C5E\u4E8E\u79C1\u4EBA\u56E2\u961F\u7684\u6C9F\u901A\u5E73\u53F0")),e.createElement(J,null,e.createElement("div",null,(0,t.t)("\u7279\u6027(\u4EAE\u70B9)"),":"),e.createElement("ul",{className:"list-disc list-inside"},e.createElement("li",null,(0,t.t)("\u57FA\u4E8E\u9762\u677F\u7684\u7FA4\u7EC4\u7A7A\u95F4, \u53EF\u9AD8\u5EA6\u81EA\u5B9A\u4E49\u5316")),e.createElement("li",null,(0,t.t)("\u57FA\u4E8E\u5FAE\u5185\u6838\u7684\u524D\u7AEF\u63D2\u4EF6\u652F\u6491, \u79C1\u4EBA\u5B9A\u5236\u5316")),e.createElement("li",null,(0,t.t)("\u5206\u5E03\u5F0F\u90E8\u7F72\u53EF\u4F9B\u4EFB\u610F\u89C4\u6A21\u7684\u4F7F\u7528\u9700\u6C42")))),e.createElement(J,null,(0,t.t)("\u5F53\u524D\u7248\u672C"),": ",t.i83),e.createElement("div",{className:"text-8xl flex flex-wrap space-x-4 bg-black p-4 rounded-md bg-opacity-20"},e.createElement(O,{src:"https://github.com/msgbyte/tailchat",icon:"logos:github-octocat"}),e.createElement(O,{src:"https://en.wikipedia.org/wiki/Open_source",icon:"logos:opensource"}),e.createElement(O,{src:"https://www.docker.com/",icon:"logos:docker-icon"}),e.createElement(O,{src:"https://ministar.moonrailgun.com/",icon:e.createElement("img",{className:"w-24 h-24",src:"https://ministar.moonrailgun.com/img/logo.svg"})}),e.createElement(O,{src:"https://tushan.msgbyte.com/",icon:e.createElement("img",{className:"w-24 h-24",src:"https://tushan.msgbyte.com/img/logo.svg"})}),e.createElement(O,{src:"https://zh-hans.reactjs.org/",icon:"logos:react"}),e.createElement(O,{src:"https://redux.js.org/",icon:"logos:redux"}),e.createElement(O,{src:"https://www.typescriptlang.org/",icon:"logos:typescript-icon"})),e.createElement(J,{className:"mt-4"},(0,t.t)("\u5F00\u6E90\u5730\u5740"),":"," ",e.createElement(Kn,{href:"https://github.com/msgbyte/tailchat",target:"_blank"},"https://github.com/msgbyte/tailchat"))));gt.displayName="SettingsAbout";var Yn=m(92951),b=m(7606),de=m(56489),qn=m(170),Ft=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const _n=[{type:"text",name:"emailOTP",placeholder:(0,t.t)("6\u4F4D\u6821\u9A8C\u7801"),label:(0,t.t)("\u90AE\u7BB1\u6821\u9A8C\u7801")}],ea=(0,E._D)({emailOTP:E._6.string().length(6,(0,t.t)("\u6821\u9A8C\u7801\u4E3A6\u4F4D")).required((0,t.t)("\u6821\u9A8C\u7801\u4E0D\u80FD\u4E3A\u7A7A"))}),bt=e.memo(n=>{const l=(0,t.TL5)(),[a,r]=(0,e.useState)(!1),s=(0,t.Pc$)(),[{loading:o},d]=(0,t.CoE)(()=>Ft(void 0,null,function*(){!s||(yield t.o4J.EA.verifyEmail(s.email),r(!0))}),[s==null?void 0:s.email]),[,c]=(0,t.CoE)(u=>Ft(void 0,null,function*(){const i=yield t.o4J.EA.verifyEmailWithOTP(u.emailOTP);(0,w.rU)(i),l(t.hIH.setUserInfo(i)),(0,t.jiy)((0,t.t)("\u90AE\u7BB1\u9A8C\u8BC1\u901A\u8FC7")),typeof n.onSuccess=="function"&&n.onSuccess()}),[s==null?void 0:s.email,n.onSuccess]);return s?e.createElement(h.AB,{title:(0,t.t)("\u8BA4\u8BC1\u90AE\u7BB1")},a?e.createElement(E.Po,{schema:ea,fields:_n,onSubmit:c}):e.createElement(e.Fragment,null,e.createElement(y.Z,{className:"mb-2",type:"primary",block:!0,size:"large",loading:o,onClick:d},(0,t.t)("\u5411 {{email}} \u53D1\u9001\u8BA4\u8BC1\u90AE\u4EF6",{email:s.email})),e.createElement(y.Z,{type:"text",block:!0,size:"large",onClick:()=>r(!0)},(0,t.t)("\u5DF2\u53D1\u9001\u8BA4\u8BC1\u90AE\u4EF6")))):e.createElement(x.t,null)});bt.displayName="EmailVerify";var ta=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const na=[{type:"password",name:"oldPassword",label:(0,t.t)("\u65E7\u5BC6\u7801")},{type:"password",name:"newPassword",label:(0,t.t)("\u65B0\u5BC6\u7801")},{type:"password",name:"newPasswordRepeat",label:(0,t.t)("\u91CD\u590D\u5BC6\u7801")}],aa=(0,E._D)({oldPassword:E._6.string().min(6,(0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4F4E\u4E8E6\u4F4D")).required((0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A")),newPassword:E._6.string().min(6,(0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4F4E\u4E8E6\u4F4D")).required((0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A")),newPasswordRepeat:E._6.string().min(6,(0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4F4E\u4E8E6\u4F4D")).required((0,t.t)("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"))}),Ct=e.memo(n=>{const[{},l]=(0,t.CoE)(a=>ta(void 0,null,function*(){if(a.newPassword!==a.newPasswordRepeat){(0,t.lHp)((0,t.t)("\u65B0\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),"warning");return}yield(0,t.MjZ)(a.oldPassword,a.newPassword),(0,t.lHp)((0,t.t)("\u5BC6\u7801\u4FEE\u6539\u6210\u529F"),"success"),typeof n.onSuccess=="function"&&n.onSuccess()}),[n.onSuccess]);return e.createElement(h.AB,{title:(0,t.t)("\u4FEE\u6539\u5BC6\u7801")},e.createElement(E.Po,{schema:aa,fields:na,onSubmit:l}))});Ct.displayName="ModifyPassword";var le=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const At=e.memo(()=>{var n;const l=(0,t.Pc$)(),a=(0,t.TL5)(),{isAlphaMode:r}=(0,t.cGl)(),s=(n=l==null?void 0:l.extra)!=null?n:{},[,o]=(0,t.CoE)(v=>le(void 0,null,function*(){yield(0,t.jOv)("avatar",v.url),a(t.hIH.setUserInfoField({fieldName:"avatar",fieldValue:v.url})),(0,t.lHp)((0,t.t)("\u4FEE\u6539\u5934\u50CF\u6210\u529F"),"success")}),[]),[,d]=(0,t.CoE)(v=>le(void 0,null,function*(){yield(0,t.jOv)("nickname",v),a(t.hIH.setUserInfoField({fieldName:"nickname",fieldValue:v})),(0,t.lHp)((0,t.t)("\u4FEE\u6539\u6635\u79F0\u6210\u529F"),"success")}),[]),[,c]=(0,t.CoE)((v,f)=>le(void 0,null,function*(){yield t.o4J.EA.modifyUserExtra(v,f),a(t.hIH.setUserInfoExtra({fieldName:v,fieldValue:f})),(0,t.jiy)((0,t.t)("\u4FEE\u6539\u6210\u529F"))}),[]),u=(0,e.useCallback)(()=>{const v=(0,h.h7)(e.createElement(Ct,{onSuccess:()=>(0,p.closeModal)(v)}))},[]),i=(0,e.useCallback)(()=>le(void 0,null,function*(){yield(0,U._H)(null),window.location.replace("/")}),[]);return l?e.createElement("div",null,e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"w-1/3 mobile:w-full"},e.createElement(Yn.C,{circle:!0,onUploadSuccess:o},e.createElement(E.qE,{size:128,src:l.avatar,name:l.nickname}))),e.createElement("div",{className:"w-2/3 mobile:w-full"},r&&e.createElement(b.LP,{title:(0,t.t)("\u7528\u6237ID"),content:l._id}),e.createElement(b.LP,{title:(0,t.t)("\u7528\u6237\u6635\u79F0"),value:l.nickname,editable:!0,renderEditor:b.jo,onSave:d}),e.createElement(b.LP,{title:(0,t.t)("\u90AE\u7BB1"),content:e.createElement("div",null,e.createElement("span",{className:"mr-1"},l.email),(0,w.JM)(l.email)?e.createElement(de.Z,{color:"default",className:"select-none"},(0,t.t)("\u5185\u7F6E\u90AE\u7BB1")):l.emailVerified?e.createElement(de.Z,{color:"success",className:"select-none"},(0,t.t)("\u5DF2\u8BA4\u8BC1")):e.createElement(de.Z,{color:"warning",className:"cursor-pointer",onClick:()=>{if(l.temporary){qn.ZP.warning((0,t.t)("\u4E34\u65F6\u7528\u6237\u65E0\u6CD5\u8BA4\u8BC1\u90AE\u7BB1, \u8BF7\u5148\u8BA4\u9886\u8D26\u53F7"));return}const v=(0,h.h7)(e.createElement(bt,{onSuccess:()=>{(0,p.closeModal)(v)}}))}},(0,t.t)("\u672A\u8BA4\u8BC1")))}),p.pluginUserExtraInfo.map((v,f)=>{if(v.component&&v.component.editor){const P=v.component.editor;return e.createElement(P,{key:v.name+f,value:s[v.name],onSave:ue=>c(v.name,ue)})}return e.createElement(b.LP,{key:v.name+f,title:v.label,value:s[v.name]?String(s[v.name]):"",editable:!0,renderEditor:b.jo,onSave:P=>c(v.name,P)})}))),e.createElement(I.Z,null),e.createElement(M.Z.Title,{level:4},(0,t.t)("\u5BC6\u7801")),e.createElement(y.Z,{type:"primary",onClick:u},(0,t.t)("\u4FEE\u6539\u5BC6\u7801")),e.createElement(I.Z,null),e.createElement("div",null,e.createElement(y.Z,{type:"primary",danger:!0,onClick:i},(0,t.t)("\u9000\u51FA\u767B\u5F55")))):null});At.displayName="SettingsAccount";var la=m(96857);const Bt=e.memo(()=>{const n=(0,la.i)(),[l,a]=(0,e.useState)(!0);return(0,e.useEffect)(()=>{const r=setInterval(()=>{a(n.connected)},1e3);return()=>{clearInterval(r)}},[]),e.createElement("div",null,e.createElement("p",null,"\u5F53\u524DSocket\u72B6\u6001: ",JSON.stringify(l)),e.createElement("div",{className:"space-x-1"},e.createElement(y.Z,{type:"primary",onClick:()=>n.mockReconnect()},"Socket \u6A21\u62DF\u91CD\u8FDE")))});Bt.displayName="SettingsDebug";const Nt=e.memo(()=>{const{vitals:n,record:l,timeUsage:a}=(0,e.useMemo)(()=>({vitals:_.L8.getVitals(),record:_.L8.getRecord(),timeUsage:_.L8.getTimeUsage()}),[]);return e.createElement("div",null,e.createElement("div",{className:"mb-4"},e.createElement("div",null,"Vitals:"),e.createElement("div",{className:"rounded bg-black bg-opacity-10 p-2"},Object.entries(n).map(([r,s])=>e.createElement("div",{key:r},r,": ",s,"ms")))),e.createElement("div",{className:"mb-4"},e.createElement("div",null,"Record:"),e.createElement("div",{className:"rounded bg-black bg-opacity-10 p-2"},Object.entries(l).map(([r,s])=>e.createElement("div",{key:r},r,": ",s,"ms")))),e.createElement("div",null,e.createElement("div",null,"TimeUsage:"),e.createElement("div",{className:"rounded bg-black bg-opacity-10 p-2"},Object.entries(a).map(([r,s])=>e.createElement("div",{key:r},r,": ",s,"ms")))))});Nt.displayName="SettingsPerformance";var ua=m(18300);const ra=[{name:"config",label:(0,t.t)("\u5168\u5C40\u914D\u7F6E")},{name:"gateway",label:(0,t.t)("\u670D\u52A1\u7F51\u5173")},{name:"user",label:(0,t.t)("\u7528\u6237\u670D\u52A1")},{name:"user.dmlist",label:(0,t.t)("\u79C1\u4FE1\u670D\u52A1")},{name:"chat.message",label:(0,t.t)("\u804A\u5929\u670D\u52A1")},{name:"chat.converse",label:(0,t.t)("\u4F1A\u8BDD\u670D\u52A1")},{name:"chat.ack",label:(0,t.t)("\u5DF2\u8BFB\u670D\u52A1")},{name:"friend",label:(0,t.t)("\u597D\u53CB\u670D\u52A1")},{name:"group",label:(0,t.t)("\u7FA4\u7EC4\u670D\u52A1")},{name:"group.invite",label:(0,t.t)("\u7FA4\u7EC4\u9080\u8BF7\u670D\u52A1")},{name:"file",label:(0,t.t)("\u6587\u4EF6\u670D\u52A1")},{name:"mail",label:(0,t.t)("\u90AE\u4EF6\u670D\u52A1")},{name:"plugin.registry",label:(0,t.t)("\u63D2\u4EF6\u4E2D\u5FC3\u670D\u52A1")}],Dt=e.memo(()=>{const n=(0,e.useMemo)(()=>[...ra,...p.pluginInspectServices],[]),{loading:l,availableServices:a,refetch:r}=(0,t.pHK)();return e.createElement("div",null,e.createElement(y.Z,{className:"mb-2",type:"primary",loading:l,onClick:r},(0,t.t)("\u5237\u65B0")),e.createElement(ua.g,{spinning:l},n.map(s=>e.createElement("div",{key:s.name,className:"flex items-center"},e.createElement("span",{className:"mr-1"},s.label,":"),(a==null?void 0:a.includes(s.name))?e.createElement("span",{title:(0,t.t)("\u5F53\u524D\u670D\u52A1\u53EF\u7528")},e.createElement(E.JO,{icon:"emojione:white-heavy-check-mark"})):e.createElement("span",{title:(0,t.t)("\u670D\u52A1\u5F02\u5E38")},e.createElement(E.JO,{icon:"emojione:cross-mark-button"}))))))});Dt.displayName="SettingsStatus";var Ee=m(44411),T=m(73246);const xt=e.memo(n=>{const{value:l,onChange:a,config:r}=n;return r.type==="text"?e.createElement(b.LP,{title:r.label,value:l,editable:!0,renderEditor:b.jo,onSave:s=>a(s)}):r.type==="textarea"?e.createElement(b.LP,{title:r.label,value:l,editable:!0,renderEditor:b.lj,onSave:s=>a(s)}):r.type==="boolean"?e.createElement(b.LP,{title:r.label,tip:r.desc,content:e.createElement(Ee.Z,{checked:l??!1,onChange:s=>a(s)})}):r.type==="select"?e.createElement(b.LP,{title:r.label,tip:r.desc,content:e.createElement(T.Z,{style:{width:280},size:"large",value:l,onChange:s=>a(s)},r.options.map(s=>e.createElement(T.Z.Option,{key:s.value,value:s.value},s.label)))}):null});xt.displayName="FullModalFactory";var sa=m(37034),oa=m(13546),ca=m.n(oa);const Pt=e.memo(()=>{var n;const{colorScheme:l,setColorScheme:a}=(0,t.tv4)(),{settings:r,setSettings:s,loading:o}=(0,t.Flu)(),{isAlphaMode:d,setAlphaMode:c}=(0,t.cGl)();return e.createElement("div",null,e.createElement(b.LP,{title:(0,t.t)("\u7CFB\u7EDF\u8BED\u8A00"),content:e.createElement(sa.S,null)}),e.createElement(b.LP,{title:(0,t.t)("\u914D\u8272\u65B9\u6848"),content:e.createElement(T.Z,{style:{width:280},size:"large",value:l,onChange:a},e.createElement(T.Z.Option,{value:"dark"},(0,t.t)("\u6697\u9ED1\u6A21\u5F0F")),e.createElement(T.Z.Option,{value:"light"},(0,t.t)("\u4EAE\u8272\u6A21\u5F0F")),e.createElement(T.Z.Option,{value:"auto"},(0,t.t)("\u81EA\u52A8")),p.pluginColorScheme.map((u,i)=>e.createElement(T.Z.Option,{key:u.name+i,value:u.name},u.label)))}),p.pluginSettings.filter(u=>u.position==="system").map(u=>{var i;return e.createElement(xt,{key:u.name,value:ca()(r,u.name,(i=u.defaultValue)!=null?i:!1),onChange:v=>{s({[u.name]:v})},config:u})}),e.createElement(b.LP,{title:(0,t.t)("Alpha\u6D4B\u8BD5\u5F00\u5173"),tip:(0,t.t)("\u5728 Alpha \u6A21\u5F0F\u4E0B\u4F1A\u6709\u4E00\u4E9B\u5C1A\u5904\u4E8E\u6D4B\u8BD5\u9636\u6BB5\u7684\u529F\u80FD\u5C06\u4F1A\u88AB\u5F00\u653E\uFF0C\u5982\u679C\u51FA\u73B0\u95EE\u9898\u6B22\u8FCE\u53CD\u9988"),content:e.createElement(Ee.Z,{checked:d,onChange:u=>c(u)})}),d&&e.createElement(b.LP,{title:(0,t.t)("\u804A\u5929\u5217\u8868\u865A\u62DF\u5316")+" (Beta)",content:e.createElement(Ee.Z,{disabled:o,loading:o,checked:(n=r.messageListVirtualization)!=null?n:!1,onChange:u=>s({messageListVirtualization:u})})}))});Pt.displayName="SettingsSystem";const St=e.memo(n=>{const l=(0,e.useCallback)(r=>{r===!1&&typeof n.onClose=="function"&&n.onClose()},[n.onClose]),a=(0,e.useMemo)(()=>{const r={type:"group",title:(0,t.t)("\u901A\u7528"),children:[{type:"item",title:(0,t.t)("\u8D26\u6237\u4FE1\u606F"),content:e.createElement(At,null)},{type:"item",title:(0,t.t)("\u7CFB\u7EDF\u8BBE\u7F6E"),content:e.createElement(Pt,null)},{type:"item",title:(0,t.t)("\u670D\u52A1\u72B6\u6001"),content:e.createElement(Dt,null)},{type:"item",title:(0,t.t)("\u6027\u80FD\u7EDF\u8BA1"),content:e.createElement(Nt,null)},{type:"item",title:(0,t.t)("\u5173\u4E8E"),content:e.createElement(gt,null)}]};t.yGS&&r.children.push({type:"item",title:(0,t.t)("\u8C03\u8BD5"),content:e.createElement(Bt,null)});const s=p.pluginCustomPanel.filter(d=>d.position==="setting").map(d=>({type:"item",title:d.label,content:e.createElement(d.render)})),o=[r];return s.length>0&&o.push({type:"group",title:(0,t.t)("\u66F4\u591A"),children:[...s]}),o},[]);return e.createElement(Wn.o,{onChangeVisible:l},e.createElement(Qn.u,{menu:a,defaultContentPath:"0.children.0.content"}))});St.displayName="SettingsView";const wt=e.memo(()=>{const n=(0,e.useCallback)(()=>{const l=(0,h.h7)(e.createElement(St,{onClose:()=>(0,h.Mr)(l)}))},[]);return e.createElement(E.JO,{className:"text-3xl text-gray-600 dark:text-white cursor-pointer",icon:"mdi:dots-horizontal",onClick:n})});wt.displayName="SettingBtn";function ia(){const n=(0,t.Wfz)();return(0,t.wuX)(n.map(a=>String(a._id))).some(a=>a===!0)}const It=e.memo(()=>{const n=(0,t.Pc$)(),l=ia(),a=(0,t.CGy)(s=>s.user.friendRequests.findIndex(o=>{var d;return o.to===((d=s.user.info)==null?void 0:d._id)})>=0),r=l||a;return e.createElement("div",{"data-tc-role":"navbar-personal"},e.createElement(G,{name:(0,t.t)("\u6211"),to:"/main/personal",showPill:!0,badge:r},e.createElement(E.qE,{shape:"square",size:48,name:n==null?void 0:n.nickname,src:n==null?void 0:n.avatar})))});It.displayName="PersonalNav";const kt=e.memo(()=>{const l=(0,t.eT7)().filter(a=>!a.readed);return e.createElement(G,{className:"bg-gray-700",name:(0,t.t)("\u6536\u4EF6\u7BB1"),to:"/main/inbox",showPill:!0,badge:l.length>0,badgeProps:{count:l.length},"data-testid":"inbox"},e.createElement(E.JO,{className:"text-3xl text-white",icon:"mdi:inbox-arrow-down"}))});kt.displayName="InboxNav";var Mt=m(77569);const Ot=e.memo(()=>ma()?e.createElement(E.JO,{className:"text-3xl text-gray-600 dark:text-white cursor-pointer",icon:"mdi:download",onClick:Mt.ud}):null);Ot.displayName="InstallBtn";function ma(){const[n,l]=(0,e.useState)(!1);return(0,e.useEffect)(()=>{if((0,Mt.Wc)()){l(!0);return}const a=r=>{l(!0)};return window.addEventListener("beforeinstallprompt",a),()=>{window.removeEventListener("beforeinstallprompt",a)}},[]),n}var da=m(53761);const Lt=e.memo(()=>t.yGS?e.createElement(da.t,{toggleButtonProps:{style:{position:"relative",zIndex:0}}}):null);Lt.displayName="ReactQueryDevBtn";const Zt=e.memo(()=>e.createElement("div",{"data-tc-role":"navbar",className:"w-18 mobile:zoom-4/5 bg-navbar-light dark:bg-navbar-dark flex flex-col justify-start items-center pt-4 pb-4"},e.createElement(ft,null),e.createElement("div",{className:"flex-1 w-full overflow-hidden flex flex-col"},e.createElement("div",{className:"space-y-2"},e.createElement(It,null),e.createElement(kt,null),p.pluginCustomPanel.filter(n=>n.position==="navbar-personal").map(n=>e.createElement(ae,{key:n.name,panelInfo:n,withBg:!0}))),e.createElement("div",{className:"px-3"},e.createElement(I.Z,null)),e.createElement("div",{className:"overflow-y-hidden hover:overflow-y-smart scroll overflow-x-hidden thin-scrollbar"},e.createElement(yt,null))),e.createElement("div",{"data-tc-role":"navbar-settings",className:"flex flex-col items-center space-y-2 pt-3"},p.pluginCustomPanel.filter(n=>n.position==="navbar-more").map(n=>e.createElement(ae,{key:n.name,panelInfo:n,withBg:!1})),e.createElement(Lt,null),e.createElement(Ot,null),e.createElement(wt,null))));Zt.displayName="Navbar";var Ea=m(7364),va=m(22398),Rt=m(442),Tt=m(63933),X=m(64750);function pa(){return{navigate:(0,g.useNavigate)()}}var ya=m(89022),fa=m.n(ya),ha=(n,l,a)=>new Promise((r,s)=>{var o=u=>{try{c(a.next(u))}catch(i){s(i)}},d=u=>{try{c(a.throw(u))}catch(i){s(i)}},c=u=>u.done?r(u.value):Promise.resolve(u.value).then(o,d);c((a=a.apply(n,l)).next())});const ga=t.o4J.Qr.tv,Fa=[{key:"personal",source:"core",label:(0,t.t)("\u4E2A\u4EBA\u4E3B\u9875"),action({navigate:n}){n("/main/personal/friends")}},{key:"plugins",source:"core",label:(0,t.t)("\u63D2\u4EF6\u4E2D\u5FC3"),action({navigate:n}){n("/main/personal/plugins")}}];function ba(){const n=(0,t.IIz)(),l=(0,t.CGy)(r=>Object.values(r.chat.converses).filter(s=>s.type===ga.DM)),{value:a=[]}=(0,t.r53)(()=>ha(this,null,function*(){return(0,t.YQu)(n)?Promise.all(l.map(r=>(0,t.S8F)(n,r).then(s=>({key:`qs#converse#${r._id}`,label:`${(0,t.t)("\u79C1\u4FE1")} ${s}`,source:"core",action:({navigate:o})=>{o(`/main/personal/converse/${r._id}`)}})))):[]}),[n,l.map(r=>r._id).join(",")]);return(0,e.useDebugValue)(a),a}function Ca(){return[...Fa,...ba()]}function Aa(n){const l=Ca();return(0,e.useMemo)(()=>fa()(l.filter(r=>r.label.includes(n)),5),[n,l.length])}let K=null;const Ut=e.memo(()=>{const[n,l]=(0,e.useState)(""),[a,r]=(0,e.useState)(0),s=pa(),o=(0,e.useCallback)(()=>{!K||((0,Rt.i6)(K),K=null)},[]),d=Aa(n);return(0,Tt.q)(c=>{if((0,X.er)(c)){const u=a-1;r(u>=0?u:d.length+u)}else(0,X.dq)(c)&&r((a+1)%d.length);if((0,X.rR)(c)){const u=d[a];typeof u.action=="function"&&u.action(s),o()}else(0,X.$)(c)&&o()}),e.createElement("div",{className:"fixed left-0 right-0 top-0 bottom-0 bg-black bg-opacity-60 flex justify-center",onClick:o},e.createElement("div",{className:"modal-inner bg-content-light dark:bg-content-dark rounded overflow-auto relative p-4",style:{marginTop:"20vh",height:"fit-content",maxHeight:"60vh",width:"60vw",maxWidth:"1280px"},onClick:va.UW},e.createElement(D.Z,{className:"mb-1",autoFocus:!0,placeholder:(0,t.t)("\u5FEB\u901F\u641C\u7D22\u3001\u8DF3\u8F6C"),size:"large",value:n,onChange:c=>l(c.target.value)}),d.map((c,u)=>e.createElement("div",{key:c.key,className:(0,R.Z)("truncate px-2 py-1 rounded",{"bg-black bg-opacity-20 dark:bg-white dark:bg-opacity-20":a===u})},e.createElement("div",{className:"text-lg"},c.label),e.createElement("div",{className:(0,R.Z)("opacity-0 text-gray-400 text-xs",{"opacity-100":a===u})},c.source)))))});Ut.displayName="QuickSwitcher";function Ba(){typeof K!="number"&&(K=(0,Rt.rk)(e.createElement(Ut,null)))}function Na(){(0,Tt.q)(n=>{(0,X.Hi)(n)&&Ba()})}const Gt=e.memo(()=>((0,_.bw)("appMainRenderStart"),Na(),(0,t.GCv)(),e.createElement(Ea.l,null,e.createElement("div",{className:"flex flex-col h-full"},e.createElement(q,null),e.createElement(k,null),e.createElement("div",{className:"flex flex-1 overflow-hidden"},e.createElement(Zt,null),e.createElement(st,null))))));Gt.displayName="MainRoute";const Da=Gt}}]);
