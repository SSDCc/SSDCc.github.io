{"version":3,"file":"useOpenAppAction-74be9afd.js","sources":["../../../plugins/com.msgbyte.openapi/src/MainPanel/AppInfo/useOpenAppAction.tsx"],"sourcesContent":["import {\n  openReconfirmModal,\n  postRequest,\n  showErrorToasts,\n  useAsyncFn,\n  useAsyncRequest,\n  useEvent,\n} from '@capital/common';\nimport { useOpenAppInfo } from '../context';\nimport type { OpenAppBot, OpenAppCapability, OpenAppOAuth } from '../types';\n\n/**\n * 开放应用操作\n */\nexport function useOpenAppAction() {\n  const { refresh, appId, capability, onSelectApp } = useOpenAppInfo();\n\n  const [{ loading }, handleChangeAppCapability] = useAsyncRequest(\n    async (targetCapability: OpenAppCapability, checked: boolean) => {\n      const newCapability: OpenAppCapability[] = [...capability];\n      const findIndex = newCapability.findIndex((c) => c === targetCapability);\n\n      if (checked) {\n        if (findIndex === -1) {\n          newCapability.push(targetCapability);\n        }\n      } else {\n        if (findIndex !== -1) {\n          newCapability.splice(findIndex, 1);\n        }\n      }\n\n      await postRequest('/openapi/app/setAppCapability', {\n        appId,\n        capability: newCapability,\n      });\n      await refresh();\n    },\n    [appId, capability, refresh]\n  );\n\n  const [, handleSetAppInfo] = useAsyncRequest(\n    async (fieldName: string, fieldValue: string) => {\n      await postRequest('/openapi/app/setAppInfo', {\n        appId,\n        fieldName,\n        fieldValue,\n      });\n      await refresh();\n    },\n    [appId, refresh]\n  );\n\n  const [, handleUpdateOAuthInfo] = useAsyncRequest(\n    async <T extends keyof OpenAppOAuth>(name: T, value: OpenAppOAuth[T]) => {\n      await postRequest('/openapi/app/setAppOAuthInfo', {\n        appId,\n        fieldName: name,\n        fieldValue: value,\n      });\n      await refresh();\n    },\n    []\n  );\n\n  const [, handleUpdateBotInfo] = useAsyncRequest(\n    async <T extends keyof OpenAppBot>(name: T, value: OpenAppBot[T]) => {\n      await postRequest('/openapi/app/setAppBotInfo', {\n        appId,\n        fieldName: name,\n        fieldValue: value,\n      });\n      await refresh();\n    },\n    [appId, refresh]\n  );\n\n  const handleDeleteApp = useEvent(() => {\n    openReconfirmModal({\n      onConfirm: async () => {\n        try {\n          await postRequest('/openapi/app/delete', {\n            appId,\n          });\n          onSelectApp(null);\n          await refresh();\n        } catch (err) {\n          showErrorToasts(err);\n        }\n      },\n    });\n  });\n\n  return {\n    loading,\n    handleSetAppInfo,\n    handleDeleteApp,\n    handleChangeAppCapability,\n    handleUpdateOAuthInfo,\n    handleUpdateBotInfo,\n  };\n}\n"],"names":["useOpenAppInfo","useAsyncRequest","postRequest","useEvent","openReconfirmModal","showErrorToasts"],"mappings":"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"}