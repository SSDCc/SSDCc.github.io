{"version":3,"file":"useOpenAppAction-635d454b.js","sources":["../../../plugins/com.msgbyte.openapi/src/MainPanel/AppInfo/useOpenAppAction.tsx"],"sourcesContent":["import { postRequest, useAsyncFn } from '@capital/common';\nimport { useOpenAppInfo } from '../context';\nimport type { OpenAppBot, OpenAppCapability, OpenAppOAuth } from '../types';\n\n/**\n * 开放应用操作\n */\nexport function useOpenAppAction() {\n  const { refresh, appId, capability } = useOpenAppInfo();\n\n  const [{ loading }, handleChangeAppCapability] = useAsyncFn(\n    async (targetCapability: OpenAppCapability, checked: boolean) => {\n      const newCapability: OpenAppCapability[] = [...capability];\n      const findIndex = newCapability.findIndex((c) => c === targetCapability);\n\n      if (checked) {\n        if (findIndex === -1) {\n          newCapability.push(targetCapability);\n        }\n      } else {\n        if (findIndex !== -1) {\n          newCapability.splice(findIndex, 1);\n        }\n      }\n\n      await postRequest('/openapi/app/setAppCapability', {\n        appId,\n        capability: newCapability,\n      });\n      await refresh();\n    },\n    [appId, capability, refresh]\n  );\n\n  const [, handleUpdateOAuthInfo] = useAsyncFn(\n    async <T extends keyof OpenAppOAuth>(name: T, value: OpenAppOAuth[T]) => {\n      await postRequest('/openapi/app/setAppOAuthInfo', {\n        appId,\n        fieldName: name,\n        fieldValue: value,\n      });\n      await refresh();\n    },\n    []\n  );\n\n  const [, handleUpdateBotInfo] = useAsyncFn(\n    async <T extends keyof OpenAppBot>(name: T, value: OpenAppBot[T]) => {\n      await postRequest('/openapi/app/setAppBotInfo', {\n        appId,\n        fieldName: name,\n        fieldValue: value,\n      });\n      await refresh();\n    },\n    [appId, refresh]\n  );\n\n  return {\n    loading,\n    handleChangeAppCapability,\n    handleUpdateOAuthInfo,\n    handleUpdateBotInfo,\n  };\n}\n"],"names":["useOpenAppInfo","useAsyncFn","postRequest"],"mappings":";;EAOmC,SAAA,gBAAA,GAAA;EACjC,EAAM,MAAA,EAAE,OAAS,EAAA,KAAA,EAAO,UAAe,EAAA,GAAAA,oBAAA,EAAA,CAAA;EAEvC,EAAA,MAAM,CAAC,EAAE,OAAA,EAAA,EAAW,6BAA6BC,iBAC/C,CAAA,OAAO,kBAAqC,OAAqB,KAAA;EAC/D,IAAM,MAAA,aAAA,GAAqC,CAAC,GAAG,UAAA,CAAA,CAAA;EAC/C,IAAA,MAAM,SAAY,GAAA,aAAA,CAAc,SAAU,CAAA,CAAC,MAAM,CAAM,KAAA,gBAAA,CAAA,CAAA;EAEvD,IAAA,IAAI,OAAS,EAAA;EACX,MAAA,IAAI,cAAc,CAAI,CAAA,EAAA;EACpB,QAAA,aAAA,CAAc,IAAK,CAAA,gBAAA,CAAA,CAAA;EAAA,OAAA;EAAA,KAEhB,MAAA;EACL,MAAA,IAAI,cAAc,CAAI,CAAA,EAAA;EACpB,QAAA,aAAA,CAAc,OAAO,SAAW,EAAA,CAAA,CAAA,CAAA;EAAA,OAAA;EAAA,KAAA;EAIpC,IAAA,MAAMC,mBAAY,+BAAiC,EAAA;EAAA,MACjD,KAAA;EAAA,MACA,UAAY,EAAA,aAAA;EAAA,KAAA,CAAA,CAAA;EAEd,IAAM,MAAA,OAAA,EAAA,CAAA;EAAA,GAER,EAAA,CAAC,OAAO,UAAY,EAAA,OAAA,CAAA,CAAA,CAAA;EAGtB,EAAA,MAAM,GAAG,qBAAA,CAAA,GAAyBD,iBAChC,CAAA,OAAqC,MAAS,KAA2B,KAAA;EACvE,IAAA,MAAMC,mBAAY,8BAAgC,EAAA;EAAA,MAChD,KAAA;EAAA,MACA,SAAW,EAAA,IAAA;EAAA,MACX,UAAY,EAAA,KAAA;EAAA,KAAA,CAAA,CAAA;EAEd,IAAM,MAAA,OAAA,EAAA,CAAA;EAAA,GAER,EAAA,EAAA,CAAA,CAAA;EAGF,EAAA,MAAM,GAAG,mBAAA,CAAA,GAAuBD,iBAC9B,CAAA,OAAmC,MAAS,KAAyB,KAAA;EACnE,IAAA,MAAMC,mBAAY,4BAA8B,EAAA;EAAA,MAC9C,KAAA;EAAA,MACA,SAAW,EAAA,IAAA;EAAA,MACX,UAAY,EAAA,KAAA;EAAA,KAAA,CAAA,CAAA;EAEd,IAAM,MAAA,OAAA,EAAA,CAAA;EAAA,GAAA,EAER,CAAC,KAAO,EAAA,OAAA,CAAA,CAAA,CAAA;EAGV,EAAO,OAAA;EAAA,IACL,OAAA;EAAA,IACA,yBAAA;EAAA,IACA,qBAAA;EAAA,IACA,mBAAA;EAAA,GAAA,CAAA;EAAA;;;;;;;;"}