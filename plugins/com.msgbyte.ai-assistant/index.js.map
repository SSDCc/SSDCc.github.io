{"version":3,"file":"index.js","sources":["../../../plugins/com.msgbyte.ai-assistant/src/translate.ts","../../../plugins/com.msgbyte.ai-assistant/src/prompt.ts","../../../plugins/com.msgbyte.ai-assistant/src/popover.tsx","../../../plugins/com.msgbyte.ai-assistant/src/index.tsx"],"sourcesContent":["import { localTrans } from '@capital/common';\n\nexport const Translate = {\n  name: localTrans({\n    'zh-CN': 'AI Assistant',\n    'en-US': 'AI Assistant',\n  }),\n  helpMeTo: localTrans({\n    'zh-CN': '帮我:',\n    'en-US': 'Help me to:',\n  }),\n  improveText: localTrans({\n    'zh-CN': '改进文本',\n    'en-US': 'Improve Text',\n  }),\n  makeShorter: localTrans({\n    'zh-CN': '精简内容',\n    'en-US': 'Make Shorter',\n  }),\n  makeLonger: localTrans({\n    'zh-CN': '扩写内容',\n    'en-US': 'Make Longer',\n  }),\n  summaryMessages: localTrans({\n    'zh-CN': '总结内容',\n    'en-US': 'Summary Messages',\n  }),\n  translateInputText: localTrans({\n    'zh-CN': '翻译输入内容',\n    'en-US': 'Translate Input',\n  }),\n  usage: localTrans({\n    'zh-CN': '用时',\n    'en-US': 'Usage',\n  }),\n  serviceBusy: localTrans({\n    'zh-CN': '服务器忙，请稍后再试',\n    'en-US': 'Server is busy, please try again later',\n  }),\n  callError: localTrans({\n    'zh-CN': '调用失败',\n    'en-US': 'Call Error',\n  }),\n  apply: localTrans({\n    'zh-CN': '应用',\n    'en-US': 'Apply',\n  }),\n  prompt: {\n    improveText: localTrans({\n      'zh-CN':\n        '你是一位文字美化师，你只需要美化文字，不需要解读。现在我需要你润色我的内容并保留我的母语:',\n      'en-US':\n        \"You are a text embellisher, you can only embellish the text, don't interpret it. Now i need you embellish it and keep my origin language:\",\n    }),\n    shorterText: localTrans({\n      'zh-CN':\n        '你是一位文字美化师，你只需要简化文字，不需要解读。现在我需要你简化它并保留我的母语:',\n      'en-US':\n        \"You are a text embellisher, you can only shorter the text, don't interpret it. Now i need you shorter it and keep my origin language:\",\n    }),\n    longerText: localTrans({\n      'zh-CN':\n        '你是一位文字美化师，你只需要扩写文字，不需要解读。现在我需要你扩写它并保留我的母语:',\n      'en-US':\n        \"You are a text embellisher, you can only longer the text, don't interpret it. Now i need you longer it and keep my origin language:\",\n    }),\n    translateText: localTrans({\n      'zh-CN':\n        '你是一个负责翻译文本的程序。你的任务是根据输入的文本输出指定的目标语言。 请不要输出翻译以外的任何文本。 目标语言是英文，如果你收到的文字是英文，请翻译成中文（不需要拼音），以下是我的内容:',\n      'en-US':\n        'You are a program responsible for translating text. Your task is to output the specified target language based on the input text. Please do not output any text other than the translation. Target language is english, and if you receive text is english, please translate to chinese(no need pinyin), then its my text:',\n    }),\n    summaryMessages: localTrans({\n      'zh-CN':\n        '你将得到一串聊天记录，希望你能够对这些记录进行摘要。要求简明扼要，以包含列表的大纲形式输出。',\n      'en-US':\n        'You will receive a chat record and we hope you can summarize it. Please provide a concise outline format that includes a list.',\n    }),\n  },\n};\n","import { Translate } from './translate';\n\nexport const improveTextPrompt = Translate.prompt.improveText;\n\nexport const shorterTextPrompt = Translate.prompt.shorterText;\n\nexport const longerTextPrompt = Translate.prompt.longerText;\n\nexport const translateTextPrompt = Translate.prompt.translateText;\n\nexport const summaryMessagesPrompt = Translate.prompt.summaryMessages;\n","import React from 'react';\nimport { Translate } from './translate';\nimport {\n  useAsyncRequest,\n  useConverseMessageContext,\n  getCachedUserInfo,\n  getMessageTextDecorators,\n} from '@capital/common';\nimport {\n  LoadingSpinner,\n  useChatInputActionContext,\n  Tag,\n  Button,\n  Divider,\n} from '@capital/component';\nimport axios from 'axios';\nimport styled from 'styled-components';\nimport {\n  improveTextPrompt,\n  longerTextPrompt,\n  shorterTextPrompt,\n  summaryMessagesPrompt,\n  translateTextPrompt,\n} from './prompt';\n\nconst Root = styled.div`\n  padding: 0.5rem;\n  max-width: 300px;\n`;\n\nconst Tip = styled.div`\n  margin-bottom: 4px;\n`;\n\nconst Answer = styled.pre`\n  white-space: pre-wrap;\n  max-height: 50vh;\n  overflow: auto;\n`;\n\nconst ActionButton = styled.div`\n  min-width: 180px;\n  padding: 4px 6px;\n  border-radius: 3px;\n  background-color: rgba(0, 0, 0, 0.1);\n  cursor: pointer;\n  margin-bottom: 4px;\n\n  &:hover {\n    background-color: rgba(0, 0, 0, 0.2);\n  }\n`;\n\nexport const AssistantPopover: React.FC<{\n  onCompleted: () => void;\n}> = React.memo((props) => {\n  const { messages } = useConverseMessageContext();\n  const { message, setMessage } = useChatInputActionContext();\n  const [{ loading, value }, handleCallAI] = useAsyncRequest(\n    async (question: string) => {\n      // TODO: wait for replace\n      const { data } = await axios.post('https://yyejoq.laf.dev/chatgpt', {\n        question,\n      });\n\n      return data;\n    },\n    []\n  );\n\n  if (loading) {\n    return (\n      <Root>\n        <LoadingSpinner />\n      </Root>\n    );\n  }\n\n  return (\n    <Root>\n      <div>\n        {typeof value === 'object' && (\n          <>\n            {value.result ? (\n              <div>\n                <Answer>{value.answer}</Answer>\n                <div>\n                  <Tag color=\"green\">\n                    {Translate.usage}: {value.usage}ms\n                  </Tag>\n\n                  <Button\n                    size=\"small\"\n                    type=\"primary\"\n                    onClick={() => {\n                      setMessage(value.answer);\n                      props.onCompleted();\n                    }}\n                  >\n                    {Translate.apply}\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <div>\n                <div>{Translate.serviceBusy}</div>\n                <Tag color=\"red\">{Translate.callError}</Tag>\n              </div>\n            )}\n\n            <Divider />\n          </>\n        )}\n      </div>\n\n      <Tip>{Translate.helpMeTo}</Tip>\n\n      {typeof message === 'string' && message.length > 0 && (\n        <>\n          <ActionButton\n            onClick={() => handleCallAI(improveTextPrompt + message)}\n          >\n            {Translate.improveText}\n          </ActionButton>\n          <ActionButton\n            onClick={() => handleCallAI(shorterTextPrompt + message)}\n          >\n            {Translate.makeShorter}\n          </ActionButton>\n          <ActionButton\n            onClick={() => handleCallAI(longerTextPrompt + message)}\n          >\n            {Translate.makeLonger}\n          </ActionButton>\n          <ActionButton\n            onClick={() => handleCallAI(translateTextPrompt + message)}\n          >\n            {Translate.translateInputText}\n          </ActionButton>\n        </>\n      )}\n\n      <ActionButton\n        onClick={async () => {\n          const plainMessages = (\n            await Promise.all(\n              [...messages]\n                .filter((item) => !item.hasRecall) // filter recalled message\n                .slice(messages.length - 30, messages.length) // get last 30 message, too much will throw error\n                .map(\n                  async (item) =>\n                    `${\n                      (\n                        await getCachedUserInfo(item.author)\n                      ).nickname\n                    }: ${getMessageTextDecorators().serialize(\n                      item.content ?? ''\n                    )}`\n                )\n            )\n          ).join('\\n');\n\n          handleCallAI(summaryMessagesPrompt + plainMessages);\n        }}\n      >\n        {Translate.summaryMessages}\n      </ActionButton>\n    </Root>\n  );\n});\nAssistantPopover.displayName = 'AssistantPopover';\n","import { regChatInputButton } from '@capital/common';\nimport { BaseChatInputButton } from '@capital/component';\nimport React from 'react';\nimport { AssistantPopover } from './popover';\n\nconst PLUGIN_ID = 'com.msgbyte.ai-assistant';\nconst PLUGIN_NAME = 'AI Assistant';\n\nconsole.log(`Plugin ${PLUGIN_NAME}(${PLUGIN_ID}) is loaded`);\n\nregChatInputButton({\n  render: () => {\n    return (\n      <BaseChatInputButton\n        icon=\"eos-icons:ai\"\n        popoverContent={({ hidePopover }) => (\n          <AssistantPopover onCompleted={hidePopover} />\n        )}\n      />\n    );\n  },\n});\n"],"names":["localTrans","styled","React","useConverseMessageContext","useChatInputActionContext","useAsyncRequest","axios","LoadingSpinner","Tag","Button","Divider","getCachedUserInfo","getMessageTextDecorators","regChatInputButton","BaseChatInputButton"],"mappings":"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"}