"use strict";(self.webpackChunktailchat_web=self.webpackChunktailchat_web||[]).push([[258],{75209:(Fe,H,e)=>{e.d(H,{d:()=>ge});var r=e(52983),n=e(98281),l=e(7975),i=e(93540),t=e(20685);function a(I){const L=(0,r.useMemo)(()=>l.messageInterpreter.map(({name:b,explainMessage:se})=>({name:b,render:se(I)})).filter(({render:b})=>b!==null),[I]);return L.length===0?null:r.createElement("span",{className:"align-middle hidden group-hover:inline-block"},r.createElement(t.Z,{placement:"topLeft",title:(0,n.t)("\u6D88\u606F\u89E3\u91CA"),content:r.createElement("div",{className:"max-w-lg"},L.map((b,se)=>{var J;return r.createElement("p",{key:se+((J=b.name)!=null?J:"")},b.name&&r.createElement("span",null,(0,n.t)("\u6765\u81EA")," ",r.createElement("span",{className:"font-bold"},b.name)," :"," "),b.render)})),trigger:"click"},r.createElement(i.JO,{className:"cursor-pointer text-base",icon:"mdi:file-question-outline"})))}var B=e(96136),O=e(75217),W=e(66559),p=e(14517),y=e(84208),A=e(86724),U=e.n(A),M=e(6494),N=e.n(M),G=(I,L,b)=>new Promise((se,J)=>{var ye=Ce=>{try{pe(b.next(Ce))}catch(Te){J(Te)}},Be=Ce=>{try{pe(b.throw(Ce))}catch(Te){J(Te)}},pe=Ce=>Ce.done?se(Ce.value):Promise.resolve(Ce.value).then(ye,Be);pe((b=b.apply(I,L)).next())});function K(I,L){var b;const se=(0,n.xMc)(),J=(0,n.rE2)(),ye=(0,n.Pc$)(),[Be]=(0,n.WHr)((b=J==null?void 0:J._id)!=null?b:"",[n.g3S.core.deleteMessage]),pe=(0,r.useCallback)(()=>{U()((0,l.getMessageTextDecorators)().serialize(I.content)),(0,n.jiy)((0,n.t)("\u590D\u5236\u7EAF\u6587\u672C\u6210\u529F"))},[I.content]),[,Ce]=(0,n.CoE)(()=>G(this,null,function*(){(yield(0,y.aW)())&&(yield(0,n.peM)(I._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u64A4\u56DE\u6210\u529F")))}),[I._id]),[,Te]=(0,n.CoE)(()=>G(this,null,function*(){(yield(0,y.aW)())&&(yield(0,n.$Zg)(I._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u5220\u9664\u6210\u529F")))}),[I._id]),d=J&&J.owner===(ye==null?void 0:ye._id),F=I.author===(ye==null?void 0:ye._id);return{onClick:L.onClick,items:N()([{key:"copy",label:(0,n.t)("\u590D\u5236"),icon:r.createElement(i.JO,{icon:"mdi:content-copy"}),onClick:pe},se.hasContext&&{key:"reply",label:(0,n.t)("\u56DE\u590D"),icon:r.createElement(i.JO,{icon:"mdi:reply"}),onClick:()=>n.Agn.emit("replyMessage",I)},(d||F)&&{key:"recall",label:(0,n.t)("\u64A4\u56DE"),icon:r.createElement(i.JO,{icon:"mdi:restore"}),onClick:Ce},Be&&{key:"delete",label:(0,n.t)("\u5220\u9664"),danger:!0,icon:r.createElement(i.JO,{icon:"mdi:delete-outline"}),onClick:Te}])}}var Q=e(53652),$=e(71607),ce=e.n($),_=Object.defineProperty,w=Object.defineProperties,P=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,Z=(I,L,b)=>L in I?_(I,L,{enumerable:!0,configurable:!0,writable:!0,value:b}):I[L]=b,k=(I,L)=>{for(var b in L||(L={}))m.call(L,b)&&Z(I,b,L[b]);if(x)for(var b of x(L))D.call(L,b)&&Z(I,b,L[b]);return I},le=(I,L)=>w(I,P(L));const de=r.createContext({closePopover:ce()}),Ee=r.memo(I=>{const[L,b]=(0,r.useState)(!1),se=(0,r.useCallback)(Be=>{b(Be),typeof I.onOpenChange=="function"&&I.onOpenChange(Be)},[I.onOpenChange]),J=(0,r.useCallback)(()=>{b(!1),typeof I.onOpenChange=="function"&&I.onOpenChange(!1)},[]),ye=(0,r.useMemo)(()=>({closePopover:J}),[J]);return r.createElement(de.Provider,{value:ye},r.createElement(t.Z,le(k({},I),{open:L,onOpenChange:se})))});Ee.displayName="TcPopover";function xe(){var I;const L=(0,r.useContext)(de);return{closePopover:(I=L==null?void 0:L.closePopover)!=null?I:ce()}}var Me=(I,L,b)=>new Promise((se,J)=>{var ye=Ce=>{try{pe(b.next(Ce))}catch(Te){J(Te)}},Be=Ce=>{try{pe(b.throw(Ce))}catch(Te){J(Te)}},pe=Ce=>Ce.done?se(Ce.value):Promise.resolve(Ce.value).then(ye,Be);pe((b=b.apply(I,L)).next())});function be(I){const L=(0,n.ysv)(I);return(0,r.useMemo)(()=>()=>{const{closePopover:se}=xe(),[,J]=(0,n.CoE)(ye=>Me(this,null,function*(){yield(0,n.rUo)(L.current._id,ye),se()}),[]);return r.createElement(Q._,{onSelect:J})},[])}var Se=e(39907),Ze=e.n(Se),ze=e(3010),Je=e.n(ze),je=e(89022),He=e.n(je),Ve=e(95268);const Qe=r.memo(I=>{const{reaction:L,onClick:b}=I,se=(0,n.R8f)(L.users);return r.createElement("div",{className:"py-0.5 px-1 bg-black bg-opacity-20 hover:bg-opacity-40 rounded cursor-pointer"},r.createElement(Ve.Z,{title:se.join(", ")},r.createElement("div",{className:"flex",onClick:b},r.createElement(Q.d,{emoji:L.name}),r.createElement("div",{className:"ml-1 text-xs"},se.length<3?r.createElement("span",null,He()(se,2).join(",")):r.createElement("span",null,He()(se,2).join(", "),", ...+",se.length-2)))))});Qe.displayName="ReactionItem";function Ye(I){var L;const b=I._id,se=(L=I.reactions)!=null?L:[],J=(0,n.IIz)(),ye=(0,r.useMemo)(()=>{const pe=Ze()(se,"name");return Object.keys(pe).map(Ce=>{const Te=Je()(pe[Ce],"author");return{name:Ce,length:Te.length,users:Te.map(d=>d.author)}})},[se]),Be=(0,r.useCallback)(pe=>{!(0,n.YQu)(J)||(pe.users.includes(J)?(0,n.WOV)(b,pe.name):(0,n.rUo)(b,pe.name))},[b,J]);return r.createElement("div",{className:"flex chat-message-reactions space-x-1 py-0.5"},ye.map(pe=>r.createElement(Qe,{key:pe.name,reaction:pe,onClick:()=>Be(pe)})))}var qe=e(22398),ie=e(16365),Y=e(51052),me=e(29787),Pe=e.n(me),Re=Object.defineProperty,Ue=Object.defineProperties,we=Object.getOwnPropertyDescriptors,Ge=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,j=(I,L,b)=>L in I?Re(I,L,{enumerable:!0,configurable:!0,writable:!0,value:b}):I[L]=b,V=(I,L)=>{for(var b in L||(L={}))R.call(L,b)&&j(I,b,L[b]);if(Ge)for(var b of Ge(L))q.call(L,b)&&j(I,b,L[b]);return I},X=(I,L)=>Ue(I,we(L));const he=r.memo(({payload:I})=>{const L=(0,r.useMemo)(()=>new n.NtG(I).hasReply(),[I]);return L===!1?null:r.createElement("div",{className:"chat-message-item_quote border-l-4 border-black border-opacity-20 pl-2 opacity-80"},(0,n.t)("\u56DE\u590D")," ",r.createElement(W.v,{userId:String(L.author)}),":"," ",r.createElement("span",null,(0,l.getMessageRender)(L.content)))});he.displayName="MessageQuote";const fe=I=>r.createElement("div",{className:"px-0.5 w-6 h-6 flex justify-center items-center opacity-60 hover:opacity-100"},r.createElement(i.JO,{icon:I.icon})),Oe=r.memo(I=>{var L,b;const{showAvatar:se,payload:J}=I,ye=(0,n.xzJ)((L=J.author)!=null?L:""),[Be,pe]=(0,r.useState)(!1),Ce=Ye(J),Te=be(J),d=K(J,{onClick:()=>{pe(!1)}}),F=J.isLocal===!0||J.sendFailed===!0;return r.createElement("div",{className:(0,p.Z)("chat-message-item flex px-2 mobile:px-0 group relative select-text",{"bg-black bg-opacity-10":Be,"hover:bg-black hover:bg-opacity-5":!Be}),"data-message-id":J._id},r.createElement("div",{className:"w-18 mobile:w-14 flex items-start justify-center pt-0.5"},se?r.createElement(t.Z,{content:!Pe()(ye)&&r.createElement(Y.Z,{userInfo:ye}),placement:"top",trigger:"click"},r.createElement(i.qE,{className:"cursor-pointer",size:40,src:ye.avatar,name:ye.nickname})):r.createElement("div",{className:"hidden group-hover:block opacity-40"},(0,n.vMv)(J.createdAt))),r.createElement("div",{className:"flex flex-col flex-1 overflow-auto group",onContextMenu:qe.UW},se&&r.createElement("div",{className:"flex items-center"},r.createElement("div",{className:"font-bold"},(b=ye.nickname)!=null?b:r.createElement("span",null,"\xA0")),r.createElement("div",{className:"hidden group-hover:block opacity-40 ml-1 text-sm"},(0,n.vMv)(J.createdAt))),r.createElement(i.wb,{maxHeight:340,backgroundColor:"var(--tc-content-background-color)",showFullText:r.createElement("div",{className:"inline-block rounded-full bg-white dark:bg-black opacity-80 py-2 px-3 hover:opacity-100"},(0,n.t)("\u70B9\u51FB\u5C55\u5F00\u66F4\u591A"))},r.createElement("div",{className:"chat-message-item_body leading-6 break-words"},r.createElement(he,{payload:J}),r.createElement("span",null,(0,l.getMessageRender)(J.content)),J.sendFailed===!0&&r.createElement(i.JO,{className:"inline-block ml-1",icon:"emojione:cross-mark-button"}),a(J.content))),r.createElement("div",null,l.pluginMessageExtraParsers.map(h=>r.createElement(r.Fragment,{key:h.name},h.render(J)))),Ce),!F&&r.createElement("div",{className:(0,p.Z)("bg-white dark:bg-black rounded absolute right-2 cursor-pointer -top-3 shadow-sm flex",{"opacity-0 group-hover:opacity-100 bg-opacity-80 hover:bg-opacity-100":!Be,"opacity-100 bg-opacity-100":Be})},r.createElement(Ee,{overlayClassName:"chat-message-item_action-popover",content:Te,placement:"bottomLeft",trigger:["click"],onOpenChange:pe},r.createElement("div",null,r.createElement(fe,{icon:"mdi:emoticon-happy-outline"}))),r.createElement(B.Z,{menu:d,placement:"bottomLeft",trigger:["click"],onOpenChange:pe},r.createElement("div",null,r.createElement(fe,{icon:"mdi:dots-horizontal"})))))});Oe.displayName="NormalMessage";const Ne=r.memo(({payload:I})=>r.createElement("div",{className:"text-center"},r.createElement("div",{className:"bg-black bg-opacity-20 rounded inline-block py-0.5 px-2 my-1 text-sm"},I.content)));Ne.displayName="SystemMessage";const Le=r.memo(I=>{const b=(0,n.FDf)(I.userIds).map(se=>se.nickname);return r.createElement(Ne,X(V({},I),{payload:I.overwritePayload(b)}))});Le.displayName="SystemMessageWithNickname";const We=r.memo(I=>{var L;const b=I.payload;return b.author===n.q6$?r.createElement(Ne,V({},I)):b.hasRecall===!0?r.createElement(Le,X(V({},I),{userIds:[(L=b.author)!=null?L:n.q6$],overwritePayload:se=>X(V({},b),{content:(0,n.t)("{{nickname}} \u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F",{nickname:se[0]||""})})})):r.createElement(Oe,V({},I))});We.displayName="ChatMessageItem";function ge(I,L){var b,se;const J=I[L];if(!J)return r.createElement("div",null);let ye=!0,Be=!0;const pe=new Date((b=J.createdAt)!=null?b:"");if(L>0){const Ce=I[L-1];(0,n.Nvc)(new Date((se=Ce.createdAt)!=null?se:""),pe)||(ye=!1),ye===!1&&(Be=Ce.author!==J.author||Ce.hasRecall===!0)}return r.createElement("div",{key:J._id},ye&&r.createElement(O.Z,{className:"text-sm opacity-40 px-6 font-normal select-text"},(0,n.omK)(pe)),J.isLocal===!0?r.createElement("div",{className:"opacity-50"},r.createElement(We,{showAvatar:Be,payload:J})):r.createElement(ie.H,{converseId:J.converseId,messageId:J._id},r.createElement(We,{showAvatar:Be,payload:J})))}},81244:(Fe,H,e)=>{e.d(H,{X:()=>W});var r=e(52983),n=e(98281),l=e(93540);const i=r.memo(p=>r.createElement("div",{className:"px-5 pb-4 pt-8"},r.createElement("div",{className:"font-extrabold mb-2 text-2xl flex items-center space-x-1"},r.createElement(l.JO,{icon:"mdi:pound"}),r.createElement("div",null,p.title)),r.createElement("div",{className:"text-base opacity-80"},(0,n.t)("\u8FD9\u91CC\u662F\u6240\u6709\u6D88\u606F\u7684\u5F00\u59CB\uFF0C\u8BF7\u7545\u6240\u6B32\u8A00\u3002"))));i.displayName="ChatMessageHeader";var t=e(75209),a=e(79861);const B=100,O=40,W=r.memo(p=>{const y=(0,r.useRef)(null),A=(0,r.useRef)(!1),[U,M]=(0,r.useState)(!1),N=(0,n.nWw)(()=>{var K;(K=y.current)==null||K.scrollTo({top:0,behavior:"smooth"})});(0,r.useEffect)(()=>{p.messages.length!==0&&A.current===!1&&N()},[p.messages.length]),(0,n.JtK)("sendMessage",N);const G=(0,r.useCallback)(()=>{p.messages.length!==0&&(!y.current||(-y.current.scrollTop<=O?(A.current=!1,M(!1)):-y.current.scrollTop+y.current.clientHeight>=y.current.scrollHeight-B?p.onLoadMore():(A.current=!0,M(!0))))},[p.messages]);return r.createElement("div",{className:"flex-1 overflow-y-scroll overflow-x-hidden flex flex-col-reverse",ref:y,onScroll:G},r.createElement("div",null,p.messages.map((K,Q,$)=>(0,t.d)($,Q))),U&&r.createElement(a.a,{onClick:N}),p.title&&!p.hasMoreMessage&&r.createElement(i,{title:p.title}))});W.displayName="NormalMessageList"},79861:(Fe,H,e)=>{e.d(H,{a:()=>l});var r=e(52983),n=e(93540);const l=r.memo(i=>r.createElement("div",{className:"absolute right-10 bottom-18 px-3 py-2 rounded-full bg-white dark:bg-black bg-opacity-50 shadow cursor-pointer z-10 w-11 h-11 flex justify-center items-center text-2xl hover:bg-opacity-80",onClick:i.onClick},r.createElement(n.JO,{icon:"mdi:chevron-double-down"})));l.displayName="ScrollToBottom"},21506:(Fe,H,e)=>{e.d(H,{r:()=>Te});var r=e(7975),n=e(52983),l=e(98281),i=e(21597),t=e(55696);const a=n.memo(()=>{const d={rows:1};return n.createElement("div",{className:"px-2 w-2/3"},n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:d}))});a.displayName="ChatBoxPlaceholder";var B=e(64750),O=e(93540),W=e(96136),p=e(29254),y=e(84208),A=e(63933),U=e(44411),M=e(75526),N=(d,F,h)=>new Promise((ne,re)=>{var ue=z=>{try{te(h.next(z))}catch(oe){re(oe)}},ee=z=>{try{te(h.throw(z))}catch(oe){re(oe)}},te=z=>z.done?ne(z.value):Promise.resolve(z.value).then(ue,ee);te((h=h.apply(d,F)).next())});const G=n.memo(d=>{const{imageUrl:F,forceUploadOriginImage:h}=d,ne=(0,n.useRef)({width:0,height:0}),[re,ue]=(0,n.useState)(h??!1),[{loading:ee},te]=(0,l.ilX)(()=>N(void 0,null,function*(){if(ne.current.width===0||ne.current.height===0){(0,l.lHp)((0,l.t)("\u64CD\u4F5C\u8FC7\u4E8E\u9891\u7E41"),"warning");return}typeof d.onConfirm=="function"&&(yield Promise.resolve(d.onConfirm({size:ne.current,uploadOriginImage:re})))}),[d.onConfirm,re]);(0,A.q)(oe=>{(0,B.rR)(oe)?(oe.stopPropagation(),oe.preventDefault(),te()):(0,B.$)(oe)&&(oe.stopPropagation(),d.onCancel())},{capture:!0});const z=(0,n.useCallback)(oe=>{const Ke=oe.currentTarget;ne.current={width:Ke.naturalWidth,height:Ke.naturalHeight}},[]);return n.createElement(y.AB,{style:{maxHeight:"60vh",maxWidth:"60vw"}},n.createElement("div",{className:"flex"},n.createElement("div",{className:"w-2/3 p-2.5 bg-black bg-opacity-20 rounded"},n.createElement("img",{className:"max-h-72 m-auto",src:F,onLoad:z})),n.createElement("div",{className:"w-1/3 p-2 flex flex-col items-end justify-between"},n.createElement("div",{className:"text-right"},n.createElement("div",{className:"text-lg"},(0,l.t)("\u4E0A\u4F20\u56FE\u7247\u5230\u4F1A\u8BDD")),n.createElement("div",{className:"text-sm text-gray-400"},(0,l.t)("\u8BF7\u52FF\u4E0A\u4F20\u8FDD\u53CD\u5F53\u5730\u6CD5\u5F8B\u6CD5\u89C4\u7684\u56FE\u7247"))),n.createElement("div",{className:"w-full"},n.createElement("div",{className:"text-left"},n.createElement(U.Z,{disabled:typeof h!="undefined",checked:re,onChange:oe=>ue(oe)}),n.createElement("span",null,(0,l.t)("\u4E0A\u4F20\u539F\u56FE"))),n.createElement("div",{className:"text-right"},n.createElement(M.Z,{className:"mt-4",type:"primary",loading:ee,onClick:te},(0,l.t)("\u786E\u8BA4")))))))});G.displayName="ImageUploadPreviewer";var K=e(74774),Q=e(83996),$=(d,F,h)=>new Promise((ne,re)=>{var ue=z=>{try{te(h.next(z))}catch(oe){re(oe)}},ee=z=>{try{te(h.throw(z))}catch(oe){re(oe)}},te=z=>z.done?ne(z.value):Promise.resolve(z.value).then(ue,ee);te((h=h.apply(d,F)).next())});function ce(d){return new Promise(F=>{(0,K.Fy)(d).then(h=>{const ne=(0,y.h7)(n.createElement(G,{imageUrl:h,forceUploadOriginImage:(0,Q.w)(d.type)?void 0:!0,onCancel:()=>{(0,y.Mr)(ne)},onConfirm:re=>$(this,null,function*(){let ue=d;if(re.uploadOriginImage===!1){const oe=d.size;ue=yield(0,K.hv)(d);const Ke=ue.size;console.log(`\u538B\u7F29\u7ED3\u679C: ${Ke/oe*100}%(${oe} -> ${Ke})`)}const z=(yield(0,l.cTq)(ue)).url;F({url:z,width:re.size.width,height:re.size.height}),(0,y.Mr)(ne)})}))})})}function _(d){return $(this,null,function*(){const F=yield(0,l.cTq)(d);return{name:d.name||F.etag,url:F.url}})}var w=e(14517),P=(d,F,h)=>new Promise((ne,re)=>{var ue=z=>{try{te(h.next(z))}catch(oe){re(oe)}},ee=z=>{try{te(h.throw(z))}catch(oe){re(oe)}},te=z=>z.done?ne(z.value):Promise.resolve(z.value).then(ue,ee);te((h=h.apply(d,F)).next())});const x=n.memo(()=>{const[d,F]=(0,n.useState)(!1),h=(0,p.at)();if(h===null)return null;const ne=ee=>{const te=ee;te&&ce(te).then(({url:z,width:oe,height:Ke})=>{h.sendMsg((0,r.getMessageTextDecorators)().image(z,{width:oe,height:Ke}))})},re=ee=>{ee&&_(ee).then(({name:te,url:z})=>{h.sendMsg((0,r.getMessageTextDecorators)().card(te,{type:"file",url:z}))})},ue={items:[{key:"send-image",label:(0,l.t)("\u53D1\u9001\u56FE\u7247"),onClick:()=>P(void 0,null,function*(){F(!1);const ee=yield(0,K.ZB)({accept:"image/*"});ee&&ne(ee)})},{key:"send-file",label:(0,l.t)("\u53D1\u9001\u6587\u4EF6"),onClick:()=>P(void 0,null,function*(){F(!1);const ee=yield(0,K.ZB)();ee&&re(ee)})},...r.pluginChatInputActions.map((ee,te)=>({key:ee.label+te,label:ee.label,onClick:()=>{ee.onClick(h),F(!1)}}))]};return n.createElement(W.Z,{menu:ue,open:d,onOpenChange:F,placement:"topRight",trigger:["click"]},n.createElement("div",null,n.createElement(O.JO,{className:(0,w.Z)("text-2xl cursor-pointer transition transform",{"rotate-45":d}),icon:"mdi:plus-circle-outline"})))});x.displayName="ChatInputAddon";class m{constructor(F){this.data=F.clipboardData}hasImage(){const F=this.isPasteImage(this.data.items);if(F===!1)return!1;const h=F.getAsFile();return h===null?!1:h}isPasteImage(F){let h=0,ne;for(;h<F.length;){if(ne=F[h],ne.type.indexOf("image")!==-1)return ne;h++}return!1}}var D=e(9021),Z=e(22398),k=e(49723);const le=n.memo(d=>n.createElement("div",{className:"flex items-center py-2 px-3"},n.createElement(O.JO,{className:"mr-1 text-lg",icon:d.icon}),n.createElement("div",null,d.label)));le.displayName="MentionCommandItem";const de={input:{overflow:"auto",maxHeight:70},highlighter:{boxSizing:"border-box",overflow:"hidden",maxHeight:70}},Ee=n.memo(d=>{const{users:F,panels:h,placeholder:ne,disabled:re}=(0,p.TD)();return n.createElement(k.r,{inputRef:d.inputRef,className:"chatbox-mention-input",placeholder:ne??(0,l.t)("\u8F93\u5165\u4E00\u4E9B\u4EC0\u4E48"),disabled:re,style:de,maxLength:1e3,value:d.value,onChange:(ue,ee,te,z)=>d.onChange(ee,z.filter(oe=>oe.display.startsWith("@")).map(oe=>oe.id)),onKeyDown:d.onKeyDown,onPaste:d.onPaste,onContextMenu:Z.UW,allowSuggestionsAboveCursor:!0,forceSuggestionsAboveCursor:!0},n.createElement(k.p,{trigger:"@",data:F,displayTransform:(ue,ee)=>`@${ee}`,appendSpaceOnAdd:!0,renderSuggestion:ue=>n.createElement(D.Q,{userId:String(ue.id)}),markup:(0,r.getMessageTextDecorators)().mention("__id__","__display__")}),n.createElement(k.p,{trigger:"#",data:h,displayTransform:(ue,ee)=>`#${ee}`,appendSpaceOnAdd:!0,renderSuggestion:ue=>{var ee;return n.createElement(le,{icon:"mdi:pound",label:(ee=ue.display)!=null?ee:String(ue.id)})},markup:(0,r.getMessageTextDecorators)().url("__id__","#__display__")}))});Ee.displayName="ChatInputBoxInput";var xe=e(53652),Me=e(28723);const be=n.memo(()=>{const d=(0,p.at)(),{appendMsg:F}=d;return n.createElement(Me.L,{icon:"mdi:emoticon-happy-outline",popoverContent:({hidePopover:h})=>n.createElement(xe._,{onSelect:ne=>{F(ne),h()}})})});be.displayName="ChatInputEmotion";var Se=e(90292),Ze=e.n(Se),ze=e(37980),Je=e(22659);const je=n.memo(()=>{const d=(0,p.at)(),F=(0,l.zX9)(re=>{const ue=re[0];!ue||(ue.type.startsWith("image/")?ce(ue).then(({url:ee,width:te,height:z})=>{d==null||d.sendMsg((0,r.getMessageTextDecorators)().image(ee,{width:te,height:z}))}):_(ue).then(({url:ee,name:te})=>{d==null||d.sendMsg((0,r.getMessageTextDecorators)().card(te,{type:"file",url:ee}))}))}),[h,ne]=(0,ze.L)({accept:[Je.FILE],drop(re){F(re.files)},canDrop(re){return!0},collect:re=>({isOver:re.isOver(),canDrop:re.canDrop()})});return h.canDrop?n.createElement("div",{ref:ne,className:"absolute inset-0 bg-white bg-opacity-50 dark:bg-black dark:bg-opacity-50 p-4"},n.createElement("div",{className:"h-full w-full border-dashed border-8 flex flex-col justify-center items-center"},n.createElement("div",null,n.createElement(O.JO,{icon:"mdi:cloud-upload",fontSize:128})),n.createElement("div",{className:"text-xl font-bold"},(0,l.t)("\u62D6\u653E\u6587\u4EF6\u4EE5\u53D1\u9001\u5230\u5F53\u524D\u4F1A\u8BDD")))):null});je.displayName="ChatDropArea";var He=(d,F,h)=>new Promise((ne,re)=>{var ue=z=>{try{te(h.next(z))}catch(oe){re(oe)}},ee=z=>{try{te(h.throw(z))}catch(oe){re(oe)}},te=z=>z.done?ne(z.value):Promise.resolve(z.value).then(ue,ee);te((h=h.apply(d,F)).next())});const Ve=n.memo(d=>{const F=(0,n.useRef)(null),[h,ne]=(0,n.useState)(""),[re,ue]=(0,n.useState)([]),{disabled:ee}=(0,p.TD)(),te=(0,l.zX9)(()=>He(void 0,null,function*(){var Ae;yield d.onSendMsg(h,{mentions:Ze()(re)}),ne(""),(Ae=F.current)==null||Ae.focus()})),z=(0,l.zX9)(Ae=>{var De;ne(h+Ae),(De=F.current)==null||De.focus()}),oe=(0,l.zX9)(Ae=>{(0,B.rR)(Ae.nativeEvent)&&(Ae.preventDefault(),te())}),Ke=(0,l.zX9)(Ae=>{const ke=new m(Ae).hasImage();ke&&(Ae.preventDefault(),ce(ke).then(({url:ot,width:at,height:tt})=>{d.onSendMsg((0,r.getMessageTextDecorators)().image(ot,{width:at,height:tt}))}))});return(0,l.JtK)("replyMessage",Ae=>He(void 0,null,function*(){if(F.current&&(F.current.focus(),Ae&&(0,l.YQu)(Ae==null?void 0:Ae.author))){const De=yield(0,l.pGV)(Ae.author);ne(`${(0,r.getMessageTextDecorators)().mention(Ae.author,De.nickname)} ${h}`)}})),n.createElement(p.zB.Provider,{value:{message:h,setMessage:ne,sendMsg:d.onSendMsg,appendMsg:z}},n.createElement("div",{className:"px-4 py-2"},n.createElement("div",{className:"bg-white dark:bg-gray-600 flex rounded-md items-center"},n.createElement("div",{className:"flex-1 w-0"},n.createElement(Ee,{inputRef:F,value:h,onChange:(Ae,De)=>{ne(Ae),ue(De)},onKeyDown:oe,onPaste:Ke})),!ee&&n.createElement(n.Fragment,null,n.createElement("div",{className:"px-2 flex space-x-1"},r.pluginChatInputButtons.map((Ae,De)=>n.cloneElement(Ae.render(),{key:`plugin-chatinput-btn#${De}`})),n.createElement(be,null),h?n.createElement(O.JO,{icon:"mdi:send-circle-outline",className:"text-2xl cursor-pointer",onClick:()=>te()}):n.createElement(x,null)),n.createElement(je,null)))))});Ve.displayName="ChatInputBox";var Qe=e(38887),Ye=e(81244),qe=e(75209),ie=e(6342),Y=e(79861),me=Math.pow;const Pe=me(10,7),Re={height:"100%"},Ue={main:1e3,reverse:1e3},we=n.memo(d=>{const F=(0,n.useRef)(null),h=(0,n.useRef)(),ne=Ge(d.messages),re=(0,l.nWw)(()=>{var De,ke;(ke=F.current)==null||ke.scrollTo({top:(De=h.current)==null?void 0:De.scrollHeight,behavior:"smooth"})});(0,l.JtK)("sendMessage",re);const ue=(0,l.nWw)(()=>{d.isLoadingMore||d.hasMoreMessage&&d.onLoadMore()}),ee=(0,l.nWw)(De=>(De&&setTimeout(()=>{var ke;(ke=F.current)==null||ke.autoscrollToBottom()},20),De?"smooth":!1)),te=(0,l.nWw)((De,ke)=>ke?ke._id:De),z=(0,l.nWw)(De=>{const ke=De+ne-Pe;return(0,qe.d)(d.messages,ke)}),[oe,Ke]=(0,n.useState)(!1),Ae=(0,l.nWw)(De=>{Ke(!De)});return n.createElement("div",{className:"flex-1"},n.createElement(ie.OO,{style:Re,ref:F,scrollerRef:De=>h.current=De,firstItemIndex:Pe-ne,initialTopMostItemIndex:Math.max(d.messages.length-1,0),computeItemKey:te,totalCount:d.messages.length,overscan:Ue,itemContent:z,alignToBottom:!0,startReached:ue,atBottomStateChange:Ae,followOutput:ee,defaultItemHeight:25,atTopThreshold:100,atBottomThreshold:40,useWindowScroll:!1}),oe&&n.createElement(Y.a,{onClick:re}))});we.displayName="VirtualizedMessageList";function Ge(d){var F;const h=(F=d==null?void 0:d[0])==null?void 0:F._id,ne=(0,n.useRef)(h),re=(0,n.useRef)(h),ue=(0,n.useRef)(0);return(0,n.useMemo)(()=>{if(!d||!d.length)return 0;if(h===re.current)return ue.current;ne.current||(ne.current=h),re.current=h;for(let te=ue.current;te<d.length;te+=1)if(d[te]._id===ne.current)return ue.current=te,te;return 0},[d,d==null?void 0:d.length])}var R=Object.defineProperty,q=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,X=(d,F,h)=>F in d?R(d,F,{enumerable:!0,configurable:!0,writable:!0,value:h}):d[F]=h,he=(d,F)=>{for(var h in F||(F={}))j.call(F,h)&&X(d,h,F[h]);if(q)for(var h of q(F))V.call(F,h)&&X(d,h,F[h]);return d};const fe=n.memo(d=>{const{value:F,loading:h}=(0,l.cvI)("messageListVirtualization",!1);return h?n.createElement("div",{className:"flex-1"},n.createElement(Qe.T,null)):F?n.createElement(we,he({},d)):n.createElement(Ye.X,he({},d))});fe.displayName="ChatMessageList";var Oe=e(14698),Ne=e.n(Oe),Le=e(66559);const We=n.memo(()=>{const{replyMsg:d,setReplyMsg:F,clearReplyMsg:h}=(0,l.xMc)();return(0,l.JtK)("replyMessage",ne=>{F(ne)}),Ne()(d)?null:n.createElement("div",{className:"relative"},n.createElement("div",{className:"absolute bottom-0 left-0 right-0 py-1 px-4"},n.createElement("div",{className:"rounded bg-white dark:bg-gray-800 p-2 max-h-44 overflow-auto shadow-sm relative"},n.createElement("span",{className:"align-top"},(0,l.t)("\u56DE\u590D")," ",d.author&&n.createElement(Le.v,{userId:d.author}),":"," "),n.createElement("span",null,(0,r.getMessageRender)(d.content)),n.createElement(O.JO,{className:"absolute right-1 top-0.5 text-lg cursor-pointer opacity-60 hover:opacity-80",icon:"mdi:close-circle-outline",onClick:h}))))});We.displayName="ChatReply";const ge=/:([a-zA-Z0-9_\-\+]+):/g;function I(d){return d=String(d).trim(),d=d.replace(ge,F=>(0,r.getMessageTextDecorators)().emoji(F)),d}var L=Object.defineProperty,b=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable,ye=(d,F,h)=>F in d?L(d,F,{enumerable:!0,configurable:!0,writable:!0,value:h}):d[F]=h,Be=(d,F)=>{for(var h in F||(F={}))se.call(F,h)&&ye(d,h,F[h]);if(b)for(var h of b(F))J.call(F,h)&&ye(d,h,F[h]);return d},pe=(d,F,h)=>new Promise((ne,re)=>{var ue=z=>{try{te(h.next(z))}catch(oe){re(oe)}},ee=z=>{try{te(h.throw(z))}catch(oe){re(oe)}},te=z=>z.done?ne(z.value):Promise.resolve(z.value).then(ue,ee);te((h=h.apply(d,F)).next())});const Ce=n.memo(d=>{const{converseId:F,converseTitle:h}=d,{messages:ne,loading:re,error:ue,isLoadingMore:ee,hasMoreMessage:te,fetchMoreMessage:z,sendMessage:oe}=(0,l.FNv)();return re?n.createElement(a,null):ue?n.createElement(i.o,{error:ue}):n.createElement("div",{className:"w-full h-full flex flex-col select-text relative text-sm"},n.createElement(fe,{key:F,title:h,messages:ne,isLoadingMore:ee,hasMoreMessage:te,onLoadMore:z}),n.createElement(We,null),n.createElement(Ve,{onSendMsg:(Ke,Ae)=>pe(void 0,null,function*(){const De=I(Ke);yield oe({converseId:d.converseId,groupId:d.groupId,content:De,plain:(0,r.getMessageTextDecorators)().serialize(De),meta:Ae})})}))});Ce.displayName="ChatBoxInner";const Te=n.memo(d=>n.createElement(l.gvw,null,n.createElement(l.$Ib,{converseId:d.converseId,isGroup:d.isGroup},n.createElement(Ce,Be({},d)))));Te.displayName="ChatBox"},10114:(Fe,H,e)=>{e.d(H,{L:()=>n});var r=e(52983);const n=r.memo(l=>r.createElement("div",{className:"h-full flex flex-col","data-tc-role":l["data-tc-role"]},l.children));n.displayName="CommonSidebarWrapper"},73513:(Fe,H,e)=>{e.d(H,{o:()=>a});var r=e(52983),n=e(45563),l=e.n(n),i=e(93540),t=e(14517);const a=r.memo(B=>{const{visible:O=!0,onChangeVisible:W}=B,p=(0,r.useRef)(null),y=(0,r.useCallback)(()=>{l()(W)&&W(!1)},[W]);return(0,r.useEffect)(()=>{const A=U=>{U.code==="Escape"&&y()};return window.addEventListener("keyup",A),()=>{window.removeEventListener("keyup",A)}},[y]),r.createElement("div",{className:(0,t.Z)("fixed left-0 right-0 top-0 bottom-0 z-10 bg-content-light dark:bg-content-dark flex justify-center items-center",{"opacity-0":!O}),ref:p},B.children,l()(W)&&r.createElement("div",{className:"absolute right-8 top-8 cursor-pointer flex flex-col",onClick:y,"data-testid":"full-modal-close"},r.createElement(i.JO,{className:"text-2xl border-2 rounded-1/2 border-gray-900 dark:border-gray-100",icon:"mdi:close"}),r.createElement("span",{className:"text-center mt-0.5 font-bold"},"ESC")))});a.displayName="FullModal"},19856:(Fe,H,e)=>{e.d(H,{D:()=>t});var r=e(95268),n=e(75217),l=e(52983),i=e(98281);const t=l.memo(a=>{const{invite:B}=a;return B.expiredAt&&new Date(B.expiredAt).valueOf()<Date.now()?l.createElement("span",null,(0,i.t)("\u8BE5\u9080\u8BF7\u7801\u5DF2\u8FC7\u671F")):l.createElement(l.Fragment,null,B.expiredAt?l.createElement(i.cCv,null,"\u8BE5\u9080\u8BF7\u5C06\u4E8E"," ",l.createElement(r.Z,{title:(0,i.KJm)(B.expiredAt)},l.createElement("span",{className:"font-bold"},{date:(0,i.u39)(B.expiredAt)}))," ","\u8FC7\u671F"):l.createElement("span",null,(0,i.t)("\u8BE5\u9080\u8BF7\u7801\u6C38\u4E0D\u8FC7\u671F")),B.usageLimit&&l.createElement(l.Fragment,null,l.createElement(n.Z,{type:"vertical"}),l.createElement(i.cCv,null,"\u53EF\u4F7F\u7528"," ",l.createElement("span",{className:"font-bold"},{num:B.usageLimit})," ","\u6B21")))});t.displayName="InviteCodeExpiredAt"},9021:(Fe,H,e)=>{e.d(H,{Q:()=>p});var r=e(52983),n=e(93540),l=e(29787),i=e.n(l),t=e(55696),a=e(20685),B=e(58761),O=e(98281),W=e(66559);const p=r.memo(y=>{const{actions:A=[],hideDiscriminator:U=!1}=y,M=(0,O.xzJ)(y.userId),[N]=(0,O.aoI)([y.userId]),G=M.nickname;return r.createElement("div",{className:"flex items-center h-14 px-2.5 rounded group bg-black bg-opacity-0 hover:bg-opacity-20 dark:bg-white dark:bg-opacity-0 dark:hover:bg-opacity-20"},r.createElement(t.Z,{loading:i()(M),avatar:!0,title:!1,active:!0},r.createElement("div",{className:"mr-2"},y.popover?r.createElement(a.Z,{content:y.popover,placement:"left",trigger:"click"},r.createElement(n.qE,{className:"cursor-pointer",src:M.avatar,name:G,isOnline:N})):r.createElement(n.qE,{src:M.avatar,name:G,isOnline:N})),r.createElement("div",{className:"flex-1 text-gray-900 dark:text-white"},r.createElement(W.v,{userId:y.userId,showDiscriminator:!U})),r.createElement(B.Z,null,A)))});p.displayName="UserListItem"},2945:(Fe,H,e)=>{e.d(H,{B:()=>i});var r=e(52983),n=e(98281),l=e(38643);const i=r.memo(t=>{const{withoutUserIds:a=[],selectedIds:B,onChange:O}=t,W=(0,n.CGy)(p=>p.user.friends.map(y=>y.id).filter(y=>!a.includes(y)));return r.createElement(l.f,{selectedIds:B,onChange:O,allUserIds:W})});i.displayName="FriendPicker"},38643:(Fe,H,e)=>{e.d(H,{f:()=>y});var r=e(79546),n=e(66990),l=e(52983),i=e(98281),t=e(89022),a=e.n(t),B=e(92238),O=e.n(B),W=e(93540),p=e(64939);const y=l.memo(A=>{const{withSearch:U=!0,selectedIds:M,onChange:N,allUserIds:G}=A,[K,Q]=(0,l.useState)(""),$=(0,i.FDf)(G),ce=(0,l.useCallback)((w,P)=>{if(P===!0){if(M.includes(w))return;typeof N=="function"&&N([...M,w])}else typeof N=="function"&&N(O()(M,w))},[M,N]),_=a()($.filter(w=>w.nickname.includes(K)),10);return l.createElement("div",null,U&&l.createElement(r.Z,{placeholder:(0,i.t)("\u641C\u7D22\u7528\u6237"),className:"mb-2",value:K,onChange:w=>Q(w.target.value)}),l.createElement("div",null,(0,i.t)("\u5DF2\u9009\u62E9 {{num}} \u9879",{num:M.length})),_.length>0?_.map(w=>l.createElement("div",{key:w._id,className:"my-1"},l.createElement(n.Z,{className:"mr-2 items-center",checked:M.includes(w._id),onChange:P=>ce(w._id,P.target.checked)},l.createElement("div",{className:"flex items-center w-full"},l.createElement(W.qE,{size:"small",name:w.nickname,src:w.avatar}),l.createElement("div",{className:"ml-1 text-typography-light dark:text-typography-dark"},w.nickname))))):l.createElement(p.T,null))});y.displayName="UserPicker"},50093:(Fe,H,e)=>{e.d(H,{m:()=>O});var r=e(75526),n=e(52983),l=e(54782),i=e(98281),t=e(2945),a=e(84208),B=(W,p,y)=>new Promise((A,U)=>{var M=K=>{try{G(y.next(K))}catch(Q){U(Q)}},N=K=>{try{G(y.throw(K))}catch(Q){U(Q)}},G=K=>K.done?A(K.value):Promise.resolve(K.value).then(M,N);G((y=y.apply(W,p)).next())});const O=n.memo(W=>{const{hiddenUserIds:p=[]}=W,[y,A]=(0,n.useState)([]),U=(0,l.useNavigate)(),[{loading:M},N]=(0,i.CoE)(()=>B(void 0,null,function*(){const G=yield(0,i.L1i)([...p,...y]);(0,a.Mr)(),U(`/main/personal/converse/${G._id}`)}),[y]);return n.createElement(a.AB,{title:(0,i.t)("\u521B\u5EFA\u591A\u4EBA\u4F1A\u8BDD")},n.createElement(t.B,{withoutUserIds:p,selectedIds:y,onChange:A}),n.createElement("div",{className:"text-right"},n.createElement(r.Z,{type:"primary",loading:M,onClick:N},(0,i.t)("\u521B\u5EFA"))))});O.displayName="CreateDMConverse"},40318:(Fe,H,e)=>{e.d(H,{P:()=>x});var r=e(93540),n=e(52983),l=e(98281),i=e(84208),t=e(19856),a=e(72297),B=e(75283),O=e(75526),W=e(96136),p=e(25355);const y={createInviteBtn:"src-components-modals-CreateGroupInvite-CreateInviteCode-module__createInviteBtn--9soUP"};var A=Object.defineProperty,U=Object.defineProperties,M=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,Q=(m,D,Z)=>D in m?A(m,D,{enumerable:!0,configurable:!0,writable:!0,value:Z}):m[D]=Z,$=(m,D)=>{for(var Z in D||(D={}))G.call(D,Z)&&Q(m,Z,D[Z]);if(N)for(var Z of N(D))K.call(D,Z)&&Q(m,Z,D[Z]);return m},ce=(m,D)=>U(m,M(D)),_=(m,D,Z)=>new Promise((k,le)=>{var de=Me=>{try{xe(Z.next(Me))}catch(be){le(be)}},Ee=Me=>{try{xe(Z.throw(Me))}catch(be){le(be)}},xe=Me=>Me.done?k(Me.value):Promise.resolve(Me.value).then(de,Ee);xe((Z=Z.apply(m,D)).next())}),w=(m=>(m.Normal="normal",m.Permanent="permanent",m))(w||{});const P=n.memo(({groupId:m,onInviteCreated:D,onInviteUpdated:Z})=>{const[k,le]=(0,n.useState)(null),[{loading:de},Ee]=(0,l.CoE)(Ze=>_(void 0,null,function*(){const ze=yield(0,l.fiB)(m,Ze);le(ze),D==null||D()}),[m,D]),[xe,Me]=(0,l.WHr)(m,[l.g3S.core.invite,l.g3S.core.unlimitedInvite]),be=(0,l.zX9)(()=>{if(!k)return;const Ze=(0,i.h7)(n.createElement(p.s,{groupId:m,code:k.code,onEditSuccess:({expiredAt:ze,usageLimit:Je})=>{(0,l.lHp)((0,l.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),le(je=>ce($({},je),{expiredAt:ze?new Date(ze).toISOString():void 0,usageLimit:Je})),(0,i.Mr)(Ze),Z==null||Z()}}))}),Se={items:[{key:"persist",label:(0,l.t)("\u521B\u5EFA\u6C38\u4E45\u9080\u8BF7\u7801"),disabled:!Me,onClick:()=>Ee("permanent")}]};return n.createElement("div",null,k?n.createElement("div",null,n.createElement(B.Z.Title,{className:"bg-white bg-opacity-30 dark:bg-black dark:bg-opacity-30 px-2 py-1 select-text text-lg rounded border border-black border-opacity-20",level:4,copyable:!0},(0,a.po)(k.code)),n.createElement("p",{className:"text-gray-500 text-sm"},n.createElement(t.D,{invite:k}),n.createElement(O.Z,{type:"link",size:"small",onClick:be},(0,l.t)("\u7F16\u8F91")))):n.createElement(W.Z.Button,{className:y.createInviteBtn,size:"large",type:"primary",disabled:!xe,loading:de,onClick:()=>Ee("normal"),menu:Se,trigger:["click"]},(0,l.t)("\u521B\u5EFA\u94FE\u63A5")))});P.displayName="CreateInviteCode";const x=n.memo(m=>{const D=m.groupId;return(0,l.iFL)(D)?n.createElement(i.AB,null,n.createElement(r.JO,{className:"text-6xl block m-auto opacity-30 mb-4 mt-2",icon:"mdi:email-edit-outline"}),n.createElement("div",{className:"text-gray-400 font-bold text-lg mb-2"},(0,l.t)("\u521B\u5EFA\u94FE\u63A5\u5E76\u53D1\u9001\u7ED9\u5916\u90E8\u597D\u53CB")),n.createElement(P,{groupId:D,onInviteCreated:m.onInviteCreated,onInviteUpdated:m.onInviteUpdated})):n.createElement("div",null,(0,l.t)("\u5F02\u5E38"))});x.displayName="GroupInvite"},25355:(Fe,H,e)=>{e.d(H,{s:()=>B});var r=e(93540),n=e(52983),l=e(98281),i=e(84208),t=(O,W,p)=>new Promise((y,A)=>{var U=G=>{try{N(p.next(G))}catch(K){A(K)}},M=G=>{try{N(p.throw(G))}catch(K){A(K)}},N=G=>G.done?y(G.value):Promise.resolve(G.value).then(U,M);N((p=p.apply(O,W)).next())});const a=[{type:"select",name:"expiredAt",label:(0,l.t)("\u8FC7\u671F\u65F6\u95F4"),defaultValue:-1,options:[{label:(0,l.t)("30\u5206\u949F"),value:30*60},{label:(0,l.t)("1\u5C0F\u65F6"),value:60*60},{label:(0,l.t)("6\u5C0F\u65F6"),value:6*60*60},{label:(0,l.t)("12\u5C0F\u65F6"),value:12*60*60},{label:(0,l.t)("1\u5929"),value:24*60*60},{label:(0,l.t)("7\u5929"),value:7*24*60*60},{label:(0,l.t)("\u6C38\u4E0D"),value:-1}]},{type:"select",name:"usageLimit",label:(0,l.t)("\u6700\u5927\u4F7F\u7528\u6B21\u6570"),defaultValue:-1,options:[{label:(0,l.t)("\u65E0\u9650\u5236"),value:-1},{label:(0,l.t)("1\u6B21\u4F7F\u7528"),value:1},{label:(0,l.t)("5\u6B21\u4F7F\u7528"),value:5},{label:(0,l.t)("10\u6B21\u4F7F\u7528"),value:10},{label:(0,l.t)("25\u6B21\u4F7F\u7528"),value:25},{label:(0,l.t)("50\u6B21\u4F7F\u7528"),value:50},{label:(0,l.t)("100\u6B21\u4F7F\u7528"),value:100}]}],B=n.memo(O=>{const W=(0,l.zX9)(p=>t(void 0,null,function*(){const y=p.expiredAt===-1?void 0:Date.now()+p.expiredAt*1e3,A=p.usageLimit===-1?void 0:p.usageLimit;yield l.o4J.ru.editGroupInvite(O.groupId,O.code,y,A),O.onEditSuccess({expiredAt:y,usageLimit:A})}));return n.createElement(i.AB,{title:(0,l.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5")},n.createElement(r.Po,{fields:a,onSubmit:W}))});B.displayName="EditGroupInvite"},17679:(Fe,H,e)=>{e.d(H,{a:()=>xt});var r=e(73513),n=e(3856),l=e(50842),i=e(7975),t=e(52983),a=e(98281),B=e(95268),O=e(58761),W=e(75526),p=e(69104),y=e(66559),A=e(84208),U=e(40318),M=e(36932),N=e(84143),G=e(86724),K=e.n(G),Q=e(72297),$=e(93540),ce=e(25355),_=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const w=t.memo(o=>{const u=o.groupId,{loading:s,value:C,refresh:f}=(0,a.IxN)(()=>_(void 0,null,function*(){return(yield(0,a.TcU)(u)).reverse()}),[u]),g=(0,a.zX9)(()=>{(0,A.h7)(t.createElement(U.P,{groupId:u,onInviteCreated:()=>{f()},onInviteUpdated:()=>{f()}}))}),S=(0,a.zX9)(T=>{const ae=(0,A.h7)(t.createElement(ce.s,{groupId:u,code:T,onEditSuccess:()=>{(0,a.lHp)((0,a.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),(0,A.Mr)(ae),f()}}))}),v=(0,a.zX9)(T=>{K()((0,Q.po)(T)),(0,a.lHp)((0,a.t)("\u9080\u8BF7\u94FE\u63A5\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"),"success")}),c=(0,a.zX9)(T=>_(void 0,null,function*(){(yield(0,A.aW)())&&(yield(0,a.L4o)(u,T),yield f())})),E=(0,t.useMemo)(()=>[{title:(0,a.t)("\u9080\u8BF7\u7801"),dataIndex:"code",width:200,render:T=>t.createElement($.PJ,{text:T})},{title:(0,a.t)("\u521B\u5EFA\u65F6\u95F4"),dataIndex:"createdAt",render:T=>t.createElement(B.Z,{title:(0,a.KJm)(T)},(0,a.u39)(T))},{title:(0,a.t)("\u8FC7\u671F\u65F6\u95F4"),dataIndex:"expiredAt",render:T=>T?new Date(T).valueOf()<Date.now()?(0,a.t)("\u5DF2\u8FC7\u671F"):t.createElement(B.Z,{title:(0,a.KJm)(T)},(0,a.u39)(T)):(0,a.t)("\u6C38\u4E0D\u8FC7\u671F")},{title:(0,a.t)("\u4F7F\u7528\u6B21\u6570"),dataIndex:"usage",render:(T,ae)=>t.createElement("div",null,T,ae.usageLimit&&` / ${ae.usageLimit}`)},{title:(0,a.t)("\u521B\u5EFA\u8005"),dataIndex:"creator",render:T=>t.createElement(y.v,{userId:T})},{title:(0,a.t)("\u64CD\u4F5C"),dataIndex:"_id",render:(T,ae)=>t.createElement(O.Z,null,t.createElement(N.a,{title:(0,a.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:edit",onClick:()=>S(ae.code)}),t.createElement(N.a,{title:(0,a.t)("\u590D\u5236\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:content-copy",onClick:()=>v(ae.code)}),t.createElement(N.a,{title:(0,a.t)("\u5220\u9664"),shape:"square",icon:"mdi:delete-outline",danger:!0,onClick:()=>c(T)}))}],[v,c]);return t.createElement(M.t,{spinning:s},t.createElement("div",{className:"text-right mb-2"},t.createElement(W.Z,{type:"primary",onClick:g},(0,a.t)("\u521B\u5EFA\u9080\u8BF7\u7801"))),t.createElement(p.Z,{columns:E,dataSource:C,pagination:{hideOnSinglePage:!0}}))});w.displayName="GroupInvite";var P=e(85466),x=e.n(P),m=e(45513),D=e(14698),Z=e.n(D),k=e(77179),le=e.n(k);function de(o){return o.filter(u=>Z()(u.parentId)).map(u=>({key:u.id,title:u.name,isLeaf:u.type!==a.Xpe.GROUP,children:u.type===a.Xpe.GROUP?o.filter(s=>s.parentId===u.id).map(s=>({key:s.id,title:s.name,isLeaf:!0})):void 0}))}function Ee(o){const u=le()(o),s=u.filter(f=>Z()(f.parentId)),C=s.length;for(let f=C-1;f>=0;f--){const g=s[f].id;s.splice(f+1,0,...u.filter(S=>S.parentId===g))}return s}function xe(o,u){const s=(0,t.useRef)(null),C=(0,t.useCallback)(v=>{s.current=v.node},[]),f=(0,t.useCallback)(()=>{s.current=null},[]),g=(0,t.useCallback)(({dropNode:v,dropPosition:c})=>{var E;return((E=s.current)==null?void 0:E.isLeaf)===!0?c===0?!v.isLeaf:!0:c===0?!1:!v.isLeaf},[]),S=(0,t.useCallback)(v=>{var c;const E=le()(o),T=E.findIndex(ve=>ve.id===v.node.key),ae=E[T];T===-1&&(0,a.lHp)("\u5F02\u5E38, \u76EE\u6807\u8282\u70B9\u672A\u627E\u5230","error");const Xe=E.findIndex(ve=>ve.id===v.dragNode.key);((c=s.current)==null?void 0:c.isLeaf)===!0&&(v.node.isLeaf===!0?v.dragNodesKeys.map(ve=>E.findIndex(et=>et.id===ve)).filter(ve=>ve!==-1).forEach(ve=>{E[ve].parentId=ae.parentId}):v.dropToGap===!1&&v.node.isLeaf===!1?v.dragNodesKeys.map(ve=>E.findIndex(et=>et.id===ve)).filter(ve=>ve!==-1).forEach(ve=>{E[ve].parentId=ae.id}):v.dropToGap===!0&&v.node.isLeaf===!1&&v.dragNodesKeys.map(ve=>E.findIndex(et=>et.id===ve)).filter(ve=>ve!==-1).forEach(ve=>{E[ve].parentId=void 0}));const $e=Xe;let Ie;if(v.node.dragOverGapTop===!0?Ie=T:Ie=T+1,$e<Ie)E.splice(Ie,0,E[$e]),E.splice($e,1);else if($e>Ie){const[ve]=E.splice($e,1);E.splice(Ie,0,ve)}if(typeof u=="function"){const ve=Ee(E);u(ve)}},[o,u]);return{handleDragStart:C,handleDragEnd:f,handleAllowDrop:g,handleDrop:S}}var Me=e(38887),be=e(89889),Se=Object.defineProperty,Ze=Object.defineProperties,ze=Object.getOwnPropertyDescriptors,Je=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,Ve=(o,u,s)=>u in o?Se(o,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[u]=s,Qe=(o,u)=>{for(var s in u||(u={}))je.call(u,s)&&Ve(o,s,u[s]);if(Je)for(var s of Je(u))He.call(u,s)&&Ve(o,s,u[s]);return o},Ye=(o,u)=>Ze(o,ze(u)),qe=(o,u)=>{var s={};for(var C in o)je.call(o,C)&&u.indexOf(C)<0&&(s[C]=o[C]);if(o!=null&&Je)for(var C of Je(o))u.indexOf(C)<0&&He.call(o,C)&&(s[C]=o[C]);return s};function ie(o){const u=o,{name:s,type:C,permissionMap:f,fallbackPermissions:g}=u,S=qe(u,["name","type","permissionMap","fallbackPermissions"]);let v,c,E;if(typeof C=="string"){const T=C;v=a.Xpe.PLUGIN;const ae=(0,be.S)(T);ae&&(c=ae.provider,E=ae.name)}else v=C;return{name:s,type:v,provider:c,pluginPanelName:E,meta:S,permissionMap:f,fallbackPermissions:g}}function Y(o){return o===null?{name:"",type:a.Xpe.TEXT}:Ye(Qe({},o.meta),{name:o.name,type:o.type===a.Xpe.PLUGIN?String(o.pluginPanelName):o.type,permissionMap:o.permissionMap,fallbackPermissions:o.fallbackPermissions})}var me=e(39907),Pe=e.n(me),Re=e(61230),Ue=e.n(Re),we=Object.defineProperty,Ge=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,j=(o,u,s)=>u in o?we(o,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[u]=s,V=(o,u)=>{for(var s in u||(u={}))R.call(u,s)&&j(o,s,u[s]);if(Ge)for(var s of Ge(u))q.call(u,s)&&j(o,s,u[s]);return o};const X=[{type:"text",name:"name",label:(0,a.t)("\u9762\u677F\u540D")},{type:"select",name:"type",label:(0,a.t)("\u7C7B\u578B"),options:[{label:(0,a.t)("\u804A\u5929\u9891\u9053"),value:a.Xpe.TEXT},{label:(0,a.t)("\u9762\u677F\u5206\u7EC4"),value:a.Xpe.GROUP},...i.pluginGroupPanel.map(o=>({label:o.label,value:o.name}))]}],he={name:$._6.string().required((0,a.t)("\u9762\u677F\u540D\u4E0D\u80FD\u4E3A\u7A7A")).max(20,(0,a.t)("\u9762\u677F\u540D\u8FC7\u957F")),type:$._6.string().required((0,a.t)("\u9762\u677F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A"))};function fe(o,u){return(0,t.useMemo)(()=>{let C=X,f=he;if(typeof u.type=="string"){const g=(0,be.S)(u.type);if(g){const S=Array.isArray(g.extraFormMeta)?g.extraFormMeta:[];C=[...X,...S];const v=Ue()(Pe()(S,c=>c.name),()=>$._6.mixed());f=V(V({},v),he)}}return{fields:C,schema:(0,$._D)(f)}},[u])}var Oe=e(75217),Ne=e(63509),Le=e(36572),We=e(44411),ge=e(90292),I=e.n(ge),L=e(92238),b=e.n(L);const se=t.memo(o=>{const u=(0,a.zX9)((g,S)=>{S?o.onChange(I()([...o.value,g])):o.onChange(b()(o.value,g))}),s=(0,a.zX9)(g=>{if(typeof o.panelType=="undefined")return!0;if(!g.panel)return!1;if(g.panel===!0)return!0;if(Array.isArray(g.panel))return g.panel.includes(o.panelType)}),C=(0,a.pZA)().filter(s),f=i.pluginPermission.filter(s);return C.length===0&&f.length===0?t.createElement("div",{className:"text-center"},(0,a.t)("\u6682\u65E0\u53EF\u7528\u7684\u6743\u9650\u9879")):t.createElement("div",null,C.map(g=>t.createElement(J,{key:g.key,title:g.title,desc:g.desc,disabled:g.required?!g.required.every(S=>o.value.includes(S)):void 0,checked:o.value.includes(g.key),onChange:S=>u(g.key,S)})),f.length>0&&t.createElement(t.Fragment,null,t.createElement(Oe.Z,null,(0,a.t)("\u4EE5\u4E0B\u4E3A\u63D2\u4EF6\u6743\u9650")),i.pluginPermission.map(g=>t.createElement(J,{key:g.key,title:g.title,desc:g.desc,disabled:g.required?!g.required.every(S=>o.value.includes(S)):void 0,checked:o.value.includes(g.key),onChange:S=>u(g.key,S)}))))});se.displayName="PermissionList";const J=t.memo(o=>t.createElement("div",{className:"mx-2 py-3 border-b border-white border-opacity-20"},t.createElement(Ne.Z,null,t.createElement(Le.Z,{flex:1,className:"font-bold"},o.title),t.createElement(Le.Z,null,t.createElement(We.Z,{disabled:o.disabled,checked:o.checked,onChange:o.onChange}))),t.createElement("div",{className:"text-gray-400"},o.desc)));J.displayName="PermissionItem";var ye=e(14517),Be=Object.defineProperty,pe=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,Te=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,h=(o,u,s)=>u in o?Be(o,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[u]=s,ne=(o,u)=>{for(var s in u||(u={}))d.call(u,s)&&h(o,s,u[s]);if(Te)for(var s of Te(u))F.call(u,s)&&h(o,s,u[s]);return o},re=(o,u)=>pe(o,Ce(u));const ue=t.memo(o=>{var u;const[s,C]=(0,t.useState)(a.eFs),f=(0,a.CGy)(ae=>ae.group.groups[o.groupId].roles),g=(0,a.CGy)(ae=>ae.group.groups[o.groupId].panels.find(Ie=>Ie.id===o.panelId)),S=(0,t.useMemo)(()=>{var ae;return g?ne({[a.eFs]:(ae=g.fallbackPermissions)!=null?ae:(0,a.Q$5)()},g.permissionMap):{[a.eFs]:(0,a.Q$5)()}},[g]),[v,c]=(0,a.kz6)(S,o.onChange),E=(0,a.zX9)(ae=>{const Xe=re(ne({},v),{[s]:ae});c(Xe)}),T=(0,a.zX9)(()=>{c({[a.eFs]:(0,a.Q$5)()}),o.onChange(void 0)});return g?t.createElement("div",{className:"flex",style:{width:540}},t.createElement("div",null,t.createElement(ee,{active:s===a.eFs,onClick:()=>C(a.eFs)},(0,a.t)("\u6240\u6709\u4EBA")),f.map(ae=>t.createElement(ee,{key:ae._id,active:s===ae._id,onClick:()=>C(ae._id)},ae.name))),t.createElement("div",{className:"flex-1 overflow-auto",style:{height:o.height}},t.createElement("div",{className:"text-right"},t.createElement(W.Z,{onClick:T},(0,a.t)("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u6743\u9650"))),t.createElement(se,{panelType:g.type===a.Xpe.PLUGIN?g.pluginPanelName:g.type,value:(u=v[s])!=null?u:[],onChange:E}))):t.createElement(Me.T,null)});ue.displayName="AdvanceGroupPanelPermission";const ee=t.memo(o=>t.createElement("div",{className:(0,ye.Z)("px-2 py-1 rounded cursor-pointer mb-1 hover:bg-black hover:bg-opacity-20",{"bg-black bg-opacity-20":o.active}),onClick:o.onClick},o.children));ee.displayName="RoleItem";var te=e(6769);const z=t.memo(o=>t.createElement(te.Z,{className:o.className,style:o.style},t.createElement(te.Z.Panel,{header:o.title,key:"main"},o.children)));z.displayName="CollapseView";var oe=e(73352),Ke=e.n(oe),Ae=Object.defineProperty,De=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,at=(o,u,s)=>u in o?Ae(o,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[u]=s,tt=(o,u)=>{for(var s in u||(u={}))ke.call(u,s)&&at(o,s,u[s]);if(De)for(var s of De(u))ot.call(u,s)&&at(o,s,u[s]);return o},Ot=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const it=t.memo(o=>{const u=(0,a.wY6)(o.groupId,o.groupPanelId),[s,C]=(0,t.useState)(Y(u)),[,f]=(0,a.CoE)(()=>Ot(void 0,null,function*(){yield(0,a.d89)(o.groupId,o.groupPanelId,ie(s)),(0,a.lHp)((0,a.t)("\u4FEE\u6539\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.groupPanelId,o.onSuccess,s]),{fields:g,schema:S}=fe(o.groupId,s),v=(0,a.zX9)(c=>{C(E=>tt(tt({},E),c))});return u?t.createElement(A.AB,{title:(0,a.t)("\u7F16\u8F91\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:600}},t.createElement($.Po,{schema:S,fields:g.filter(c=>c.type!=="type"),initialValues:Y(u),onChange:v,onSubmit:f,extraProps:{suffixElement:t.createElement(z,{title:(0,a.t)("\u9AD8\u7EA7\u6743\u9650\u63A7\u5236"),className:"mb-2"},t.createElement(ue,{height:320,groupId:o.groupId,panelId:o.groupPanelId,onChange:c=>{if(c){const E=c[a.eFs],T=tt({},c);v({fallbackPermissions:E,permissionMap:Ke()(T,[a.eFs])})}else v({fallbackPermissions:void 0,permissionMap:void 0})}}))}})):t.createElement(Me.T,null)});it.displayName="ModalModifyGroupPanel";var Nt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const ct=t.memo(o=>{const u=(0,t.useMemo)(()=>de(o.groupPanels),[o.groupPanels]),s=(0,t.useCallback)(E=>{const T=(0,A.h7)(t.createElement(it,{groupId:o.groupId,groupPanelId:E,onSuccess:()=>(0,A.Mr)(T)}))},[o.groupId]),C=(0,t.useCallback)((E,T,ae)=>{(0,a.wp$)({message:ae?(0,a.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F\u7EC4 \u3010{{name}}\u3011 \u4EE5\u53CA\u4E0B\u7EA7\u7684\u6240\u6709\u9762\u677F\u4E48",{name:T}):(0,a.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F \u3010{{name}}\u3011 \u4E48",{name:T}),onConfirm:()=>Nt(void 0,null,function*(){yield(0,a.J9q)(o.groupId,E)})})},[o.groupId]),f=(0,t.useCallback)(E=>t.createElement("div",{className:"flex group"},t.createElement("span",null,E.title),t.createElement("div",{className:"opacity-0 group-hover:opacity-100 ml-2"},t.createElement(O.Z,{size:"small"},t.createElement(N.a,{title:(0,a.t)("\u7F16\u8F91"),type:"text",size:"small",icon:"mdi:pencil-outline",onClick:T=>{T.stopPropagation(),T.preventDefault(),s(String(E.key))}}),t.createElement(N.a,{title:(0,a.t)("\u5220\u9664"),type:"text",size:"small",icon:"mdi:trash-can-outline",onClick:T=>{T.stopPropagation(),T.preventDefault(),C(String(E.key),String(E.title),!E.isLeaf)}})))),[C]),{handleDragStart:g,handleDragEnd:S,handleAllowDrop:v,handleDrop:c}=xe(o.groupPanels,o.onChange);return t.createElement(m.Z,{treeData:u,defaultExpandAll:!0,blockNode:!0,draggable:{icon:!1},selectable:!1,titleRender:f,onDrop:c,onDragStart:g,onDragEnd:S,allowDrop:v})});ct.displayName="GroupPanelTree";const nt=t.memo(o=>t.createElement("div",{className:"text-xl font-bold mb-4 flex justify-between"},t.createElement("div",null,o.children),t.createElement("div",null,o.extra)));nt.displayName="FullModalCommonTitle";var At=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const mt=t.memo(o=>{const[u,s]=(0,t.useState)({}),[,C]=(0,a.CoE)(S=>At(void 0,null,function*(){yield(0,a.XAi)(o.groupId,ie(S)),(0,a.lHp)((0,a.t)("\u521B\u5EFA\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.onSuccess]),{fields:f,schema:g}=fe(o.groupId,u);return t.createElement(A.AB,{title:(0,a.t)("\u521B\u5EFA\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:440}},t.createElement($.Po,{schema:g,fields:f,onChange:s,onSubmit:C}))});mt.displayName="ModalCreateGroupPanel";var Bt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const dt=t.memo(o=>{var u;const s=o.groupId,C=(0,a.iFL)(s),f=(u=C==null?void 0:C.panels)!=null?u:[],[g,S]=(0,t.useState)(f),v=(0,t.useRef)(!1);(0,t.useEffect)(()=>{v.current!==!0&&S(f)},[f]);const c=(0,t.useCallback)($e=>{v.current=!0,S($e)},[]),[{loading:E},T]=(0,a.CoE)(()=>Bt(void 0,null,function*(){yield(0,a.uRW)(s,"panels",g),v.current=!1,(0,a.lHp)((0,a.t)("\u4FDD\u5B58\u6210\u529F"),"success")}),[g]),ae=(0,t.useCallback)(()=>{S(f),v.current=!1},[f]),Xe=(0,t.useCallback)(()=>{const $e=(0,A.h7)(t.createElement(mt,{groupId:s,onSuccess:()=>{(0,A.Mr)($e),v.current=!1}}))},[]);return t.createElement("div",null,t.createElement(nt,{extra:t.createElement(W.Z,{type:"primary",onClick:Xe},(0,a.t)("\u521B\u5EFA\u9762\u677F"))},(0,a.t)("\u9762\u677F\u7BA1\u7406")),t.createElement("div",{className:"max-h-160 overflow-auto border rounded border-black border-opacity-20 p-1"},t.createElement(ct,{groupId:s,groupPanels:g,onChange:c})),!x()(f,g)&&t.createElement("div",{className:"space-x-1 mt-2"},t.createElement(W.Z,{type:"primary",loading:E,onClick:T},(0,a.t)("\u4FDD\u5B58")),t.createElement(W.Z,{onClick:ae},(0,a.t)("\u91CD\u7F6E"))))});dt.displayName="GroupPanel";var vt=e(18300),bt=e(83667);const lt=t.memo(o=>t.createElement("div",{className:(0,ye.Z)("px-2 py-1 rounded cursor-pointer mb-1 hover:bg-black hover:bg-opacity-20",{"bg-black bg-opacity-20":o.active}),onClick:o.onClick},o.children));lt.displayName="RoleItem";var rt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});function St(o,u){const[{loading:s},C]=(0,a.CoE)(()=>rt(this,null,function*(){yield a.o4J.ru.createGroupRole(o,(0,a.t)("\u65B0\u8EAB\u4EFD\u7EC4"),(0,a.Q$5)()),(0,a.jiy)()}),[o]),[{loading:f},g]=(0,a.CoE)(T=>rt(this,null,function*(){u===a.eFs?yield a.o4J.ru.modifyGroupField(o,"fallbackPermissions",T):yield a.o4J.ru.updateGroupRolePermission(o,u,T),(0,a.jiy)()}),[o,u]),[{loading:S},v]=(0,a.CoE)(T=>rt(this,null,function*(){if(u===a.eFs)throw new Error((0,a.t)("\u65E0\u6CD5\u4FEE\u6539\u6240\u6709\u4EBA\u6743\u9650\u7EC4\u7684\u663E\u793A\u540D\u79F0"));yield a.o4J.ru.updateGroupRoleName(o,u,T),(0,a.jiy)()}),[o,u]),[{loading:c},E]=(0,a.CoE)(()=>rt(this,null,function*(){if(u===a.eFs)throw new Error((0,a.t)("\u65E0\u6CD5\u5220\u9664\u6240\u6709\u4EBA\u6743\u9650"));yield a.o4J.ru.deleteGroupRole(o,u),(0,a.jiy)()}),[o,u]);return{loading:s||f||S||c,handleCreateRole:C,handleSavePermission:g,handleChangeRoleName:v,handleDeleteRole:E}}var _e=e(7606);const Et=t.memo(o=>{const{currentRoleInfo:u}=o,s=(0,a.nWw)(()=>{(0,A.VW)({title:(0,a.t)("\u786E\u8BA4\u8981\u5220\u9664\u89D2\u8272 {{name}} \u4E48?",{name:u.name}),onConfirm:()=>o.onDeleteRole()})});return t.createElement("div",{className:"px-2"},t.createElement(_e.LP,{title:(0,a.t)("\u8EAB\u4EFD\u7EC4\u540D\u79F0"),value:o.currentRoleInfo.name,editable:!0,renderEditor:_e.jo,onSave:o.onChangeRoleName}),t.createElement(W.Z,{type:"primary",danger:!0,onClick:s},(0,a.t)("\u5220\u9664\u8EAB\u4EFD\u7EC4")))});Et.displayName="RoleSummary";function Rt(o){const[u,s]=(0,t.useState)([]),C=(0,t.useMemo)(()=>!x()(new Set(o),new Set(u)),[o,u]);return(0,t.useEffect)(()=>{s([...o])},[o]),{isEditing:C,editingPermission:u,setEditingPermission:s}}const ft=t.memo(o=>{const u=(0,t.useMemo)(()=>{var S,v;return o.roleId===a.eFs?o.fallbackPermissions:(v=(S=o.currentRoleInfo)==null?void 0:S.permissions)!=null?v:[]},[o.roleId,o.fallbackPermissions,o.currentRoleInfo]),{isEditing:s,editingPermission:C,setEditingPermission:f}=Rt(u),g=(0,t.useCallback)(()=>{f((0,a.Q$5)())},[]);return t.createElement("div",null,t.createElement("div",{className:"mb-2 space-x-2 text-right"},t.createElement(W.Z,{onClick:g},(0,a.t)("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C")),t.createElement(W.Z,{type:"primary",disabled:!s,onClick:()=>o.onSavePermission(C)},(0,a.t)("\u4FDD\u5B58"))),t.createElement(se,{value:C,onChange:f}))});ft.displayName="RolePermission";var Lt=e(38643),Tt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const pt=t.memo(o=>{const{groupId:u,withoutMemberIds:s=[],onConfirm:C}=o,[f,g]=(0,t.useState)([]),S=(0,a.aaJ)(u),v=(0,t.useMemo)(()=>b()(S,...s),[S,s]),[{loading:c},E]=(0,a.ilX)(()=>Tt(void 0,null,function*(){yield C(f)}),[C,f]);return t.createElement(A.AB,{title:(0,a.t)("\u9009\u62E9\u7FA4\u7EC4\u6210\u5458")},t.createElement(Lt.f,{allUserIds:v,selectedIds:f,onChange:g}),t.createElement("div",{className:"text-right"},t.createElement(W.Z,{type:"primary",loading:c,onClick:E},(0,a.t)("\u786E\u8BA4"))))});pt.displayName="SelectGroupMember";var ht=e(9021),st=e(79546),Ut=e(6494),gt=e.n(Ut),yt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const Pt=t.memo(o=>{var u,s;const C=o.currentRoleInfo._id,f=(0,a.iFL)(o.groupId),S=((u=f==null?void 0:f.members)!=null?u:[]).filter(Ie=>{var ve;return((ve=Ie.roles)!=null?ve:[]).includes(C)}).map(Ie=>Ie.userId),v=(0,a.FDf)(S),{searchText:c,setSearchText:E,isSearching:T,searchResult:ae}=(0,a.RxY)({dataSource:v,filterFn:(Ie,ve)=>String(Ie.nickname).includes(ve)}),Xe=(0,a.nWw)(()=>{const Ie=(0,A.h7)(t.createElement(pt,{groupId:o.groupId,withoutMemberIds:gt()([...S]),onConfirm:ve=>yt(void 0,null,function*(){try{yield a.o4J.ru.appendGroupMemberRoles(o.groupId,ve,[o.currentRoleInfo._id]),(0,a.jiy)(),(0,A.Mr)(Ie)}catch(et){(0,a.hJM)(et)}})}))}),[,$e]=(0,a.CoE)(Ie=>yt(void 0,null,function*(){var ve;if(!((ve=o.currentRoleInfo)==null?void 0:ve._id)){(0,a.hJM)((0,a.t)("\u5F53\u524D\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u89D2\u8272\u7EC4"));return}yield a.o4J.ru.removeGroupMemberRoles(o.groupId,[Ie],[o.currentRoleInfo._id]),(0,a.jiy)()}),[o.groupId,(s=o.currentRoleInfo)==null?void 0:s._id]);return t.createElement("div",null,t.createElement("div",{className:"text-right mb-2 flex space-x-1"},t.createElement(W.Z,{type:"primary",onClick:Xe},(0,a.t)("\u6DFB\u52A0\u6210\u5458")),v.length>0&&t.createElement(st.Z,{placeholder:(0,a.t)("\u641C\u7D22\u6210\u5458"),size:"middle",suffix:t.createElement($.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:c,onChange:Ie=>E(Ie.target.value)})),(T?ae:v).map(Ie=>t.createElement(ht.Q,{key:Ie._id,userId:Ie._id,actions:[t.createElement(N.a,{key:"remove",icon:"mdi:close",onClick:()=>$e(Ie._id)})]})))});Pt.displayName="RoleMember";var Gt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const Ct=t.memo(o=>{var u,s;const{groupId:C}=o,[f,g]=(0,t.useState)(a.eFs),S=(0,a.iFL)(C),v=(u=S==null?void 0:S.roles)!=null?u:[],c=(0,t.useMemo)(()=>v.find(Ie=>Ie._id===f),[v,f]),{loading:E,handleCreateRole:T,handleSavePermission:ae,handleChangeRoleName:Xe,handleDeleteRole:$e}=St(C,f);return t.createElement(vt.g,{spinning:E,className:"h-full"},t.createElement("div",{className:"flex h-full"},t.createElement("div",{className:"pr-2 mr-2 w-40 mobile:w-28 border-r border-white border-opacity-20"},t.createElement(lt,{active:f===a.eFs,onClick:()=>g(a.eFs)},(0,a.t)("\u6240\u6709\u4EBA")),v.map(Ie=>t.createElement(lt,{key:Ie._id,active:f===Ie._id,onClick:()=>g(Ie._id)},Ie.name)),t.createElement(lt,{active:!1,onClick:T},(0,a.t)("\u6DFB\u52A0\u89D2\u8272"))),t.createElement("div",{className:"flex-1 overflow-y-auto"},t.createElement(bt.N,{defaultActiveKey:"permission",items:[{key:"summary",label:(0,a.t)("\u6982\u8FF0"),disabled:f===a.eFs,children:t.createElement(t.Fragment,null,c&&t.createElement(Et,{currentRoleInfo:c,onChangeRoleName:Xe,onDeleteRole:()=>Gt(void 0,null,function*(){yield $e(),g(a.eFs)})}))},{key:"permission",label:(0,a.t)("\u6743\u9650"),children:t.createElement(ft,{roleId:f,fallbackPermissions:(s=S==null?void 0:S.fallbackPermissions)!=null?s:[],currentRoleInfo:c,onSavePermission:ae})},{key:"member",label:(0,a.t)("\u7BA1\u7406\u6210\u5458"),disabled:f===a.eFs,children:t.createElement(t.Fragment,null,c&&t.createElement(Pt,{groupId:C,currentRoleInfo:c}))}]}))))});Ct.displayName="GroupRole";var It=e(92951),Wt=e(15333),ut=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const Dt=t.memo(({groupId:o})=>{var u,s;const C=(0,a.iFL)(o),[,f]=(0,a.CoE)(v=>ut(void 0,null,function*(){yield(0,a.uRW)(o,"name",v),(0,a.jiy)((0,a.t)("\u4FEE\u6539\u7FA4\u7EC4\u540D\u6210\u529F"))}),[o]),[,g]=(0,a.CoE)(v=>ut(void 0,null,function*(){yield(0,a.uRW)(o,"description",v),(0,a.jiy)((0,a.t)("\u4FEE\u6539\u7FA4\u7EC4\u63CF\u8FF0\u6210\u529F"))}),[o]),[,S]=(0,a.CoE)(v=>ut(void 0,null,function*(){yield(0,a.uRW)(o,"avatar",v.url),(0,a.lHp)((0,a.t)("\u4FEE\u6539\u7FA4\u7EC4\u5934\u50CF\u6210\u529F"),"success")}),[o]);return C?t.createElement("div",null,t.createElement(nt,null,(0,a.t)("\u7FA4\u7EC4\u6982\u8FF0")),t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-1/3 mobile:w-full mobile:text-center"},t.createElement(It.C,{circle:!0,onUploadSuccess:S},t.createElement($.qE,{size:128,name:C.name,src:C.avatar}))),t.createElement("div",{className:"w-2/3 mobile:w-full"},t.createElement(_e.LP,{title:(0,a.t)("\u7FA4\u7EC4\u540D\u79F0"),value:C.name,editable:!0,renderEditor:_e.jo,onSave:f}),t.createElement(_e.LP,{title:(0,a.t)("\u6210\u5458\u6570"),value:String(C.members.length)}),t.createElement(_e.LP,{title:(0,a.t)("\u7FA4\u7EC4\u63CF\u8FF0"),value:(u=C.description)!=null?u:"",content:t.createElement("pre",null,(s=C.description)!=null?s:""),editable:!0,renderEditor:wt,onSave:g})))):t.createElement(Wt.J,{message:(0,a.t)("\u65E0\u6CD5\u83B7\u53D6\u5230\u7FA4\u7EC4\u4FE1\u606F")})});Dt.displayName="GroupSummary";const wt=({value:o,onChange:u})=>t.createElement(st.Z.TextArea,{autoSize:{minRows:4,maxRows:6},maxLength:120,value:o,onChange:s=>u(s.target.value),showCount:!0});var Kt=(o,u,s)=>new Promise((C,f)=>{var g=c=>{try{v(s.next(c))}catch(E){f(E)}},S=c=>{try{v(s.throw(c))}catch(E){f(E)}},v=c=>c.done?C(c.value):Promise.resolve(c.value).then(g,S);v((s=s.apply(o,u)).next())});const Mt=t.memo(o=>{var u,s,C;const f=o.groupId,g=(0,a.iFL)(f),S=(0,a.TL5)(),[{loading:v},c]=(0,a.CoE)((T,ae)=>Kt(void 0,null,function*(){yield a.o4J.ru.modifyGroupConfig(f,T,ae),S(a.hyC.updateGroupConfig({groupId:f,configName:T,configValue:ae})),(0,a.jiy)()}),[f]);if(!g)return t.createElement(vt.g,{spinning:!0});const E=(u=g.config)!=null?u:{};return t.createElement("div",null,t.createElement(nt,null,(0,a.t)("\u7FA4\u7EC4\u914D\u7F6E")),t.createElement(_e.LP,{title:(0,a.t)("\u9690\u85CF\u6210\u5458\u5B8C\u6574\u540D\u79F0"),tip:(0,a.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u83B7\u53D6\u6210\u5458\u4FE1\u606F"),content:t.createElement(We.Z,{disabled:v,checked:(s=E.hideGroupMemberDiscriminator)!=null?s:!1,onChange:T=>c("hideGroupMemberDiscriminator",T)})}),t.createElement(_e.LP,{title:(0,a.t)("\u7981\u6B62\u5728\u7FA4\u7EC4\u53D1\u8D77\u79C1\u4FE1"),tip:(0,a.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u9A9A\u6270\u7528\u6237\u3002"),content:t.createElement(We.Z,{disabled:v||E.hideGroupMemberDiscriminator===!0,checked:(C=E.hideGroupMemberDiscriminator===!0||E.disableCreateConverseFromGroup)!=null?C:!1,onChange:T=>c("disableCreateConverseFromGroup",T)})}),t.createElement(_e.LP,{title:(0,a.t)("\u7FA4\u7EC4\u80CC\u666F"),tip:(0,a.t)("\u4E2A\u6027\u5316\u914D\u7F6E\u7FA4\u7EC4\u80CC\u666F"),content:t.createElement(t.Fragment,null,t.createElement(It.w,{aspect:16/9,onUploadSuccess:T=>{c("groupBackgroundImage",T.url)}},t.createElement($.Ee,{wrapperClassName:"block",style:{width:640,height:360},src:E.groupBackgroundImage})),t.createElement("div",{className:"text-xs opacity-80"},(0,a.t)("\u5EFA\u8BAE\u6BD4\u4F8B: 16:9 | \u5EFA\u8BAE\u5927\u5C0F: 1280x720")),E.groupBackgroundImage&&t.createElement(W.Z,{className:"mt-1",type:"primary",onClick:()=>{c("groupBackgroundImage","")}},(0,a.t)("\u6E05\u9664")))}),i.pluginGroupConfigItems.map(T=>{const ae=(0,be.g)(T.name);return t.createElement(_e.LP,{key:ae,title:T.title,tip:T.tip,content:t.createElement(T.component,{value:E[ae],onChange:Xe=>c(ae,Xe),loading:v})})}))});Mt.displayName="GroupConfig";var Zt=e(64917),jt=e(96136),kt=e(6342);const Ft=t.memo(o=>{const u=o.groupId,{userInfos:s,searchText:C,setSearchText:f,isSearching:g,searchResult:S,generateActionMenu:v}=(0,Zt.Q)(u),c=E=>{const T=v(E);return t.createElement(ht.Q,{key:E._id,userId:E._id,actions:[t.createElement("div",{key:"more"},t.createElement(jt.Z,{menu:T,trigger:["click"],placement:"bottomRight"},t.createElement("div",null,t.createElement(N.a,{icon:"mdi:dots-vertical"}))))]})};return t.createElement("div",{className:"flex flex-col h-full"},t.createElement(nt,null,(0,a.t)("\u6210\u5458\u7BA1\u7406")),t.createElement("div",{className:"py-2"},t.createElement(st.Z,{placeholder:(0,a.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:t.createElement($.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:C,onChange:E=>f(E.target.value)})),t.createElement("div",{className:"flex-1 overflow-auto"},t.createElement(kt.OO,{style:{height:"100%"},data:g?S:s,itemContent:(E,T)=>c(T)})))});Ft.displayName="GroupMember";const xt=t.memo(o=>{const u=o.groupId,s=(0,t.useCallback)(E=>{E===!1&&typeof o.onClose=="function"&&o.onClose()},[o.onClose]),[C,f,g,S,v]=(0,a.WHr)(u,[a.g3S.core.groupConfig,a.g3S.core.manageUser,a.g3S.core.managePanel,a.g3S.core.manageInvite,a.g3S.core.manageRoles]),c=(0,t.useMemo)(()=>{const E=[{type:"group",title:(0,a.t)("\u901A\u7528"),children:gt()([{type:"item",title:(0,a.t)("\u6982\u8FF0"),content:t.createElement(Dt,{groupId:u})},C&&{type:"item",title:(0,a.t)("\u914D\u7F6E"),content:t.createElement(Mt,{groupId:u})},f&&{type:"item",title:(0,a.t)("\u6210\u5458"),content:t.createElement(Ft,{groupId:u})},g&&{type:"item",title:(0,a.t)("\u9762\u677F"),content:t.createElement(dt,{groupId:u})},S&&{type:"item",title:(0,a.t)("\u9080\u8BF7\u7801"),content:t.createElement(w,{groupId:u})},v&&{type:"item",title:(0,a.t)("\u8EAB\u4EFD\u7EC4"),content:t.createElement(Ct,{groupId:u})}])}],T=i.pluginCustomPanel.filter(ae=>ae.position==="groupdetail").map(ae=>({type:"item",title:ae.label,content:t.createElement(ae.render)}));return T.length>0&&E.push({type:"group",title:(0,a.t)("\u63D2\u4EF6"),children:T}),E},[]);return t.createElement(l.A,{value:u},t.createElement(r.o,{onChangeVisible:s},t.createElement(n.u,{menu:c,defaultContentPath:"0.children.0.content"})))});xt.displayName="GroupDetail"},51052:(Fe,H,e)=>{e.d(H,{Z:()=>ce});var r=e(50842),n=e(52983),l=e(98281),i=e(84143),t=e(66559),a=e(83996),B=e(58761),O=e(56489),W=e(95268),p=e(54782),y=e(93540),A=(_,w,P)=>new Promise((x,m)=>{var D=le=>{try{k(P.next(le))}catch(de){m(de)}},Z=le=>{try{k(P.throw(le))}catch(de){m(de)}},k=le=>le.done?x(le.value):Promise.resolve(le.value).then(D,Z);k((P=P.apply(_,w)).next())});const U=n.memo(_=>{const{userInfo:w}=_,P=w._id,[x]=(0,l.aoI)([P]),{value:m}=(0,l.r53)(()=>A(void 0,null,function*(){if(!w.avatar)return(0,y.Yy)(w.nickname);const D=yield(0,a.f)(w.avatar);return`rgba(${D.r}, ${D.g}, ${D.b}, ${D.a})`}),[w.avatar]);return n.createElement("div",{className:"relative bg-inherit"},n.createElement("div",{style:{width:"100%",height:60,backgroundColor:m}}),n.createElement("div",{className:"absolute p-1 rounded-1/2 -mt-11 ml-3 bg-inherit"},n.createElement(y.OI,{size:80,src:w.avatar,name:w.nickname,isOnline:x})),n.createElement("div",{className:"p-2 mt-10"},_.children))});U.displayName="UserProfileContainer";var M=e(7975);function N(_={}){return n.createElement(n.Fragment,null,M.pluginUserExtraInfo.map((w,P)=>{var x;const m=(x=w.component)==null?void 0:x.render;return m?n.createElement(m,{key:w.name+P,value:_[w.name]}):n.createElement("div",{key:w.name+P,className:"flex"},n.createElement("div",{className:"w-1/4 text-gray-500"},w.label,":"),n.createElement("div",{className:"w-3/4"},_[w.name]?String(_[w.name]):""))}))}var G=(_,w,P)=>new Promise((x,m)=>{var D=le=>{try{k(P.next(le))}catch(de){m(de)}},Z=le=>{try{k(P.throw(le))}catch(de){m(de)}},k=le=>le.done?x(le.value):Promise.resolve(le.value).then(D,Z);k((P=P.apply(_,w)).next())});const K=n.memo(_=>{var w;const{userInfo:P,groupInfo:x}=_,m=P._id,D=(w=P.extra)!=null?w:{},Z=Q(m,x),{hideGroupMemberDiscriminator:k,disableCreateConverseFromGroup:le}=(0,l.r3q)(x),de=N(D),Ee=(0,p.useNavigate)(),xe=(0,l.IIz)(),Me=!k&&!le&&xe!==m,[,be]=(0,l.CoE)(()=>G(void 0,null,function*(){const Se=yield(0,l.L1i)([m]);Ee(`/main/personal/converse/${Se._id}`)}),[Ee]);return(0,n.useEffect)(()=>{P.avatar&&(0,a.f)(P.avatar).then(Se=>{console.log("fetchImagePrimaryColor",Se)})},[P.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(U,{userInfo:P},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(t.v,{userId:m})),!k&&n.createElement("span",{className:"opacity-60 ml-1"},"#",P.discriminator)),n.createElement(B.Z,{size:4,wrap:!0,className:"py-1"},x.owner===m&&n.createElement(O.Z,{color:"gold"},(0,l.t)("\u521B\u5EFA\u8005")),P.temporary&&n.createElement(O.Z,{color:"processing"},(0,l.t)("\u6E38\u5BA2")),Z.map(Se=>n.createElement(O.Z,{key:Se,color:(0,y.Yy)(Se)},Se))),n.createElement("div",{className:"pt-2"},de),n.createElement("div",{className:"text-right"},Me&&n.createElement(W.Z,{title:(0,l.t)("\u53D1\u9001\u6D88\u606F")},n.createElement(i.a,{icon:"mdi:message-processing-outline",onClick:be})))))});K.displayName="GroupUserPopover";function Q(_,w){var P,x;const m=(x=(P=w.members.find(Z=>Z.userId===_))==null?void 0:P.roles)!=null?x:[];return w.roles.filter(Z=>m.includes(Z._id)).map(Z=>Z.name)}const $=n.memo(_=>{var w;const{userInfo:P}=_,x=(w=P.extra)!=null?w:{},m=N(x);return(0,n.useEffect)(()=>{P.avatar&&(0,a.f)(P.avatar).then(D=>{console.log("fetchImagePrimaryColor",D)})},[P.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(U,{userInfo:P},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(t.v,{userId:P._id})),n.createElement("span",{className:"opacity-60 ml-1"},"#",P.discriminator)),n.createElement(B.Z,{size:4,wrap:!0,className:"py-1"},P.temporary&&n.createElement(O.Z,{color:"processing"},(0,l.t)("\u6E38\u5BA2"))),n.createElement("div",{className:"pt-2"},m)))});$.displayName="PersonalUserPopover";const ce=n.memo(_=>{const w=(0,r.b)(),P=(0,l.iFL)(w);return(0,l.xzJ)(_.userInfo._id,!0),P?n.createElement(K,{userInfo:_.userInfo,groupInfo:P}):n.createElement($,{userInfo:_.userInfo})});ce.displayName="UserPopover"},63933:(Fe,H,e)=>{e.d(H,{q:()=>l});var r=e(52983),n=e(98281);function l(i,t){const a=(0,n.ysv)(i);(0,r.useLayoutEffect)(()=>{const B=O=>{typeof a.current=="function"&&a.current(O)};return window.addEventListener("keydown",B,t),()=>{window.removeEventListener("keydown",B,t)}},[])}},64917:(Fe,H,e)=>{e.d(H,{Q:()=>O});var r=e(84208),n=e(52983),l=e(98281),i=e(6494),t=e.n(i),a=e(95850),B=(p,y,A)=>new Promise((U,M)=>{var N=Q=>{try{K(A.next(Q))}catch($){M($)}},G=Q=>{try{K(A.throw(Q))}catch($){M($)}},K=Q=>Q.done?U(Q.value):Promise.resolve(Q.value).then(N,G);K((A=A.apply(p,y)).next())});function O(p){var y;const A=(0,l.iFL)(p),U=(y=A==null?void 0:A.members)!=null?y:[],M=(0,l.Tgq)(p),N=(0,a.x)(),{handleMuteMember:G,handleUnmuteMember:K}=W(p,M),{searchText:Q,setSearchText:$,isSearching:ce,searchResult:_}=(0,l.RxY)({dataSource:M,filterFn:(m,D)=>!!(N[m._id]&&N[m._id].includes(D)||m.nickname.includes(D))}),[,w]=(0,l.CoE)(m=>B(this,null,function*(){(yield(0,r.aW)({title:(0,l.t)("\u786E\u8BA4\u8981\u5C06\u8BE5\u7528\u6237\u79FB\u51FA\u7FA4\u7EC4\u4E48")}))&&(yield l.o4J.ru.deleteGroupMember(p,m),(0,l.jiy)())}),[p]),P=(0,n.useCallback)(m=>{const D=U.find(k=>k.userId===m);if(!D||!D.muteUntil)return!1;const Z=D.muteUntil;return new Date(Z).valueOf()>new Date().valueOf()},[U]),x=(0,l.nWw)(m=>{const Z=P(m._id)?[{key:"unmute",label:(0,l.t)("\u89E3\u9664\u7981\u8A00"),onClick:()=>K(m._id)}]:[{key:"mute",label:(0,l.t)("\u7981\u8A00"),children:[{key:"1m",label:(0,l.t)("1\u5206\u949F"),onClick:()=>G(m._id,1*60*1e3)},{key:"5m",label:(0,l.t)("5\u5206\u949F"),onClick:()=>G(m._id,5*60*1e3)},{key:"10m",label:(0,l.t)("10\u5206\u949F"),onClick:()=>G(m._id,10*60*1e3)},{key:"30m",label:(0,l.t)("30\u5206\u949F"),onClick:()=>G(m._id,30*60*1e3)},{key:"1d",label:(0,l.t)("1\u5929"),onClick:()=>G(m._id,1*24*60*60*1e3)},{key:"7d",label:(0,l.t)("7\u5929"),onClick:()=>G(m._id,7*24*60*60*1e3)},{key:"30d",label:(0,l.t)("30\u5929"),onClick:()=>G(m._id,30*24*60*60*1e3)}]}];return{items:t()([...Z,{key:"delete",label:(0,l.t)("\u79FB\u51FA\u7FA4\u7EC4"),danger:!0,onClick:()=>w(m._id)}])}});return{userInfos:M,searchText:Q,setSearchText:$,isSearching:ce,searchResult:_,getMemberHasMute:P,handleMuteMember:G,handleUnmuteMember:K,handleRemoveGroupMember:w,generateActionMenu:x}}function W(p,y){const[,A]=(0,l.CoE)((M,N)=>B(this,null,function*(){const G=y.find(K=>K._id===M);if(!G)throw new Error((0,l.t)("\u6CA1\u6709\u627E\u5230\u7528\u6237"));(yield(0,r.aW)({title:(0,l.t)("\u786E\u5B9A\u8981\u7981\u8A00 {{name}} \u4E48",{name:G.nickname}),content:(0,l.t)("\u7981\u8A00 {{length}}, \u9884\u8BA1\u5230 {{until}} \u4E3A\u6B62",{length:(0,l.TGs)(N),until:(0,l.KJm)(new Date().valueOf()+N)})}))&&(yield l.o4J.ru.muteGroupMember(p,M,N),(0,l.jiy)())}),[p,y]),[,U]=(0,l.CoE)(M=>B(this,null,function*(){yield l.o4J.ru.muteGroupMember(p,M,-1),(0,l.jiy)()}),[p]);return{handleMuteMember:A,handleUnmuteMember:U}}},95483:(Fe,H,e)=>{e.d(H,{r:()=>A});var r=e(98281);const n=(0,r.fA3)(()=>sessionStorage);var l=Object.defineProperty,i=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,W=(U,M,N)=>M in U?l(U,M,{enumerable:!0,configurable:!0,writable:!0,value:N}):U[M]=N,p=(U,M)=>{for(var N in M||(M={}))B.call(M,N)&&W(U,N,M[N]);if(a)for(var N of a(M))O.call(M,N)&&W(U,N,M[N]);return U},y=(U,M)=>i(U,t(M));function A(U){const[M={},N]=n("sessionPreference"),G=M[U],K=(0,r.nWw)(Q=>{N(y(p({},M),{[U]:Q}))});return[G,K]}},16131:(Fe,H,e)=>{e.d(H,{E:()=>Ye,x:()=>qe});var r=e(6739),n=e(89889),l=e(48303),i=e(52983),t=e(98281);const a=i.memo(ie=>{const Y=(0,t.wY6)(ie.groupId,ie.panelId);if(!Y)return i.createElement(l.Z,{className:"w-full text-center",message:(0,t.t)("\u65E0\u6CD5\u83B7\u53D6\u9762\u677F\u4FE1\u606F")});if(typeof Y.provider!="string")return i.createElement(l.Z,{className:"w-full text-center",message:(0,t.t)("\u672A\u627E\u5230\u63D2\u4EF6\u7684\u63D0\u4F9B\u8005")});const me=(0,i.useMemo)(()=>(0,t.YQu)(Y.pluginPanelName)?(0,n.S)(Y.pluginPanelName):null,[Y.name]);if(!me)return i.createElement(l.Z,{className:"w-full text-center",message:i.createElement("div",null,i.createElement("p",null,(0,t.t)("\u8BE5\u9762\u677F\u7531\u63D2\u4EF6\u63D0\u4F9B")),i.createElement("p",null,(0,t.t)("\u63D2\u4EF6\u540D"),": ",Y.provider),i.createElement("p",null,(0,t.t)("\u9762\u677F\u540D"),": ",Y.pluginPanelName))});const Pe=me.render;return Pe?i.createElement(Pe,{panelInfo:Y}):i.createElement(r.t,{text:(0,t.t)("\u63D2\u4EF6\u6E32\u67D3\u51FD\u6570\u4E0D\u5B58\u5728")})});a.displayName="GroupPluginPanel";var B=e(21506),O=e(29254),W=e(84143),p=e(7975),y=e(95850),A=e(93540),U=e(9021),M=e(55696),N=e(96136),G=e(79546),K=e(64917),Q=e(51052),$=e(6342),ce=e(89022),_=e.n(ce),w=e(28102),P=e.n(w),x=e(13546),m=e.n(x);const D=i.memo(ie=>{var Y;const me=ie.groupId,Pe=(0,t.iFL)(me),Re=(Y=Pe==null?void 0:Pe.members)!=null?Y:[],Ue=(0,t.aoI)(Re.map(ge=>ge.userId)),[we]=(0,t.WHr)(me,[t.g3S.core.manageUser]),{hideGroupMemberDiscriminator:Ge}=(0,t.r3q)(Pe),{userInfos:R,searchText:q,setSearchText:j,isSearching:V,searchResult:X,generateActionMenu:he}=(0,K.Q)(me),fe=(0,i.useMemo)(()=>{const ge=[],I=[];return R.forEach((L,b)=>{Ue[b]===!0?ge.push(L):I.push(L)}),{[(0,t.t)("\u5728\u7EBF")]:ge,[(0,t.t)("\u79BB\u7EBF")]:I}},[R,Ue]),{groupCounts:Oe,groupNames:Ne,getGroupedMemberInfo:Le}=(0,i.useMemo)(()=>{const ge=V?{"":X}:fe,I=Object.values(ge).map(se=>se.length),L=Object.keys(ge);return{groupCounts:I,groupNames:L,getGroupedMemberInfo:(se,J)=>{const ye=L[J],Be=P()(_()(I,J)),pe=se-Be;return m()(ge,[ye,pe],null)}}},[V,X,fe]);if(!Pe)return i.createElement(r.t,null);if(R.length===0)return i.createElement(M.Z,null);const We=ge=>{if(!ge)return i.createElement("div",null);if(we){const I=he(ge);return i.createElement(N.Z,{key:ge._id,trigger:["contextMenu"],menu:I},i.createElement("div",null,i.createElement(U.Q,{userId:ge._id,popover:i.createElement(Q.Z,{userInfo:ge}),hideDiscriminator:Ge})))}else return i.createElement(U.Q,{key:ge._id,userId:ge._id,popover:i.createElement(Q.Z,{userInfo:ge}),hideDiscriminator:Ge})};return i.createElement("div",{className:"h-full flex flex-col"},i.createElement("div",{className:"p-2"},i.createElement(G.Z,{placeholder:(0,t.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:i.createElement(A.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:q,onChange:ge=>j(ge.target.value)})),i.createElement("div",{className:"flex-1"},i.createElement($.Px,{className:"h-full",groupCounts:Oe,groupContent:ge=>i.createElement("div",{className:"pt-4 px-2.5 font-bold text-sm text-opacity-80 bg-content-light dark:bg-content-dark"},Ne[ge]," - ",Oe[ge]),itemContent:(ge,I)=>We(Le(ge,I))})))});D.displayName="MembersPanel";var Z=e(29188);function k(ie,Y){const me=(0,t.IIz)(),Pe=(0,t.mWi)(ie,me??""),[Re]=(0,t.a_M)(ie,Y,[t.g3S.core.message]),[Ue,we]=(0,i.useState)(void 0),Ge=(0,i.useCallback)(()=>{we(Pe&&Pe?(0,t.t)("\u7981\u8A00\u4E2D, \u8FD8\u5269 {{remain}}",{remain:(0,t.TGs)(new Date().valueOf()-new Date(Pe).valueOf())}):void 0)},[Pe]);return(0,t.Yzt)(Ge,1e4),(0,i.useLayoutEffect)(()=>{Ge()},[Pe]),Re?{disabled:Boolean(Pe),placeholder:Ue}:{disabled:!0,placeholder:(0,t.t)("\u6CA1\u6709\u53D1\u9001\u6D88\u606F\u7684\u6743\u9650, \u8BF7\u8054\u7CFB\u7FA4\u7EC4\u6240\u6709\u8005")}}const le=i.memo(({groupId:ie,panelId:Y})=>{const me=(0,t.iFL)(ie),Pe=(0,t.Tgq)(ie),Re=(0,t.wY6)(ie,Y),{disabled:Ue,placeholder:we}=k(ie,Y),Ge=(0,y.x)();return!me||!Re?null:i.createElement(Z.q,{groupId:ie,panelId:Y,prefixActions:()=>[...p.pluginPanelActions.filter(R=>R.position==="group").map(R=>i.createElement(W.a,{key:R.name,title:R.label,shape:"square",icon:R.icon,iconClassName:"text-2xl",onClick:()=>R.onClick({groupId:ie,panelId:Y})}))],suffixActions:({setRightPanel:R})=>[i.createElement(W.a,{key:"members",title:(0,t.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>R({name:(0,t.t)("\u6210\u5458")+` (${Pe.length})`,panel:i.createElement(D,{groupId:ie})})})]},i.createElement(O.x2,{users:Pe.map(R=>({id:R._id,display:Ge[R._id]?Ge[R._id]:R.nickname})),panels:me.panels.filter(R=>R.type!==t.Xpe.GROUP).map(R=>({id:`/main/group/${ie}/${R.id}`,display:R.name})),disabled:Ue,placeholder:we},i.createElement(B.r,{converseId:Y,converseTitle:Re.name,isGroup:!0,groupId:ie})))});le.displayName="TextPanel";var de=e(85478),Ee=e(95483),xe=e(22215),Me=Object.defineProperty,be=Object.defineProperties,Se=Object.getOwnPropertyDescriptors,Ze=Object.getOwnPropertySymbols,ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,je=(ie,Y,me)=>Y in ie?Me(ie,Y,{enumerable:!0,configurable:!0,writable:!0,value:me}):ie[Y]=me,He=(ie,Y)=>{for(var me in Y||(Y={}))ze.call(Y,me)&&je(ie,me,Y[me]);if(Ze)for(var me of Ze(Y))Je.call(Y,me)&&je(ie,me,Y[me]);return ie},Ve=(ie,Y)=>be(ie,Se(Y));function Qe(ie,Y){const[me,Pe]=(0,Ee.r)("groupLastVisitPanel");(0,i.useEffect)(()=>{Pe(Ve(He({},me),{[ie]:Y}))},[ie,Y])}const Ye=i.memo(ie=>{const{groupId:Y,panelId:me}=ie,Pe=(0,t.iFL)(Y),Re=(0,t.wY6)(Y,me),Ue=(0,i.useMemo)(()=>({groupId:Y,panelId:me}),[Y,me]);return Qe(Y,me),Pe===null?i.createElement(l.Z,{className:"w-full text-center",type:"error",message:(0,t.t)("\u7FA4\u7EC4\u4E0D\u5B58\u5728")}):Re===null?i.createElement(r.t,{text:(0,t.t)("\u9762\u677F\u4E0D\u5B58\u5728")}):Re.type===t.Xpe.TEXT?i.createElement(t.f4G,{groupInfo:Pe},i.createElement(de.x.Provider,{value:Ue},i.createElement(le,{groupId:Y,panelId:Re.id}))):Re.type===t.Xpe.PLUGIN?i.createElement(de.x.Provider,{value:Ue},i.createElement(a,{groupId:Y,panelId:Re.id})):i.createElement(l.Z,{className:"w-full text-center",type:"error",message:(0,t.t)("\u672A\u77E5\u7684\u9762\u677F\u7C7B\u578B")})});Ye.displayName="GroupPanelRender";const qe=i.memo(()=>{const{groupId:ie,panelId:Y}=(0,xe.PO)();return i.createElement(Ye,{groupId:ie,panelId:Y})});qe.displayName="GroupPanelRoute"},53937:(Fe,H,e)=>{e.d(H,{Z:()=>Ge});var r=e(6739),n=e(14517),l=e(52983),i=e(72425),t=e(98281);const a=l.memo(R=>{const[q,{save:j}]=(0,t.y$C)("pin-sizes",[90,10]),V=X=>{j(X)};return l.createElement(i.Z,{className:(0,n.Z)("split",R.className),sizes:q,minSize:250,expandToMin:!0,onDragEnd:V},R.children)});a.displayName="SplitPanel";var B=e(50842),O=e(54782),W=e(12492),p=e(16131),y=e(14698),A=e.n(y),U=e(95483);const M=l.memo(()=>{const{groupId:R=""}=(0,O.useParams)(),q=(0,O.useNavigate)(),[j]=(0,U.r)("groupLastVisitPanel"),V=(0,t.ysv)(j),X=(0,t.iFL)(R);return(0,l.useEffect)(()=>{var he;if(!X||!Array.isArray(X==null?void 0:X.panels)||(X==null?void 0:X.panels.length)===0)return;const fe=(he=V.current)==null?void 0:he[X._id],Oe=X.panels;if(Oe.some(We=>We.id===fe)){q(`/main/group/${R}/${fe}`,{replace:!0});return}const Le=Oe.find(We=>We.type!==t.Xpe.GROUP);A()(Le)||q(`/main/group/${R}/${Le.id}`,{replace:!0})},[X]),null});M.displayName="GroupPanelRedirect";var N=e(6494),G=e.n(N),K=e(1348),Q=e(84208),$=e(17679),ce=e(40318),_=e(72297),w=e(59417),P=e.n(w);function x(R,q){const j=(0,O.useLocation)(),V=(0,l.useRef)(""),X=(0,t.ysv)(q);(0,l.useEffect)(()=>{const{nav:he}=(0,_.qp)(j.search,{ignoreQueryPrefix:!0}),fe=String(he);fe&&(fe!==V.current&&P()(fe,R)&&X.current(fe),V.current=fe)},[j.search])}var m=(R,q,j)=>new Promise((V,X)=>{var he=Ne=>{try{Oe(j.next(Ne))}catch(Le){X(Le)}},fe=Ne=>{try{Oe(j.throw(Ne))}catch(Le){X(Le)}},Oe=Ne=>Ne.done?V(Ne.value):Promise.resolve(Ne.value).then(he,fe);Oe((j=j.apply(R,q)).next())});function D(R){const q=(0,t.GLd)(R),j=(0,O.useNavigate)(),V=(0,l.useCallback)(()=>{const fe=(0,Q.h7)(l.createElement($.a,{groupId:R,onClose:()=>{(0,Q.Mr)(fe)}}))},[R]),X=(0,l.useCallback)(()=>{(0,Q.h7)(l.createElement(ce.P,{groupId:R}))},[R]),he=(0,l.useCallback)(()=>{(0,t.wp$)({message:q?(0,t.t)("\u60A8\u662F\u7FA4\u7EC4\u7BA1\u7406\u8005\uFF0C\u9000\u51FA\u7FA4\u7EC4\u4F1A\u5BFC\u81F4\u89E3\u6563\u7FA4\u7EC4"):(0,t.t)("\u786E\u5B9A\u8981\u9000\u51FA\u7FA4\u7EC4\u4E48?"),onConfirm(){return m(this,null,function*(){yield(0,t.XV6)(R),j("/main",{replace:!0})})}})},[R,q]);return x("group.*",fe=>{fe.startsWith("group.detail")&&V()}),{handleShowGroupDetail:V,handleInviteUser:X,handleQuitGroup:he}}const Z=l.memo(R=>{const{groupId:q}=R,j=(0,t.iFL)(q),{t:V}=(0,t.$G7)(),[X,he]=(0,t.WHr)(q,[t.g3S.core.groupDetail,t.g3S.core.invite]),{handleShowGroupDetail:fe,handleInviteUser:Oe,handleQuitGroup:Ne}=D(q);if(A()(j))return null;const Le={items:G()([X&&{key:"0",label:V("\u67E5\u770B\u8BE6\u60C5"),onClick:fe},he&&{key:"1",label:V("\u9080\u8BF7\u7528\u6237"),onClick:Oe},{key:"2",label:V("\u9000\u51FA\u7FA4\u7EC4"),danger:!0,onClick:Ne}])};return l.createElement(K.M,{menu:Le,"data-testid":"group-header"},j==null?void 0:j.name)});Z.displayName="GroupHeader";var k=e(93540);const le=l.memo(R=>{const[q,j]=(0,l.useReducer)(V=>!V,!0);return l.createElement("div",null,l.createElement("div",{className:"flex items-center cursor-pointer py-1 text-xs",onClick:j},l.createElement(k.JO,{className:"mr-1",icon:"mdi:chevron-right",rotate:q?45:0}),l.createElement("div",null,R.header)),l.createElement("div",{className:"transition-all overflow-hidden space-y-0.5 pl-2 ml-1 border-l-4 border-opacity-40",style:{maxHeight:q?"var(--max-height)":0},ref:V=>V==null?void 0:V.style.setProperty("--max-height",`${V.scrollHeight}px`)},R.children))});le.displayName="GroupSection";var de=e(10114),Ee=e(75283),xe=e(58761),Me=e(68e3),be=e(10330),Se=Object.defineProperty,Ze=Object.getOwnPropertySymbols,ze=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,je=(R,q,j)=>q in R?Se(R,q,{enumerable:!0,configurable:!0,writable:!0,value:j}):R[q]=j,He=(R,q)=>{for(var j in q||(q={}))ze.call(q,j)&&je(R,j,q[j]);if(Ze)for(var j of Ze(q))Je.call(q,j)&&je(R,j,q[j]);return R};const Ve=l.memo(R=>{const{icon:q,name:j,to:V,dimmed:X=!1,badge:he}=R,Oe=(0,O.useLocation)().pathname.startsWith(V);return l.createElement(be.rU,{className:"block",to:V},l.createElement("div",{className:(0,n.Z)("w-full hover:bg-black hover:bg-opacity-20 dark:hover:bg-white dark:hover:bg-opacity-20 cursor-pointer text-gray-900 dark:text-white rounded px-1 h-8 flex items-center text-base group",{"bg-black bg-opacity-20 dark:bg-white dark:bg-opacity-20":Oe},X&&"text-opacity-40 dark:text-opacity-40")},l.createElement("div",{className:(0,n.Z)("flex items-center justify-center px-1 mr-1")},q),l.createElement(Ee.Z.Text,{className:(0,n.Z)("flex-1 text-gray-900 dark:text-white",X&&"text-opacity-40 dark:text-opacity-40"),ellipsis:!0},j),l.createElement(xe.Z,null,he===!0&&l.createElement(Me.Z,He({status:"error"},R.badgeProps)),R.extraBadge)))});Ve.displayName="GroupPanelItem";var Qe=e(22215);const Ye=l.memo(R=>{var q;const{groupId:j,panel:V}=R,X=V.id,he=(0,t.EP)(X),fe=(0,Qe.rF)(j,X,(q=V.pluginPanelName)!=null?q:""),{checkIsMuted:Oe}=(0,t.OqL)(),Ne=Oe(X,j);return l.createElement(Ve,{name:V.name,icon:R.icon,to:`/main/group/${j}/${V.id}`,dimmed:Ne,badge:he,badgeProps:{status:Ne?"default":"error"},extraBadge:fe})});Ye.displayName="GroupAckPanelItem";var qe=e(96136),ie=e(86724),Y=e.n(ie),me=e(103),Pe=e(38887),Re=e(35633);const Ue=l.memo(R=>{var q;const{groupId:j,panel:V}=R,X=V.id,{hasOpenedPanel:he,openPanelWindow:fe}=(0,me.l)(`/panel/group/${j}/${X}`),Oe=(0,t.iFL)(j),Ne=(0,t.TL5)(),{markConverseAllAck:Le}=(0,t.hoD)(X),We=(0,Qe.Sp)(V),ge=(0,Qe.rF)(j,X,(q=V.pluginPanelName)!=null?q:""),{checkIsMuted:I,toggleMute:L}=(0,t.OqL)();if(!Oe)return l.createElement(Pe.T,null);const b=(0,t.YQu)(Oe.pinnedPanelId)&&Oe.pinnedPanelId===X,se={items:G()([{key:"copy",label:(0,t.t)("\u590D\u5236\u94FE\u63A5"),icon:l.createElement(k.JO,{icon:"mdi:content-copy"}),onClick:()=>{Y()(`${location.origin}/main/group/${j}/${X}`),(0,t.lHp)((0,t.t)("\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"))}},{key:"new",label:(0,t.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),icon:l.createElement(k.JO,{icon:"mdi:dock-window"}),disabled:he,onClick:fe},b?{key:"unpin",label:(0,t.t)("Unpin"),icon:l.createElement(k.JO,{icon:"mdi:pin-off"}),onClick:()=>{Ne(t.hyC.unpinGroupPanel({groupId:j}))}}:{key:"pin",label:(0,t.t)("Pin"),icon:l.createElement(k.JO,{icon:"mdi:pin"}),onClick:()=>{Ne(t.hyC.pinGroupPanel({groupId:j,panelId:X}))}},V.type===t.Xpe.TEXT&&{key:"markAsRead",label:(0,t.t)("\u6807\u8BB0\u4E3A\u5DF2\u8BFB"),icon:l.createElement(k.JO,{icon:"mdi:message-badge-outline"}),onClick:Le},V.type===t.Xpe.TEXT&&{key:"mute",label:I(X,j)?(0,t.t)("\u53D6\u6D88\u514D\u6253\u6270"):(0,t.t)("\u514D\u6253\u6270"),icon:l.createElement(k.JO,{icon:"mdi:bell-off-outline"}),onClick:()=>L(X)},...We])},J=b?l.createElement(k.JO,{icon:"mdi:pin"}):l.createElement(k.JO,{icon:"mdi:pound"});return l.createElement(qe.Z,{menu:se,trigger:["contextMenu"]},l.createElement("div",null,(0,Re.Q)(V)?l.createElement(Ye,{icon:J,groupId:j,panel:V}):l.createElement(Ve,{name:V.name,icon:J,to:`/main/group/${j}/${X}`,extraBadge:ge})))});Ue.displayName="SidebarItem";const we=l.memo(()=>{var R;const{groupId:q=""}=(0,O.useParams)(),j=(0,t.iFL)(q),V=(R=j==null?void 0:j.panels)!=null?R:[];return l.createElement(de.L,{"data-tc-role":"sidebar-group"},l.createElement(Z,{groupId:q}),l.createElement("div",{className:"p-2 space-y-1 overflow-auto"},V.filter(X=>!(0,t.YQu)(X.parentId)).map(X=>X.type===t.Xpe.GROUP?l.createElement(le,{key:X.id,header:X.name},V.filter(he=>he.parentId===X.id).map(he=>l.createElement(Ue,{key:he.id,groupId:q,panel:he}))):l.createElement(Ue,{key:X.id,groupId:q,panel:X}))))});we.displayName="Sidebar";const Ge=l.memo(()=>{const{groupId:R=""}=(0,O.useParams)(),q=(0,t.iFL)(R);if(!q)return l.createElement(r.t,{text:(0,t.t)("\u7FA4\u7EC4\u672A\u627E\u5230")});const j=q.pinnedPanelId,V=l.createElement(O.Routes,null,l.createElement(O.Route,{path:"/:panelId",element:l.createElement(p.x,null)}),l.createElement(O.Route,{path:"/",element:l.createElement(M,null)}));return l.createElement(B.A,{value:R},l.createElement(W.J,{"data-tc-role":"content-group",sidebar:l.createElement(we,null)},(0,t.YQu)(j)?l.createElement(a,{className:"flex-auto w-full"},l.createElement("div",null,V),l.createElement("div",null,l.createElement(p.E,{groupId:R,panelId:j}))):V))});Ge.displayName="Group"},12492:(Fe,H,e)=>{e.d(H,{J:()=>w});var r=e(52983),n=e(58935),l=e(14698),i=e.n(l),t=e(59270),a=e(89935),B=e(14517),O=e(67706),W=e(98281),p=Object.defineProperty,y=Object.defineProperties,A=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,G=(P,x,m)=>x in P?p(P,x,{enumerable:!0,configurable:!0,writable:!0,value:m}):P[x]=m,K=(P,x)=>{for(var m in x||(x={}))M.call(x,m)&&G(P,m,x[m]);if(U)for(var m of U(x))N.call(x,m)&&G(P,m,x[m]);return P},Q=(P,x)=>y(P,A(x)),$=(P,x)=>{var m={};for(var D in P)M.call(P,D)&&x.indexOf(D)<0&&(m[D]=P[D]);if(P!=null&&U)for(var D of U(P))x.indexOf(D)<0&&N.call(P,D)&&(m[D]=P[D]);return m};const ce=P=>{var x=P,{className:m,style:D,children:Z}=x,k=$(x,["className","style","children"]);return r.createElement("div",Q(K({},k),{style:D,className:(0,B.Z)("flex flex-row flex-1 overflow-hidden relative",m)}),Z)},_=r.memo(P=>{const{setShowSidebar:x}=(0,n.S)(),m=(0,t.useDrag)(D=>{const{swipe:Z}=D,k=Z[0];k>0?x(!0):k<0&&x(!1)},{axis:"x",swipe:{distance:5}});return r.createElement(ce,K({style:{touchAction:"pan-x"}},m()),P.children)});_.displayName="PageGestureWrapper";const w=r.memo(P=>{const{sidebar:x,children:m}=P,{showSidebar:D,setShowSidebar:Z}=(0,n.S)(),k=(0,a.d)(),le=(0,r.useCallback)(Se=>{Se.stopPropagation(),Se.preventDefault(),Z(!1)},[]);(0,W.qoQ)([k],()=>{k===!1&&Z(!0)});const de=i()(x)?null:r.createElement("div",{className:(0,B.Z)("bg-sidebar-light dark:bg-sidebar-dark flex-shrink-0 transition-width w-60")},P.sidebar),Ee=k===!0&&D===!0&&!i()(de),xe=Ee?r.createElement("div",{className:"absolute right-0 top-0 bottom-0 z-10",style:{width:"calc(100% - 15rem)"},onClick:le}):null,Me=m,be=r.createElement(O.S,null,de,xe,r.createElement("div",{className:(0,B.Z)("flex flex-auto bg-content-light dark:bg-content-dark overflow-hidden",k&&"transform left-0 w-full h-full absolute transition-transform",k&&{"translate-x-60":D,"translate-x-0":!D}),"data-tc-role":P["data-tc-role"]},r.createElement("div",{className:"tc-content-background"}),r.createElement("div",{className:(0,B.Z)("flex relative w-full",{"overflow-auto":!Ee,"overflow-hidden":Ee})},r.createElement(O.S,null,Me))));return k?r.createElement(_,null,be):r.createElement(ce,null,be)});w.displayName="PageContent"},14231:(Fe,H,e)=>{e.d(H,{d:()=>P});var r=e(64939),n=e(21506),l=e(9021),i=e(52983),t=e(98281),a=e(712),B=e(6494),O=e.n(B),W=e(84208),p=e(75526),y=e(2945),A=(x,m,D)=>new Promise((Z,k)=>{var le=xe=>{try{Ee(D.next(xe))}catch(Me){k(Me)}},de=xe=>{try{Ee(D.throw(xe))}catch(Me){k(Me)}},Ee=xe=>xe.done?Z(xe.value):Promise.resolve(xe.value).then(le,de);Ee((D=D.apply(x,m)).next())});const U=i.memo(x=>{const{converseId:m,withoutUserIds:D=[]}=x,[Z,k]=(0,i.useState)([]),[{loading:le},de]=(0,t.ilX)(()=>A(void 0,null,function*(){yield(0,t.m8p)(m,[...Z]),(0,W.Mr)()}),[m,Z]);return i.createElement(W.AB,{title:(0,t.t)("\u9080\u8BF7\u597D\u53CB\u52A0\u5165\u4F1A\u8BDD")},i.createElement(y.B,{withoutUserIds:D,selectedIds:Z,onChange:k}),i.createElement("div",{className:"text-right"},i.createElement(p.Z,{type:"primary",loading:le,onClick:de},(0,t.t)("\u786E\u8BA4"))))});U.displayName="AppendDMConverseMembers";var M=e(103),N=e(87179),G=e(84143),K=e(7975),Q=e(50093);const $=i.memo(({converse:x})=>{const m=(0,t.Y84)(x);return(0,t.t)("\u4E0E {{name}} \u7684\u4F1A\u8BDD",{name:m})});$.displayName="ConversePanelTitle";const ce=i.memo(({members:x})=>i.createElement("div",null,x.map(m=>i.createElement(l.Q,{key:m,userId:m}))));ce.displayName="ConversePanelMembers";const _=i.memo(({converseId:x})=>{const m=(0,t.CGy)(de=>de.chat.converses[x]),{hasOpenedPanel:D,openPanelWindow:Z,closePanelWindow:k}=(0,M.l)(`/panel/personal/converse/${x}`);if(D)return i.createElement(N.x,{onClosePanelWindow:k});const le=m&&i.createElement($,{converse:m});return i.createElement(a.S,{header:le,actions:({setRightPanel:de})=>m?O()([...K.pluginPanelActions.filter(Ee=>Ee.position==="dm").map(Ee=>i.createElement(G.a,{key:Ee.name,title:Ee.label,shape:"square",icon:Ee.icon,iconClassName:"text-2xl",onClick:()=>Ee.onClick({converseId:x})})),i.createElement(G.a,{key:"open",title:(0,t.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),shape:"square",icon:"mdi:dock-window",iconClassName:"text-2xl",onClick:Z}),m.members.length===2?i.createElement(G.a,{key:"create",title:(0,t.t)("\u521B\u5EFA\u4F1A\u8BDD"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,W.h7)(i.createElement(Q.m,{hiddenUserIds:m.members}))}):i.createElement(G.a,{key:"add",title:(0,t.t)("\u9080\u8BF7\u6210\u5458"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,W.h7)(i.createElement(U,{converseId:m._id,withoutUserIds:m.members}))}),m.members.length>2&&i.createElement(G.a,{key:"members",title:(0,t.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>de({name:(0,t.t)("\u6210\u5458")+` (${m.members.length})`,panel:i.createElement(ce,{members:m.members})})})]):[]},i.createElement(n.r,{converseId:x,converseTitle:le,isGroup:!1}))});_.displayName="ConversePanel";var w=e(54782);const P=i.memo(()=>{const x=(0,w.useParams)();return x.converseId?i.createElement(_,{converseId:x.converseId}):i.createElement(r.T,null)});P.displayName="PersonalConverse"},7364:(Fe,H,e)=>{e.d(H,{l:()=>G});var r=e(98281),n=e(52983),l=e(38887),i=e(21848),t=e(14698),a=e.n(t),B=e(54782),O=e(58935),W=e(442),p=e(5198),y=e(96857),A=e(6739),U=e(13893),M=(K,Q,$)=>new Promise((ce,_)=>{var w=m=>{try{x($.next(m))}catch(D){_(D)}},P=m=>{try{x($.throw(m))}catch(D){_(D)}},x=m=>m.done?ce(m.value):Promise.resolve(m.value).then(w,P);x(($=$.apply(K,Q)).next())});function N(){const K=(0,B.useNavigate)(),{value:Q,loading:$,error:ce}=(0,r.r53)(()=>M(this,null,function*(){let P;try{P=yield(0,i.gP)()}catch(D){K(`/entry/login?redirect=${encodeURIComponent(location.pathname)}`,{replace:!0});return}const x=(0,r.vIP)();x.dispatch(r.hIH.setUserInfo(P)),(0,p._3)(x);const m=yield(0,r.Tzh)(P.token);return(0,p.Kj)(m),(0,r.cUn)(m,x),{store:x,socket:m}}),[]),_=Q==null?void 0:Q.store,w=Q==null?void 0:Q.socket;return{loading:$,store:_,socket:w,error:ce}}const G=n.memo(K=>{const{loading:Q,store:$,error:ce,socket:_}=N();return Q?n.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-content-light dark:bg-content-dark text-gray-700 dark:text-white text-xl"},n.createElement(l.T,{tip:(0,r.t)("\u6B63\u5728\u8FDE\u63A5\u5230\u804A\u5929\u670D\u52A1\u5668...")})):ce?(console.error("[MainProvider]",ce),n.createElement("div",null,ce.message)):a()($)?n.createElement(A.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Store \u521B\u5EFA\u5931\u8D25")}):a()(_)?n.createElement(A.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Socket \u521B\u5EFA\u5931\u8D25")}):n.createElement(r.m$Z,{store:$},n.createElement(y.Z,{socket:_},n.createElement(O.f,null,n.createElement(U.L,null,n.createElement(W.$2,null,K.children)))))});G.displayName="MainProvider"},58935:(Fe,H,e)=>{e.d(H,{S:()=>a,f:()=>t});var r=e(52983),n=e(71607),l=e.n(n);const i=r.createContext({showSidebar:!0,switchSidebar:l(),setShowSidebar:l()});i.displayName="SidebarContext";const t=r.memo(B=>{const[O,W]=(0,r.useState)(!0),p=(0,r.useCallback)(()=>{W(!O)},[O]);return r.createElement(i.Provider,{value:{showSidebar:O,switchSidebar:p,setShowSidebar:W}},B.children)});t.displayName="SidebarContextProvider";function a(){return(0,r.useContext)(i)}},35633:(Fe,H,e)=>{e.d(H,{Q:()=>l});var r=e(98281),n=e(89889);function l(i){var t,a;if(i.type===r.Xpe.TEXT)return!0;if(i.type===r.Xpe.PLUGIN){const B=(0,n.S)(i.name);return(a=(t=B==null?void 0:B.feature)==null?void 0:t.includes("ack"))!=null?a:!1}return!1}},64750:(Fe,H,e)=>{e.d(H,{$:()=>l,Hi:()=>i,dq:()=>a,er:()=>t,rR:()=>n});var r=e(79172);const n=(0,r.P6)("enter"),l=(0,r.P6)("esc"),i=(0,r.P6)("mod+k"),t=(0,r.P6)("up"),a=(0,r.P6)("down")},83996:(Fe,H,e)=>{e.d(H,{f:()=>i,w:()=>t});var r=e(98281),n=(a,B,O)=>new Promise((W,p)=>{var y=M=>{try{U(O.next(M))}catch(N){p(N)}},A=M=>{try{U(O.throw(M))}catch(N){p(N)}},U=M=>M.done?W(M.value):Promise.resolve(M.value).then(y,A);U((O=O.apply(a,B)).next())});function l(a){return n(this,null,function*(){const B=document.createElement("img");return new Promise((O,W)=>{B.onload=()=>O(B),B.onerror=W,B.src=(0,r.Awg)(a),B.crossOrigin="Anonymous"})})}function i(a){return n(this,null,function*(){const B=yield l(a),O=document.createElement("canvas");O.width=B.width,O.height=B.height;const W=O.getContext("2d");if(!W)return{r:0,g:0,b:0,a:0};W.drawImage(B,0,0,O.width,O.height);const p=W.getImageData(0,0,O.width,O.height);let y=0,A=0,U=0,M=0;for(let G=0;G<p.height;G++)for(let K=0;K<p.width;K++)y+=p.data[(p.width*G+K)*4],A+=p.data[(p.width*G+K)*4+1],U+=p.data[(p.width*G+K)*4+2],M+=p.data[(p.width*G+K)*4+3];const N=p.width*p.height;return y=Math.round(y/N),A=Math.round(A/N),U=Math.round(U/N),M=Math.round(M/N),{r:y,g:A,b:U,a:M}})}function t(a){return!["image/gif"].includes(a)}},21848:(Fe,H,e)=>{e.d(H,{JM:()=>p,gP:()=>W,rU:()=>B});var r=e(98281),n=e(14698),l=e.n(n),i=e(87450),t=(y,A,U)=>new Promise((M,N)=>{var G=$=>{try{Q(U.next($))}catch(ce){N(ce)}},K=$=>{try{Q(U.throw($))}catch(ce){N(ce)}},Q=$=>$.done?M($.value):Promise.resolve($.value).then(G,K);Q((U=U.apply(y,A)).next())});let a=null;function B(y){a=y}function O(){return a}function W(){return t(this,null,function*(){let y=O();if(l()(y)){const A=yield(0,i.pT)();if(typeof A!="string")throw new Error("Token \u683C\u5F0F\u4E0D\u5408\u6CD5");if(console.debug("\u6B63\u5728\u5C1D\u8BD5\u4F7F\u7528Token\u767B\u5F55"),y=yield r.o4J.EA.loginWithToken(A),y===null)throw new Error("Token \u5185\u5BB9\u4E0D\u5408\u6CD5");B(y)}return y})}function p(y){if(typeof y!="string")return!0;const A=y.split("@")[1];return!!(!A||A.endsWith(".msgbyte.com"))}}}]);
