"use strict";(self.webpackChunktailchat_web=self.webpackChunktailchat_web||[]).push([[258],{75209:(Ne,X,e)=>{e.d(X,{d:()=>he});var r=e(52983),n=e(30831),a=e(7975),s=e(93540),t=e(20685);function l(I){const U=(0,r.useMemo)(()=>a.messageInterpreter.map(({name:T,explainMessage:fe})=>({name:T,render:fe(I)})).filter(({render:T})=>T!==null),[I]);return U.length===0?null:r.createElement("span",{className:"align-middle hidden group-hover:inline-block"},r.createElement(t.Z,{placement:"topLeft",title:(0,n.t)("\u6D88\u606F\u89E3\u91CA"),content:r.createElement("div",{className:"max-w-lg"},U.map((T,fe)=>{var _;return r.createElement("p",{key:fe+((_=T.name)!=null?_:"")},T.name&&r.createElement("span",null,(0,n.t)("\u6765\u81EA")," ",r.createElement("span",{className:"font-bold"},T.name)," :"," "),T.render)})),trigger:"click"},r.createElement(s.JO,{className:"cursor-pointer text-base",icon:"mdi:file-question-outline"})))}var b=e(96136),N=e(75217),w=e(66559),h=e(14517),g=e(84208),B=e(86724),L=e.n(B),F=e(6494),x=e.n(F),G=(I,U,T)=>new Promise((fe,_)=>{var Ce=Ie=>{try{ge(T.next(Ie))}catch(we){_(we)}},xe=Ie=>{try{ge(T.throw(Ie))}catch(we){_(we)}},ge=Ie=>Ie.done?fe(Ie.value):Promise.resolve(Ie.value).then(Ce,xe);ge((T=T.apply(I,U)).next())});function j(I,U){var T;const fe=(0,n.xMc)(),_=(0,n.rE2)(),Ce=(0,n.Pc$)(),[xe]=(0,n.WHr)((T=_==null?void 0:_._id)!=null?T:"",[n.g3S.core.deleteMessage]),ge=(0,r.useCallback)(()=>{L()((0,a.getMessageTextDecorators)().serialize(I.content)),(0,n.jiy)((0,n.t)("\u590D\u5236\u7EAF\u6587\u672C\u6210\u529F"))},[I.content]),[,Ie]=(0,n.CoE)(()=>G(this,null,function*(){(yield(0,g.aW)())&&(yield(0,n.peM)(I._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u64A4\u56DE\u6210\u529F")))}),[I._id]),[,we]=(0,n.CoE)(()=>G(this,null,function*(){(yield(0,g.aW)())&&(yield(0,n.$Zg)(I._id),(0,n.jiy)((0,n.t)("\u6D88\u606F\u5220\u9664\u6210\u529F")))}),[I._id]),v=_&&_.owner===(Ce==null?void 0:Ce._id),O=I.author===(Ce==null?void 0:Ce._id);return{onClick:U.onClick,items:x()([{key:"copy",label:(0,n.t)("\u590D\u5236"),icon:r.createElement(s.JO,{icon:"mdi:content-copy"}),onClick:ge},fe.hasContext&&{key:"reply",label:(0,n.t)("\u56DE\u590D"),icon:r.createElement(s.JO,{icon:"mdi:reply"}),onClick:()=>n.Agn.emit("replyMessage",I)},(v||O)&&{key:"recall",label:(0,n.t)("\u64A4\u56DE"),icon:r.createElement(s.JO,{icon:"mdi:restore"}),onClick:Ie},xe&&{key:"delete",label:(0,n.t)("\u5220\u9664"),danger:!0,icon:r.createElement(s.JO,{icon:"mdi:delete-outline"}),onClick:we}])}}var Q=e(53652),z=e(71607),pe=e.n(z),te=Object.defineProperty,K=Object.defineProperties,P=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,f=(I,U,T)=>U in I?te(I,U,{enumerable:!0,configurable:!0,writable:!0,value:T}):I[U]=T,C=(I,U)=>{for(var T in U||(U={}))d.call(U,T)&&f(I,T,U[T]);if(D)for(var T of D(U))A.call(U,T)&&f(I,T,U[T]);return I},R=(I,U)=>K(I,P(U));const ae=r.createContext({closePopover:pe()}),J=r.memo(I=>{const[U,T]=(0,r.useState)(!1),fe=(0,r.useCallback)(xe=>{T(xe),typeof I.onOpenChange=="function"&&I.onOpenChange(xe)},[I.onOpenChange]),_=(0,r.useCallback)(()=>{T(!1),typeof I.onOpenChange=="function"&&I.onOpenChange(!1)},[]),Ce=(0,r.useMemo)(()=>({closePopover:_}),[_]);return r.createElement(ae.Provider,{value:Ce},r.createElement(t.Z,R(C({},I),{open:U,onOpenChange:fe})))});J.displayName="TcPopover";function re(){var I;const U=(0,r.useContext)(ae);return{closePopover:(I=U==null?void 0:U.closePopover)!=null?I:pe()}}var de=(I,U,T)=>new Promise((fe,_)=>{var Ce=Ie=>{try{ge(T.next(Ie))}catch(we){_(we)}},xe=Ie=>{try{ge(T.throw(Ie))}catch(we){_(we)}},ge=Ie=>Ie.done?fe(Ie.value):Promise.resolve(Ie.value).then(Ce,xe);ge((T=T.apply(I,U)).next())});function ee(I){const U=(0,n.ysv)(I);return(0,r.useMemo)(()=>()=>{const{closePopover:fe}=re(),[,_]=(0,n.CoE)(Ce=>de(this,null,function*(){yield(0,n.rUo)(U.current._id,Ce),fe()}),[]);return r.createElement(Q._,{onSelect:_})},[])}var ce=e(39907),Ae=e.n(ce),Ge=e(3010),We=e.n(Ge),ze=e(89022),He=e.n(ze),$e=e(95268);const Xe=r.memo(I=>{const{reaction:U,onClick:T}=I,fe=(0,n.R8f)(U.users);return r.createElement("div",{className:"py-0.5 px-1 bg-black bg-opacity-20 hover:bg-opacity-40 rounded cursor-pointer"},r.createElement($e.Z,{title:fe.join(", ")},r.createElement("div",{className:"flex",onClick:T},r.createElement(Q.d,{emoji:U.name}),r.createElement("div",{className:"ml-1 text-xs"},fe.length<3?r.createElement("span",null,He()(fe,2).join(",")):r.createElement("span",null,He()(fe,2).join(", "),", ...+",fe.length-2)))))});Xe.displayName="ReactionItem";function Qe(I){var U;const T=I._id,fe=(U=I.reactions)!=null?U:[],_=(0,n.IIz)(),Ce=(0,r.useMemo)(()=>{const ge=Ae()(fe,"name");return Object.keys(ge).map(Ie=>{const we=We()(ge[Ie],"author");return{name:Ie,length:we.length,users:we.map(v=>v.author)}})},[fe]),xe=(0,r.useCallback)(ge=>{!(0,n.YQu)(_)||(ge.users.includes(_)?(0,n.WOV)(T,ge.name):(0,n.rUo)(T,ge.name))},[T,_]);return r.createElement("div",{className:"flex chat-message-reactions space-x-1 py-0.5"},Ce.map(ge=>r.createElement(Xe,{key:ge.name,reaction:ge,onClick:()=>xe(ge)})))}var Ye=e(22398),ve=e(16365),le=e(51052),Ee=e(29787),Be=e.n(Ee),Te=Object.defineProperty,Le=Object.defineProperties,je=Object.getOwnPropertyDescriptors,Je=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,$=(I,U,T)=>U in I?Te(I,U,{enumerable:!0,configurable:!0,writable:!0,value:T}):I[U]=T,Y=(I,U)=>{for(var T in U||(U={}))W.call(U,T)&&$(I,T,U[T]);if(Je)for(var T of Je(U))ne.call(U,T)&&$(I,T,U[T]);return I},q=(I,U)=>Le(I,je(U));const ye=r.memo(({payload:I})=>{const U=(0,r.useMemo)(()=>new n.NtG(I).hasReply(),[I]);return U===!1?null:r.createElement("div",{className:"chat-message-item_quote border-l-4 border-black border-opacity-20 pl-2 opacity-80"},(0,n.t)("\u56DE\u590D")," ",r.createElement(w.v,{userId:String(U.author)}),":"," ",r.createElement("span",null,(0,a.getMessageRender)(U.content)))});ye.displayName="MessageQuote";const Pe=I=>r.createElement("div",{className:"px-0.5 w-6 h-6 flex justify-center items-center opacity-60 hover:opacity-100"},r.createElement(s.JO,{icon:I.icon})),Re=r.memo(I=>{var U,T;const{showAvatar:fe,payload:_}=I,Ce=(0,n.xzJ)((U=_.author)!=null?U:""),[xe,ge]=(0,r.useState)(!1),Ie=Qe(_),we=ee(_),v=j(_,{onClick:()=>{ge(!1)}}),O=_.isLocal===!0||_.sendFailed===!0;return r.createElement("div",{className:(0,h.Z)("chat-message-item flex px-2 mobile:px-0 group relative select-text",{"bg-black bg-opacity-10":xe,"hover:bg-black hover:bg-opacity-5":!xe}),"data-message-id":_._id},r.createElement("div",{className:"w-18 mobile:w-14 flex items-start justify-center pt-0.5"},fe?r.createElement(t.Z,{content:!Be()(Ce)&&r.createElement(le.Z,{userInfo:Ce}),placement:"top",trigger:"click"},r.createElement(s.qE,{className:"cursor-pointer",size:40,src:Ce.avatar,name:Ce.nickname})):r.createElement("div",{className:"hidden group-hover:block opacity-40"},(0,n.vMv)(_.createdAt))),r.createElement("div",{className:"flex flex-col flex-1 overflow-auto group",onContextMenu:Ye.UW},fe&&r.createElement("div",{className:"flex items-center"},r.createElement("div",{className:"font-bold"},(T=Ce.nickname)!=null?T:r.createElement("span",null,"\xA0")),r.createElement("div",{className:"hidden group-hover:block opacity-40 ml-1 text-sm"},(0,n.vMv)(_.createdAt))),r.createElement(s.wb,{maxHeight:340,backgroundColor:"var(--tc-content-background-color)",showFullText:r.createElement("div",{className:"inline-block rounded-full bg-white dark:bg-black opacity-80 py-2 px-3 hover:opacity-100"},(0,n.t)("\u70B9\u51FB\u5C55\u5F00\u66F4\u591A"))},r.createElement("div",{className:"chat-message-item_body leading-6 break-words"},r.createElement(ye,{payload:_}),r.createElement("span",null,(0,a.getMessageRender)(_.content)),_.sendFailed===!0&&r.createElement(s.JO,{className:"inline-block ml-1",icon:"emojione:cross-mark-button"}),l(_.content))),r.createElement("div",null,a.pluginMessageExtraParsers.map(y=>r.createElement(r.Fragment,{key:y.name},y.render(_)))),Ie),!O&&r.createElement("div",{className:(0,h.Z)("bg-white dark:bg-black rounded absolute right-2 cursor-pointer -top-3 shadow-sm flex",{"opacity-0 group-hover:opacity-100 bg-opacity-80 hover:bg-opacity-100":!xe,"opacity-100 bg-opacity-100":xe})},r.createElement(J,{overlayClassName:"chat-message-item_action-popover",content:we,placement:"bottomLeft",trigger:["click"],onOpenChange:ge},r.createElement("div",null,r.createElement(Pe,{icon:"mdi:emoticon-happy-outline"}))),r.createElement(b.Z,{menu:v,placement:"bottomLeft",trigger:["click"],onOpenChange:ge},r.createElement("div",null,r.createElement(Pe,{icon:"mdi:dots-horizontal"})))))});Re.displayName="NormalMessage";const be=r.memo(({payload:I})=>r.createElement("div",{className:"text-center"},r.createElement("div",{className:"bg-black bg-opacity-20 rounded inline-block py-0.5 px-2 my-1 text-sm"},I.content)));be.displayName="SystemMessage";const Ue=r.memo(I=>{const T=(0,n.FDf)(I.userIds).map(fe=>fe.nickname);return r.createElement(be,q(Y({},I),{payload:I.overwritePayload(T)}))});Ue.displayName="SystemMessageWithNickname";const Ze=r.memo(I=>{var U;const T=I.payload;return T.author===n.q6$?r.createElement(be,Y({},I)):T.hasRecall===!0?r.createElement(Ue,q(Y({},I),{userIds:[(U=T.author)!=null?U:n.q6$],overwritePayload:fe=>q(Y({},T),{content:(0,n.t)("{{nickname}} \u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F",{nickname:fe[0]||""})})})):r.createElement(Re,Y({},I))});Ze.displayName="ChatMessageItem";function he(I,U){var T,fe;const _=I[U];if(!_)return r.createElement("div",null);let Ce=!0,xe=!0;const ge=new Date((T=_.createdAt)!=null?T:"");if(U>0){const Ie=I[U-1];(0,n.Nvc)(new Date((fe=Ie.createdAt)!=null?fe:""),ge)||(Ce=!1),Ce===!1&&(xe=Ie.author!==_.author||Ie.hasRecall===!0)}return r.createElement("div",{key:_._id},Ce&&r.createElement(N.Z,{className:"text-sm opacity-40 px-6 font-normal select-text"},(0,n.omK)(ge)),_.isLocal===!0?r.createElement("div",{className:"opacity-50"},r.createElement(Ze,{showAvatar:xe,payload:_})):r.createElement(ve.H,{converseId:_.converseId,messageId:_._id},r.createElement(Ze,{showAvatar:xe,payload:_})))}},81244:(Ne,X,e)=>{e.d(X,{X:()=>w});var r=e(52983),n=e(30831),a=e(93540);const s=r.memo(h=>r.createElement("div",{className:"px-5 pb-4 pt-8"},r.createElement("div",{className:"font-extrabold mb-2 text-2xl flex items-center space-x-1"},r.createElement(a.JO,{icon:"mdi:pound"}),r.createElement("div",null,h.title)),r.createElement("div",{className:"text-base opacity-80"},(0,n.t)("\u8FD9\u91CC\u662F\u6240\u6709\u6D88\u606F\u7684\u5F00\u59CB\uFF0C\u8BF7\u7545\u6240\u6B32\u8A00\u3002"))));s.displayName="ChatMessageHeader";var t=e(75209),l=e(79861);const b=100,N=40,w=r.memo(h=>{const g=(0,r.useRef)(null),B=(0,r.useRef)(!1),[L,F]=(0,r.useState)(!1),x=(0,n.nWw)(()=>{var j;(j=g.current)==null||j.scrollTo({top:0,behavior:"smooth"})});(0,r.useEffect)(()=>{h.messages.length!==0&&B.current===!1&&x()},[h.messages.length]),(0,n.JtK)("sendMessage",x);const G=(0,r.useCallback)(()=>{h.messages.length!==0&&(!g.current||(-g.current.scrollTop<=N?(B.current=!1,F(!1)):-g.current.scrollTop+g.current.clientHeight>=g.current.scrollHeight-b?h.onLoadMore():(B.current=!0,F(!0))))},[h.messages]);return r.createElement("div",{className:"flex-1 overflow-y-scroll overflow-x-hidden flex flex-col-reverse",ref:g,onScroll:G},r.createElement("div",null,h.messages.map((j,Q,z)=>(0,t.d)(z,Q))),L&&r.createElement(l.a,{onClick:x}),h.title&&!h.hasMoreMessage&&r.createElement(s,{title:h.title}))});w.displayName="NormalMessageList"},79861:(Ne,X,e)=>{e.d(X,{a:()=>a});var r=e(52983),n=e(93540);const a=r.memo(s=>r.createElement("div",{className:"absolute right-10 bottom-18 px-3 py-2 rounded-full bg-white dark:bg-black bg-opacity-50 shadow cursor-pointer z-10 w-11 h-11 flex justify-center items-center text-2xl hover:bg-opacity-80",onClick:s.onClick},r.createElement(n.JO,{icon:"mdi:chevron-double-down"})));a.displayName="ScrollToBottom"},21506:(Ne,X,e)=>{e.d(X,{r:()=>we});var r=e(7975),n=e(52983),a=e(30831),s=e(21597),t=e(55696);const l=n.memo(()=>{const v={rows:1};return n.createElement("div",{className:"px-2 w-2/3"},n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}),n.createElement(t.Z,{className:"mb-2",active:!0,avatar:!0,paragraph:v}))});l.displayName="ChatBoxPlaceholder";var b=e(64750),N=e(93540),w=e(96136),h=e(29254),g=e(84208),B=e(63933),L=e(44411),F=e(75526),x=(v,O,y)=>new Promise((oe,se)=>{var ie=V=>{try{H(y.next(V))}catch(me){se(me)}},ue=V=>{try{H(y.throw(V))}catch(me){se(me)}},H=V=>V.done?oe(V.value):Promise.resolve(V.value).then(ie,ue);H((y=y.apply(v,O)).next())});const G=n.memo(v=>{const{imageUrl:O,forceUploadOriginImage:y}=v,oe=(0,n.useRef)({width:0,height:0}),[se,ie]=(0,n.useState)(y??!1),[{loading:ue},H]=(0,a.ilX)(()=>x(void 0,null,function*(){if(oe.current.width===0||oe.current.height===0){(0,a.lHp)((0,a.t)("\u64CD\u4F5C\u8FC7\u4E8E\u9891\u7E41"),"warning");return}typeof v.onConfirm=="function"&&(yield Promise.resolve(v.onConfirm({size:oe.current,uploadOriginImage:se})))}),[v.onConfirm,se]);(0,B.q)(me=>{(0,b.rR)(me)?(me.stopPropagation(),me.preventDefault(),H()):(0,b.$)(me)&&(me.stopPropagation(),v.onCancel())},{capture:!0});const V=(0,n.useCallback)(me=>{const ke=me.currentTarget;oe.current={width:ke.naturalWidth,height:ke.naturalHeight}},[]);return n.createElement(g.AB,{style:{maxHeight:"60vh",maxWidth:"60vw"}},n.createElement("div",{className:"flex"},n.createElement("div",{className:"w-2/3 p-2.5 bg-black bg-opacity-20 rounded"},n.createElement("img",{className:"max-h-72 m-auto",src:O,onLoad:V})),n.createElement("div",{className:"w-1/3 p-2 flex flex-col items-end justify-between"},n.createElement("div",{className:"text-right"},n.createElement("div",{className:"text-lg"},(0,a.t)("\u4E0A\u4F20\u56FE\u7247\u5230\u4F1A\u8BDD")),n.createElement("div",{className:"text-sm text-gray-400"},(0,a.t)("\u8BF7\u52FF\u4E0A\u4F20\u8FDD\u53CD\u5F53\u5730\u6CD5\u5F8B\u6CD5\u89C4\u7684\u56FE\u7247"))),n.createElement("div",{className:"w-full"},n.createElement("div",{className:"text-left"},n.createElement(L.Z,{disabled:typeof y!="undefined",checked:se,onChange:me=>ie(me)}),n.createElement("span",null,(0,a.t)("\u4E0A\u4F20\u539F\u56FE"))),n.createElement("div",{className:"text-right"},n.createElement(F.Z,{className:"mt-4",type:"primary",loading:ue,onClick:H},(0,a.t)("\u786E\u8BA4")))))))});G.displayName="ImageUploadPreviewer";var j=e(74774),Q=e(83996),z=(v,O,y)=>new Promise((oe,se)=>{var ie=V=>{try{H(y.next(V))}catch(me){se(me)}},ue=V=>{try{H(y.throw(V))}catch(me){se(me)}},H=V=>V.done?oe(V.value):Promise.resolve(V.value).then(ie,ue);H((y=y.apply(v,O)).next())});function pe(v){return new Promise(O=>{(0,j.Fy)(v).then(y=>{const oe=(0,g.h7)(n.createElement(G,{imageUrl:y,forceUploadOriginImage:(0,Q.w)(v.type)?void 0:!0,onCancel:()=>{(0,g.Mr)(oe)},onConfirm:se=>z(this,null,function*(){let ie=v;if(se.uploadOriginImage===!1){const me=v.size;ie=yield(0,j.hv)(v);const ke=ie.size;console.log(`\u538B\u7F29\u7ED3\u679C: ${ke/me*100}%(${me} -> ${ke})`)}const V=(yield(0,a.cTq)(ie)).url;O({url:V,width:se.size.width,height:se.size.height}),(0,g.Mr)(oe)})}))})})}function te(v){return z(this,null,function*(){const O=yield(0,a.cTq)(v);return{name:v.name||O.etag,url:O.url}})}var K=e(14517),P=(v,O,y)=>new Promise((oe,se)=>{var ie=V=>{try{H(y.next(V))}catch(me){se(me)}},ue=V=>{try{H(y.throw(V))}catch(me){se(me)}},H=V=>V.done?oe(V.value):Promise.resolve(V.value).then(ie,ue);H((y=y.apply(v,O)).next())});const D=n.memo(()=>{const[v,O]=(0,n.useState)(!1),y=(0,h.at)();if(y===null)return null;const oe=ue=>{const H=ue;H&&pe(H).then(({url:V,width:me,height:ke})=>{y.sendMsg((0,r.getMessageTextDecorators)().image(V,{width:me,height:ke}))})},se=ue=>{ue&&te(ue).then(({name:H,url:V})=>{y.sendMsg((0,r.getMessageTextDecorators)().card(H,{type:"file",url:V}))})},ie={items:[{key:"send-image",label:(0,a.t)("\u53D1\u9001\u56FE\u7247"),onClick:()=>P(void 0,null,function*(){O(!1);const ue=yield(0,j.ZB)({accept:"image/*"});ue&&oe(ue)})},{key:"send-file",label:(0,a.t)("\u53D1\u9001\u6587\u4EF6"),onClick:()=>P(void 0,null,function*(){O(!1);const ue=yield(0,j.ZB)();ue&&se(ue)})},...r.pluginChatInputActions.map((ue,H)=>({key:ue.label+H,label:ue.label,onClick:()=>{ue.onClick(y),O(!1)}}))]};return n.createElement(w.Z,{menu:ie,open:v,onOpenChange:O,placement:"topRight",trigger:["click"]},n.createElement("div",null,n.createElement(N.JO,{className:(0,K.Z)("text-2xl cursor-pointer transition transform",{"rotate-45":v}),icon:"mdi:plus-circle-outline"})))});D.displayName="ChatInputAddon";class d{constructor(O){this.data=O.clipboardData}hasImage(){const O=this.isPasteImage(this.data.items);if(O===!1)return!1;const y=O.getAsFile();return y===null?!1:y}isPasteImage(O){let y=0,oe;for(;y<O.length;){if(oe=O[y],oe.type.indexOf("image")!==-1)return oe;y++}return!1}}var A=e(9021),f=e(22398),C=e(49723);const R=n.memo(v=>n.createElement("div",{className:"flex items-center py-2 px-3"},n.createElement(N.JO,{className:"mr-1 text-lg",icon:v.icon}),n.createElement("div",null,v.label)));R.displayName="MentionCommandItem";const ae={input:{overflow:"auto",maxHeight:70},highlighter:{boxSizing:"border-box",overflow:"hidden",maxHeight:70}},J=n.memo(v=>{const{users:O,panels:y,placeholder:oe,disabled:se}=(0,h.TD)();return n.createElement(C.r,{inputRef:v.inputRef,className:"chatbox-mention-input",placeholder:oe??(0,a.t)("\u8F93\u5165\u4E00\u4E9B\u4EC0\u4E48"),disabled:se,style:ae,maxLength:1e3,value:v.value,onChange:(ie,ue,H,V)=>v.onChange(ue,V.filter(me=>me.display.startsWith("@")).map(me=>me.id)),onKeyDown:v.onKeyDown,onPaste:v.onPaste,onContextMenu:f.UW,allowSuggestionsAboveCursor:!0,forceSuggestionsAboveCursor:!0},n.createElement(C.p,{trigger:"@",data:O,displayTransform:(ie,ue)=>`@${ue}`,appendSpaceOnAdd:!0,renderSuggestion:ie=>n.createElement(A.Q,{userId:String(ie.id)}),markup:(0,r.getMessageTextDecorators)().mention("__id__","__display__")}),n.createElement(C.p,{trigger:"#",data:y,displayTransform:(ie,ue)=>`#${ue}`,appendSpaceOnAdd:!0,renderSuggestion:ie=>{var ue;return n.createElement(R,{icon:"mdi:pound",label:(ue=ie.display)!=null?ue:String(ie.id)})},markup:(0,r.getMessageTextDecorators)().url("__id__","#__display__")}))});J.displayName="ChatInputBoxInput";var re=e(53652),de=e(28723);const ee=n.memo(()=>{const v=(0,h.at)(),{appendMsg:O}=v;return n.createElement(de.L,{icon:"mdi:emoticon-happy-outline",popoverContent:({hidePopover:y})=>n.createElement(re._,{onSelect:oe=>{O(oe),y()}})})});ee.displayName="ChatInputEmotion";var ce=e(90292),Ae=e.n(ce),Ge=e(37980),We=e(22659);const ze=n.memo(()=>{const v=(0,h.at)(),O=(0,a.zX9)(se=>{const ie=se[0];!ie||(ie.type.startsWith("image/")?pe(ie).then(({url:ue,width:H,height:V})=>{v==null||v.sendMsg((0,r.getMessageTextDecorators)().image(ue,{width:H,height:V}))}):te(ie).then(({url:ue,name:H})=>{v==null||v.sendMsg((0,r.getMessageTextDecorators)().card(H,{type:"file",url:ue}))}))}),[y,oe]=(0,Ge.L)({accept:[We.FILE],drop(se){O(se.files)},canDrop(se){return!0},collect:se=>({isOver:se.isOver(),canDrop:se.canDrop()})});return y.canDrop?n.createElement("div",{ref:oe,className:"absolute inset-0 bg-white bg-opacity-50 dark:bg-black dark:bg-opacity-50 p-4"},n.createElement("div",{className:"h-full w-full border-dashed border-8 flex flex-col justify-center items-center"},n.createElement("div",null,n.createElement(N.JO,{icon:"mdi:cloud-upload",fontSize:128})),n.createElement("div",{className:"text-xl font-bold"},(0,a.t)("\u62D6\u653E\u6587\u4EF6\u4EE5\u53D1\u9001\u5230\u5F53\u524D\u4F1A\u8BDD")))):null});ze.displayName="ChatDropArea";var He=(v,O,y)=>new Promise((oe,se)=>{var ie=V=>{try{H(y.next(V))}catch(me){se(me)}},ue=V=>{try{H(y.throw(V))}catch(me){se(me)}},H=V=>V.done?oe(V.value):Promise.resolve(V.value).then(ie,ue);H((y=y.apply(v,O)).next())});const $e=n.memo(v=>{const O=(0,n.useRef)(null),[y,oe]=(0,n.useState)(""),[se,ie]=(0,n.useState)([]),{disabled:ue}=(0,h.TD)(),H=(0,a.zX9)(()=>He(void 0,null,function*(){var Se;yield v.onSendMsg(y,{mentions:Ae()(se)}),oe(""),(Se=O.current)==null||Se.focus()})),V=(0,a.zX9)(Se=>{var Me;oe(y+Se),(Me=O.current)==null||Me.focus()}),me=(0,a.zX9)(Se=>{(0,b.rR)(Se.nativeEvent)&&(Se.preventDefault(),H())}),ke=(0,a.zX9)(Se=>{const Ke=new d(Se).hasImage();Ke&&(Se.preventDefault(),pe(Ke).then(({url:et,width:tt,height:nt})=>{v.onSendMsg((0,r.getMessageTextDecorators)().image(et,{width:tt,height:nt}))}))});return(0,a.JtK)("replyMessage",Se=>He(void 0,null,function*(){if(O.current&&(O.current.focus(),Se&&(0,a.YQu)(Se==null?void 0:Se.author))){const Me=yield(0,a.pGV)(Se.author);oe(`${(0,r.getMessageTextDecorators)().mention(Se.author,Me.nickname)} ${y}`)}})),n.createElement(h.zB.Provider,{value:{message:y,setMessage:oe,sendMsg:v.onSendMsg,appendMsg:V}},n.createElement("div",{className:"px-4 py-2"},n.createElement("div",{className:"bg-white dark:bg-gray-600 flex rounded-md items-center"},n.createElement("div",{className:"flex-1 w-0"},n.createElement(J,{inputRef:O,value:y,onChange:(Se,Me)=>{oe(Se),ie(Me)},onKeyDown:me,onPaste:ke})),!ue&&n.createElement(n.Fragment,null,n.createElement("div",{className:"px-2 flex space-x-1"},r.pluginChatInputButtons.map((Se,Me)=>n.cloneElement(Se.render(),{key:`plugin-chatinput-btn#${Me}`})),n.createElement(ee,null),y?n.createElement(N.JO,{icon:"mdi:send-circle-outline",className:"text-2xl cursor-pointer",onClick:()=>H()}):n.createElement(D,null)),n.createElement(ze,null)))))});$e.displayName="ChatInputBox";var Xe=e(38887),Qe=e(81244),Ye=e(75209),ve=e(6342),le=e(79861),Ee=Math.pow;const Be=Ee(10,7),Te={height:"100%"},Le={main:1e3,reverse:1e3},je=n.memo(v=>{const O=(0,n.useRef)(null),y=(0,n.useRef)(),oe=Je(v.messages),se=(0,a.nWw)(()=>{var Me,Ke;(Ke=O.current)==null||Ke.scrollTo({top:(Me=y.current)==null?void 0:Me.scrollHeight,behavior:"smooth"})});(0,a.JtK)("sendMessage",se);const ie=(0,a.nWw)(()=>{v.isLoadingMore||v.hasMoreMessage&&v.onLoadMore()}),ue=(0,a.nWw)(Me=>(Me&&setTimeout(()=>{var Ke;(Ke=O.current)==null||Ke.autoscrollToBottom()},20),Me?"smooth":!1)),H=(0,a.nWw)((Me,Ke)=>Ke?Ke._id:Me),V=(0,a.nWw)(Me=>{const Ke=Me+oe-Be;return(0,Ye.d)(v.messages,Ke)}),[me,ke]=(0,n.useState)(!1),Se=(0,a.nWw)(Me=>{ke(!Me)});return n.createElement("div",{className:"flex-1"},n.createElement(ve.OO,{style:Te,ref:O,scrollerRef:Me=>y.current=Me,firstItemIndex:Be-oe,initialTopMostItemIndex:Math.max(v.messages.length-1,0),computeItemKey:H,totalCount:v.messages.length,overscan:Le,itemContent:V,alignToBottom:!0,startReached:ie,atBottomStateChange:Se,followOutput:ue,defaultItemHeight:25,atTopThreshold:100,atBottomThreshold:40,useWindowScroll:!1}),me&&n.createElement(le.a,{onClick:se}))});je.displayName="VirtualizedMessageList";function Je(v){var O;const y=(O=v==null?void 0:v[0])==null?void 0:O._id,oe=(0,n.useRef)(y),se=(0,n.useRef)(y),ie=(0,n.useRef)(0);return(0,n.useMemo)(()=>{if(!v||!v.length)return 0;if(y===se.current)return ie.current;oe.current||(oe.current=y),se.current=y;for(let H=ie.current;H<v.length;H+=1)if(v[H]._id===oe.current)return ie.current=H,H;return 0},[v,v==null?void 0:v.length])}var W=Object.defineProperty,ne=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,q=(v,O,y)=>O in v?W(v,O,{enumerable:!0,configurable:!0,writable:!0,value:y}):v[O]=y,ye=(v,O)=>{for(var y in O||(O={}))$.call(O,y)&&q(v,y,O[y]);if(ne)for(var y of ne(O))Y.call(O,y)&&q(v,y,O[y]);return v};const Pe=n.memo(v=>{const{value:O,loading:y}=(0,a.cvI)("messageListVirtualization",!1);return y?n.createElement("div",{className:"flex-1"},n.createElement(Xe.T,null)):O?n.createElement(je,ye({},v)):n.createElement(Qe.X,ye({},v))});Pe.displayName="ChatMessageList";var Re=e(14698),be=e.n(Re),Ue=e(66559);const Ze=n.memo(()=>{const{replyMsg:v,setReplyMsg:O,clearReplyMsg:y}=(0,a.xMc)();return(0,a.JtK)("replyMessage",oe=>{O(oe)}),be()(v)?null:n.createElement("div",{className:"relative"},n.createElement("div",{className:"absolute bottom-0 left-0 right-0 py-1 px-4"},n.createElement("div",{className:"rounded bg-white dark:bg-gray-800 p-2 max-h-44 overflow-auto shadow-sm relative"},n.createElement("span",{className:"align-top"},(0,a.t)("\u56DE\u590D")," ",v.author&&n.createElement(Ue.v,{userId:v.author}),":"," "),n.createElement("span",null,(0,r.getMessageRender)(v.content)),n.createElement(N.JO,{className:"absolute right-1 top-0.5 text-lg cursor-pointer opacity-60 hover:opacity-80",icon:"mdi:close-circle-outline",onClick:y}))))});Ze.displayName="ChatReply";const he=/:([a-zA-Z0-9_\-\+]+):/g;function I(v){return v=String(v).trim(),v=v.replace(he,O=>(0,r.getMessageTextDecorators)().emoji(O)),v}var U=Object.defineProperty,T=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,Ce=(v,O,y)=>O in v?U(v,O,{enumerable:!0,configurable:!0,writable:!0,value:y}):v[O]=y,xe=(v,O)=>{for(var y in O||(O={}))fe.call(O,y)&&Ce(v,y,O[y]);if(T)for(var y of T(O))_.call(O,y)&&Ce(v,y,O[y]);return v},ge=(v,O,y)=>new Promise((oe,se)=>{var ie=V=>{try{H(y.next(V))}catch(me){se(me)}},ue=V=>{try{H(y.throw(V))}catch(me){se(me)}},H=V=>V.done?oe(V.value):Promise.resolve(V.value).then(ie,ue);H((y=y.apply(v,O)).next())});const Ie=n.memo(v=>{const{converseId:O,converseTitle:y}=v,{messages:oe,loading:se,error:ie,isLoadingMore:ue,hasMoreMessage:H,fetchMoreMessage:V,sendMessage:me}=(0,a.FNv)();return se?n.createElement(l,null):ie?n.createElement(s.o,{error:ie}):n.createElement("div",{className:"w-full h-full flex flex-col select-text relative text-sm"},n.createElement(Pe,{key:O,title:y,messages:oe,isLoadingMore:ue,hasMoreMessage:H,onLoadMore:V}),n.createElement(Ze,null),n.createElement($e,{onSendMsg:(ke,Se)=>ge(void 0,null,function*(){const Me=I(ke);yield me({converseId:v.converseId,groupId:v.groupId,content:Me,plain:(0,r.getMessageTextDecorators)().serialize(Me),meta:Se})})}))});Ie.displayName="ChatBoxInner";const we=n.memo(v=>n.createElement(a.gvw,null,n.createElement(a.$Ib,{converseId:v.converseId,isGroup:v.isGroup},n.createElement(Ie,xe({},v)))));we.displayName="ChatBox"},10114:(Ne,X,e)=>{e.d(X,{L:()=>n});var r=e(52983);const n=r.memo(a=>r.createElement("div",{className:"h-full flex flex-col","data-tc-role":a["data-tc-role"]},a.children));n.displayName="CommonSidebarWrapper"},73513:(Ne,X,e)=>{e.d(X,{o:()=>l});var r=e(52983),n=e(45563),a=e.n(n),s=e(93540),t=e(14517);const l=r.memo(b=>{const{visible:N=!0,onChangeVisible:w}=b,h=(0,r.useRef)(null),g=(0,r.useCallback)(()=>{a()(w)&&w(!1)},[w]);return(0,r.useEffect)(()=>{const B=L=>{L.code==="Escape"&&g()};return window.addEventListener("keyup",B),()=>{window.removeEventListener("keyup",B)}},[g]),r.createElement("div",{className:(0,t.Z)("fixed left-0 right-0 top-0 bottom-0 z-10 bg-content-light dark:bg-content-dark flex justify-center items-center",{"opacity-0":!N}),ref:h},b.children,a()(w)&&r.createElement("div",{className:"absolute right-8 top-8 cursor-pointer flex flex-col",onClick:g,"data-testid":"full-modal-close"},r.createElement(s.JO,{className:"text-2xl border-2 rounded-1/2 border-gray-900 dark:border-gray-100",icon:"mdi:close"}),r.createElement("span",{className:"text-center mt-0.5 font-bold"},"ESC")))});l.displayName="FullModal"},92951:(Ne,X,e)=>{e.d(X,{C:()=>A,w:()=>d});var r=e(74774),n=e(14517),a=e(52983),s=e(30831),t=e(84208),l=e(93540),b=e(64650),N=e(14698),w=e.n(N),h=e(75526),g=(f,C,R)=>new Promise((ae,J)=>{var re=ce=>{try{ee(R.next(ce))}catch(Ae){J(Ae)}},de=ce=>{try{ee(R.throw(ce))}catch(Ae){J(Ae)}},ee=ce=>ce.done?ae(ce.value):Promise.resolve(ce.value).then(re,de);ee((R=R.apply(f,C)).next())});const B=a.memo(f=>{var C;const R=(C=f.aspect)!=null?C:1,[ae,J]=(0,a.useState)({x:0,y:0}),[re,de]=(0,a.useState)(1),[ee,ce]=(0,a.useState)({width:0,height:0,x:0,y:0}),Ae=()=>g(void 0,null,function*(){const Ge=yield G(yield L(f.imageUrl),ee);f.onConfirm(Ge)});return a.createElement(t.AB,{className:"flex flex-col",style:{width:"80vw",height:"80vh"}},a.createElement("div",{className:"flex-1 relative mb-4"},a.createElement(b.ZP,{image:f.imageUrl,crop:ae,zoom:re,aspect:R,onCropChange:J,onZoomChange:de,onCropComplete:(Ge,We)=>ce(We)})),a.createElement(h.Z,{type:"primary",onClick:Ae},(0,s.t)("\u786E\u8BA4")))});B.displayName="ImageCropperModal";function L(f){return new Promise((C,R)=>{const ae=new Image;ae.addEventListener("load",()=>C(ae)),ae.addEventListener("error",J=>R(J)),ae.setAttribute("crossOrigin","anonymous"),ae.src=f})}function F(f){return f*Math.PI/180}let x=null;function G(f,C,R=0,ae="newFile.jpeg"){const J=document.createElement("canvas"),re=J.getContext("2d");if(!w()(re)){const de=Math.max(f.width,f.height),ee=2*(de/2*Math.sqrt(2));J.width=ee,J.height=ee,re.translate(ee/2,ee/2),re.rotate(F(R)),re.translate(-ee/2,-ee/2),re.drawImage(f,ee/2-f.width*.5,ee/2-f.height*.5);const ce=re.getImageData(0,0,ee,ee);J.width=C.width,J.height=C.height,re.putImageData(ce,Math.round(0-ee/2+f.width*.5-C.x),Math.round(0-ee/2+f.height*.5-C.y))}return new Promise(de=>{try{J.toBlob(ee=>{if(!ee){console.error("Canvas is empty");return}ee.name=ae,typeof x=="string"&&window.URL.revokeObjectURL(x),x=window.URL.createObjectURL(ee),de(x)},"image/jpeg")}catch(ee){console.error(ee),(0,s.lHp)("\u65E0\u6CD5\u6B63\u786E\u751F\u6210\u56FE\u7247, \u53EF\u80FD\u662F\u56E0\u4E3A\u60A8\u7684\u6D4F\u89C8\u5668\u7248\u672C\u8FC7\u65E7","error")}})}const j=a.memo(f=>{const C=(0,a.useRef)(null),R=J=>{typeof f.onChange=="function"&&f.onChange(J)},ae=(0,s.zX9)(J=>{if(J.target.files&&J.target.files.length>0){const re=J.target.files[0];if(!re)return;if((0,r.DQ)(re))R(URL.createObjectURL(re));else{const de=new FileReader;de.addEventListener("load",()=>{if(de.result){const ee=(0,t.h7)(a.createElement(B,{imageUrl:de.result.toString(),aspect:f.aspect,onConfirm:ce=>{(0,t.Mr)(ee),R(ce)}}),{maskClosable:!1,closable:!0})}else(0,s.lHp)((0,s.t)("\u6587\u4EF6\u8BFB\u53D6\u5931\u8D25"),"error")}),de.readAsDataURL(re)}J.target.files=null,J.target.value=""}});return a.createElement("div",{className:f.className},a.createElement("div",{className:"cursor-pointer inline-block relative",onClick:()=>{var J;return!f.disabled&&((J=C.current)==null?void 0:J.click())}},a.createElement("input",{ref:C,type:"file",className:"hidden",onChange:ae,accept:"image/*"}),a.createElement("div",{className:(0,n.Z)("group",f.className)},f.children,a.createElement("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center transition opacity-0 group-hover:opacity-100"},a.createElement(l.JO,{className:"text-white opacity-80 text-4xl",icon:"mdi:camera-outline"})))))});j.displayName="ImagePicker";var Q=Object.defineProperty,z=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,K=(f,C,R)=>C in f?Q(f,C,{enumerable:!0,configurable:!0,writable:!0,value:R}):f[C]=R,P=(f,C)=>{for(var R in C||(C={}))pe.call(C,R)&&K(f,R,C[R]);if(z)for(var R of z(C))te.call(C,R)&&K(f,R,C[R]);return f},D=(f,C,R)=>new Promise((ae,J)=>{var re=ce=>{try{ee(R.next(ce))}catch(Ae){J(Ae)}},de=ce=>{try{ee(R.throw(ce))}catch(Ae){J(Ae)}},ee=ce=>ce.done?ae(ce.value):Promise.resolve(ce.value).then(re,de);ee((R=R.apply(f,C)).next())});const d=a.memo(f=>{var C;const R=(C=f.aspect)!=null?C:1,[ae,J]=(0,a.useState)(0),[{loading:re},de]=(0,s.CoE)(ee=>D(void 0,null,function*(){const ce=yield(0,r.NV)(ee),Ae=yield(0,s.cTq)(ce,{onProgress(Ge){const We=Number((Ge*100).toFixed());console.log(`\u8FDB\u5EA6:${We}`),J(We)}});console.log("\u4E0A\u4F20\u6210\u529F",Ae),f.onUploadSuccess(Ae)}),[]);return a.createElement(j,{className:(0,n.Z)(f.className,"relative overflow-hidden",{"rounded-full":f.circle}),aspect:R,disabled:re,onChange:de},re&&a.createElement("div",{className:"absolute bottom-0 left-0 h-1",style:{width:`${ae}%`}}),f.children)});d.displayName="ImageUploader";const A=a.memo(f=>a.createElement(d,P({aspect:1,circle:!0},f)));A.displayName="AvatarUploader"},19856:(Ne,X,e)=>{e.d(X,{D:()=>t});var r=e(95268),n=e(75217),a=e(52983),s=e(30831);const t=a.memo(l=>{const{invite:b}=l;return b.expiredAt&&new Date(b.expiredAt).valueOf()<Date.now()?a.createElement("span",null,(0,s.t)("\u8BE5\u9080\u8BF7\u7801\u5DF2\u8FC7\u671F")):a.createElement(a.Fragment,null,b.expiredAt?a.createElement(s.cCv,null,"\u8BE5\u9080\u8BF7\u5C06\u4E8E"," ",a.createElement(r.Z,{title:(0,s.KJm)(b.expiredAt)},a.createElement("span",{className:"font-bold"},{date:(0,s.u39)(b.expiredAt)}))," ","\u8FC7\u671F"):a.createElement("span",null,(0,s.t)("\u8BE5\u9080\u8BF7\u7801\u6C38\u4E0D\u8FC7\u671F")),b.usageLimit&&a.createElement(a.Fragment,null,a.createElement(n.Z,{type:"vertical"}),a.createElement(s.cCv,null,"\u53EF\u4F7F\u7528"," ",a.createElement("span",{className:"font-bold"},{num:b.usageLimit})," ","\u6B21")))});t.displayName="InviteCodeExpiredAt"},9021:(Ne,X,e)=>{e.d(X,{Q:()=>h});var r=e(52983),n=e(93540),a=e(29787),s=e.n(a),t=e(55696),l=e(20685),b=e(58761),N=e(30831),w=e(66559);const h=r.memo(g=>{const{actions:B=[],hideDiscriminator:L=!1}=g,F=(0,N.xzJ)(g.userId),[x]=(0,N.aoI)([g.userId]),G=F.nickname;return r.createElement("div",{className:"flex items-center h-14 px-2.5 rounded group bg-black bg-opacity-0 hover:bg-opacity-20 dark:bg-white dark:bg-opacity-0 dark:hover:bg-opacity-20"},r.createElement(t.Z,{loading:s()(F),avatar:!0,title:!1,active:!0},r.createElement("div",{className:"mr-2"},g.popover?r.createElement(l.Z,{content:g.popover,placement:"left",trigger:"click"},r.createElement(n.qE,{className:"cursor-pointer",src:F.avatar,name:G,isOnline:x})):r.createElement(n.qE,{src:F.avatar,name:G,isOnline:x})),r.createElement("div",{className:"flex-1 text-gray-900 dark:text-white"},r.createElement(w.v,{userId:g.userId,showDiscriminator:!L})),r.createElement(b.Z,null,B)))});h.displayName="UserListItem"},2945:(Ne,X,e)=>{e.d(X,{B:()=>s});var r=e(52983),n=e(30831),a=e(38643);const s=r.memo(t=>{const{withoutUserIds:l=[],selectedIds:b,onChange:N}=t,w=(0,n.CGy)(h=>h.user.friends.map(g=>g.id).filter(g=>!l.includes(g)));return r.createElement(a.f,{selectedIds:b,onChange:N,allUserIds:w})});s.displayName="FriendPicker"},38643:(Ne,X,e)=>{e.d(X,{f:()=>g});var r=e(79546),n=e(66990),a=e(52983),s=e(30831),t=e(89022),l=e.n(t),b=e(92238),N=e.n(b),w=e(93540),h=e(64939);const g=a.memo(B=>{const{withSearch:L=!0,selectedIds:F,onChange:x,allUserIds:G}=B,[j,Q]=(0,a.useState)(""),z=(0,s.FDf)(G),pe=(0,a.useCallback)((K,P)=>{if(P===!0){if(F.includes(K))return;typeof x=="function"&&x([...F,K])}else typeof x=="function"&&x(N()(F,K))},[F,x]),te=l()(z.filter(K=>K.nickname.includes(j)),10);return a.createElement("div",null,L&&a.createElement(r.Z,{placeholder:(0,s.t)("\u641C\u7D22\u7528\u6237"),className:"mb-2",value:j,onChange:K=>Q(K.target.value)}),a.createElement("div",null,(0,s.t)("\u5DF2\u9009\u62E9 {{num}} \u9879",{num:F.length})),te.length>0?te.map(K=>a.createElement("div",{key:K._id,className:"my-1"},a.createElement(n.Z,{className:"mr-2 items-center",checked:F.includes(K._id),onChange:P=>pe(K._id,P.target.checked)},a.createElement("div",{className:"flex items-center w-full"},a.createElement(w.qE,{size:"small",name:K.nickname,src:K.avatar}),a.createElement("div",{className:"ml-1 text-typography-light dark:text-typography-dark"},K.nickname))))):a.createElement(h.T,null))});g.displayName="UserPicker"},50093:(Ne,X,e)=>{e.d(X,{m:()=>N});var r=e(75526),n=e(52983),a=e(54782),s=e(30831),t=e(2945),l=e(84208),b=(w,h,g)=>new Promise((B,L)=>{var F=j=>{try{G(g.next(j))}catch(Q){L(Q)}},x=j=>{try{G(g.throw(j))}catch(Q){L(Q)}},G=j=>j.done?B(j.value):Promise.resolve(j.value).then(F,x);G((g=g.apply(w,h)).next())});const N=n.memo(w=>{const{hiddenUserIds:h=[]}=w,[g,B]=(0,n.useState)([]),L=(0,a.useNavigate)(),[{loading:F},x]=(0,s.CoE)(()=>b(void 0,null,function*(){const G=yield(0,s.L1i)([...h,...g]);(0,l.Mr)(),L(`/main/personal/converse/${G._id}`)}),[g]);return n.createElement(l.AB,{title:(0,s.t)("\u521B\u5EFA\u591A\u4EBA\u4F1A\u8BDD")},n.createElement(t.B,{withoutUserIds:h,selectedIds:g,onChange:B}),n.createElement("div",{className:"text-right"},n.createElement(r.Z,{type:"primary",loading:F,onClick:x},(0,s.t)("\u521B\u5EFA"))))});N.displayName="CreateDMConverse"},40318:(Ne,X,e)=>{e.d(X,{P:()=>D});var r=e(93540),n=e(52983),a=e(30831),s=e(84208),t=e(19856),l=e(72297),b=e(75283),N=e(75526),w=e(96136),h=e(25355);const g={createInviteBtn:"src-components-modals-CreateGroupInvite-CreateInviteCode-module__createInviteBtn--9soUP"};var B=Object.defineProperty,L=Object.defineProperties,F=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,Q=(d,A,f)=>A in d?B(d,A,{enumerable:!0,configurable:!0,writable:!0,value:f}):d[A]=f,z=(d,A)=>{for(var f in A||(A={}))G.call(A,f)&&Q(d,f,A[f]);if(x)for(var f of x(A))j.call(A,f)&&Q(d,f,A[f]);return d},pe=(d,A)=>L(d,F(A)),te=(d,A,f)=>new Promise((C,R)=>{var ae=de=>{try{re(f.next(de))}catch(ee){R(ee)}},J=de=>{try{re(f.throw(de))}catch(ee){R(ee)}},re=de=>de.done?C(de.value):Promise.resolve(de.value).then(ae,J);re((f=f.apply(d,A)).next())}),K=(d=>(d.Normal="normal",d.Permanent="permanent",d))(K||{});const P=n.memo(({groupId:d,onInviteCreated:A,onInviteUpdated:f})=>{const[C,R]=(0,n.useState)(null),[{loading:ae},J]=(0,a.CoE)(Ae=>te(void 0,null,function*(){const Ge=yield(0,a.fiB)(d,Ae);R(Ge),A==null||A()}),[d,A]),[re,de]=(0,a.WHr)(d,[a.g3S.core.invite,a.g3S.core.unlimitedInvite]),ee=(0,a.zX9)(()=>{if(!C)return;const Ae=(0,s.h7)(n.createElement(h.s,{groupId:d,code:C.code,onEditSuccess:({expiredAt:Ge,usageLimit:We})=>{(0,a.lHp)((0,a.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),R(ze=>pe(z({},ze),{expiredAt:Ge?new Date(Ge).toISOString():void 0,usageLimit:We})),(0,s.Mr)(Ae),f==null||f()}}))}),ce={items:[{key:"persist",label:(0,a.t)("\u521B\u5EFA\u6C38\u4E45\u9080\u8BF7\u7801"),disabled:!de,onClick:()=>J("permanent")}]};return n.createElement("div",null,C?n.createElement("div",null,n.createElement(b.Z.Title,{className:"bg-white bg-opacity-30 dark:bg-black dark:bg-opacity-30 px-2 py-1 select-text text-lg rounded border border-black border-opacity-20",level:4,copyable:!0},(0,l.po)(C.code)),n.createElement("p",{className:"text-gray-500 text-sm"},n.createElement(t.D,{invite:C}),n.createElement(N.Z,{type:"link",size:"small",onClick:ee},(0,a.t)("\u7F16\u8F91")))):n.createElement(w.Z.Button,{className:g.createInviteBtn,size:"large",type:"primary",disabled:!re,loading:ae,onClick:()=>J("normal"),menu:ce,trigger:["click"]},(0,a.t)("\u521B\u5EFA\u94FE\u63A5")))});P.displayName="CreateInviteCode";const D=n.memo(d=>{const A=d.groupId;return(0,a.iFL)(A)?n.createElement(s.AB,null,n.createElement(r.JO,{className:"text-6xl block m-auto opacity-30 mb-4 mt-2",icon:"mdi:email-edit-outline"}),n.createElement("div",{className:"text-gray-400 font-bold text-lg mb-2"},(0,a.t)("\u521B\u5EFA\u94FE\u63A5\u5E76\u53D1\u9001\u7ED9\u5916\u90E8\u597D\u53CB")),n.createElement(P,{groupId:A,onInviteCreated:d.onInviteCreated,onInviteUpdated:d.onInviteUpdated})):n.createElement("div",null,(0,a.t)("\u5F02\u5E38"))});D.displayName="GroupInvite"},25355:(Ne,X,e)=>{e.d(X,{s:()=>b});var r=e(93540),n=e(52983),a=e(30831),s=e(84208),t=(N,w,h)=>new Promise((g,B)=>{var L=G=>{try{x(h.next(G))}catch(j){B(j)}},F=G=>{try{x(h.throw(G))}catch(j){B(j)}},x=G=>G.done?g(G.value):Promise.resolve(G.value).then(L,F);x((h=h.apply(N,w)).next())});const l=[{type:"select",name:"expiredAt",label:(0,a.t)("\u8FC7\u671F\u65F6\u95F4"),defaultValue:-1,options:[{label:(0,a.t)("30\u5206\u949F"),value:30*60},{label:(0,a.t)("1\u5C0F\u65F6"),value:60*60},{label:(0,a.t)("6\u5C0F\u65F6"),value:6*60*60},{label:(0,a.t)("12\u5C0F\u65F6"),value:12*60*60},{label:(0,a.t)("1\u5929"),value:24*60*60},{label:(0,a.t)("7\u5929"),value:7*24*60*60},{label:(0,a.t)("\u6C38\u4E0D"),value:-1}]},{type:"select",name:"usageLimit",label:(0,a.t)("\u6700\u5927\u4F7F\u7528\u6B21\u6570"),defaultValue:-1,options:[{label:(0,a.t)("\u65E0\u9650\u5236"),value:-1},{label:(0,a.t)("1\u6B21\u4F7F\u7528"),value:1},{label:(0,a.t)("5\u6B21\u4F7F\u7528"),value:5},{label:(0,a.t)("10\u6B21\u4F7F\u7528"),value:10},{label:(0,a.t)("25\u6B21\u4F7F\u7528"),value:25},{label:(0,a.t)("50\u6B21\u4F7F\u7528"),value:50},{label:(0,a.t)("100\u6B21\u4F7F\u7528"),value:100}]}],b=n.memo(N=>{const w=(0,a.zX9)(h=>t(void 0,null,function*(){const g=h.expiredAt===-1?void 0:Date.now()+h.expiredAt*1e3,B=h.usageLimit===-1?void 0:h.usageLimit;yield a.o4J.ru.editGroupInvite(N.groupId,N.code,g,B),N.onEditSuccess({expiredAt:g,usageLimit:B})}));return n.createElement(s.AB,{title:(0,a.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5")},n.createElement(r.Po,{fields:l,onSubmit:w}))});b.displayName="EditGroupInvite"},39979:(Ne,X,e)=>{e.d(X,{a:()=>pt});var r=e(73513),n=e(3856),a=e(50842),s=e(7975),t=e(52983),l=e(30831),b=e(95268),N=e(58761),w=e(75526),h=e(69104),g=e(66559),B=e(84208),L=e(40318),F=e(36932),x=e(84143),G=e(86724),j=e.n(G),Q=e(72297),z=e(93540),pe=e(25355),te=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const K=t.memo(o=>{const c=o.groupId,{loading:u,value:M,refresh:p}=(0,l.IxN)(()=>te(void 0,null,function*(){return(yield(0,l.TcU)(c)).reverse()}),[c]),Z=(0,l.zX9)(()=>{(0,B.h7)(t.createElement(L.P,{groupId:c,onInviteCreated:()=>{p()},onInviteUpdated:()=>{p()}}))}),S=(0,l.zX9)(k=>{const Fe=(0,B.h7)(t.createElement(pe.s,{groupId:c,code:k,onEditSuccess:()=>{(0,l.lHp)((0,l.t)("\u9080\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u6210\u529F"),"success"),(0,B.Mr)(Fe),p()}}))}),m=(0,l.zX9)(k=>{j()((0,Q.po)(k)),(0,l.lHp)((0,l.t)("\u9080\u8BF7\u94FE\u63A5\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"),"success")}),i=(0,l.zX9)(k=>te(void 0,null,function*(){(yield(0,B.aW)())&&(yield(0,l.L4o)(c,k),yield p())})),E=(0,t.useMemo)(()=>[{title:(0,l.t)("\u9080\u8BF7\u7801"),dataIndex:"code",width:200,render:k=>t.createElement(z.PJ,{text:k})},{title:(0,l.t)("\u521B\u5EFA\u65F6\u95F4"),dataIndex:"createdAt",render:k=>t.createElement(b.Z,{title:(0,l.KJm)(k)},(0,l.u39)(k))},{title:(0,l.t)("\u8FC7\u671F\u65F6\u95F4"),dataIndex:"expiredAt",render:k=>k?new Date(k).valueOf()<Date.now()?(0,l.t)("\u5DF2\u8FC7\u671F"):t.createElement(b.Z,{title:(0,l.KJm)(k)},(0,l.u39)(k)):(0,l.t)("\u6C38\u4E0D\u8FC7\u671F")},{title:(0,l.t)("\u4F7F\u7528\u6B21\u6570"),dataIndex:"usage",render:(k,Fe)=>t.createElement("div",null,k,Fe.usageLimit&&` / ${Fe.usageLimit}`)},{title:(0,l.t)("\u521B\u5EFA\u8005"),dataIndex:"creator",render:k=>t.createElement(g.v,{userId:k})},{title:(0,l.t)("\u64CD\u4F5C"),dataIndex:"_id",render:(k,Fe)=>t.createElement(N.Z,null,t.createElement(x.a,{title:(0,l.t)("\u7F16\u8F91\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:edit",onClick:()=>S(Fe.code)}),t.createElement(x.a,{title:(0,l.t)("\u590D\u5236\u9080\u8BF7\u94FE\u63A5"),shape:"square",icon:"mdi:content-copy",onClick:()=>m(Fe.code)}),t.createElement(x.a,{title:(0,l.t)("\u5220\u9664"),shape:"square",icon:"mdi:delete-outline",danger:!0,onClick:()=>i(k)}))}],[m,i]);return t.createElement(F.t,{spinning:u},t.createElement("div",{className:"text-right mb-2"},t.createElement(w.Z,{type:"primary",onClick:Z},(0,l.t)("\u521B\u5EFA\u9080\u8BF7\u7801"))),t.createElement(h.Z,{columns:E,dataSource:M,pagination:{hideOnSinglePage:!0}}))});K.displayName="GroupInvite";var P=e(85466),D=e.n(P),d=e(45513),A=e(14698),f=e.n(A),C=e(77179),R=e.n(C);function ae(o){return o.filter(c=>f()(c.parentId)).map(c=>({key:c.id,title:c.name,isLeaf:c.type!==l.Xpe.GROUP,children:c.type===l.Xpe.GROUP?o.filter(u=>u.parentId===c.id).map(u=>({key:u.id,title:u.name,isLeaf:!0})):void 0}))}function J(o){const c=R()(o),u=c.filter(p=>f()(p.parentId)),M=u.length;for(let p=M-1;p>=0;p--){const Z=u[p].id;u.splice(p+1,0,...c.filter(S=>S.parentId===Z))}return u}function re(o,c){const u=(0,t.useRef)(null),M=(0,t.useCallback)(m=>{u.current=m.node},[]),p=(0,t.useCallback)(()=>{u.current=null},[]),Z=(0,t.useCallback)(({dropNode:m,dropPosition:i})=>{var E;return((E=u.current)==null?void 0:E.isLeaf)===!0?i===0?!m.isLeaf:!0:i===0?!1:!m.isLeaf},[]),S=(0,t.useCallback)(m=>{var i;const E=R()(o),k=E.findIndex(De=>De.id===m.node.key),Fe=E[k];k===-1&&(0,l.lHp)("\u5F02\u5E38, \u76EE\u6807\u8282\u70B9\u672A\u627E\u5230","error");const qe=E.findIndex(De=>De.id===m.dragNode.key);((i=u.current)==null?void 0:i.isLeaf)===!0&&(m.node.isLeaf===!0?m.dragNodesKeys.map(De=>E.findIndex(_e=>_e.id===De)).filter(De=>De!==-1).forEach(De=>{E[De].parentId=Fe.parentId}):m.dropToGap===!1&&m.node.isLeaf===!1?m.dragNodesKeys.map(De=>E.findIndex(_e=>_e.id===De)).filter(De=>De!==-1).forEach(De=>{E[De].parentId=Fe.id}):m.dropToGap===!0&&m.node.isLeaf===!1&&m.dragNodesKeys.map(De=>E.findIndex(_e=>_e.id===De)).filter(De=>De!==-1).forEach(De=>{E[De].parentId=void 0}));const Ve=qe;let Oe;if(m.node.dragOverGapTop===!0?Oe=k:Oe=k+1,Ve<Oe)E.splice(Oe,0,E[Ve]),E.splice(Ve,1);else if(Ve>Oe){const[De]=E.splice(Ve,1);E.splice(Oe,0,De)}if(typeof c=="function"){const De=J(E);c(De)}},[o,c]);return{handleDragStart:M,handleDragEnd:p,handleAllowDrop:Z,handleDrop:S}}var de=e(38887),ee=e(89889),ce=Object.defineProperty,Ae=Object.defineProperties,Ge=Object.getOwnPropertyDescriptors,We=Object.getOwnPropertySymbols,ze=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,$e=(o,c,u)=>c in o?ce(o,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[c]=u,Xe=(o,c)=>{for(var u in c||(c={}))ze.call(c,u)&&$e(o,u,c[u]);if(We)for(var u of We(c))He.call(c,u)&&$e(o,u,c[u]);return o},Qe=(o,c)=>Ae(o,Ge(c)),Ye=(o,c)=>{var u={};for(var M in o)ze.call(o,M)&&c.indexOf(M)<0&&(u[M]=o[M]);if(o!=null&&We)for(var M of We(o))c.indexOf(M)<0&&He.call(o,M)&&(u[M]=o[M]);return u};function ve(o){const c=o,{name:u,type:M}=c,p=Ye(c,["name","type"]);let Z,S,m;if(typeof M=="string"){const i=M;Z=l.Xpe.PLUGIN;const E=(0,ee.S)(i);E&&(S=E.provider,m=E.name)}else Z=M;return{name:u,type:Z,provider:S,pluginPanelName:m,meta:p}}function le(o){return Qe(Xe({},o.meta),{name:o.name,type:o.type===l.Xpe.PLUGIN?String(o.pluginPanelName):o.type})}var Ee=e(73246);const Be=t.memo(o=>{const{allUserIds:c,userIds:u,onChange:M}=o,p=(0,l.FDf)(c),Z=(0,t.useCallback)(S=>{typeof M=="function"&&M(S)},[M]);return t.createElement(Ee.Z,{mode:"multiple",allowClear:!0,placeholder:(0,l.t)("\u8BF7\u9009\u62E9\u7528\u6237"),value:u,onChange:Z},p.map(S=>t.createElement(Ee.Z.Option,{key:S._id,value:S._id},S.nickname)))});Be.displayName="UserSelector";var Te=e(6494),Le=e.n(Te),je=e(39907),Je=e.n(je),W=e(61230),ne=e.n(W),$=Object.defineProperty,Y=Object.defineProperties,q=Object.getOwnPropertyDescriptors,ye=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,be=(o,c,u)=>c in o?$(o,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[c]=u,Ue=(o,c)=>{for(var u in c||(c={}))Pe.call(c,u)&&be(o,u,c[u]);if(ye)for(var u of ye(c))Re.call(c,u)&&be(o,u,c[u]);return o},Ze=(o,c)=>Y(o,q(c));const he=[{type:"text",name:"name",label:(0,l.t)("\u9762\u677F\u540D")},{type:"select",name:"type",label:(0,l.t)("\u7C7B\u578B"),options:[{label:(0,l.t)("\u804A\u5929\u9891\u9053"),value:l.Xpe.TEXT},{label:(0,l.t)("\u9762\u677F\u5206\u7EC4"),value:l.Xpe.GROUP},...s.pluginGroupPanel.map(o=>({label:o.label,value:o.name}))]}],I={name:z._6.string().required((0,l.t)("\u9762\u677F\u540D\u4E0D\u80FD\u4E3A\u7A7A")).max(20,(0,l.t)("\u9762\u677F\u540D\u8FC7\u957F")),type:z._6.string().required((0,l.t)("\u9762\u677F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A"))};function U(o,c){const u=(0,t.useMemo)(()=>{const p=()=>{const Z=(0,l.aaJ)(o),S=(0,z.tF)();return t.createElement(Be,{allUserIds:Z,onChange:m=>{S==null||S.setValues(Ze(Ue({},S.values),{disableSendMessageWithout:m}))}})};return p.displayName="DisableSendMessageWithoutComponent",p},[o]);return(0,t.useMemo)(()=>{if(l.yGS&&c.type===l.Xpe.TEXT)return{fields:Le()([...he,{type:"checkbox",name:"disableSendMessage",label:(0,l.t)("\u7981\u6B62\u6240\u6709\u4EBA\u53D1\u8A00")},c.disableSendMessage===!0&&{type:"custom",name:"disableSendMessageWithout",label:(0,l.t)("\u4EC5\u5141\u8BB8\u6307\u5B9A\u7528\u6237\u53D1\u8A00"),render:u}]),schema:(0,z._D)(Ze(Ue({},I),{disableSendMessage:z._6.mixed(),disableSendMessageWithout:z._6.mixed()}))};let p=he,Z=I;if(typeof c.type=="string"){const S=(0,ee.S)(c.type);if(S){const m=Array.isArray(S.extraFormMeta)?S.extraFormMeta:[];p=[...he,...m];const i=ne()(Je()(m,E=>E.name),()=>z._6.mixed());Z=Ue(Ue({},i),I)}}return{fields:p,schema:(0,z._D)(Z)}},[c])}var T=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const fe=t.memo(o=>{const c=(0,l.wY6)(o.groupId,o.groupPanelId),[u,M]=(0,t.useState)({}),[,p]=(0,l.CoE)(m=>T(void 0,null,function*(){yield(0,l.d89)(o.groupId,o.groupPanelId,ve(m)),(0,l.lHp)((0,l.t)("\u4FEE\u6539\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.groupPanelId,o.onSuccess]),{fields:Z,schema:S}=U(o.groupId,u);return c?t.createElement(B.AB,{title:(0,l.t)("\u7F16\u8F91\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:440}},t.createElement(z.Po,{schema:S,fields:Z.filter(m=>m.type!=="type"),initialValues:le(c),onChange:M,onSubmit:p})):t.createElement(de.T,null)});fe.displayName="ModalModifyGroupPanel";var _=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const Ce=t.memo(o=>{const c=(0,t.useMemo)(()=>ae(o.groupPanels),[o.groupPanels]),u=(0,t.useCallback)(E=>{const k=(0,B.h7)(t.createElement(fe,{groupId:o.groupId,groupPanelId:E,onSuccess:()=>(0,B.Mr)(k)}))},[o.groupId]),M=(0,t.useCallback)((E,k,Fe)=>{(0,l.wp$)({message:Fe?(0,l.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F\u7EC4 \u3010{{name}}\u3011 \u4EE5\u53CA\u4E0B\u7EA7\u7684\u6240\u6709\u9762\u677F\u4E48",{name:k}):(0,l.t)("\u786E\u5B9A\u8981\u5220\u9664\u9762\u677F \u3010{{name}}\u3011 \u4E48",{name:k}),onConfirm:()=>_(void 0,null,function*(){yield(0,l.J9q)(o.groupId,E)})})},[o.groupId]),p=(0,t.useCallback)(E=>t.createElement("div",{className:"flex group"},t.createElement("span",null,E.title),t.createElement("div",{className:"opacity-0 group-hover:opacity-100 ml-2"},t.createElement(N.Z,{size:"small"},t.createElement(x.a,{title:(0,l.t)("\u7F16\u8F91"),type:"text",size:"small",icon:"mdi:pencil-outline",onClick:k=>{k.stopPropagation(),k.preventDefault(),u(String(E.key))}}),t.createElement(x.a,{title:(0,l.t)("\u5220\u9664"),type:"text",size:"small",icon:"mdi:trash-can-outline",onClick:k=>{k.stopPropagation(),k.preventDefault(),M(String(E.key),String(E.title),!E.isLeaf)}})))),[M]),{handleDragStart:Z,handleDragEnd:S,handleAllowDrop:m,handleDrop:i}=re(o.groupPanels,o.onChange);return t.createElement(d.Z,{treeData:c,defaultExpandAll:!0,blockNode:!0,draggable:{icon:!1},selectable:!1,titleRender:p,onDrop:i,onDragStart:Z,onDragEnd:S,allowDrop:m})});Ce.displayName="GroupPanelTree";const xe=t.memo(o=>t.createElement("div",{className:"text-xl font-bold mb-4 flex justify-between"},t.createElement("div",null,o.children),t.createElement("div",null,o.extra)));xe.displayName="FullModalCommonTitle";var ge=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const Ie=t.memo(o=>{const[c,u]=(0,t.useState)({}),[,M]=(0,l.CoE)(S=>ge(void 0,null,function*(){yield(0,l.XAi)(o.groupId,ve(S)),(0,l.lHp)((0,l.t)("\u521B\u5EFA\u6210\u529F"),"success"),typeof o.onSuccess=="function"&&o.onSuccess()}),[o.groupId,o.onSuccess]),{fields:p,schema:Z}=U(o.groupId,c);return t.createElement(B.AB,{title:(0,l.t)("\u521B\u5EFA\u7FA4\u7EC4\u9762\u677F"),style:{maxWidth:440}},t.createElement(z.Po,{schema:Z,fields:p,onChange:u,onSubmit:M}))});Ie.displayName="ModalCreateGroupPanel";var we=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const v=t.memo(o=>{var c;const u=o.groupId,M=(0,l.iFL)(u),p=(c=M==null?void 0:M.panels)!=null?c:[],[Z,S]=(0,t.useState)(p),m=(0,t.useRef)(!1);(0,t.useEffect)(()=>{m.current!==!0&&S(p)},[p]);const i=(0,t.useCallback)(Ve=>{m.current=!0,S(Ve)},[]),[{loading:E},k]=(0,l.CoE)(()=>we(void 0,null,function*(){yield(0,l.uRW)(u,"panels",Z),m.current=!1,(0,l.lHp)((0,l.t)("\u4FDD\u5B58\u6210\u529F"),"success")}),[Z]),Fe=(0,t.useCallback)(()=>{S(p),m.current=!1},[p]),qe=(0,t.useCallback)(()=>{const Ve=(0,B.h7)(t.createElement(Ie,{groupId:u,onSuccess:()=>{(0,B.Mr)(Ve),m.current=!1}}))},[]);return t.createElement("div",null,t.createElement(xe,{extra:t.createElement(w.Z,{type:"primary",onClick:qe},(0,l.t)("\u521B\u5EFA\u9762\u677F"))},(0,l.t)("\u9762\u677F\u7BA1\u7406")),t.createElement("div",{className:"max-h-80 overflow-auto border rounded border-black border-opacity-20 p-1"},t.createElement(Ce,{groupId:u,groupPanels:Z,onChange:i})),!D()(p,Z)&&t.createElement("div",{className:"space-x-1 mt-2"},t.createElement(w.Z,{type:"primary",loading:E,onClick:k},(0,l.t)("\u4FDD\u5B58")),t.createElement(w.Z,{onClick:Fe},(0,l.t)("\u91CD\u7F6E"))))});v.displayName="GroupPanel";var O=e(18300),y=e(83667),oe=e(14517);const se=t.memo(o=>t.createElement("div",{className:(0,oe.Z)("px-2 py-1 rounded cursor-pointer mb-1 hover:bg-black hover:bg-opacity-20",{"bg-black bg-opacity-20":o.active}),onClick:o.onClick},o.children));se.displayName="RoleItem";var ie=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});function ue(o,c){const[{loading:u},M]=(0,l.CoE)(()=>ie(this,null,function*(){yield l.o4J.ru.createGroupRole(o,(0,l.t)("\u65B0\u8EAB\u4EFD\u7EC4"),(0,l.Q$5)()),(0,l.jiy)()}),[o]),[{loading:p},Z]=(0,l.CoE)(k=>ie(this,null,function*(){c===l.lin?yield l.o4J.ru.modifyGroupField(o,"fallbackPermissions",k):yield l.o4J.ru.updateGroupRolePermission(o,c,k),(0,l.jiy)()}),[o,c]),[{loading:S},m]=(0,l.CoE)(k=>ie(this,null,function*(){if(c===l.lin)throw new Error((0,l.t)("\u65E0\u6CD5\u4FEE\u6539\u6240\u6709\u4EBA\u6743\u9650\u7EC4\u7684\u663E\u793A\u540D\u79F0"));yield l.o4J.ru.updateGroupRoleName(o,c,k),(0,l.jiy)()}),[o,c]),[{loading:i},E]=(0,l.CoE)(()=>ie(this,null,function*(){if(c===l.lin)throw new Error((0,l.t)("\u65E0\u6CD5\u5220\u9664\u6240\u6709\u4EBA\u6743\u9650"));yield l.o4J.ru.deleteGroupRole(o,c),(0,l.jiy)()}),[o,c]);return{loading:u||p||S||i,handleCreateRole:M,handleSavePermission:Z,handleChangeRoleName:m,handleDeleteRole:E}}var H=e(7606);const V=t.memo(o=>{const{currentRoleInfo:c}=o,u=(0,l.nWw)(()=>{(0,B.VW)({title:(0,l.t)("\u786E\u8BA4\u8981\u5220\u9664\u89D2\u8272 {{name}} \u4E48?",{name:c.name}),onConfirm:()=>o.onDeleteRole()})});return t.createElement("div",{className:"px-2"},t.createElement(H.LP,{title:(0,l.t)("\u8EAB\u4EFD\u7EC4\u540D\u79F0"),value:o.currentRoleInfo.name,editable:!0,renderEditor:H.jo,onSave:o.onChangeRoleName}),t.createElement(w.Z,{type:"primary",danger:!0,onClick:u},(0,l.t)("\u5220\u9664\u8EAB\u4EFD\u7EC4")))});V.displayName="RoleSummary";var me=e(75217),ke=e(63509),Se=e(36572),Me=e(44411);const Ke=t.memo(o=>t.createElement("div",{className:"mx-2 py-3 border-b border-white border-opacity-20"},t.createElement(ke.Z,null,t.createElement(Se.Z,{flex:1,className:"font-bold"},o.title),t.createElement(Se.Z,null,t.createElement(Me.Z,{disabled:o.disabled,checked:o.checked,onChange:o.onChange}))),t.createElement("div",{className:"text-gray-400"},o.desc)));Ke.displayName="PermissionItem";var et=e(90292),tt=e.n(et),nt=e(92238),rt=e.n(nt);function ht(o){const[c,u]=(0,t.useState)([]),M=(0,t.useMemo)(()=>!D()(new Set(o),new Set(c)),[o,c]);(0,t.useEffect)(()=>{u([...o])},[o]);const p=(0,t.useCallback)((Z,S)=>{u(S?tt()([...c,Z]):rt()(c,Z))},[c]);return{isEditing:M,editingPermission:c,setEditingPermission:u,handleSwitchPermission:p}}const ot=t.memo(o=>{const c=(0,t.useMemo)(()=>{var m,i;return o.roleId===l.lin?o.fallbackPermissions:(i=(m=o.currentRoleInfo)==null?void 0:m.permissions)!=null?i:[]},[o.roleId,o.fallbackPermissions,o.currentRoleInfo]),{isEditing:u,editingPermission:M,setEditingPermission:p,handleSwitchPermission:Z}=ht(c),S=(0,t.useCallback)(()=>{p((0,l.pZA)().filter(m=>m.default===!0).map(m=>m.key))},[]);return t.createElement("div",null,t.createElement("div",{className:"mb-2 space-x-2 text-right"},t.createElement(w.Z,{onClick:S},(0,l.t)("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C")),t.createElement(w.Z,{type:"primary",disabled:!u,onClick:()=>o.onSavePermission(M)},(0,l.t)("\u4FDD\u5B58"))),(0,l.pZA)().map(m=>t.createElement(Ke,{key:m.key,title:m.title,desc:m.desc,disabled:m.required?!m.required.every(i=>M.includes(i)):void 0,checked:M.includes(m.key),onChange:i=>Z(m.key,i)})),s.pluginPermission.length>0&&t.createElement(t.Fragment,null,t.createElement(me.Z,null,(0,l.t)("\u4EE5\u4E0B\u4E3A\u63D2\u4EF6\u6743\u9650")),s.pluginPermission.map(m=>t.createElement(Ke,{key:m.key,title:m.title,desc:m.desc,disabled:m.required?!m.required.every(i=>M.includes(i)):void 0,checked:M.includes(m.key),onChange:i=>Z(m.key,i)}))))});ot.displayName="RolePermission";var gt=e(38643),yt=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const st=t.memo(o=>{const{groupId:c,withoutMemberIds:u=[],onConfirm:M}=o,[p,Z]=(0,t.useState)([]),S=(0,l.aaJ)(c),m=(0,t.useMemo)(()=>rt()(S,...u),[S,u]),[{loading:i},E]=(0,l.ilX)(()=>yt(void 0,null,function*(){yield M(p)}),[M,p]);return t.createElement(B.AB,{title:(0,l.t)("\u9009\u62E9\u7FA4\u7EC4\u6210\u5458")},t.createElement(gt.f,{allUserIds:m,selectedIds:p,onChange:Z}),t.createElement("div",{className:"text-right"},t.createElement(w.Z,{type:"primary",loading:i,onClick:E},(0,l.t)("\u786E\u8BA4"))))});st.displayName="SelectGroupMember";var ut=e(9021),at=e(79546),ct=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const it=t.memo(o=>{var c,u;const M=o.currentRoleInfo._id,p=(0,l.iFL)(o.groupId),S=((c=p==null?void 0:p.members)!=null?c:[]).filter(Oe=>Oe.roles.includes(M)).map(Oe=>Oe.userId),m=(0,l.FDf)(S),{searchText:i,setSearchText:E,isSearching:k,searchResult:Fe}=(0,l.RxY)({dataSource:m,filterFn:(Oe,De)=>String(Oe.nickname).includes(De)}),qe=(0,l.nWw)(()=>{const Oe=(0,B.h7)(t.createElement(st,{groupId:o.groupId,withoutMemberIds:Le()([...S]),onConfirm:De=>ct(void 0,null,function*(){try{yield l.o4J.ru.appendGroupMemberRoles(o.groupId,De,[o.currentRoleInfo._id]),(0,l.jiy)(),(0,B.Mr)(Oe)}catch(_e){(0,l.hJM)(_e)}})}))}),[,Ve]=(0,l.CoE)(Oe=>ct(void 0,null,function*(){var De;if(!((De=o.currentRoleInfo)==null?void 0:De._id)){(0,l.hJM)((0,l.t)("\u5F53\u524D\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u89D2\u8272\u7EC4"));return}yield l.o4J.ru.removeGroupMemberRoles(o.groupId,[Oe],[o.currentRoleInfo._id]),(0,l.jiy)()}),[o.groupId,(u=o.currentRoleInfo)==null?void 0:u._id]);return t.createElement("div",null,t.createElement("div",{className:"text-right mb-2 flex space-x-1"},t.createElement(w.Z,{type:"primary",onClick:qe},(0,l.t)("\u6DFB\u52A0\u6210\u5458")),m.length>0&&t.createElement(at.Z,{placeholder:(0,l.t)("\u641C\u7D22\u6210\u5458"),size:"middle",suffix:t.createElement(z.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:i,onChange:Oe=>E(Oe.target.value)})),(k?Fe:m).map(Oe=>t.createElement(ut.Q,{key:Oe._id,userId:Oe._id,actions:[t.createElement(x.a,{key:"remove",icon:"mdi:close",onClick:()=>Ve(Oe._id)})]})))});it.displayName="RoleMember";var Pt=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const mt=t.memo(o=>{var c,u;const{groupId:M}=o,[p,Z]=(0,t.useState)(l.lin),S=(0,l.iFL)(M),m=(c=S==null?void 0:S.roles)!=null?c:[],i=(0,t.useMemo)(()=>m.find(Oe=>Oe._id===p),[m,p]),{loading:E,handleCreateRole:k,handleSavePermission:Fe,handleChangeRoleName:qe,handleDeleteRole:Ve}=ue(M,p);return t.createElement(O.g,{spinning:E,className:"h-full"},t.createElement("div",{className:"flex h-full"},t.createElement("div",{className:"pr-2 mr-2 w-40 mobile:w-28 border-r border-white border-opacity-20"},t.createElement(se,{active:p===l.lin,onClick:()=>Z(l.lin)},(0,l.t)("\u6240\u6709\u4EBA")),m.map(Oe=>t.createElement(se,{key:Oe._id,active:p===Oe._id,onClick:()=>Z(Oe._id)},Oe.name)),t.createElement(se,{active:!1,onClick:k},(0,l.t)("\u6DFB\u52A0\u89D2\u8272"))),t.createElement("div",{className:"flex-1 overflow-y-auto"},t.createElement(y.N,{defaultActiveKey:"permission",items:[{key:"summary",label:(0,l.t)("\u6982\u8FF0"),disabled:p===l.lin,children:t.createElement(t.Fragment,null,i&&t.createElement(V,{currentRoleInfo:i,onChangeRoleName:qe,onDeleteRole:()=>Pt(void 0,null,function*(){yield Ve(),Z(l.lin)})}))},{key:"permission",label:(0,l.t)("\u6743\u9650"),children:t.createElement(ot,{roleId:p,fallbackPermissions:(u=S==null?void 0:S.fallbackPermissions)!=null?u:[],currentRoleInfo:i,onSavePermission:Fe})},{key:"member",label:(0,l.t)("\u7BA1\u7406\u6210\u5458"),disabled:p===l.lin,children:t.createElement(t.Fragment,null,i&&t.createElement(it,{groupId:M,currentRoleInfo:i}))}]}))))});mt.displayName="GroupRole";var dt=e(92951),Ct=e(15333),lt=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const vt=t.memo(({groupId:o})=>{var c,u;const M=(0,l.iFL)(o),[,p]=(0,l.CoE)(m=>lt(void 0,null,function*(){yield(0,l.uRW)(o,"name",m),(0,l.jiy)((0,l.t)("\u4FEE\u6539\u7FA4\u7EC4\u540D\u6210\u529F"))}),[o]),[,Z]=(0,l.CoE)(m=>lt(void 0,null,function*(){yield(0,l.uRW)(o,"description",m),(0,l.jiy)((0,l.t)("\u4FEE\u6539\u7FA4\u7EC4\u63CF\u8FF0\u6210\u529F"))}),[o]),[,S]=(0,l.CoE)(m=>lt(void 0,null,function*(){yield(0,l.uRW)(o,"avatar",m.url),(0,l.lHp)((0,l.t)("\u4FEE\u6539\u7FA4\u7EC4\u5934\u50CF\u6210\u529F"),"success")}),[o]);return M?t.createElement("div",null,t.createElement(xe,null,(0,l.t)("\u7FA4\u7EC4\u6982\u8FF0")),t.createElement("div",{className:"flex flex-wrap"},t.createElement("div",{className:"w-1/3 mobile:w-full mobile:text-center"},t.createElement(dt.C,{circle:!0,onUploadSuccess:S},t.createElement(z.qE,{size:128,name:M.name,src:M.avatar}))),t.createElement("div",{className:"w-2/3 mobile:w-full"},t.createElement(H.LP,{title:(0,l.t)("\u7FA4\u7EC4\u540D\u79F0"),value:M.name,editable:!0,renderEditor:H.jo,onSave:p}),t.createElement(H.LP,{title:(0,l.t)("\u6210\u5458\u6570"),value:String(M.members.length)}),t.createElement(H.LP,{title:(0,l.t)("\u7FA4\u7EC4\u63CF\u8FF0"),value:(c=M.description)!=null?c:"",content:t.createElement("pre",null,(u=M.description)!=null?u:""),editable:!0,renderEditor:It,onSave:Z})))):t.createElement(Ct.J,{message:(0,l.t)("\u65E0\u6CD5\u83B7\u53D6\u5230\u7FA4\u7EC4\u4FE1\u606F")})});vt.displayName="GroupSummary";const It=({value:o,onChange:c})=>t.createElement(at.Z.TextArea,{autoSize:{minRows:4,maxRows:6},maxLength:120,value:o,onChange:u=>c(u.target.value),showCount:!0});var Dt=(o,c,u)=>new Promise((M,p)=>{var Z=i=>{try{m(u.next(i))}catch(E){p(E)}},S=i=>{try{m(u.throw(i))}catch(E){p(E)}},m=i=>i.done?M(i.value):Promise.resolve(i.value).then(Z,S);m((u=u.apply(o,c)).next())});const Et=t.memo(o=>{var c,u,M;const p=o.groupId,Z=(0,l.iFL)(p),S=(0,l.TL5)(),[{loading:m},i]=(0,l.CoE)((k,Fe)=>Dt(void 0,null,function*(){yield l.o4J.ru.modifyGroupConfig(p,k,Fe),S(l.hyC.updateGroupConfig({groupId:p,configName:k,configValue:Fe})),(0,l.jiy)()}),[p]);if(!Z)return t.createElement(O.g,{spinning:!0});const E=(c=Z.config)!=null?c:{};return t.createElement("div",null,t.createElement(xe,null,(0,l.t)("\u7FA4\u7EC4\u914D\u7F6E")),t.createElement(H.LP,{title:(0,l.t)("\u9690\u85CF\u6210\u5458\u5B8C\u6574\u540D\u79F0"),tip:(0,l.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u83B7\u53D6\u6210\u5458\u4FE1\u606F"),content:t.createElement(Me.Z,{disabled:m,checked:(u=E.hideGroupMemberDiscriminator)!=null?u:!1,onChange:k=>i("hideGroupMemberDiscriminator",k)})}),t.createElement(H.LP,{title:(0,l.t)("\u7981\u6B62\u5728\u7FA4\u7EC4\u53D1\u8D77\u79C1\u4FE1"),tip:(0,l.t)("\u7FA4\u7EC4\u9690\u79C1\u63A7\u5236\uFF0C\u9632\u6B62\u901A\u8FC7\u7FA4\u7EC4\u6076\u610F\u9A9A\u6270\u7528\u6237\u3002"),content:t.createElement(Me.Z,{disabled:m||E.hideGroupMemberDiscriminator===!0,checked:(M=E.hideGroupMemberDiscriminator===!0||E.disableCreateConverseFromGroup)!=null?M:!1,onChange:k=>i("disableCreateConverseFromGroup",k)})}),t.createElement(H.LP,{title:(0,l.t)("\u7FA4\u7EC4\u80CC\u666F"),tip:(0,l.t)("\u4E2A\u6027\u5316\u914D\u7F6E\u7FA4\u7EC4\u80CC\u666F"),content:t.createElement(t.Fragment,null,t.createElement(dt.w,{aspect:16/9,onUploadSuccess:function(k){i("groupBackgroundImage",k.url)}},t.createElement(z.Ee,{wrapperClassName:"block",style:{width:640,height:360},src:E.groupBackgroundImage})),t.createElement("div",{className:"text-xs opacity-80"},(0,l.t)("\u5EFA\u8BAE\u6BD4\u4F8B: 16:9 | \u5EFA\u8BAE\u5927\u5C0F: 1280x720")),E.groupBackgroundImage&&t.createElement(w.Z,{className:"mt-1",type:"primary",onClick:()=>{i("groupBackgroundImage","")}},(0,l.t)("\u6E05\u9664")))}),s.pluginGroupConfigItems.map(k=>{const Fe=(0,ee.g)(k.name);return t.createElement(H.LP,{key:Fe,title:k.title,tip:k.tip,content:t.createElement(k.component,{value:E[Fe],onChange:qe=>i(Fe,qe),loading:m})})}))});Et.displayName="GroupConfig";var Mt=e(64917),Ft=e(96136),xt=e(6342);const ft=t.memo(o=>{const c=o.groupId,{userInfos:u,searchText:M,setSearchText:p,isSearching:Z,searchResult:S,generateActionMenu:m}=(0,Mt.Q)(c),i=E=>{const k=m(E);return t.createElement(ut.Q,{key:E._id,userId:E._id,actions:[t.createElement("div",{key:"more"},t.createElement(Ft.Z,{menu:k,trigger:["click"],placement:"bottomRight"},t.createElement("div",null,t.createElement(x.a,{icon:"mdi:dots-vertical"}))))]})};return t.createElement("div",{className:"flex flex-col h-full"},t.createElement(xe,null,(0,l.t)("\u6210\u5458\u7BA1\u7406")),t.createElement("div",{className:"py-2"},t.createElement(at.Z,{placeholder:(0,l.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:t.createElement(z.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:M,onChange:E=>p(E.target.value)})),t.createElement("div",{className:"flex-1 overflow-auto"},t.createElement(xt.OO,{style:{height:"100%"},data:Z?S:u,itemContent:(E,k)=>i(k)})))});ft.displayName="GroupMember";const pt=t.memo(o=>{const c=o.groupId,u=(0,t.useCallback)(E=>{E===!1&&typeof o.onClose=="function"&&o.onClose()},[o.onClose]),[M,p,Z,S,m]=(0,l.WHr)(c,[l.g3S.core.groupConfig,l.g3S.core.manageUser,l.g3S.core.managePanel,l.g3S.core.manageInvite,l.g3S.core.manageRoles]),i=(0,t.useMemo)(()=>{const E=[{type:"group",title:(0,l.t)("\u901A\u7528"),children:Le()([{type:"item",title:(0,l.t)("\u6982\u8FF0"),content:t.createElement(vt,{groupId:c})},M&&{type:"item",title:(0,l.t)("\u914D\u7F6E"),content:t.createElement(Et,{groupId:c})},p&&{type:"item",title:(0,l.t)("\u6210\u5458"),content:t.createElement(ft,{groupId:c})},Z&&{type:"item",title:(0,l.t)("\u9762\u677F"),content:t.createElement(v,{groupId:c})},S&&{type:"item",title:(0,l.t)("\u9080\u8BF7\u7801"),content:t.createElement(K,{groupId:c})},m&&{type:"item",title:(0,l.t)("\u8EAB\u4EFD\u7EC4"),content:t.createElement(mt,{groupId:c})}])}],k=s.pluginCustomPanel.filter(Fe=>Fe.position==="groupdetail").map(Fe=>({type:"item",title:Fe.label,content:t.createElement(Fe.render)}));return k.length>0&&E.push({type:"group",title:(0,l.t)("\u63D2\u4EF6"),children:k}),E},[]);return t.createElement(a.A,{value:c},t.createElement(r.o,{onChangeVisible:u},t.createElement(n.u,{menu:i,defaultContentPath:"0.children.0.content"})))});pt.displayName="GroupDetail"},51052:(Ne,X,e)=>{e.d(X,{Z:()=>pe});var r=e(50842),n=e(52983),a=e(30831),s=e(84143),t=e(66559),l=e(83996),b=e(58761),N=e(56489),w=e(95268),h=e(54782),g=e(93540),B=(te,K,P)=>new Promise((D,d)=>{var A=R=>{try{C(P.next(R))}catch(ae){d(ae)}},f=R=>{try{C(P.throw(R))}catch(ae){d(ae)}},C=R=>R.done?D(R.value):Promise.resolve(R.value).then(A,f);C((P=P.apply(te,K)).next())});const L=n.memo(te=>{const{userInfo:K}=te,{value:P}=(0,a.r53)(()=>B(void 0,null,function*(){if(!K.avatar)return(0,g.Yy)(K.nickname);const D=yield(0,l.f)(K.avatar);return`rgba(${D.r}, ${D.g}, ${D.b}, ${D.a})`}),[K.avatar]);return n.createElement("div",{className:"relative bg-inherit"},n.createElement("div",{style:{width:"100%",height:60,backgroundColor:P}}),n.createElement("div",{className:"absolute p-1 rounded-1/2 -mt-11 ml-3 bg-inherit"},n.createElement(g.OI,{size:80,src:K.avatar,name:K.nickname})),n.createElement("div",{className:"p-2 mt-10"},te.children))});L.displayName="UserProfileContainer";var F=e(7975);function x(te={}){return n.createElement(n.Fragment,null,F.pluginUserExtraInfo.map((K,P)=>{var D;const d=(D=K.component)==null?void 0:D.render;return d?n.createElement(d,{key:K.name+P,value:te[K.name]}):n.createElement("div",{key:K.name+P,className:"flex"},n.createElement("div",{className:"w-1/4 text-gray-500"},K.label,":"),n.createElement("div",{className:"w-3/4"},te[K.name]?String(te[K.name]):""))}))}var G=(te,K,P)=>new Promise((D,d)=>{var A=R=>{try{C(P.next(R))}catch(ae){d(ae)}},f=R=>{try{C(P.throw(R))}catch(ae){d(ae)}},C=R=>R.done?D(R.value):Promise.resolve(R.value).then(A,f);C((P=P.apply(te,K)).next())});const j=n.memo(te=>{var K;const{userInfo:P,groupInfo:D}=te,d=P._id,A=(K=P.extra)!=null?K:{},f=Q(d,D),{hideGroupMemberDiscriminator:C,disableCreateConverseFromGroup:R}=(0,a.r3q)(D),ae=x(A),J=(0,h.useNavigate)(),re=(0,a.IIz)(),de=!C&&!R&&re!==d,[,ee]=(0,a.CoE)(()=>G(void 0,null,function*(){const ce=yield(0,a.L1i)([d]);J(`/main/personal/converse/${ce._id}`)}),[J]);return(0,n.useEffect)(()=>{P.avatar&&(0,l.f)(P.avatar).then(ce=>{console.log("fetchImagePrimaryColor",ce)})},[P.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(L,{userInfo:P},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(t.v,{userId:d})),!C&&n.createElement("span",{className:"opacity-60 ml-1"},"#",P.discriminator)),n.createElement(b.Z,{size:4,wrap:!0,className:"py-1"},D.owner===d&&n.createElement(N.Z,{color:"gold"},(0,a.t)("\u521B\u5EFA\u8005")),P.temporary&&n.createElement(N.Z,{color:"processing"},(0,a.t)("\u6E38\u5BA2")),f.map(ce=>n.createElement(N.Z,{key:ce,color:(0,g.Yy)(ce)},ce))),n.createElement("div",{className:"pt-2"},ae),n.createElement("div",{className:"text-right"},de&&n.createElement(w.Z,{title:(0,a.t)("\u53D1\u9001\u6D88\u606F")},n.createElement(s.a,{icon:"mdi:message-processing-outline",onClick:ee})))))});j.displayName="GroupUserPopover";function Q(te,K){var P,D;const d=(D=(P=K.members.find(f=>f.userId===te))==null?void 0:P.roles)!=null?D:[];return K.roles.filter(f=>d.includes(f._id)).map(f=>f.name)}const z=n.memo(te=>{var K;const{userInfo:P}=te,D=(K=P.extra)!=null?K:{},d=x(D);return(0,n.useEffect)(()=>{P.avatar&&(0,l.f)(P.avatar).then(A=>{console.log("fetchImagePrimaryColor",A)})},[P.avatar]),n.createElement("div",{className:"w-80 -mx-4 -my-3 bg-inherit"},n.createElement(L,{userInfo:P},n.createElement("div",{className:"text-xl"},n.createElement("span",{className:"font-semibold"},n.createElement(t.v,{userId:P._id})),n.createElement("span",{className:"opacity-60 ml-1"},"#",P.discriminator)),n.createElement(b.Z,{size:4,wrap:!0,className:"py-1"},P.temporary&&n.createElement(N.Z,{color:"processing"},(0,a.t)("\u6E38\u5BA2"))),n.createElement("div",{className:"pt-2"},d)))});z.displayName="PersonalUserPopover";const pe=n.memo(te=>{const K=(0,r.b)(),P=(0,a.iFL)(K);return(0,a.xzJ)(te.userInfo._id,!0),P?n.createElement(j,{userInfo:te.userInfo,groupInfo:P}):n.createElement(z,{userInfo:te.userInfo})});pe.displayName="UserPopover"},63933:(Ne,X,e)=>{e.d(X,{q:()=>a});var r=e(52983),n=e(30831);function a(s,t){const l=(0,n.ysv)(s);(0,r.useLayoutEffect)(()=>{const b=N=>{typeof l.current=="function"&&l.current(N)};return window.addEventListener("keydown",b,t),()=>{window.removeEventListener("keydown",b,t)}},[])}},64917:(Ne,X,e)=>{e.d(X,{Q:()=>N});var r=e(84208),n=e(52983),a=e(30831),s=e(6494),t=e.n(s),l=e(95850),b=(h,g,B)=>new Promise((L,F)=>{var x=Q=>{try{j(B.next(Q))}catch(z){F(z)}},G=Q=>{try{j(B.throw(Q))}catch(z){F(z)}},j=Q=>Q.done?L(Q.value):Promise.resolve(Q.value).then(x,G);j((B=B.apply(h,g)).next())});function N(h){var g;const B=(0,a.iFL)(h),L=(g=B==null?void 0:B.members)!=null?g:[],F=(0,a.Tgq)(h),x=(0,l.x)(),{handleMuteMember:G,handleUnmuteMember:j}=w(h,F),{searchText:Q,setSearchText:z,isSearching:pe,searchResult:te}=(0,a.RxY)({dataSource:F,filterFn:(d,A)=>!!(x[d._id]&&x[d._id].includes(A)||d.nickname.includes(A))}),[,K]=(0,a.CoE)(d=>b(this,null,function*(){(yield(0,r.aW)({title:(0,a.t)("\u786E\u8BA4\u8981\u5C06\u8BE5\u7528\u6237\u79FB\u51FA\u7FA4\u7EC4\u4E48")}))&&(yield a.o4J.ru.deleteGroupMember(h,d),(0,a.jiy)())}),[h]),P=(0,n.useCallback)(d=>{const A=L.find(C=>C.userId===d);if(!A||!A.muteUntil)return!1;const f=A.muteUntil;return new Date(f).valueOf()>new Date().valueOf()},[L]),D=(0,a.nWw)(d=>{const f=P(d._id)?[{key:"unmute",label:(0,a.t)("\u89E3\u9664\u7981\u8A00"),onClick:()=>j(d._id)}]:[{key:"mute",label:(0,a.t)("\u7981\u8A00"),children:[{key:"1m",label:(0,a.t)("1\u5206\u949F"),onClick:()=>G(d._id,1*60*1e3)},{key:"5m",label:(0,a.t)("5\u5206\u949F"),onClick:()=>G(d._id,5*60*1e3)},{key:"10m",label:(0,a.t)("10\u5206\u949F"),onClick:()=>G(d._id,10*60*1e3)},{key:"30m",label:(0,a.t)("30\u5206\u949F"),onClick:()=>G(d._id,30*60*1e3)},{key:"1d",label:(0,a.t)("1\u5929"),onClick:()=>G(d._id,1*24*60*60*1e3)},{key:"7d",label:(0,a.t)("7\u5929"),onClick:()=>G(d._id,7*24*60*60*1e3)},{key:"30d",label:(0,a.t)("30\u5929"),onClick:()=>G(d._id,30*24*60*60*1e3)}]}];return{items:t()([...f,{key:"delete",label:(0,a.t)("\u79FB\u51FA\u7FA4\u7EC4"),danger:!0,onClick:()=>K(d._id)}])}});return{userInfos:F,searchText:Q,setSearchText:z,isSearching:pe,searchResult:te,getMemberHasMute:P,handleMuteMember:G,handleUnmuteMember:j,handleRemoveGroupMember:K,generateActionMenu:D}}function w(h,g){const[,B]=(0,a.CoE)((F,x)=>b(this,null,function*(){const G=g.find(j=>j._id===F);if(!G)throw new Error((0,a.t)("\u6CA1\u6709\u627E\u5230\u7528\u6237"));(yield(0,r.aW)({title:(0,a.t)("\u786E\u5B9A\u8981\u7981\u8A00 {{name}} \u4E48",{name:G.nickname}),content:(0,a.t)("\u7981\u8A00 {{length}}, \u9884\u8BA1\u5230 {{until}} \u4E3A\u6B62",{length:(0,a.TGs)(x),until:(0,a.KJm)(new Date().valueOf()+x)})}))&&(yield a.o4J.ru.muteGroupMember(h,F,x),(0,a.jiy)())}),[h,g]),[,L]=(0,a.CoE)(F=>b(this,null,function*(){yield a.o4J.ru.muteGroupMember(h,F,-1),(0,a.jiy)()}),[h]);return{handleMuteMember:B,handleUnmuteMember:L}}},95483:(Ne,X,e)=>{e.d(X,{r:()=>B});var r=e(30831);const n=(0,r.fA3)(()=>sessionStorage);var a=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable,w=(L,F,x)=>F in L?a(L,F,{enumerable:!0,configurable:!0,writable:!0,value:x}):L[F]=x,h=(L,F)=>{for(var x in F||(F={}))b.call(F,x)&&w(L,x,F[x]);if(l)for(var x of l(F))N.call(F,x)&&w(L,x,F[x]);return L},g=(L,F)=>s(L,t(F));function B(L){const[F={},x]=n("sessionPreference"),G=F[L],j=(0,r.nWw)(Q=>{x(g(h({},F),{[L]:Q}))});return[G,j]}},16131:(Ne,X,e)=>{e.d(X,{E:()=>Qe,x:()=>Ye});var r=e(6739),n=e(89889),a=e(48303),s=e(52983),t=e(30831);const l=s.memo(ve=>{const le=(0,t.wY6)(ve.groupId,ve.panelId);if(!le)return s.createElement(a.Z,{className:"w-full text-center",message:(0,t.t)("\u65E0\u6CD5\u83B7\u53D6\u9762\u677F\u4FE1\u606F")});if(typeof le.provider!="string")return s.createElement(a.Z,{className:"w-full text-center",message:(0,t.t)("\u672A\u627E\u5230\u63D2\u4EF6\u7684\u63D0\u4F9B\u8005")});const Ee=(0,s.useMemo)(()=>(0,t.YQu)(le.pluginPanelName)?(0,n.S)(le.pluginPanelName):null,[le.name]);if(!Ee)return s.createElement(a.Z,{className:"w-full text-center",message:s.createElement("div",null,s.createElement("p",null,(0,t.t)("\u8BE5\u9762\u677F\u7531\u63D2\u4EF6\u63D0\u4F9B")),s.createElement("p",null,(0,t.t)("\u63D2\u4EF6\u540D"),": ",le.provider),s.createElement("p",null,(0,t.t)("\u9762\u677F\u540D"),": ",le.pluginPanelName))});const Be=Ee.render;return Be?s.createElement(Be,{panelInfo:le}):s.createElement(r.t,{text:(0,t.t)("\u63D2\u4EF6\u6E32\u67D3\u51FD\u6570\u4E0D\u5B58\u5728")})});l.displayName="GroupPluginPanel";var b=e(21506),N=e(29254),w=e(84143),h=e(7975),g=e(95850),B=e(93540),L=e(9021),F=e(55696),x=e(96136),G=e(79546),j=e(64917),Q=e(51052),z=e(6342),pe=e(89022),te=e.n(pe),K=e(28102),P=e.n(K),D=e(13546),d=e.n(D);const A=s.memo(ve=>{var le;const Ee=ve.groupId,Be=(0,t.iFL)(Ee),Te=(le=Be==null?void 0:Be.members)!=null?le:[],Le=(0,t.aoI)(Te.map(he=>he.userId)),[je]=(0,t.WHr)(Ee,[t.g3S.core.manageUser]),{hideGroupMemberDiscriminator:Je}=(0,t.r3q)(Be),{userInfos:W,searchText:ne,setSearchText:$,isSearching:Y,searchResult:q,generateActionMenu:ye}=(0,j.Q)(Ee),Pe=(0,s.useMemo)(()=>{const he=[],I=[];return W.forEach((U,T)=>{Le[T]===!0?he.push(U):I.push(U)}),{[(0,t.t)("\u5728\u7EBF")]:he,[(0,t.t)("\u79BB\u7EBF")]:I}},[W,Le]),{groupCounts:Re,groupNames:be,getGroupedMemberInfo:Ue}=(0,s.useMemo)(()=>{const he=Y?{"":q}:Pe,I=Object.values(he).map(fe=>fe.length),U=Object.keys(he);return{groupCounts:I,groupNames:U,getGroupedMemberInfo:(fe,_)=>{const Ce=U[_],xe=P()(te()(I,_)),ge=fe-xe;return d()(he,[Ce,ge],null)}}},[Y,q,Pe]);if(!Be)return s.createElement(r.t,null);if(W.length===0)return s.createElement(F.Z,null);const Ze=he=>{if(!he)return s.createElement("div",null);if(je){const I=ye(he);return s.createElement(x.Z,{key:he._id,trigger:["contextMenu"],menu:I},s.createElement("div",null,s.createElement(L.Q,{userId:he._id,popover:s.createElement(Q.Z,{userInfo:he}),hideDiscriminator:Je})))}else return s.createElement(L.Q,{key:he._id,userId:he._id,popover:s.createElement(Q.Z,{userInfo:he}),hideDiscriminator:Je})};return s.createElement("div",{className:"h-full flex flex-col"},s.createElement("div",{className:"p-2"},s.createElement(G.Z,{placeholder:(0,t.t)("\u641C\u7D22\u6210\u5458"),size:"large",suffix:s.createElement(B.JO,{fontSize:20,color:"grey",icon:"mdi:magnify"}),value:ne,onChange:he=>$(he.target.value)})),s.createElement("div",{className:"flex-1"},s.createElement(z.Px,{className:"h-full",groupCounts:Re,groupContent:he=>s.createElement("div",{className:"pt-4 px-2.5 font-bold text-sm text-opacity-80 bg-content-light dark:bg-content-dark"},be[he]," - ",Re[he]),itemContent:(he,I)=>Ze(Ue(he,I))})))});A.displayName="MembersPanel";var f=e(29188);function C(ve){const le=(0,t.IIz)(),Ee=(0,t.mWi)(ve,le??""),[Be]=(0,t.WHr)(ve,[t.g3S.core.message]),[Te,Le]=(0,s.useState)(void 0),je=(0,s.useCallback)(()=>{Le(Ee&&Ee?(0,t.t)("\u7981\u8A00\u4E2D, \u8FD8\u5269 {{remain}}",{remain:(0,t.TGs)(new Date().valueOf()-new Date(Ee).valueOf())}):void 0)},[Ee]);return(0,t.Yzt)(je,1e4),(0,s.useLayoutEffect)(()=>{je()},[Ee]),Be?{disabled:Boolean(Ee),placeholder:Te}:{disabled:!0,placeholder:(0,t.t)("\u6CA1\u6709\u53D1\u9001\u6D88\u606F\u7684\u6743\u9650, \u8BF7\u8054\u7CFB\u7FA4\u7EC4\u6240\u6709\u8005")}}const R=s.memo(({groupId:ve,panelId:le})=>{const Ee=(0,t.iFL)(ve),Be=(0,t.Tgq)(ve),Te=(0,t.wY6)(ve,le),{disabled:Le,placeholder:je}=C(ve),Je=(0,g.x)();return!Ee||!Te?null:s.createElement(f.q,{groupId:ve,panelId:le,prefixActions:()=>[...h.pluginPanelActions.filter(W=>W.position==="group").map(W=>s.createElement(w.a,{key:W.name,title:W.label,shape:"square",icon:W.icon,iconClassName:"text-2xl",onClick:()=>W.onClick({groupId:ve,panelId:le})}))],suffixActions:({setRightPanel:W})=>[s.createElement(w.a,{key:"members",title:(0,t.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>W({name:(0,t.t)("\u6210\u5458")+` (${Be.length})`,panel:s.createElement(A,{groupId:ve})})})]},s.createElement(N.x2,{users:Be.map(W=>({id:W._id,display:Je[W._id]?Je[W._id]:W.nickname})),panels:Ee.panels.filter(W=>W.type!==t.Xpe.GROUP).map(W=>({id:`/main/group/${ve}/${W.id}`,display:W.name})),disabled:Le,placeholder:je},s.createElement(b.r,{converseId:le,converseTitle:Te.name,isGroup:!0,groupId:ve})))});R.displayName="TextPanel";var ae=e(85478),J=e(95483),re=e(22215),de=Object.defineProperty,ee=Object.defineProperties,ce=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,ze=(ve,le,Ee)=>le in ve?de(ve,le,{enumerable:!0,configurable:!0,writable:!0,value:Ee}):ve[le]=Ee,He=(ve,le)=>{for(var Ee in le||(le={}))Ge.call(le,Ee)&&ze(ve,Ee,le[Ee]);if(Ae)for(var Ee of Ae(le))We.call(le,Ee)&&ze(ve,Ee,le[Ee]);return ve},$e=(ve,le)=>ee(ve,ce(le));function Xe(ve,le){const[Ee,Be]=(0,J.r)("groupLastVisitPanel");(0,s.useEffect)(()=>{Be($e(He({},Ee),{[ve]:le}))},[ve,le])}const Qe=s.memo(ve=>{const{groupId:le,panelId:Ee}=ve,Be=(0,t.iFL)(le),Te=(0,t.wY6)(le,Ee),Le=(0,s.useMemo)(()=>({groupId:le,panelId:Ee}),[le,Ee]);return Xe(le,Ee),Be===null?s.createElement(a.Z,{className:"w-full text-center",type:"error",message:(0,t.t)("\u7FA4\u7EC4\u4E0D\u5B58\u5728")}):Te===null?s.createElement(r.t,{text:(0,t.t)("\u9762\u677F\u4E0D\u5B58\u5728")}):Te.type===t.Xpe.TEXT?s.createElement(t.f4G,{groupInfo:Be},s.createElement(ae.x.Provider,{value:Le},s.createElement(R,{groupId:le,panelId:Te.id}))):Te.type===t.Xpe.PLUGIN?s.createElement(ae.x.Provider,{value:Le},s.createElement(l,{groupId:le,panelId:Te.id})):s.createElement(a.Z,{className:"w-full text-center",type:"error",message:(0,t.t)("\u672A\u77E5\u7684\u9762\u677F\u7C7B\u578B")})});Qe.displayName="GroupPanelRender";const Ye=s.memo(()=>{const{groupId:ve,panelId:le}=(0,re.PO)();return s.createElement(Qe,{groupId:ve,panelId:le})});Ye.displayName="GroupPanelRoute"},53937:(Ne,X,e)=>{e.d(X,{Z:()=>Je});var r=e(6739),n=e(14517),a=e(52983),s=e(72425),t=e(30831);const l=a.memo(W=>{const[ne,{save:$}]=(0,t.y$C)("pin-sizes",[90,10]),Y=q=>{$(q)};return a.createElement(s.Z,{className:(0,n.Z)("split",W.className),sizes:ne,minSize:250,expandToMin:!0,onDragEnd:Y},W.children)});l.displayName="SplitPanel";var b=e(50842),N=e(54782),w=e(12492),h=e(16131),g=e(14698),B=e.n(g),L=e(95483);const F=a.memo(()=>{const{groupId:W=""}=(0,N.useParams)(),ne=(0,N.useNavigate)(),[$]=(0,L.r)("groupLastVisitPanel"),Y=(0,t.ysv)($),q=(0,t.iFL)(W);return(0,a.useEffect)(()=>{var ye;if(!q||!Array.isArray(q==null?void 0:q.panels)||(q==null?void 0:q.panels.length)===0)return;const Pe=(ye=Y.current)==null?void 0:ye[q._id],Re=q.panels;if(Re.some(Ze=>Ze.id===Pe)){ne(`/main/group/${W}/${Pe}`,{replace:!0});return}const Ue=Re.find(Ze=>Ze.type!==t.Xpe.GROUP);B()(Ue)||ne(`/main/group/${W}/${Ue.id}`,{replace:!0})},[q]),null});F.displayName="GroupPanelRedirect";var x=e(6494),G=e.n(x),j=e(1348),Q=e(84208),z=e(39979),pe=e(40318),te=e(72297),K=e(59417),P=e.n(K);function D(W,ne){const $=(0,N.useLocation)(),Y=(0,a.useRef)(""),q=(0,t.ysv)(ne);(0,a.useEffect)(()=>{const{nav:ye}=(0,te.qp)($.search,{ignoreQueryPrefix:!0}),Pe=String(ye);Pe&&(Pe!==Y.current&&P()(Pe,W)&&q.current(Pe),Y.current=Pe)},[$.search])}var d=(W,ne,$)=>new Promise((Y,q)=>{var ye=be=>{try{Re($.next(be))}catch(Ue){q(Ue)}},Pe=be=>{try{Re($.throw(be))}catch(Ue){q(Ue)}},Re=be=>be.done?Y(be.value):Promise.resolve(be.value).then(ye,Pe);Re(($=$.apply(W,ne)).next())});function A(W){const ne=(0,t.GLd)(W),$=(0,N.useNavigate)(),Y=(0,a.useCallback)(()=>{const Pe=(0,Q.h7)(a.createElement(z.a,{groupId:W,onClose:()=>{(0,Q.Mr)(Pe)}}))},[W]),q=(0,a.useCallback)(()=>{(0,Q.h7)(a.createElement(pe.P,{groupId:W}))},[W]),ye=(0,a.useCallback)(()=>{(0,t.wp$)({message:ne?(0,t.t)("\u60A8\u662F\u7FA4\u7EC4\u7BA1\u7406\u8005\uFF0C\u9000\u51FA\u7FA4\u7EC4\u4F1A\u5BFC\u81F4\u89E3\u6563\u7FA4\u7EC4"):(0,t.t)("\u786E\u5B9A\u8981\u9000\u51FA\u7FA4\u7EC4\u4E48?"),onConfirm(){return d(this,null,function*(){yield(0,t.XV6)(W),$("/main",{replace:!0})})}})},[W,ne]);return D("group.*",Pe=>{Pe.startsWith("group.detail")&&Y()}),{handleShowGroupDetail:Y,handleInviteUser:q,handleQuitGroup:ye}}const f=a.memo(W=>{const{groupId:ne}=W,$=(0,t.iFL)(ne),{t:Y}=(0,t.$G7)(),[q,ye]=(0,t.WHr)(ne,[t.g3S.core.groupDetail,t.g3S.core.invite]),{handleShowGroupDetail:Pe,handleInviteUser:Re,handleQuitGroup:be}=A(ne);if(B()($))return null;const Ue={items:G()([q&&{key:"0",label:Y("\u67E5\u770B\u8BE6\u60C5"),onClick:Pe},ye&&{key:"1",label:Y("\u9080\u8BF7\u7528\u6237"),onClick:Re},{key:"2",label:Y("\u9000\u51FA\u7FA4\u7EC4"),danger:!0,onClick:be}])};return a.createElement(j.M,{menu:Ue,"data-testid":"group-header"},$==null?void 0:$.name)});f.displayName="GroupHeader";var C=e(93540);const R=a.memo(W=>{const[ne,$]=(0,a.useReducer)(Y=>!Y,!0);return a.createElement("div",null,a.createElement("div",{className:"flex items-center cursor-pointer py-1 text-xs",onClick:$},a.createElement(C.JO,{className:"mr-1",icon:"mdi:chevron-right",rotate:ne?45:0}),a.createElement("div",null,W.header)),a.createElement("div",{className:"transition-all overflow-hidden space-y-0.5 pl-2 ml-1 border-l-4 border-opacity-40",style:{maxHeight:ne?"var(--max-height)":0},ref:Y=>Y==null?void 0:Y.style.setProperty("--max-height",`${Y.scrollHeight}px`)},W.children))});R.displayName="GroupSection";var ae=e(10114),J=e(75283),re=e(58761),de=e(68e3),ee=e(10330),ce=Object.defineProperty,Ae=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,ze=(W,ne,$)=>ne in W?ce(W,ne,{enumerable:!0,configurable:!0,writable:!0,value:$}):W[ne]=$,He=(W,ne)=>{for(var $ in ne||(ne={}))Ge.call(ne,$)&&ze(W,$,ne[$]);if(Ae)for(var $ of Ae(ne))We.call(ne,$)&&ze(W,$,ne[$]);return W};const $e=a.memo(W=>{const{icon:ne,name:$,to:Y,dimmed:q=!1,badge:ye}=W,Re=(0,N.useLocation)().pathname.startsWith(Y);return a.createElement(ee.rU,{className:"block",to:Y},a.createElement("div",{className:(0,n.Z)("w-full hover:bg-black hover:bg-opacity-20 dark:hover:bg-white dark:hover:bg-opacity-20 cursor-pointer text-gray-900 dark:text-white rounded px-1 h-8 flex items-center text-base group",{"bg-black bg-opacity-20 dark:bg-white dark:bg-opacity-20":Re},q&&"text-opacity-40 dark:text-opacity-40")},a.createElement("div",{className:(0,n.Z)("flex items-center justify-center px-1 mr-1")},ne),a.createElement(J.Z.Text,{className:(0,n.Z)("flex-1 text-gray-900 dark:text-white",q&&"text-opacity-40 dark:text-opacity-40"),ellipsis:!0},$),a.createElement(re.Z,null,ye===!0&&a.createElement(de.Z,He({status:"error"},W.badgeProps)),W.extraBadge)))});$e.displayName="GroupPanelItem";var Xe=e(22215);const Qe=a.memo(W=>{var ne;const{groupId:$,panel:Y}=W,q=Y.id,ye=(0,t.EP)(q),Pe=(0,Xe.rF)($,q,(ne=Y.pluginPanelName)!=null?ne:""),{checkIsMuted:Re}=(0,t.OqL)(),be=Re(q,$);return a.createElement($e,{name:Y.name,icon:W.icon,to:`/main/group/${$}/${Y.id}`,dimmed:be,badge:ye,badgeProps:{status:be?"default":"error"},extraBadge:Pe})});Qe.displayName="GroupAckPanelItem";var Ye=e(96136),ve=e(86724),le=e.n(ve),Ee=e(103),Be=e(38887),Te=e(35633);const Le=a.memo(W=>{var ne;const{groupId:$,panel:Y}=W,q=Y.id,{hasOpenedPanel:ye,openPanelWindow:Pe}=(0,Ee.l)(`/panel/group/${$}/${q}`),Re=(0,t.iFL)($),be=(0,t.TL5)(),{markConverseAllAck:Ue}=(0,t.hoD)(q),Ze=(0,Xe.Sp)(Y),he=(0,Xe.rF)($,q,(ne=Y.pluginPanelName)!=null?ne:""),{checkIsMuted:I,toggleMute:U}=(0,t.OqL)();if(!Re)return a.createElement(Be.T,null);const T=(0,t.YQu)(Re.pinnedPanelId)&&Re.pinnedPanelId===q,fe={items:G()([{key:"copy",label:(0,t.t)("\u590D\u5236\u94FE\u63A5"),icon:a.createElement(C.JO,{icon:"mdi:content-copy"}),onClick:()=>{le()(`${location.origin}/main/group/${$}/${q}`),(0,t.lHp)((0,t.t)("\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F"))}},{key:"new",label:(0,t.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),icon:a.createElement(C.JO,{icon:"mdi:dock-window"}),disabled:ye,onClick:Pe},T?{key:"unpin",label:(0,t.t)("Unpin"),icon:a.createElement(C.JO,{icon:"mdi:pin-off"}),onClick:()=>{be(t.hyC.unpinGroupPanel({groupId:$}))}}:{key:"pin",label:(0,t.t)("Pin"),icon:a.createElement(C.JO,{icon:"mdi:pin"}),onClick:()=>{be(t.hyC.pinGroupPanel({groupId:$,panelId:q}))}},Y.type===t.Xpe.TEXT&&{key:"markAsRead",label:(0,t.t)("\u6807\u8BB0\u4E3A\u5DF2\u8BFB"),icon:a.createElement(C.JO,{icon:"mdi:message-badge-outline"}),onClick:Ue},Y.type===t.Xpe.TEXT&&{key:"mute",label:I(q,$)?(0,t.t)("\u53D6\u6D88\u514D\u6253\u6270"):(0,t.t)("\u514D\u6253\u6270"),icon:a.createElement(C.JO,{icon:"mdi:bell-off-outline"}),onClick:()=>U(q)},...Ze])},_=T?a.createElement(C.JO,{icon:"mdi:pin"}):a.createElement(C.JO,{icon:"mdi:pound"});return a.createElement(Ye.Z,{menu:fe,trigger:["contextMenu"]},a.createElement("div",null,(0,Te.Q)(Y)?a.createElement(Qe,{icon:_,groupId:$,panel:Y}):a.createElement($e,{name:Y.name,icon:_,to:`/main/group/${$}/${q}`,extraBadge:he})))});Le.displayName="SidebarItem";const je=a.memo(()=>{var W;const{groupId:ne=""}=(0,N.useParams)(),$=(0,t.iFL)(ne),Y=(W=$==null?void 0:$.panels)!=null?W:[];return a.createElement(ae.L,{"data-tc-role":"sidebar-group"},a.createElement(f,{groupId:ne}),a.createElement("div",{className:"p-2 space-y-1 overflow-auto"},Y.filter(q=>!(0,t.YQu)(q.parentId)).map(q=>q.type===t.Xpe.GROUP?a.createElement(R,{key:q.id,header:q.name},Y.filter(ye=>ye.parentId===q.id).map(ye=>a.createElement(Le,{key:ye.id,groupId:ne,panel:ye}))):a.createElement(Le,{key:q.id,groupId:ne,panel:q}))))});je.displayName="Sidebar";const Je=a.memo(()=>{const{groupId:W=""}=(0,N.useParams)(),ne=(0,t.iFL)(W);if(!ne)return a.createElement(r.t,{text:(0,t.t)("\u7FA4\u7EC4\u672A\u627E\u5230")});const $=ne.pinnedPanelId,Y=a.createElement(N.Routes,null,a.createElement(N.Route,{path:"/:panelId",element:a.createElement(h.x,null)}),a.createElement(N.Route,{path:"/",element:a.createElement(F,null)}));return a.createElement(b.A,{value:W},a.createElement(w.J,{"data-tc-role":"content-group",sidebar:a.createElement(je,null)},(0,t.YQu)($)?a.createElement(l,{className:"flex-auto w-full"},a.createElement("div",null,Y),a.createElement("div",null,a.createElement(h.E,{groupId:W,panelId:$}))):Y))});Je.displayName="Group"},12492:(Ne,X,e)=>{e.d(X,{J:()=>K});var r=e(52983),n=e(58935),a=e(14698),s=e.n(a),t=e(59270),l=e(89935),b=e(14517),N=e(67706),w=e(30831),h=Object.defineProperty,g=Object.defineProperties,B=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,G=(P,D,d)=>D in P?h(P,D,{enumerable:!0,configurable:!0,writable:!0,value:d}):P[D]=d,j=(P,D)=>{for(var d in D||(D={}))F.call(D,d)&&G(P,d,D[d]);if(L)for(var d of L(D))x.call(D,d)&&G(P,d,D[d]);return P},Q=(P,D)=>g(P,B(D)),z=(P,D)=>{var d={};for(var A in P)F.call(P,A)&&D.indexOf(A)<0&&(d[A]=P[A]);if(P!=null&&L)for(var A of L(P))D.indexOf(A)<0&&x.call(P,A)&&(d[A]=P[A]);return d};const pe=P=>{var D=P,{className:d,style:A,children:f}=D,C=z(D,["className","style","children"]);return r.createElement("div",Q(j({},C),{style:A,className:(0,b.Z)("flex flex-row flex-1 overflow-hidden relative",d)}),f)},te=r.memo(P=>{const{setShowSidebar:D}=(0,n.S)(),d=(0,t.useDrag)(A=>{const{swipe:f}=A,C=f[0];C>0?D(!0):C<0&&D(!1)},{axis:"x",swipe:{distance:5}});return r.createElement(pe,j({style:{touchAction:"pan-x"}},d()),P.children)});te.displayName="PageGestureWrapper";const K=r.memo(P=>{const{sidebar:D,children:d}=P,{showSidebar:A,setShowSidebar:f}=(0,n.S)(),C=(0,l.d)(),R=(0,r.useCallback)(ce=>{ce.stopPropagation(),ce.preventDefault(),f(!1)},[]);(0,w.qoQ)([C],()=>{C===!1&&f(!0)});const ae=s()(D)?null:r.createElement("div",{className:(0,b.Z)("bg-sidebar-light dark:bg-sidebar-dark flex-shrink-0 transition-width w-60")},P.sidebar),J=C===!0&&A===!0&&!s()(ae),re=J?r.createElement("div",{className:"absolute right-0 top-0 bottom-0 z-10",style:{width:"calc(100% - 15rem)"},onClick:R}):null,de=d,ee=r.createElement(N.S,null,ae,re,r.createElement("div",{className:(0,b.Z)("flex flex-auto bg-content-light dark:bg-content-dark overflow-hidden",C&&"transform left-0 w-full h-full absolute transition-transform",C&&{"translate-x-60":A,"translate-x-0":!A}),"data-tc-role":P["data-tc-role"]},r.createElement("div",{className:"tc-content-background"}),r.createElement("div",{className:(0,b.Z)("flex relative w-full",{"overflow-auto":!J,"overflow-hidden":J})},r.createElement(N.S,null,de))));return C?r.createElement(te,null,ee):r.createElement(pe,null,ee)});K.displayName="PageContent"},14231:(Ne,X,e)=>{e.d(X,{d:()=>P});var r=e(64939),n=e(21506),a=e(9021),s=e(52983),t=e(30831),l=e(712),b=e(6494),N=e.n(b),w=e(84208),h=e(75526),g=e(2945),B=(D,d,A)=>new Promise((f,C)=>{var R=re=>{try{J(A.next(re))}catch(de){C(de)}},ae=re=>{try{J(A.throw(re))}catch(de){C(de)}},J=re=>re.done?f(re.value):Promise.resolve(re.value).then(R,ae);J((A=A.apply(D,d)).next())});const L=s.memo(D=>{const{converseId:d,withoutUserIds:A=[]}=D,[f,C]=(0,s.useState)([]),[{loading:R},ae]=(0,t.ilX)(()=>B(void 0,null,function*(){yield(0,t.m8p)(d,[...f]),(0,w.Mr)()}),[d,f]);return s.createElement(w.AB,{title:(0,t.t)("\u9080\u8BF7\u597D\u53CB\u52A0\u5165\u4F1A\u8BDD")},s.createElement(g.B,{withoutUserIds:A,selectedIds:f,onChange:C}),s.createElement("div",{className:"text-right"},s.createElement(h.Z,{type:"primary",loading:R,onClick:ae},(0,t.t)("\u786E\u8BA4"))))});L.displayName="AppendDMConverseMembers";var F=e(103),x=e(87179),G=e(84143),j=e(7975),Q=e(50093);const z=s.memo(({converse:D})=>{const d=(0,t.Y84)(D);return(0,t.t)("\u4E0E {{name}} \u7684\u4F1A\u8BDD",{name:d})});z.displayName="ConversePanelTitle";const pe=s.memo(({members:D})=>s.createElement("div",null,D.map(d=>s.createElement(a.Q,{key:d,userId:d}))));pe.displayName="ConversePanelMembers";const te=s.memo(({converseId:D})=>{const d=(0,t.CGy)(ae=>ae.chat.converses[D]),{hasOpenedPanel:A,openPanelWindow:f,closePanelWindow:C}=(0,F.l)(`/panel/personal/converse/${D}`);if(A)return s.createElement(x.x,{onClosePanelWindow:C});const R=d&&s.createElement(z,{converse:d});return s.createElement(l.S,{header:R,actions:({setRightPanel:ae})=>d?N()([...j.pluginPanelActions.filter(J=>J.position==="dm").map(J=>s.createElement(G.a,{key:J.name,title:J.label,shape:"square",icon:J.icon,iconClassName:"text-2xl",onClick:()=>J.onClick({converseId:D})})),s.createElement(G.a,{key:"open",title:(0,t.t)("\u5728\u65B0\u7A97\u53E3\u6253\u5F00"),shape:"square",icon:"mdi:dock-window",iconClassName:"text-2xl",onClick:f}),d.members.length===2?s.createElement(G.a,{key:"create",title:(0,t.t)("\u521B\u5EFA\u4F1A\u8BDD"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,w.h7)(s.createElement(Q.m,{hiddenUserIds:d.members}))}):s.createElement(G.a,{key:"add",title:(0,t.t)("\u9080\u8BF7\u6210\u5458"),shape:"square",icon:"mdi:account-multiple-plus-outline",iconClassName:"text-2xl",onClick:()=>(0,w.h7)(s.createElement(L,{converseId:d._id,withoutUserIds:d.members}))}),d.members.length>2&&s.createElement(G.a,{key:"members",title:(0,t.t)("\u6210\u5458\u5217\u8868"),shape:"square",icon:"mdi:account-supervisor-outline",iconClassName:"text-2xl",onClick:()=>ae({name:(0,t.t)("\u6210\u5458")+` (${d.members.length})`,panel:s.createElement(pe,{members:d.members})})})]):[]},s.createElement(n.r,{converseId:D,converseTitle:R,isGroup:!1}))});te.displayName="ConversePanel";var K=e(54782);const P=s.memo(()=>{const D=(0,K.useParams)();return D.converseId?s.createElement(te,{converseId:D.converseId}):s.createElement(r.T,null)});P.displayName="PersonalConverse"},7364:(Ne,X,e)=>{e.d(X,{l:()=>G});var r=e(30831),n=e(52983),a=e(38887),s=e(21848),t=e(14698),l=e.n(t),b=e(54782),N=e(58935),w=e(442),h=e(5198),g=e(96857),B=e(6739),L=e(13893),F=(j,Q,z)=>new Promise((pe,te)=>{var K=d=>{try{D(z.next(d))}catch(A){te(A)}},P=d=>{try{D(z.throw(d))}catch(A){te(A)}},D=d=>d.done?pe(d.value):Promise.resolve(d.value).then(K,P);D((z=z.apply(j,Q)).next())});function x(){const j=(0,b.useNavigate)(),{value:Q,loading:z,error:pe}=(0,r.r53)(()=>F(this,null,function*(){let P;try{P=yield(0,s.gP)()}catch(A){j(`/entry/login?redirect=${encodeURIComponent(location.pathname)}`,{replace:!0});return}const D=(0,r.vIP)();D.dispatch(r.hIH.setUserInfo(P)),(0,h._3)(D);const d=yield(0,r.Tzh)(P.token);return(0,h.Kj)(d),(0,r.cUn)(d,D),{store:D,socket:d}}),[]),te=Q==null?void 0:Q.store,K=Q==null?void 0:Q.socket;return{loading:z,store:te,socket:K,error:pe}}const G=n.memo(j=>{const{loading:Q,store:z,error:pe,socket:te}=x();return Q?n.createElement("div",{className:"fixed inset-0 flex items-center justify-center bg-content-light dark:bg-content-dark text-gray-700 dark:text-white text-xl"},n.createElement(a.T,{tip:(0,r.t)("\u6B63\u5728\u8FDE\u63A5\u5230\u804A\u5929\u670D\u52A1\u5668...")})):pe?(console.error("[MainProvider]",pe),n.createElement("div",null,pe.message)):l()(z)?n.createElement(B.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Store \u521B\u5EFA\u5931\u8D25")}):l()(te)?n.createElement(B.t,{text:(0,r.t)("\u51FA\u73B0\u5F02\u5E38, Socket \u521B\u5EFA\u5931\u8D25")}):n.createElement(r.m$Z,{store:z},n.createElement(g.Z,{socket:te},n.createElement(N.f,null,n.createElement(L.L,null,n.createElement(w.$2,null,j.children)))))});G.displayName="MainProvider"},58935:(Ne,X,e)=>{e.d(X,{S:()=>l,f:()=>t});var r=e(52983),n=e(71607),a=e.n(n);const s=r.createContext({showSidebar:!0,switchSidebar:a(),setShowSidebar:a()});s.displayName="SidebarContext";const t=r.memo(b=>{const[N,w]=(0,r.useState)(!0),h=(0,r.useCallback)(()=>{w(!N)},[N]);return r.createElement(s.Provider,{value:{showSidebar:N,switchSidebar:h,setShowSidebar:w}},b.children)});t.displayName="SidebarContextProvider";function l(){return(0,r.useContext)(s)}},35633:(Ne,X,e)=>{e.d(X,{Q:()=>a});var r=e(30831),n=e(89889);function a(s){var t,l;if(s.type===r.Xpe.TEXT)return!0;if(s.type===r.Xpe.PLUGIN){const b=(0,n.S)(s.name);return(l=(t=b==null?void 0:b.feature)==null?void 0:t.includes("ack"))!=null?l:!1}return!1}},64750:(Ne,X,e)=>{e.d(X,{$:()=>a,Hi:()=>s,dq:()=>l,er:()=>t,rR:()=>n});var r=e(79172);const n=(0,r.P6)("enter"),a=(0,r.P6)("esc"),s=(0,r.P6)("mod+k"),t=(0,r.P6)("up"),l=(0,r.P6)("down")},83996:(Ne,X,e)=>{e.d(X,{f:()=>s,w:()=>t});var r=e(30831),n=(l,b,N)=>new Promise((w,h)=>{var g=F=>{try{L(N.next(F))}catch(x){h(x)}},B=F=>{try{L(N.throw(F))}catch(x){h(x)}},L=F=>F.done?w(F.value):Promise.resolve(F.value).then(g,B);L((N=N.apply(l,b)).next())});function a(l){return n(this,null,function*(){const b=document.createElement("img");return new Promise((N,w)=>{b.onload=()=>N(b),b.onerror=w,b.src=(0,r.Awg)(l),b.crossOrigin="Anonymous"})})}function s(l){return n(this,null,function*(){const b=yield a(l),N=document.createElement("canvas");N.width=b.width,N.height=b.height;const w=N.getContext("2d");if(!w)return{r:0,g:0,b:0,a:0};w.drawImage(b,0,0,N.width,N.height);const h=w.getImageData(0,0,N.width,N.height);let g=0,B=0,L=0,F=0;for(let G=0;G<h.height;G++)for(let j=0;j<h.width;j++)g+=h.data[(h.width*G+j)*4],B+=h.data[(h.width*G+j)*4+1],L+=h.data[(h.width*G+j)*4+2],F+=h.data[(h.width*G+j)*4+3];const x=h.width*h.height;return g=Math.round(g/x),B=Math.round(B/x),L=Math.round(L/x),F=Math.round(F/x),{r:g,g:B,b:L,a:F}})}function t(l){return!["image/gif"].includes(l)}},21848:(Ne,X,e)=>{e.d(X,{JM:()=>h,gP:()=>w,rU:()=>b});var r=e(30831),n=e(14698),a=e.n(n),s=e(87450),t=(g,B,L)=>new Promise((F,x)=>{var G=z=>{try{Q(L.next(z))}catch(pe){x(pe)}},j=z=>{try{Q(L.throw(z))}catch(pe){x(pe)}},Q=z=>z.done?F(z.value):Promise.resolve(z.value).then(G,j);Q((L=L.apply(g,B)).next())});let l=null;function b(g){l=g}function N(){return l}function w(){return t(this,null,function*(){let g=N();if(a()(g)){const B=yield(0,s.pT)();if(typeof B!="string")throw new Error("Token \u683C\u5F0F\u4E0D\u5408\u6CD5");if(console.debug("\u6B63\u5728\u5C1D\u8BD5\u4F7F\u7528Token\u767B\u5F55"),g=yield r.o4J.EA.loginWithToken(B),g===null)throw new Error("Token \u5185\u5BB9\u4E0D\u5408\u6CD5");b(g)}return g})}function h(g){if(typeof g!="string")return!0;const B=g.split("@")[1];return!!(!B||B.endsWith(".msgbyte.com"))}}}]);
